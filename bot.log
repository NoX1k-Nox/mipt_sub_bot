2025-06-12 18:54:51,537 - __main__ - INFO - Starting bot...
2025-06-12 18:54:51,591 - __main__ - INFO - Routers and middleware included
2025-06-12 18:54:51,592 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-12 18:54:51,595 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-12 18:54:51,596 - apscheduler.scheduler - INFO - Scheduler started
2025-06-12 18:54:51,596 - scheduler - INFO - Scheduler set up
2025-06-12 18:54:51,596 - aiogram.dispatcher - INFO - Start polling
2025-06-12 18:54:52,042 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-12 18:55:55,964 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-12 18:55:56,403 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-12 18:55:56,403 - aiogram.event - INFO - Update id=449602517 is handled. Duration 439 ms by bot id=7921957055
2025-06-12 18:55:57,909 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-12 18:55:58,892 - bot.handlers.payments - ERROR - Error creating payment for user 435204858: name 'get_reminder_keyboard' is not defined
2025-06-12 18:55:59,401 - aiogram.event - INFO - Update id=449602518 is handled. Duration 1493 ms by bot id=7921957055
2025-06-12 18:57:12,391 - __main__ - INFO - Starting bot...
2025-06-12 18:57:12,451 - __main__ - INFO - Routers and middleware included
2025-06-12 18:57:12,452 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-12 18:57:12,455 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-12 18:57:12,455 - apscheduler.scheduler - INFO - Scheduler started
2025-06-12 18:57:12,455 - scheduler - INFO - Scheduler set up
2025-06-12 18:57:12,456 - aiogram.dispatcher - INFO - Start polling
2025-06-12 18:57:12,871 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-12 18:57:52,055 - __main__ - INFO - Starting bot...
2025-06-12 18:57:52,109 - __main__ - INFO - Routers and middleware included
2025-06-12 18:57:52,110 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-12 18:57:52,113 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-12 18:57:52,113 - apscheduler.scheduler - INFO - Scheduler started
2025-06-12 18:57:52,113 - scheduler - INFO - Scheduler set up
2025-06-12 18:57:52,113 - aiogram.dispatcher - INFO - Start polling
2025-06-12 18:57:52,494 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-12 18:57:57,887 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-12 18:57:58,558 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-12 18:57:58,558 - aiogram.event - INFO - Update id=449602519 is handled. Duration 671 ms by bot id=7921957055
2025-06-12 18:58:00,042 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-12 18:58:00,964 - bot.handlers.payments - INFO - Sent payment link ef094a87-3b6c-42e3-a698-50820e6a6a06 to user 435204858
2025-06-12 18:58:01,144 - aiogram.event - INFO - Update id=449602520 is handled. Duration 1104 ms by bot id=7921957055
2025-06-12 19:03:51,133 - __main__ - INFO - Starting bot...
2025-06-12 19:03:51,393 - __main__ - INFO - Routers and middleware included
2025-06-12 19:03:51,393 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-12 19:03:51,396 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-12 19:03:51,401 - apscheduler.scheduler - INFO - Scheduler started
2025-06-12 19:03:51,401 - scheduler - INFO - Scheduler set up
2025-06-12 19:03:51,402 - aiogram.dispatcher - INFO - Start polling
2025-06-12 19:03:51,853 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-13 00:45:55,204 - __main__ - INFO - Starting bot...
2025-06-13 00:45:55,258 - __main__ - INFO - Routers and middleware included
2025-06-13 00:45:55,259 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 00:45:55,262 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 00:45:55,262 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 00:45:55,263 - scheduler - INFO - Scheduler set up
2025-06-13 00:45:55,263 - aiogram.dispatcher - INFO - Start polling
2025-06-13 00:45:55,668 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-13 00:48:16,687 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-13 00:48:17,109 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-13 00:48:17,109 - aiogram.event - INFO - Update id=449602521 is handled. Duration 423 ms by bot id=7921957055
2025-06-13 00:48:24,605 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-13 00:48:25,792 - bot.handlers.payments - INFO - Sent payment link cb4a0d84-8955-44fd-8353-0aa81e2487f2 to user 435204858
2025-06-13 00:48:25,886 - aiogram.event - INFO - Update id=449602522 is handled. Duration 1282 ms by bot id=7921957055
2025-06-13 16:04:27,829 - __main__ - INFO - Starting bot...
2025-06-13 16:04:27,870 - __main__ - INFO - Routers and middleware included
2025-06-13 16:04:27,870 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 16:04:27,872 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 16:04:27,872 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 16:04:27,872 - scheduler - INFO - Scheduler set up
2025-06-13 16:04:27,873 - aiogram.dispatcher - INFO - Start polling
2025-06-13 16:04:28,208 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-13 16:04:46,522 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-13 16:04:47,088 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-13 16:04:47,088 - aiogram.event - INFO - Update id=449602547 is handled. Duration 566 ms by bot id=7921957055
2025-06-13 16:05:56,315 - __main__ - INFO - Starting bot...
2025-06-13 16:05:56,358 - __main__ - INFO - Routers and middleware included
2025-06-13 16:05:56,359 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 16:05:56,360 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 16:05:56,360 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 16:05:56,360 - scheduler - INFO - Scheduler set up
2025-06-13 16:05:56,360 - aiogram.dispatcher - INFO - Start polling
2025-06-13 16:05:56,785 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-13 16:06:04,699 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-13 16:06:05,174 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-13 16:06:05,174 - aiogram.event - INFO - Update id=449602548 is handled. Duration 475 ms by bot id=7921957055
2025-06-13 16:07:12,913 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-13 16:07:13,318 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-13 16:07:13,319 - aiogram.event - INFO - Update id=449602549 is handled. Duration 405 ms by bot id=7921957055
2025-06-13 16:07:49,568 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-13 16:07:50,333 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-13 16:07:50,333 - aiogram.event - INFO - Update id=449602550 is handled. Duration 765 ms by bot id=7921957055
2025-06-13 16:07:50,562 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-13 16:07:50,888 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-13 16:07:50,888 - aiogram.event - INFO - Update id=449602551 is handled. Duration 325 ms by bot id=7921957055
2025-06-13 16:25:45,327 - __main__ - INFO - Starting bot...
2025-06-13 16:25:45,375 - __main__ - INFO - Routers and middleware included
2025-06-13 16:25:45,375 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 16:25:45,377 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 16:25:45,378 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 16:25:45,378 - scheduler - INFO - Scheduler set up
2025-06-13 16:25:45,378 - aiogram.dispatcher - INFO - Start polling
2025-06-13 16:25:45,757 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-13 16:26:05,206 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-13 16:26:05,841 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-13 16:26:05,842 - aiogram.event - INFO - Update id=449602552 is handled. Duration 636 ms by bot id=7921957055
2025-06-13 16:26:16,084 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-13 16:26:16,621 - bot.handlers.payments - INFO - Sent payment link ca25d6b2-e3f6-4e2a-a4ec-105824ae5c5c to user 435204858
2025-06-13 16:26:16,715 - aiogram.event - INFO - Update id=449602553 is handled. Duration 632 ms by bot id=7921957055
2025-06-13 16:26:22,502 - aiogram.event - INFO - Update id=449602554 is not handled. Duration 2 ms by bot id=7921957055
2025-06-13 16:27:00,714 - __main__ - INFO - Starting bot...
2025-06-13 16:27:00,753 - __main__ - INFO - Routers and middleware included
2025-06-13 16:27:00,753 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 16:27:00,756 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 16:27:00,756 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 16:27:00,756 - scheduler - INFO - Scheduler set up
2025-06-13 16:27:00,757 - aiogram.dispatcher - INFO - Start polling
2025-06-13 16:27:01,272 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-13 16:27:13,779 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-13 16:27:14,388 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-13 16:27:14,388 - aiogram.event - INFO - Update id=449602555 is handled. Duration 609 ms by bot id=7921957055
2025-06-13 16:27:18,182 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-13 16:27:19,035 - bot.handlers.payments - INFO - Sent payment link 6f5b326b-442a-45cc-8f44-613fa0a6ab8e to user 435204858
2025-06-13 16:27:19,215 - aiogram.event - INFO - Update id=449602556 is handled. Duration 1034 ms by bot id=7921957055
2025-06-14 00:37:41,509 - __main__ - INFO - Starting bot...
2025-06-14 00:37:41,560 - __main__ - INFO - Routers and middleware included
2025-06-14 00:37:41,561 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 00:37:41,564 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 00:37:41,564 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 00:37:41,564 - scheduler - INFO - Scheduler set up
2025-06-14 00:37:41,564 - aiogram.dispatcher - INFO - Start polling
2025-06-14 00:37:41,904 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-14 00:38:15,477 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 00:38:16,491 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 00:38:16,491 - aiogram.event - INFO - Update id=449602557 is handled. Duration 1015 ms by bot id=7921957055
2025-06-14 00:38:21,572 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 00:38:22,480 - bot.handlers.payments - INFO - Sent payment link 45933161-d675-47cc-a090-126bd23fe149 to user 435204858
2025-06-14 00:38:22,696 - aiogram.event - INFO - Update id=449602558 is handled. Duration 1124 ms by bot id=7921957055
2025-06-14 00:38:36,633 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976b3a-f9cd-7939-b493-140d4f466e07', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 00:38:36,752 - aiogram.event - INFO - Update id=449602559 is handled. Duration 404 ms by bot id=7921957055
2025-06-14 00:38:51,199 - bot.handlers.payments - INFO - Checking payment for user 435204858
2025-06-14 00:38:51,576 - bot.handlers.payments - ERROR - Error checking payment for user 435204858: {'type': 'error', 'id': '01976b3b-342d-7d87-83ec-30cf395c1488', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 00:38:51,751 - aiogram.event - INFO - Update id=449602560 is handled. Duration 554 ms by bot id=7921957055
2025-06-14 00:39:26,841 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 00:39:29,940 - bot.handlers.payments - INFO - Sent payment link 94e77f2a-2958-4e9b-a5eb-a9c7eb123514 to user 435204858
2025-06-14 00:39:30,038 - aiogram.event - INFO - Update id=449602561 is handled. Duration 3199 ms by bot id=7921957055
2025-06-14 00:39:37,176 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976b3b-e656-7347-b3a8-3bd5fab5cdf2', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 00:39:37,386 - aiogram.event - INFO - Update id=449602562 is handled. Duration 608 ms by bot id=7921957055
2025-06-14 00:43:55,455 - __main__ - INFO - Starting bot...
2025-06-14 00:43:55,507 - __main__ - INFO - Routers and middleware included
2025-06-14 00:43:55,508 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 00:43:55,510 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 00:43:55,511 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 00:43:55,511 - scheduler - INFO - Scheduler set up
2025-06-14 00:43:55,511 - aiogram.dispatcher - INFO - Start polling
2025-06-14 00:43:57,149 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-14 00:44:05,813 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 00:44:06,335 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 00:44:06,336 - aiogram.event - INFO - Update id=449602563 is handled. Duration 523 ms by bot id=7921957055
2025-06-14 00:44:16,005 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-14 00:44:16,298 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-14 00:44:16,299 - aiogram.event - INFO - Update id=449602564 is handled. Duration 296 ms by bot id=7921957055
2025-06-14 00:44:20,321 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-14 00:44:20,327 - dao.user_dao - INFO - Created user 435204858
2025-06-14 00:44:20,789 - aiogram.event - INFO - Update id=449602565 is handled. Duration 469 ms by bot id=7921957055
2025-06-14 00:44:28,722 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 00:44:29,357 - bot.handlers.payments - INFO - Sent payment link 1161be70-7c6e-4807-a604-43bd5d9b0a23 to user 435204858
2025-06-14 00:44:29,468 - aiogram.event - INFO - Update id=449602566 is handled. Duration 747 ms by bot id=7921957055
2025-06-14 00:52:45,133 - aiogram.dispatcher - WARNING - Received SIGINT signal
2025-06-14 00:52:45,138 - aiogram.dispatcher - INFO - Polling stopped for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-14 00:52:45,139 - aiogram.dispatcher - INFO - Polling stopped
2025-06-14 01:02:02,619 - __main__ - INFO - Starting bot...
2025-06-14 01:02:02,744 - __main__ - INFO - Routers and middleware included
2025-06-14 01:02:02,744 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 01:02:02,748 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 01:02:02,748 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 01:02:02,749 - scheduler - INFO - Scheduler set up
2025-06-14 01:02:02,749 - aiogram.dispatcher - INFO - Start polling
2025-06-14 01:02:03,107 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-14 01:02:14,746 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 01:02:15,170 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 01:02:15,170 - aiogram.event - INFO - Update id=449602567 is handled. Duration 424 ms by bot id=7921957055
2025-06-14 01:02:18,244 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 01:02:18,988 - bot.handlers.payments - INFO - Sent payment link b1d6a854-32ed-46a8-9a1a-cff1ff1b8711 to user 435204858
2025-06-14 01:02:19,086 - aiogram.event - INFO - Update id=449602568 is handled. Duration 843 ms by bot id=7921957055
2025-06-14 01:02:33,774 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976b50-e714-7806-8394-2a696600831d', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 01:02:33,888 - aiogram.event - INFO - Update id=449602569 is handled. Duration 568 ms by bot id=7921957055
2025-06-14 01:09:03,917 - __main__ - INFO - Starting bot...
2025-06-14 01:09:03,972 - __main__ - INFO - Routers and middleware included
2025-06-14 01:09:03,973 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 01:09:03,976 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 01:09:03,976 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 01:09:03,977 - scheduler - INFO - Scheduler set up
2025-06-14 01:09:03,977 - aiogram.dispatcher - INFO - Start polling
2025-06-14 01:09:04,453 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-14 01:09:30,695 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 01:09:31,068 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 01:09:31,068 - aiogram.event - INFO - Update id=449602570 is handled. Duration 374 ms by bot id=7921957055
2025-06-14 01:09:32,410 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 01:09:33,246 - bot.handlers.payments - INFO - Sent payment link ba611b07-3ae1-405c-81b3-a2f504de2d2e to user 435204858
2025-06-14 01:09:33,426 - aiogram.event - INFO - Update id=449602571 is handled. Duration 1017 ms by bot id=7921957055
2025-06-14 01:09:41,090 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976b57-6cac-70aa-a213-1d3c9e15b054', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 01:09:41,286 - aiogram.event - INFO - Update id=449602572 is handled. Duration 685 ms by bot id=7921957055
2025-06-13 22:42:13,661 - __main__ - INFO - Starting bot...
2025-06-13 22:42:13,670 - __main__ - INFO - Routers and middleware included
2025-06-13 22:42:13,670 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 22:42:13,671 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 22:42:13,671 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 22:42:13,672 - scheduler - INFO - Scheduler set up
2025-06-13 22:42:13,672 - aiogram.dispatcher - INFO - Start polling
2025-06-13 22:42:13,858 - aiogram.dispatcher - INFO - Run polling for bot @MIPTPAYBot id=7921957055 - 'Членство Физтех-Союз'
2025-06-13 22:42:30,957 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-13 22:42:31,069 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-13 22:42:31,069 - aiogram.event - INFO - Update id=449602576 is handled. Duration 112 ms by bot id=7921957055
2025-06-13 22:42:36,733 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-13 22:42:36,860 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-13 22:42:36,861 - aiogram.event - INFO - Update id=449602577 is handled. Duration 132 ms by bot id=7921957055
2025-06-13 22:42:38,512 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-13 22:42:38,604 - dao.user_dao - INFO - Retrieved 3 users
2025-06-13 22:42:38,612 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-13 22:42:38,612 - dao.user_dao - INFO - Created user 435204858
2025-06-13 22:42:38,679 - aiogram.event - INFO - Update id=449602578 is handled. Duration 168 ms by bot id=7921957055
2025-06-13 22:56:04,758 - __main__ - INFO - Starting bot...
2025-06-13 22:56:04,768 - __main__ - INFO - Routers and middleware included
2025-06-13 22:56:04,769 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 22:56:04,770 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 22:56:04,770 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 22:56:04,770 - scheduler - INFO - Scheduler set up
2025-06-13 22:58:35,370 - __main__ - INFO - Starting bot...
2025-06-13 22:58:35,384 - __main__ - INFO - Routers and middleware included
2025-06-13 22:58:35,385 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 22:58:35,386 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 22:58:35,386 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 22:58:35,386 - scheduler - INFO - Scheduler set up
2025-06-13 22:58:35,673 - asyncio - ERROR - Task was destroyed but it is pending!
task: <Task cancelling name='Task-2' coro=<_run_app() running at /home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiohttp/web.py:301> cb=[gather.<locals>._done_callback() at /usr/lib/python3.11/asyncio/tasks.py:764]>
2025-06-13 23:11:01,696 - __main__ - INFO - Starting bot...
2025-06-13 23:11:01,696 - __main__ - INFO - Routers and middleware included
2025-06-13 23:11:01,697 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-13 23:11:01,697 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-13 23:11:01,698 - apscheduler.scheduler - INFO - Scheduler started
2025-06-13 23:11:01,698 - scheduler - INFO - Scheduler set up
2025-06-14 01:54:51,634 - __main__ - INFO - Starting bot...
2025-06-14 01:54:51,636 - __main__ - INFO - Routers and middleware included
2025-06-14 01:54:51,636 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 01:54:51,637 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 01:54:51,637 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 01:54:51,637 - scheduler - INFO - Scheduler set up
2025-06-14 02:02:10,327 - __main__ - INFO - Starting bot...
2025-06-14 02:02:10,327 - __main__ - INFO - Routers and middleware included
2025-06-14 02:02:10,327 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 02:02:10,328 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 02:02:10,328 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 02:02:10,328 - scheduler - INFO - Scheduler set up
2025-06-14 02:03:34,947 - __main__ - INFO - Starting bot...
2025-06-14 02:03:34,947 - __main__ - INFO - Routers and middleware included
2025-06-14 02:03:34,948 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 02:03:34,948 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 02:03:34,949 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 02:03:34,949 - scheduler - INFO - Scheduler set up
2025-06-14 02:05:17,672 - __main__ - INFO - Starting bot...
2025-06-14 02:05:17,673 - __main__ - INFO - Routers and middleware included
2025-06-14 02:05:17,673 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 02:05:17,674 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 02:05:17,674 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 02:05:17,674 - scheduler - INFO - Scheduler set up
2025-06-14 02:05:17,729 - __main__ - INFO - Webhook set to https://185.223.93.139:8443/7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM
2025-06-14 02:05:17,897 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f1475b22090>
2025-06-14 02:05:17,898 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f1475a8bcb0>, 93787.787821468)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f147874a690>
2025-06-14 02:20:42,014 - __main__ - INFO - Starting bot...
2025-06-14 02:20:42,014 - __main__ - INFO - Routers and middleware included
2025-06-14 02:20:42,014 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 02:20:42,015 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 02:20:42,015 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 02:20:42,015 - scheduler - INFO - Scheduler set up
2025-06-14 02:20:42,214 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f7e0a1dd810>
2025-06-14 02:20:42,215 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f7e0a14bcb0>, 94712.094893586)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f7e0cb17e10>
2025-06-14 02:25:02,017 - __main__ - INFO - Starting bot...
2025-06-14 02:25:02,017 - __main__ - INFO - Routers and middleware included
2025-06-14 02:25:02,017 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 02:25:02,018 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 02:25:02,018 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 02:25:02,018 - scheduler - INFO - Scheduler set up
2025-06-14 02:25:02,062 - __main__ - INFO - Webhook set to https://185.223.93.139:8443/7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM
2025-06-14 02:37:14,920 - __main__ - INFO - Starting bot...
2025-06-14 02:37:14,920 - __main__ - INFO - Routers and middleware included
2025-06-14 02:37:14,920 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 02:37:14,921 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 02:37:14,921 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 02:37:14,921 - scheduler - INFO - Scheduler set up
2025-06-14 02:37:14,965 - __main__ - INFO - Webhook set to https://185.223.93.139:8443/MIPTPAYBot
2025-06-14 03:38:15,510 - __main__ - INFO - Starting bot...
2025-06-14 03:38:15,511 - __main__ - INFO - Routers and middleware included
2025-06-14 03:38:15,511 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 03:38:15,512 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 03:38:15,512 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 03:38:15,512 - scheduler - INFO - Scheduler set up
2025-06-14 03:38:15,533 - __main__ - INFO - Webhook set to https://185.223.93.139:8443/7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM
2025-06-14 04:00:27,927 - __main__ - INFO - Starting bot...
2025-06-14 04:00:27,927 - __main__ - INFO - Routers and middleware included
2025-06-14 04:00:27,928 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 04:00:27,929 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 04:00:27,929 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 04:00:27,929 - scheduler - INFO - Scheduler set up
2025-06-14 04:00:27,979 - __main__ - INFO - Webhook set to https://0f46-185-223-93-139.ngrok-free.app/7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM
2025-06-14 04:00:27,980 - __main__ - ERROR - Failed to start web server: [Errno 98] error while attempting to bind on address ('0.0.0.0', 8443): address already in use
2025-06-14 04:00:28,074 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f06d0409d50>
2025-06-14 04:00:28,075 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f06d0377cb0>, 100698.038227113)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f06d2c9ad90>
2025-06-14 04:05:26,578 - __main__ - INFO - Starting bot...
2025-06-14 04:05:26,578 - __main__ - INFO - Routers and middleware included
2025-06-14 04:05:26,579 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 04:05:26,579 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 04:05:26,580 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 04:05:26,580 - scheduler - INFO - Scheduler set up
2025-06-14 04:05:26,614 - __main__ - INFO - Webhook set successfully
2025-06-14 04:05:26,615 - __main__ - INFO - Web server started on port 8443
2025-06-14 04:05:48,662 - __main__ - INFO - Received webhook request: {"update_id":449602582,
"message":{"message_id":1454,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749873948,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:05:48,681 - __main__ - ERROR - Error processing webhook: Dispatcher.feed_webhook_update() missing 1 required positional argument: 'bot'
2025-06-14 04:05:48,682 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:05:48 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 500 177 "-" "-"
2025-06-14 04:05:48,697 - __main__ - INFO - Received webhook request: {"update_id":449602582,
"message":{"message_id":1454,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749873948,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:05:48,701 - __main__ - ERROR - Error processing webhook: Dispatcher.feed_webhook_update() missing 1 required positional argument: 'bot'
2025-06-14 04:05:48,701 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:05:48 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 500 177 "-" "-"
2025-06-14 04:05:50,717 - __main__ - INFO - Received webhook request: {"update_id":449602582,
"message":{"message_id":1454,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749873948,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:05:50,728 - __main__ - ERROR - Error processing webhook: Dispatcher.feed_webhook_update() missing 1 required positional argument: 'bot'
2025-06-14 04:05:50,728 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:05:50 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 500 177 "-" "-"
2025-06-14 04:05:54,744 - __main__ - INFO - Received webhook request: {"update_id":449602582,
"message":{"message_id":1454,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749873948,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:05:54,748 - __main__ - ERROR - Error processing webhook: Dispatcher.feed_webhook_update() missing 1 required positional argument: 'bot'
2025-06-14 04:05:54,749 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:05:54 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 500 177 "-" "-"
2025-06-14 04:06:02,765 - __main__ - INFO - Received webhook request: {"update_id":449602582,
"message":{"message_id":1454,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749873948,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:06:02,769 - __main__ - ERROR - Error processing webhook: Dispatcher.feed_webhook_update() missing 1 required positional argument: 'bot'
2025-06-14 04:06:02,769 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:06:02 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 500 177 "-" "-"
2025-06-14 04:12:10,063 - __main__ - INFO - Starting bot...
2025-06-14 04:12:10,064 - __main__ - INFO - Routers and middleware included
2025-06-14 04:12:10,064 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 04:12:10,065 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 04:12:10,065 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 04:12:10,065 - scheduler - INFO - Scheduler set up
2025-06-14 04:12:10,101 - __main__ - INFO - Webhook set successfully
2025-06-14 04:12:10,102 - __main__ - INFO - Web server started on port 8443
2025-06-14 04:12:32,494 - __main__ - INFO - Bot stopped by user
2025-06-14 04:12:32,587 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fa96d2e21d0>
2025-06-14 04:13:49,279 - __main__ - INFO - Starting bot...
2025-06-14 04:13:49,279 - __main__ - INFO - Routers and middleware included
2025-06-14 04:13:49,280 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 04:13:49,280 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 04:13:49,280 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 04:13:49,281 - scheduler - INFO - Scheduler set up
2025-06-14 04:13:49,296 - __main__ - INFO - Webhook set successfully
2025-06-14 04:13:49,296 - __main__ - INFO - Web server started on port 8443
2025-06-14 04:14:05,104 - __main__ - INFO - Received webhook request: {"update_id":449602583,
"message":{"message_id":1455,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874445,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:14:05,105 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 04:14:05,412 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 04:14:05,413 - aiogram.event - INFO - Update id=449602583 is handled. Duration 308 ms by bot id=7921957055
2025-06-14 04:14:05,414 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:14:05 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:14:10,520 - __main__ - INFO - Received webhook request: {"update_id":449602584,
"callback_query":{"id":"1869190633459228171","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1456,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874445,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 04:14:10,522 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 04:14:11,036 - bot.handlers.payments - INFO - Sent payment link 7522ad90-7445-48e8-96c8-992e9741cde7 to user 435204858
2025-06-14 04:14:11,058 - aiogram.event - INFO - Update id=449602584 is handled. Duration 536 ms by bot id=7921957055
2025-06-14 04:14:11,058 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:14:10 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:14:18,678 - __main__ - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf0ad2-000f-5001-9000-10097d807851",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf0ad2-000f-5001-9000-10097d807851",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T04:14:18.172Z",
    "created_at" : "2025-06-14T04:14:10.888Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "7522ad90-7445-48e8-96c8-992e9741cde7"
    }
  }
}
2025-06-14 04:14:18,679 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:14:18 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 04:14:30,070 - __main__ - INFO - Received webhook request: {"update_id":449602585,
"message":{"message_id":1458,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874470,"text":"/start payment_success_7522ad90-7445-48e8-96c8-992e9741cde7","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:14:30,232 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976ca5-6d3b-759c-87a2-a2180d65bfa6', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 04:14:30,268 - aiogram.event - INFO - Update id=449602585 is handled. Duration 196 ms by bot id=7921957055
2025-06-14 04:14:30,268 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:14:30 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:14:44,142 - __main__ - INFO - Received webhook request: {"update_id":449602586,
"message":{"message_id":1460,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874484,"text":"/check_payment","entities":[{"offset":0,"length":14,"type":"bot_command"}]}}
2025-06-14 04:14:44,145 - bot.handlers.payments - INFO - Checking payment for user 435204858
2025-06-14 04:14:44,304 - bot.handlers.payments - ERROR - Error checking payment for user 435204858: {'type': 'error', 'id': '01976ca5-a433-7deb-9190-b585b0fb580a', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 04:14:44,327 - aiogram.event - INFO - Update id=449602586 is handled. Duration 183 ms by bot id=7921957055
2025-06-14 04:14:44,328 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:14:44 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:14:49,653 - __main__ - INFO - Received webhook request: {"update_id":449602587,
"callback_query":{"id":"1869190634825723146","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1461,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874484,"text":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0435 \u043f\u043b\u0430\u0442\u0435\u0436\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435 \u0438\u043b\u0438 \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u0432 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0443.","reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 04:14:49,670 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 04:14:49,959 - bot.handlers.payments - INFO - Sent payment link 9769a0b4-76c6-4019-99f5-e2e77bc0c122 to user 435204858
2025-06-14 04:14:49,980 - aiogram.event - INFO - Update id=449602587 is handled. Duration 310 ms by bot id=7921957055
2025-06-14 04:14:49,981 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:14:49 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:14:55,734 - __main__ - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf0af9-000f-5000-8000-1034b3428530",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf0af9-000f-5000-8000-1034b3428530",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T04:14:55.483Z",
    "created_at" : "2025-06-14T04:14:49.861Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "9769a0b4-76c6-4019-99f5-e2e77bc0c122"
    }
  }
}
2025-06-14 04:14:55,735 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:14:55 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 04:15:00,670 - __main__ - INFO - Received webhook request: {"update_id":449602588,
"message":{"message_id":1463,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874500,"text":"/start payment_success_9769a0b4-76c6-4019-99f5-e2e77bc0c122","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:15:00,817 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976ca5-e4b3-7ef0-bc5c-6516492165d3', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 04:15:00,853 - aiogram.event - INFO - Update id=449602588 is handled. Duration 182 ms by bot id=7921957055
2025-06-14 04:15:00,854 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:15:00 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:15:03,638 - __main__ - INFO - Received webhook request: {"update_id":449602589,
"message":{"message_id":1465,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874503,"text":"/start payment_success_9769a0b4-76c6-4019-99f5-e2e77bc0c122","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:15:03,783 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976ca5-f04a-7543-aadd-8ca43cc275cd', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 04:15:03,851 - aiogram.event - INFO - Update id=449602589 is handled. Duration 212 ms by bot id=7921957055
2025-06-14 04:15:03,852 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:15:03 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:17:58,837 - __main__ - INFO - Bot stopped by user
2025-06-14 04:20:37,329 - __main__ - INFO - Starting bot...
2025-06-14 04:20:37,330 - __main__ - INFO - Routers and middleware included
2025-06-14 04:20:37,330 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 04:20:37,330 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 04:20:37,331 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 04:20:37,331 - scheduler - INFO - Scheduler set up
2025-06-14 04:20:37,350 - __main__ - INFO - Webhook set successfully
2025-06-14 04:20:37,351 - __main__ - INFO - Web server started on port 8443
2025-06-14 04:21:01,132 - __main__ - INFO - Received webhook request: {"update_id":449602590,
"message":{"message_id":1467,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874861,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:21:01,134 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 04:21:01,227 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 04:21:01,228 - aiogram.event - INFO - Update id=449602590 is handled. Duration 94 ms by bot id=7921957055
2025-06-14 04:21:01,228 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:21:01 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:21:09,376 - __main__ - INFO - Received webhook request: {"update_id":449602591,
"callback_query":{"id":"1869190636259779795","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1468,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874861,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 04:21:09,378 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 04:21:09,864 - bot.handlers.payments - INFO - Sent payment link 82480b47-0576-429f-bacc-ebf58609c61b to user 435204858
2025-06-14 04:21:09,927 - aiogram.event - INFO - Update id=449602591 is handled. Duration 550 ms by bot id=7921957055
2025-06-14 04:21:09,928 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:21:09 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:21:38,454 - __main__ - INFO - Received webhook request: {"update_id":449602592,
"message":{"message_id":1470,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874898,"text":"/start payment_success_82480b47-0576-429f-bacc-ebf58609c61b","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:21:38,609 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976cab-f695-78b3-aa88-b05481085c0b', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 04:21:38,666 - aiogram.event - INFO - Update id=449602592 is handled. Duration 211 ms by bot id=7921957055
2025-06-14 04:21:38,667 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:21:38 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:22:02,306 - __main__ - INFO - Received webhook request: {"update_id":449602593,
"message":{"message_id":1472,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749874922,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:22:02,307 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 04:22:02,371 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 04:22:02,371 - aiogram.event - INFO - Update id=449602593 is handled. Duration 64 ms by bot id=7921957055
2025-06-14 04:22:02,372 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:22:02 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:24:03,396 - __main__ - INFO - Bot stopped by user
2025-06-14 04:34:50,834 - __main__ - INFO - Starting bot...
2025-06-14 04:34:50,834 - __main__ - INFO - Routers and middleware included
2025-06-14 04:34:50,834 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 04:34:50,835 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 04:34:50,835 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 04:34:50,836 - scheduler - INFO - Scheduler set up
2025-06-14 04:34:50,863 - __main__ - INFO - Webhook set successfully
2025-06-14 04:34:50,864 - __main__ - INFO - Web server started on port 8443
2025-06-14 04:35:07,411 - __main__ - INFO - Received webhook request: {"update_id":449602594,
"message":{"message_id":1474,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749875707,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:35:07,412 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 04:35:07,489 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 04:35:07,490 - aiogram.event - INFO - Update id=449602594 is handled. Duration 77 ms by bot id=7921957055
2025-06-14 04:35:07,490 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:35:07 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:35:13,203 - __main__ - INFO - Received webhook request: {"update_id":449602595,
"message":{"message_id":1476,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749875713,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-14 04:35:13,205 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-14 04:35:13,248 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-14 04:35:13,248 - aiogram.event - INFO - Update id=449602595 is handled. Duration 44 ms by bot id=7921957055
2025-06-14 04:35:13,249 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:35:13 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:35:14,736 - __main__ - INFO - Received webhook request: {"update_id":449602596,
"callback_query":{"id":"1869190633410646758","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1477,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749875713,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"3791523253817970959","data":"status_associate"}}
2025-06-14 04:35:14,738 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-14 04:35:14,842 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 04:35:14,848 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 04:35:14,848 - dao.user_dao - INFO - Created user 435204858
2025-06-14 04:35:14,908 - aiogram.event - INFO - Update id=449602596 is handled. Duration 170 ms by bot id=7921957055
2025-06-14 04:35:14,908 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:35:14 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:35:16,667 - __main__ - INFO - Received webhook request: {"update_id":449602597,
"callback_query":{"id":"1869190633630399463","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1478,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749875714,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 04:35:16,668 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 04:35:17,060 - bot.handlers.payments - INFO - Sent payment link 375535b0-8ba2-4463-9725-38bc8df6e87b to user 435204858
2025-06-14 04:35:17,069 - aiogram.event - INFO - Update id=449602597 is handled. Duration 401 ms by bot id=7921957055
2025-06-14 04:35:17,069 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:35:16 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:35:23,094 - __main__ - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf0fc4-000f-5000-8000-13fff3d754e0",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf0fc4-000f-5000-8000-13fff3d754e0",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T04:35:22.734Z",
    "created_at" : "2025-06-14T04:35:16.959Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "375535b0-8ba2-4463-9725-38bc8df6e87b"
    }
  }
}
2025-06-14 04:35:23,095 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:35:23 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 04:35:28,979 - __main__ - INFO - Received webhook request: {"update_id":449602598,
"message":{"message_id":1480,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749875728,"text":"/start payment_success_375535b0-8ba2-4463-9725-38bc8df6e87b","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 04:35:29,135 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: {'type': 'error', 'id': '01976cb8-a2d1-7fd2-8943-dbf24cc360fc', 'code': 'not_found', 'description': "Incorrect payment_id. Payment doesn't exist or access denied. Specify the payment ID created in your store.", 'parameter': 'payment_id'}
2025-06-14 04:35:29,387 - aiogram.event - INFO - Update id=449602598 is handled. Duration 407 ms by bot id=7921957055
2025-06-14 04:35:29,388 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:04:35:28 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 04:35:48,195 - __main__ - INFO - Bot stopped by user
2025-06-14 05:17:22,276 - __main__ - INFO - Starting bot...
2025-06-14 05:17:22,276 - __main__ - INFO - Routers and middleware included
2025-06-14 05:17:22,277 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 05:17:22,277 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 05:17:22,278 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 05:17:22,278 - scheduler - INFO - Scheduler set up
2025-06-14 05:17:22,296 - __main__ - INFO - Webhook set successfully
2025-06-14 05:17:22,297 - __main__ - INFO - Web server started on port 8443
2025-06-14 05:17:43,010 - __main__ - INFO - Received webhook request: {"update_id":449602599,
"message":{"message_id":1482,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878262,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:17:43,012 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 05:17:43,071 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 05:17:43,071 - aiogram.event - INFO - Update id=449602599 is handled. Duration 60 ms by bot id=7921957055
2025-06-14 05:17:43,072 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:17:43 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:17:45,796 - __main__ - INFO - Received webhook request: {"update_id":449602600,
"callback_query":{"id":"1869190633084542058","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1483,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878263,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 05:17:45,798 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 05:17:46,497 - dao.payment_dao - INFO - Saved payment: payment_id=ecd7a064-a07c-4afe-9ef3-22cee3981129, yookassa_id=2fdf19ba-000f-5001-8000-17ba535de74e, telegram_id=435204858
2025-06-14 05:17:46,559 - bot.handlers.payments - INFO - Sent payment link ecd7a064-a07c-4afe-9ef3-22cee3981129 to user 435204858
2025-06-14 05:17:46,611 - aiogram.event - INFO - Update id=449602600 is handled. Duration 814 ms by bot id=7921957055
2025-06-14 05:17:46,612 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:17:45 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:17:53,867 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:17:52.680Z",
    "created_at" : "2025-06-14T05:17:46.161Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "ecd7a064-a07c-4afe-9ef3-22cee3981129"
    }
  }
}
2025-06-14 05:17:54,479 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf19ba-000f-5001-8000-17ba535de74e, status=succeeded
2025-06-14 05:17:54,582 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:17:54,586 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:17:54,587 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:17:54,607 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:17:54,608 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:17:53 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:17:57,110 - __main__ - INFO - Received webhook request: {"update_id":449602601,
"message":{"message_id":1485,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878277,"text":"/start payment_success_ecd7a064-a07c-4afe-9ef3-22cee3981129","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:17:57,111 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: ecd7a064-a07c-4afe-9ef3-22cee3981129
2025-06-14 05:17:57,338 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:17:57,340 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:17:57,341 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:17:57,347 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:17:57,374 - aiogram.event - INFO - Update id=449602601 is handled. Duration 262 ms by bot id=7921957055
2025-06-14 05:17:57,374 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:17:57 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:18:03,879 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:17:52.680Z",
    "created_at" : "2025-06-14T05:17:46.161Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "ecd7a064-a07c-4afe-9ef3-22cee3981129"
    }
  }
}
2025-06-14 05:18:03,881 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf19ba-000f-5001-8000-17ba535de74e, status=succeeded
2025-06-14 05:18:03,883 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:18:03,884 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:18:03,884 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:18:03,890 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:18:03,890 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:18:03 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:18:41,615 - __main__ - INFO - Bot stopped by user
2025-06-14 05:19:06,633 - __main__ - INFO - Starting bot...
2025-06-14 05:19:06,633 - __main__ - INFO - Routers and middleware included
2025-06-14 05:19:06,633 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 05:19:06,634 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 05:19:06,634 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 05:19:06,634 - scheduler - INFO - Scheduler set up
2025-06-14 05:19:06,655 - __main__ - INFO - Webhook set successfully
2025-06-14 05:19:06,656 - __main__ - INFO - Web server started on port 8443
2025-06-14 05:19:25,298 - __main__ - INFO - Received webhook request: {"update_id":449602602,
"message":{"message_id":1487,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878365,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:19:25,300 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 05:19:25,477 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 05:19:25,477 - aiogram.event - INFO - Update id=449602602 is handled. Duration 178 ms by bot id=7921957055
2025-06-14 05:19:25,478 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:19:25 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:19:30,266 - __main__ - INFO - Received webhook request: {"update_id":449602603,
"callback_query":{"id":"1869190634436120234","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1488,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878365,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 05:19:30,268 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 05:19:30,680 - dao.payment_dao - INFO - Saved payment: payment_id=fc3946b0-29f1-4ca0-840e-ac850cbe8777, yookassa_id=2fdf1a22-000f-5000-b000-11a6745bc3ca, telegram_id=435204858
2025-06-14 05:19:30,714 - bot.handlers.payments - INFO - Sent payment link fc3946b0-29f1-4ca0-840e-ac850cbe8777 to user 435204858
2025-06-14 05:19:30,725 - aiogram.event - INFO - Update id=449602603 is handled. Duration 458 ms by bot id=7921957055
2025-06-14 05:19:30,726 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:19:30 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:19:49,011 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:19:48.445Z",
    "created_at" : "2025-06-14T05:19:30.556Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "fc3946b0-29f1-4ca0-840e-ac850cbe8777"
    }
  }
}
2025-06-14 05:19:49,086 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1a22-000f-5000-b000-11a6745bc3ca, status=succeeded
2025-06-14 05:19:49,130 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:19:49,134 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:19:49,135 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:19:49,172 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:19:49,173 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:19:49 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:19:55,570 - __main__ - INFO - Received webhook request: {"update_id":449602604,
"message":{"message_id":1490,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878395,"text":"/start payment_success_fc3946b0-29f1-4ca0-840e-ac850cbe8777","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:19:55,571 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: fc3946b0-29f1-4ca0-840e-ac850cbe8777
2025-06-14 05:19:55,762 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:19:55,764 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:19:55,764 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:19:55,773 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:19:55,808 - aiogram.event - INFO - Update id=449602604 is handled. Duration 237 ms by bot id=7921957055
2025-06-14 05:19:55,808 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:19:55 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:19:59,026 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:19:48.445Z",
    "created_at" : "2025-06-14T05:19:30.556Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "fc3946b0-29f1-4ca0-840e-ac850cbe8777"
    }
  }
}
2025-06-14 05:19:59,028 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1a22-000f-5000-b000-11a6745bc3ca, status=succeeded
2025-06-14 05:19:59,029 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:19:59,031 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:19:59,031 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:19:59,041 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:19:59,041 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:19:59 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:20:09,973 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:17:52.680Z",
    "created_at" : "2025-06-14T05:17:46.161Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "ecd7a064-a07c-4afe-9ef3-22cee3981129"
    }
  }
}
2025-06-14 05:20:09,976 - dao.payment_dao - WARNING - No payment found for yookassa_id=2fdf19ba-000f-5001-8000-17ba535de74e
2025-06-14 05:20:10,037 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:20:10,041 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:20:10,041 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:20:10,058 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:20:10,058 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:20:09 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:20:41,037 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:19:48.445Z",
    "created_at" : "2025-06-14T05:19:30.556Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "fc3946b0-29f1-4ca0-840e-ac850cbe8777"
    }
  }
}
2025-06-14 05:20:41,040 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1a22-000f-5000-b000-11a6745bc3ca, status=succeeded
2025-06-14 05:20:41,069 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:20:41,072 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:20:41,073 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:20:41,085 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:20:41,086 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:20:41 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:21:20,363 - __main__ - INFO - Bot stopped by user
2025-06-14 05:21:41,123 - __main__ - INFO - Starting bot...
2025-06-14 05:21:41,123 - __main__ - INFO - Routers and middleware included
2025-06-14 05:21:41,124 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 05:21:41,124 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 05:21:41,125 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 05:21:41,125 - scheduler - INFO - Scheduler set up
2025-06-14 05:21:41,159 - __main__ - INFO - Webhook set successfully
2025-06-14 05:21:41,159 - __main__ - INFO - Web server started on port 8443
2025-06-14 05:21:54,517 - __main__ - INFO - Received webhook request: {"update_id":449602605,
"message":{"message_id":1492,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878514,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:21:54,519 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 05:21:54,600 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 05:21:54,601 - aiogram.event - INFO - Update id=449602605 is handled. Duration 82 ms by bot id=7921957055
2025-06-14 05:21:54,601 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:21:54 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:21:57,221 - __main__ - INFO - Received webhook request: {"update_id":449602606,
"callback_query":{"id":"1869190635569250656","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1493,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878514,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 05:21:57,222 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 05:21:57,689 - dao.payment_dao - INFO - Saved payment: payment_id=d7975317-08b0-4723-8a90-4109804a3026, yookassa_id=2fdf1ab5-000f-5001-8000-17866418d731, telegram_id=435204858
2025-06-14 05:21:57,733 - bot.handlers.payments - INFO - Sent payment link d7975317-08b0-4723-8a90-4109804a3026 to user 435204858
2025-06-14 05:21:57,752 - aiogram.event - INFO - Update id=449602606 is handled. Duration 530 ms by bot id=7921957055
2025-06-14 05:21:57,753 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:21:57 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:22:04,729 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:22:04 +0000] "POST /webhook/yookassa HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-14 05:22:05,053 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1a22-000f-5000-b000-11a6745bc3ca",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:19:48.445Z",
    "created_at" : "2025-06-14T05:19:30.556Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "fc3946b0-29f1-4ca0-840e-ac850cbe8777"
    }
  }
}
2025-06-14 05:22:05,057 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1a22-000f-5000-b000-11a6745bc3ca, status=succeeded
2025-06-14 05:22:05,060 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:22:05,065 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:22:05,065 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:22:05,097 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:22:05,098 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:22:05 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:22:09,246 - __main__ - INFO - Received webhook request: {"update_id":449602607,
"message":{"message_id":1495,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878529,"text":"/start payment_success_d7975317-08b0-4723-8a90-4109804a3026","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:22:09,247 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: d7975317-08b0-4723-8a90-4109804a3026
2025-06-14 05:22:09,486 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:22:09,488 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:22:09,488 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:22:09,499 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:22:09,663 - aiogram.event - INFO - Update id=449602607 is handled. Duration 416 ms by bot id=7921957055
2025-06-14 05:22:09,664 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:22:09 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:22:14,751 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:22:14 +0000] "POST /webhook/yookassa HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-14 05:22:39,675 - __main__ - INFO - Bot stopped by user
2025-06-14 05:28:45,740 - __main__ - INFO - Starting bot...
2025-06-14 05:28:45,740 - __main__ - INFO - Routers and middleware included
2025-06-14 05:28:45,740 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 05:28:45,741 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 05:28:45,741 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 05:28:45,742 - scheduler - INFO - Scheduler set up
2025-06-14 05:28:45,762 - __main__ - INFO - Webhook set successfully
2025-06-14 05:28:45,763 - __main__ - INFO - Web server started on port 8443
2025-06-14 05:29:00,697 - __main__ - INFO - Received webhook request: {"update_id":449602608,
"message":{"message_id":1497,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878940,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:29:00,699 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 05:29:00,861 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 05:29:00,862 - aiogram.event - INFO - Update id=449602608 is handled. Duration 163 ms by bot id=7921957055
2025-06-14 05:29:00,862 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:29:00 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:29:05,423 - __main__ - INFO - Received webhook request: {"update_id":449602609,
"callback_query":{"id":"1869190635919997869","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1498,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878940,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 05:29:05,425 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 05:29:05,907 - dao.payment_dao - INFO - Saved payment: payment_id=a029c396-cbd6-4c9d-89c7-cef9e58f8700, yookassa_id=2fdf1c61-000f-5000-b000-10d3e756f5b3, telegram_id=435204858
2025-06-14 05:29:05,963 - bot.handlers.payments - INFO - Sent payment link a029c396-cbd6-4c9d-89c7-cef9e58f8700 to user 435204858
2025-06-14 05:29:05,982 - aiogram.event - INFO - Update id=449602609 is handled. Duration 558 ms by bot id=7921957055
2025-06-14 05:29:05,983 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:29:05 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:29:11,960 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:29:11.691Z",
    "created_at" : "2025-06-14T05:29:05.727Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a029c396-cbd6-4c9d-89c7-cef9e58f8700"
    }
  }
}
2025-06-14 05:29:12,105 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c61-000f-5000-b000-10d3e756f5b3, status=succeeded
2025-06-14 05:29:12,221 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:29:12,224 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:29:12,224 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:29:15,260 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:29:15,261 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:29:11 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:29:18,677 - __main__ - INFO - Received webhook request: {"update_id":449602610,
"message":{"message_id":1501,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878958,"text":"/start payment_success_a029c396-cbd6-4c9d-89c7-cef9e58f8700","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:29:18,679 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: a029c396-cbd6-4c9d-89c7-cef9e58f8700
2025-06-14 05:29:18,894 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:29:18,896 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:29:18,897 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:29:21,928 - bot.handlers.start - ERROR - Error checking payment via deep-link for user 435204858: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:29:21,985 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:29:11.691Z",
    "created_at" : "2025-06-14T05:29:05.727Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a029c396-cbd6-4c9d-89c7-cef9e58f8700"
    }
  }
}
2025-06-14 05:29:21,987 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c61-000f-5000-b000-10d3e756f5b3, status=succeeded
2025-06-14 05:29:21,989 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:29:21,991 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:29:21,991 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:29:22,043 - aiogram.event - INFO - Update id=449602610 is handled. Duration 3365 ms by bot id=7921957055
2025-06-14 05:29:22,044 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:29:18 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:29:25,139 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:29:25,140 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:29:21 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:29:58,989 - __main__ - INFO - Received webhook request: {"update_id":449602611,
"message":{"message_id":1505,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878998,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:29:58,991 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 05:29:59,040 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 05:29:59,040 - aiogram.event - INFO - Update id=449602611 is handled. Duration 49 ms by bot id=7921957055
2025-06-14 05:29:59,041 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:29:58 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:30:00,792 - __main__ - INFO - Received webhook request: {"update_id":449602612,
"callback_query":{"id":"1869190635159139889","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1506,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749878999,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 05:30:00,794 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 05:30:01,280 - dao.payment_dao - INFO - Saved payment: payment_id=e43558f6-dbf9-4111-95c7-a0a7b4d9285d, yookassa_id=2fdf1c99-000f-5001-9000-1af7c06c20f9, telegram_id=435204858
2025-06-14 05:30:01,339 - bot.handlers.payments - INFO - Sent payment link e43558f6-dbf9-4111-95c7-a0a7b4d9285d to user 435204858
2025-06-14 05:30:01,360 - aiogram.event - INFO - Update id=449602612 is handled. Duration 566 ms by bot id=7921957055
2025-06-14 05:30:01,360 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:30:00 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:30:04,001 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:29:11.691Z",
    "created_at" : "2025-06-14T05:29:05.727Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a029c396-cbd6-4c9d-89c7-cef9e58f8700"
    }
  }
}
2025-06-14 05:30:04,005 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c61-000f-5000-b000-10d3e756f5b3, status=succeeded
2025-06-14 05:30:04,008 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:30:04,021 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:30:04,021 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:30:07,080 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:30:07,081 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:30:04 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:30:12,500 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:30:12.214Z",
    "created_at" : "2025-06-14T05:30:01.074Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "e43558f6-dbf9-4111-95c7-a0a7b4d9285d"
    }
  }
}
2025-06-14 05:30:12,765 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c99-000f-5001-9000-1af7c06c20f9, status=succeeded
2025-06-14 05:30:12,881 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:30:12,883 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:30:12,883 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:30:15,919 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:30:15,919 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:30:12 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:30:22,528 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:30:12.214Z",
    "created_at" : "2025-06-14T05:30:01.074Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "e43558f6-dbf9-4111-95c7-a0a7b4d9285d"
    }
  }
}
2025-06-14 05:30:22,544 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c99-000f-5001-9000-1af7c06c20f9, status=succeeded
2025-06-14 05:30:22,546 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:30:22,572 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:30:22,572 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:30:25,606 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:30:25,607 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:30:22 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:31:04,570 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:30:12.214Z",
    "created_at" : "2025-06-14T05:30:01.074Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "e43558f6-dbf9-4111-95c7-a0a7b4d9285d"
    }
  }
}
2025-06-14 05:31:04,572 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c99-000f-5001-9000-1af7c06c20f9, status=succeeded
2025-06-14 05:31:04,574 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:31:04,576 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:31:04,576 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:31:07,651 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:31:07,652 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:31:04 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:31:28,023 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:29:11.691Z",
    "created_at" : "2025-06-14T05:29:05.727Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a029c396-cbd6-4c9d-89c7-cef9e58f8700"
    }
  }
}
2025-06-14 05:31:28,025 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c61-000f-5000-b000-10d3e756f5b3, status=succeeded
2025-06-14 05:31:28,210 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:31:28,212 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:31:28,212 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:31:31,276 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:31:31,277 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:31:28 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:32:28,579 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c99-000f-5001-9000-1af7c06c20f9",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:30:12.214Z",
    "created_at" : "2025-06-14T05:30:01.074Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "e43558f6-dbf9-4111-95c7-a0a7b4d9285d"
    }
  }
}
2025-06-14 05:32:28,586 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c99-000f-5001-9000-1af7c06c20f9, status=succeeded
2025-06-14 05:32:28,627 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:32:28,633 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:32:28,634 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:32:31,716 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:32:31,717 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:32:28 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:34:10,025 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf19ba-000f-5001-8000-17ba535de74e",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:17:52.680Z",
    "created_at" : "2025-06-14T05:17:46.161Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "ecd7a064-a07c-4afe-9ef3-22cee3981129"
    }
  }
}
2025-06-14 05:34:10,030 - dao.payment_dao - WARNING - No payment found for yookassa_id=2fdf19ba-000f-5001-8000-17ba535de74e
2025-06-14 05:34:10,120 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:34:10,129 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:34:10,129 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:34:13,216 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:34:13,217 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:34:10 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:34:16,439 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1c61-000f-5000-b000-10d3e756f5b3",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:29:11.691Z",
    "created_at" : "2025-06-14T05:29:05.727Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a029c396-cbd6-4c9d-89c7-cef9e58f8700"
    }
  }
}
2025-06-14 05:34:16,441 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1c61-000f-5000-b000-10d3e756f5b3, status=succeeded
2025-06-14 05:34:17,073 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:34:17,075 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:34:17,075 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:34:20,142 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:34:20,143 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:34:16 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:34:25,257 - __main__ - INFO - Bot stopped by user
2025-06-14 05:36:49,213 - __main__ - INFO - Starting bot...
2025-06-14 05:36:49,213 - __main__ - INFO - Routers and middleware included
2025-06-14 05:36:49,213 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 05:36:49,214 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 05:36:49,214 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 05:36:49,214 - scheduler - INFO - Scheduler set up
2025-06-14 05:36:49,952 - __main__ - INFO - Webhook set successfully
2025-06-14 05:36:49,953 - __main__ - INFO - Web server started on port 8443
2025-06-14 05:36:53,439 - __main__ - INFO - Received webhook request: {"update_id":449602613,
"message":{"message_id":1516,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749879413,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 05:36:53,441 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 05:36:53,496 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 05:36:53,496 - aiogram.event - INFO - Update id=449602613 is handled. Duration 56 ms by bot id=7921957055
2025-06-14 05:36:53,497 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:36:53 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:36:56,131 - __main__ - INFO - Received webhook request: {"update_id":449602614,
"callback_query":{"id":"1869190635314011118","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1517,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749879413,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 05:36:56,133 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 05:36:56,600 - dao.payment_dao - INFO - Saved payment: payment_id=a0cce68e-ae45-464c-8d19-a06f9b11e327, yookassa_id=2fdf1e38-000f-5001-8000-179e38f3f9a1, telegram_id=435204858
2025-06-14 05:36:56,647 - bot.handlers.payments - INFO - Sent payment link a0cce68e-ae45-464c-8d19-a06f9b11e327 to user 435204858
2025-06-14 05:36:56,659 - aiogram.event - INFO - Update id=449602614 is handled. Duration 526 ms by bot id=7921957055
2025-06-14 05:36:56,659 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:36:56 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 05:37:10,969 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1e38-000f-5001-8000-179e38f3f9a1",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1e38-000f-5001-8000-179e38f3f9a1",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:37:10.681Z",
    "created_at" : "2025-06-14T05:36:56.454Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a0cce68e-ae45-464c-8d19-a06f9b11e327"
    }
  }
}
2025-06-14 05:37:11,037 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1e38-000f-5001-8000-179e38f3f9a1, status=succeeded
2025-06-14 05:37:11,092 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:37:11,095 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:37:11,096 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:37:14,128 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:37:14,129 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:37:10 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:37:21,016 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdf1e38-000f-5001-8000-179e38f3f9a1",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdf1e38-000f-5001-8000-179e38f3f9a1",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T05:37:10.681Z",
    "created_at" : "2025-06-14T05:36:56.454Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a0cce68e-ae45-464c-8d19-a06f9b11e327"
    }
  }
}
2025-06-14 05:37:21,018 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdf1e38-000f-5001-8000-179e38f3f9a1, status=succeeded
2025-06-14 05:37:21,020 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 05:37:21,022 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 05:37:21,022 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 05:37:24,066 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 05:37:24,067 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:05:37:21 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 05:37:38,475 - __main__ - INFO - Bot stopped by user
2025-06-14 11:21:22,608 - __main__ - INFO - Starting bot...
2025-06-14 11:21:22,609 - __main__ - INFO - Routers and middleware included
2025-06-14 11:21:22,609 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 11:21:22,610 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 11:21:22,610 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 11:21:22,610 - scheduler - INFO - Scheduler set up
2025-06-14 11:21:22,656 - __main__ - INFO - Webhook set successfully
2025-06-14 11:21:22,657 - __main__ - INFO - Web server started on port 8443
2025-06-14 11:22:13,536 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:11:22:13 +0000] "GET / HTTP/1.1" 404 175 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 YaBrowser/25.4.0.0 Safari/537.36"
2025-06-14 11:22:13,807 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:11:22:13 +0000] "GET /favicon.ico HTTP/1.1" 404 175 "https://66e0-185-223-93-139.ngrok-free.app/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 YaBrowser/25.4.0.0 Safari/537.36"
2025-06-14 12:30:42,973 - aiohttp.access - INFO - 18.206.168.24 [14/Jun/2025:12:30:42 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 13:51:10,840 - aiohttp.access - INFO - 165.227.27.132 [14/Jun/2025:13:51:10 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 14:21:30,403 - aiohttp.access - INFO - 20.168.120.101 [14/Jun/2025:14:21:30 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 18:58:14,781 - __main__ - INFO - Starting bot...
2025-06-14 18:58:14,781 - __main__ - INFO - Routers and middleware included
2025-06-14 18:58:14,782 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 18:58:14,782 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 18:58:14,783 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 18:58:14,783 - scheduler - INFO - Scheduler set up
2025-06-14 18:58:14,833 - __main__ - INFO - Webhook set successfully
2025-06-14 18:58:14,834 - __main__ - INFO - Web server started on port 8443
2025-06-14 18:59:08,838 - __main__ - INFO - Received webhook request: {"update_id":449602622,
"message":{"message_id":1528,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749927548,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 18:59:08,842 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 18:59:09,026 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 18:59:09,026 - aiogram.event - INFO - Update id=449602622 is handled. Duration 185 ms by bot id=7921957055
2025-06-14 18:59:09,027 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:18:59:08 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 18:59:11,209 - __main__ - INFO - Received webhook request: {"update_id":449602623,
"callback_query":{"id":"1869190635306875667","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1529,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749927548,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 18:59:11,211 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 18:59:11,652 - dao.payment_dao - INFO - Saved payment: payment_id=05587352-f592-4d1c-9393-2d2ae30ba7a2, yookassa_id=2fdfda3f-000f-5000-b000-18dd7ecc3a97, telegram_id=435204858
2025-06-14 18:59:11,739 - bot.handlers.payments - INFO - Sent payment link 05587352-f592-4d1c-9393-2d2ae30ba7a2 to user 435204858
2025-06-14 18:59:11,820 - aiogram.event - INFO - Update id=449602623 is handled. Duration 610 ms by bot id=7921957055
2025-06-14 18:59:11,821 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:18:59:11 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 18:59:19,778 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfda3f-000f-5000-b000-18dd7ecc3a97",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfda3f-000f-5000-b000-18dd7ecc3a97",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T18:59:19.436Z",
    "created_at" : "2025-06-14T18:59:11.547Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "05587352-f592-4d1c-9393-2d2ae30ba7a2"
    }
  }
}
2025-06-14 18:59:20,548 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfda3f-000f-5000-b000-18dd7ecc3a97, status=succeeded
2025-06-14 18:59:20,958 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 18:59:20,966 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 18:59:20,966 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 18:59:24,122 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 18:59:24,123 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:18:59:19 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 18:59:30,458 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfda3f-000f-5000-b000-18dd7ecc3a97",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfda3f-000f-5000-b000-18dd7ecc3a97",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T18:59:19.436Z",
    "created_at" : "2025-06-14T18:59:11.547Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "05587352-f592-4d1c-9393-2d2ae30ba7a2"
    }
  }
}
2025-06-14 18:59:30,460 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfda3f-000f-5000-b000-18dd7ecc3a97, status=succeeded
2025-06-14 18:59:30,462 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 18:59:30,465 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 18:59:30,465 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 18:59:33,596 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 18:59:33,597 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:18:59:30 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:00:00,804 - __main__ - INFO - Bot stopped by user
2025-06-14 19:04:54,870 - __main__ - INFO - Starting bot...
2025-06-14 19:04:54,870 - __main__ - INFO - Routers and middleware included
2025-06-14 19:04:54,871 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:04:54,871 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:04:54,871 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:04:54,872 - scheduler - INFO - Scheduler set up
2025-06-14 19:04:54,890 - __main__ - INFO - Webhook set successfully
2025-06-14 19:04:54,891 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:05:03,929 - __main__ - INFO - Received webhook request: {"update_id":449602624,
"message":{"message_id":1533,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749927903,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:05:03,930 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:05:04,097 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:05:04,097 - aiogram.event - INFO - Update id=449602624 is handled. Duration 167 ms by bot id=7921957055
2025-06-14 19:05:04,098 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:05:03 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:05:06,435 - __main__ - INFO - Received webhook request: {"update_id":449602625,
"callback_query":{"id":"1869190633688313467","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1534,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749927904,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:05:06,437 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:05:06,881 - dao.payment_dao - INFO - Saved payment: payment_id=23c0986c-dd14-4f9b-8f85-f5c40f5ae6d1, yookassa_id=2fdfdba2-000f-5001-9000-1047ce604825, telegram_id=435204858
2025-06-14 19:05:06,923 - bot.handlers.payments - INFO - Sent payment link 23c0986c-dd14-4f9b-8f85-f5c40f5ae6d1 to user 435204858
2025-06-14 19:05:06,936 - aiogram.event - INFO - Update id=449602625 is handled. Duration 500 ms by bot id=7921957055
2025-06-14 19:05:06,937 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:05:06 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:05:15,576 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdba2-000f-5001-9000-1047ce604825",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdba2-000f-5001-9000-1047ce604825",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:05:15.280Z",
    "created_at" : "2025-06-14T19:05:06.767Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "23c0986c-dd14-4f9b-8f85-f5c40f5ae6d1"
    }
  }
}
2025-06-14 19:05:15,607 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdba2-000f-5001-9000-1047ce604825, status=succeeded
2025-06-14 19:05:15,635 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:05:15,639 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:05:15,639 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:05:18,671 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:05:18,672 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:05:15 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:05:25,588 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdba2-000f-5001-9000-1047ce604825",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdba2-000f-5001-9000-1047ce604825",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:05:15.280Z",
    "created_at" : "2025-06-14T19:05:06.767Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "23c0986c-dd14-4f9b-8f85-f5c40f5ae6d1"
    }
  }
}
2025-06-14 19:05:25,590 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdba2-000f-5001-9000-1047ce604825, status=succeeded
2025-06-14 19:05:25,592 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:05:25,594 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:05:25,594 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:05:28,643 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:05:28,643 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:05:25 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:05:30,915 - __main__ - INFO - Bot stopped by user
2025-06-14 19:06:16,741 - __main__ - INFO - Starting bot...
2025-06-14 19:06:16,741 - __main__ - INFO - Routers and middleware included
2025-06-14 19:06:16,742 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:06:16,742 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:06:16,743 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:06:16,743 - scheduler - INFO - Scheduler set up
2025-06-14 19:06:16,789 - __main__ - INFO - Webhook set successfully
2025-06-14 19:06:16,790 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:06:31,277 - __main__ - INFO - Received webhook request: {"update_id":449602626,
"message":{"message_id":1538,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749927991,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:06:31,278 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:06:31,423 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:06:31,424 - aiogram.event - INFO - Update id=449602626 is handled. Duration 146 ms by bot id=7921957055
2025-06-14 19:06:31,424 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:06:31 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:06:32,878 - __main__ - INFO - Received webhook request: {"update_id":449602627,
"callback_query":{"id":"1869190635350067856","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1539,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749927991,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:06:32,879 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:06:33,317 - dao.payment_dao - INFO - Saved payment: payment_id=2b7a7996-e74d-4ee4-82f7-2b62c059f4d0, yookassa_id=2fdfdbf9-000f-5000-8000-1ba423e7b8a9, telegram_id=435204858
2025-06-14 19:06:33,361 - bot.handlers.payments - INFO - Sent payment link 2b7a7996-e74d-4ee4-82f7-2b62c059f4d0 to user 435204858
2025-06-14 19:06:33,418 - aiogram.event - INFO - Update id=449602627 is handled. Duration 538 ms by bot id=7921957055
2025-06-14 19:06:33,418 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:06:32 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:06:39,429 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdbf9-000f-5000-8000-1ba423e7b8a9",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdbf9-000f-5000-8000-1ba423e7b8a9",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:06:39.067Z",
    "created_at" : "2025-06-14T19:06:33.221Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "2b7a7996-e74d-4ee4-82f7-2b62c059f4d0"
    }
  }
}
2025-06-14 19:06:39,499 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdbf9-000f-5000-8000-1ba423e7b8a9, status=succeeded
2025-06-14 19:06:39,525 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:06:39,528 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:06:39,528 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:06:42,660 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:06:42,661 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:06:39 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:06:49,445 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdbf9-000f-5000-8000-1ba423e7b8a9",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdbf9-000f-5000-8000-1ba423e7b8a9",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:06:39.067Z",
    "created_at" : "2025-06-14T19:06:33.221Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "2b7a7996-e74d-4ee4-82f7-2b62c059f4d0"
    }
  }
}
2025-06-14 19:06:49,448 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdbf9-000f-5000-8000-1ba423e7b8a9, status=succeeded
2025-06-14 19:06:49,449 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:06:49,452 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:06:49,452 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:06:52,508 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:06:52,509 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:06:49 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:07:11,896 - __main__ - INFO - Bot stopped by user
2025-06-14 19:20:49,764 - __main__ - INFO - Starting bot...
2025-06-14 19:20:49,764 - __main__ - INFO - Routers and middleware included
2025-06-14 19:20:49,764 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:20:49,765 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:20:49,765 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:20:49,765 - scheduler - INFO - Scheduler set up
2025-06-14 19:20:49,843 - __main__ - INFO - Webhook set successfully
2025-06-14 19:20:49,844 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:21:22,441 - __main__ - INFO - Received webhook request: {"update_id":449602628,
"message":{"message_id":1543,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749928882,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:21:22,442 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:21:22,578 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:21:22,578 - aiogram.event - INFO - Update id=449602628 is handled. Duration 136 ms by bot id=7921957055
2025-06-14 19:21:22,579 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:21:22 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:21:24,080 - __main__ - INFO - Received webhook request: {"update_id":449602629,
"callback_query":{"id":"1869190632684624991","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1544,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749928882,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:21:24,082 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:21:24,518 - dao.payment_dao - INFO - Saved payment: payment_id=b0b36331-6c7b-4da2-8b7d-5ca7e5b9efd9, yookassa_id=2fdfdf74-000f-5001-8000-184833377626, telegram_id=435204858
2025-06-14 19:21:24,633 - bot.handlers.payments - INFO - Sent payment link b0b36331-6c7b-4da2-8b7d-5ca7e5b9efd9 to user 435204858
2025-06-14 19:21:24,731 - aiogram.event - INFO - Update id=449602629 is handled. Duration 650 ms by bot id=7921957055
2025-06-14 19:21:24,731 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:21:24 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:21:31,872 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdba2-000f-5001-9000-1047ce604825",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdba2-000f-5001-9000-1047ce604825",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:05:15.280Z",
    "created_at" : "2025-06-14T19:05:06.767Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "23c0986c-dd14-4f9b-8f85-f5c40f5ae6d1"
    }
  }
}
2025-06-14 19:21:31,875 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdba2-000f-5001-9000-1047ce604825, status=succeeded
2025-06-14 19:21:31,895 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:21:31,899 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:21:31,899 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:21:32,594 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdf74-000f-5001-8000-184833377626",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdf74-000f-5001-8000-184833377626",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:21:32.303Z",
    "created_at" : "2025-06-14T19:21:24.428Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "b0b36331-6c7b-4da2-8b7d-5ca7e5b9efd9"
    }
  }
}
2025-06-14 19:21:32,621 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdf74-000f-5001-8000-184833377626, status=succeeded
2025-06-14 19:21:32,645 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:21:32,647 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:21:32,647 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:21:34,935 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:21:34,936 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:21:31 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:21:35,678 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:21:35,679 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:21:32 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:21:42,614 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdf74-000f-5001-8000-184833377626",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdf74-000f-5001-8000-184833377626",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:21:32.303Z",
    "created_at" : "2025-06-14T19:21:24.428Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "b0b36331-6c7b-4da2-8b7d-5ca7e5b9efd9"
    }
  }
}
2025-06-14 19:21:42,616 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdf74-000f-5001-8000-184833377626, status=succeeded
2025-06-14 19:21:42,618 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:21:42,620 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:21:42,620 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:21:45,751 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:21:45,752 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:21:42 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:22:24,950 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdf74-000f-5001-8000-184833377626",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdf74-000f-5001-8000-184833377626",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:21:32.303Z",
    "created_at" : "2025-06-14T19:21:24.428Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "b0b36331-6c7b-4da2-8b7d-5ca7e5b9efd9"
    }
  }
}
2025-06-14 19:22:24,953 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdf74-000f-5001-8000-184833377626, status=succeeded
2025-06-14 19:22:24,954 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:22:24,957 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:22:24,957 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:22:28,034 - bot.handlers.payments - ERROR - Error processing YooKassa webhook: Telegram server says - Bad Request: can't parse inline keyboard button: Text buttons are unallowed in the inline keyboard
2025-06-14 19:22:28,034 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:22:24 +0000] "POST /yookassa HTTP/1.1" 500 177 "-" "AHC/2.1"
2025-06-14 19:22:34,560 - __main__ - INFO - Bot stopped by user
2025-06-14 19:36:04,669 - __main__ - INFO - Starting bot...
2025-06-14 19:36:04,669 - __main__ - INFO - Routers and middleware included
2025-06-14 19:36:04,669 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:36:04,670 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:36:04,670 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:36:04,670 - scheduler - INFO - Scheduler set up
2025-06-14 19:36:04,726 - __main__ - INFO - Webhook set successfully
2025-06-14 19:36:04,727 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:36:25,864 - __main__ - INFO - Received webhook request: {"update_id":449602630,
"message":{"message_id":1550,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749929785,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:36:25,866 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:36:25,920 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:36:25,920 - aiogram.event - INFO - Update id=449602630 is handled. Duration 54 ms by bot id=7921957055
2025-06-14 19:36:25,921 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:36:25 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:36:27,979 - __main__ - INFO - Received webhook request: {"update_id":449602631,
"callback_query":{"id":"1869190634857301811","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1551,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749929785,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:36:27,981 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:36:28,415 - dao.payment_dao - INFO - Saved payment: payment_id=aabfc6ad-dd2c-481f-a8e0-4c216b8cedc5, yookassa_id=2fdfe2fc-000f-5000-b000-18681b267efb, telegram_id=435204858
2025-06-14 19:36:28,449 - bot.handlers.payments - INFO - Sent payment link aabfc6ad-dd2c-481f-a8e0-4c216b8cedc5 to user 435204858
2025-06-14 19:36:28,461 - aiogram.event - INFO - Update id=449602631 is handled. Duration 480 ms by bot id=7921957055
2025-06-14 19:36:28,462 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:36:27 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:36:28,770 - __main__ - INFO - Received webhook request: {"update_id":449602632,
"message":{"message_id":1553,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749929788,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:36:28,770 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:36:28,846 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:36:28,846 - aiogram.event - INFO - Update id=449602632 is handled. Duration 75 ms by bot id=7921957055
2025-06-14 19:36:28,847 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:36:28 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:36:47,160 - __main__ - INFO - Received webhook request: {"update_id":449602633,
"message":{"message_id":1555,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749929807,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:36:47,161 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:36:47,260 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:36:47,261 - aiogram.event - INFO - Update id=449602633 is handled. Duration 99 ms by bot id=7921957055
2025-06-14 19:36:47,261 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:36:47 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:36:51,342 - __main__ - INFO - Received webhook request: {"update_id":449602634,
"callback_query":{"id":"1869190632395728043","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1556,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749929807,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:36:51,343 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:36:51,624 - dao.payment_dao - INFO - Saved payment: payment_id=f182bb24-5e61-40a7-8b83-b57f99be30a1, yookassa_id=2fdfe313-000f-5000-b000-1635b4e64b12, telegram_id=435204858
2025-06-14 19:36:51,664 - bot.handlers.payments - INFO - Sent payment link f182bb24-5e61-40a7-8b83-b57f99be30a1 to user 435204858
2025-06-14 19:36:51,689 - aiogram.event - INFO - Update id=449602634 is handled. Duration 346 ms by bot id=7921957055
2025-06-14 19:36:51,690 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:36:51 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:36:51,999 - __main__ - INFO - Received webhook request: {"update_id":449602635,
"message":{"message_id":1558,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749929811,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:36:52,000 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:36:52,053 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:36:52,053 - aiogram.event - INFO - Update id=449602635 is handled. Duration 53 ms by bot id=7921957055
2025-06-14 19:36:52,054 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:36:51 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:36:58,190 - __main__ - INFO - Received webhook request: {"update_id":449602636,
"callback_query":{"id":"1869190632819595896","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1559,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749929812,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:36:58,192 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:36:58,497 - dao.payment_dao - INFO - Saved payment: payment_id=da997775-66b3-48a3-8fce-8e1c50c7101a, yookassa_id=2fdfe31a-000f-5001-8000-14a72031936c, telegram_id=435204858
2025-06-14 19:36:58,544 - bot.handlers.payments - INFO - Sent payment link da997775-66b3-48a3-8fce-8e1c50c7101a to user 435204858
2025-06-14 19:36:58,577 - aiogram.event - INFO - Update id=449602636 is handled. Duration 385 ms by bot id=7921957055
2025-06-14 19:36:58,578 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:36:58 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:37:07,171 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfe31a-000f-5001-8000-14a72031936c",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfe31a-000f-5001-8000-14a72031936c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:37:06.845Z",
    "created_at" : "2025-06-14T19:36:58.403Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "da997775-66b3-48a3-8fce-8e1c50c7101a"
    }
  }
}
2025-06-14 19:37:07,204 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfe31a-000f-5001-8000-14a72031936c, status=succeeded
2025-06-14 19:37:07,233 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:37:07,236 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:37:07,236 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:37:10,415 - bot.handlers.payments - INFO - Payment succeeded: payment_id=da997775-66b3-48a3-8fce-8e1c50c7101a, yookassa_id=2fdfe31a-000f-5001-8000-14a72031936c, user=435204858
2025-06-14 19:37:10,415 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:37:07 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 19:37:48,695 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfdf74-000f-5001-8000-184833377626",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfdf74-000f-5001-8000-184833377626",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:21:32.303Z",
    "created_at" : "2025-06-14T19:21:24.428Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "b0b36331-6c7b-4da2-8b7d-5ca7e5b9efd9"
    }
  }
}
2025-06-14 19:37:48,698 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfdf74-000f-5001-8000-184833377626, status=succeeded
2025-06-14 19:37:48,725 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:37:48,728 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:37:48,728 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:37:51,848 - bot.handlers.payments - INFO - Payment succeeded: payment_id=b0b36331-6c7b-4da2-8b7d-5ca7e5b9efd9, yookassa_id=2fdfdf74-000f-5001-8000-184833377626, user=435204858
2025-06-14 19:37:51,849 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:37:48 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 19:38:54,278 - __main__ - INFO - Bot stopped by user
2025-06-14 19:40:02,674 - __main__ - INFO - Starting bot...
2025-06-14 19:40:02,674 - __main__ - INFO - Routers and middleware included
2025-06-14 19:40:02,675 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:40:02,676 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:40:02,676 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:40:02,676 - scheduler - INFO - Scheduler set up
2025-06-14 19:40:02,696 - __main__ - INFO - Webhook set successfully
2025-06-14 19:40:02,697 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:40:17,431 - __main__ - INFO - Received webhook request: {"update_id":449602637,
"message":{"message_id":1565,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930017,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:40:17,433 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:40:17,478 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 19:40:17,479 - aiogram.event - INFO - Update id=449602637 is handled. Duration 46 ms by bot id=7921957055
2025-06-14 19:40:17,479 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:40:17 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:40:26,207 - __main__ - INFO - Received webhook request: {"update_id":449602638,
"message":{"message_id":1567,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930026,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-14 19:40:26,208 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-14 19:40:26,259 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-14 19:40:26,259 - aiogram.event - INFO - Update id=449602638 is handled. Duration 52 ms by bot id=7921957055
2025-06-14 19:40:26,260 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:40:26 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:40:26,489 - __main__ - INFO - Received webhook request: {"update_id":449602639,
"message":{"message_id":1569,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930026,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:40:26,490 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:40:26,555 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 19:40:26,555 - aiogram.event - INFO - Update id=449602639 is handled. Duration 66 ms by bot id=7921957055
2025-06-14 19:40:26,556 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:40:26 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:40:38,862 - __main__ - INFO - Received webhook request: {"update_id":449602640,
"callback_query":{"id":"1869190632185456956","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1568,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930026,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"3791523253817970959","data":"status_associate"}}
2025-06-14 19:40:38,863 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-14 19:40:38,908 - aiogram.event - INFO - Update id=449602640 is handled. Duration 45 ms by bot id=7921957055
2025-06-14 19:40:38,909 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:40:38 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:40:51,167 - __main__ - INFO - Received webhook request: {"update_id":449602641,
"callback_query":{"id":"1869190632550609037","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1571,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930038,"text":"\u041e\u0448\u0438\u0431\u043a\u0430: \u0434\u0430\u043d\u043d\u044b\u0435 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044e\u0442. \u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u0441 /start.","entities":[{"offset":50,"length":6,"type":"bot_command"}],"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:40:51,169 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:40:51,210 - aiogram.event - INFO - Update id=449602641 is handled. Duration 41 ms by bot id=7921957055
2025-06-14 19:40:51,210 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:40:51 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:41:05,455 - __main__ - INFO - Received webhook request: {"update_id":449602642,
"message":{"message_id":1573,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930065,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:41:05,456 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:41:05,556 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 19:41:05,556 - aiogram.event - INFO - Update id=449602642 is handled. Duration 100 ms by bot id=7921957055
2025-06-14 19:41:05,557 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:41:05 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:41:12,591 - __main__ - INFO - Received webhook request: {"update_id":449602643,
"message":{"message_id":1575,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930072,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-14 19:41:12,594 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-14 19:41:13,002 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-14 19:41:13,003 - aiogram.event - INFO - Update id=449602643 is handled. Duration 410 ms by bot id=7921957055
2025-06-14 19:41:13,004 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:41:12 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:41:13,020 - __main__ - INFO - Received webhook request: {"update_id":449602644,
"message":{"message_id":1576,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930072,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:41:13,021 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:41:13,196 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 19:41:13,197 - aiogram.event - INFO - Update id=449602644 is handled. Duration 176 ms by bot id=7921957055
2025-06-14 19:41:13,197 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:41:13 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:41:22,591 - __main__ - INFO - Received webhook request: {"update_id":449602645,
"callback_query":{"id":"1869190632571309784","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1577,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930072,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"3791523253817970959","data":"status_associate"}}
2025-06-14 19:41:22,593 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-14 19:41:22,628 - aiogram.event - INFO - Update id=449602645 is handled. Duration 36 ms by bot id=7921957055
2025-06-14 19:41:22,629 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:41:22 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:41:39,816 - __main__ - INFO - Bot stopped by user
2025-06-14 19:41:50,554 - __main__ - INFO - Starting bot...
2025-06-14 19:41:50,554 - __main__ - INFO - Routers and middleware included
2025-06-14 19:41:50,554 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:41:50,555 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:41:50,555 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:41:50,555 - scheduler - INFO - Scheduler set up
2025-06-14 19:41:50,575 - __main__ - INFO - Webhook set successfully
2025-06-14 19:41:50,575 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:41:53,768 - __main__ - INFO - Received webhook request: {"update_id":449602646,
"message":{"message_id":1580,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930113,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:41:53,769 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:41:53,836 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 19:41:53,837 - aiogram.event - INFO - Update id=449602646 is handled. Duration 67 ms by bot id=7921957055
2025-06-14 19:41:53,837 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:41:53 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:42:37,285 - __main__ - INFO - Received webhook request: {"update_id":449602647,
"message":{"message_id":1582,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930157,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-14 19:42:37,287 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-14 19:42:37,419 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-14 19:42:37,419 - aiogram.event - INFO - Update id=449602647 is handled. Duration 133 ms by bot id=7921957055
2025-06-14 19:42:37,420 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:42:37 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:42:37,584 - __main__ - INFO - Received webhook request: {"update_id":449602648,
"message":{"message_id":1584,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930157,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:42:37,585 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:42:37,647 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 19:42:37,647 - aiogram.event - INFO - Update id=449602648 is handled. Duration 63 ms by bot id=7921957055
2025-06-14 19:42:37,648 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:42:37 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:43:10,555 - __main__ - INFO - Received webhook request: {"update_id":449602649,
"message":{"message_id":1586,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930190,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-14 19:43:10,556 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-14 19:43:10,662 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-14 19:43:10,662 - aiogram.event - INFO - Update id=449602649 is handled. Duration 107 ms by bot id=7921957055
2025-06-14 19:43:10,663 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:43:10 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:43:26,477 - __main__ - INFO - Received webhook request: {"update_id":449602650,
"callback_query":{"id":"1869190635544122317","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1587,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930190,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"3791523253817970959","data":"status_associate"}}
2025-06-14 19:43:26,480 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-14 19:43:26,542 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:43:26,548 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:43:26,548 - dao.user_dao - INFO - Created user 435204858
2025-06-14 19:43:26,667 - aiogram.event - INFO - Update id=449602650 is handled. Duration 188 ms by bot id=7921957055
2025-06-14 19:43:26,668 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:43:26 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:43:30,353 - __main__ - INFO - Received webhook request: {"update_id":449602651,
"callback_query":{"id":"1869190632216007603","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1588,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930206,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:43:30,355 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:43:30,802 - dao.payment_dao - INFO - Saved payment: payment_id=dcee7c64-a1f7-42ab-8d41-bc35d5e0f98e, yookassa_id=2fdfe4a2-000f-5000-8000-1e1fd09fe68c, telegram_id=435204858
2025-06-14 19:43:30,849 - bot.handlers.payments - INFO - Sent payment link dcee7c64-a1f7-42ab-8d41-bc35d5e0f98e to user 435204858
2025-06-14 19:43:30,870 - aiogram.event - INFO - Update id=449602651 is handled. Duration 515 ms by bot id=7921957055
2025-06-14 19:43:30,871 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:43:30 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:43:39,431 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfe4a2-000f-5000-8000-1e1fd09fe68c",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfe4a2-000f-5000-8000-1e1fd09fe68c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:43:39.130Z",
    "created_at" : "2025-06-14T19:43:30.683Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "dcee7c64-a1f7-42ab-8d41-bc35d5e0f98e"
    }
  }
}
2025-06-14 19:43:39,548 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfe4a2-000f-5000-8000-1e1fd09fe68c, status=succeeded
2025-06-14 19:43:39,629 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:43:39,631 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:43:39,631 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:43:42,698 - bot.handlers.payments - INFO - Payment succeeded: payment_id=dcee7c64-a1f7-42ab-8d41-bc35d5e0f98e, yookassa_id=2fdfe4a2-000f-5000-8000-1e1fd09fe68c, user=435204858
2025-06-14 19:43:42,698 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:43:39 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 19:44:16,291 - __main__ - INFO - Received webhook request: {"update_id":449602652,
"message":{"message_id":1592,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930256,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:44:16,293 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:44:16,442 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:44:16,442 - aiogram.event - INFO - Update id=449602652 is handled. Duration 150 ms by bot id=7921957055
2025-06-14 19:44:16,443 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:44:16 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:44:16,555 - __main__ - INFO - Received webhook request: {"update_id":449602653,
"message":{"message_id":1594,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930256,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:44:16,556 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:44:16,605 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:44:16,605 - aiogram.event - INFO - Update id=449602653 is handled. Duration 49 ms by bot id=7921957055
2025-06-14 19:44:16,606 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:44:16 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:44:22,885 - __main__ - INFO - Bot stopped by user
2025-06-14 19:48:27,368 - __main__ - INFO - Starting bot...
2025-06-14 19:48:27,368 - __main__ - INFO - Routers and middleware included
2025-06-14 19:48:27,369 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:48:27,369 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:48:27,369 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:48:27,370 - scheduler - INFO - Scheduler set up
2025-06-14 19:48:27,394 - __main__ - INFO - Webhook set successfully
2025-06-14 19:48:27,395 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:48:52,984 - __main__ - INFO - Received webhook request: {"update_id":449602654,
"message":{"message_id":1596,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930532,"text":"/admin_export","entities":[{"offset":0,"length":13,"type":"bot_command"}]}}
2025-06-14 19:48:52,986 - aiogram.event - INFO - Update id=449602654 is not handled. Duration 1 ms by bot id=7921957055
2025-06-14 19:48:52,986 - aiogram.event - ERROR - Cause exception while process update id=449602654 by bot id=7921957055
AttributeError: 'list' object has no attribute 'split'
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/admin.py", line 37, in cmd_admin_export
    if str(message.from_user.id) not in ADMIN_IDS.split(","):
                                        ^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'split'
2025-06-14 19:48:52,989 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-06-14 19:48:52,990 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:48:52 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:49:06,331 - __main__ - INFO - Received webhook request: {"update_id":449602655,
"message":{"message_id":1597,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930546,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:49:06,333 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:49:06,444 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:49:06,444 - aiogram.event - INFO - Update id=449602655 is handled. Duration 112 ms by bot id=7921957055
2025-06-14 19:49:06,445 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:49:06 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:49:28,262 - __main__ - INFO - Received webhook request: {"update_id":449602656,
"message":{"message_id":1599,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930568,"text":"/admin_export","entities":[{"offset":0,"length":13,"type":"bot_command"}]}}
2025-06-14 19:49:28,265 - aiogram.event - INFO - Update id=449602656 is not handled. Duration 1 ms by bot id=7921957055
2025-06-14 19:49:28,265 - aiogram.event - ERROR - Cause exception while process update id=449602656 by bot id=7921957055
AttributeError: 'list' object has no attribute 'split'
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/admin.py", line 37, in cmd_admin_export
    if str(message.from_user.id) not in ADMIN_IDS.split(","):
                                        ^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'split'
2025-06-14 19:49:28,267 - __main__ - ERROR - Error processing webhook: 'list' object has no attribute 'split'
2025-06-14 19:49:28,268 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:49:28 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:50:50,142 - __main__ - INFO - Received webhook request: {"update_id":449602657,
"callback_query":{"id":"1869190634362120535","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1598,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930546,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:50:50,146 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:50:50,647 - dao.payment_dao - INFO - Saved payment: payment_id=89b74b29-a0ae-461e-b460-444a84d2b84a, yookassa_id=2fdfe65a-000f-5000-8000-11c7501207ec, telegram_id=435204858
2025-06-14 19:50:50,760 - bot.handlers.payments - INFO - Sent payment link 89b74b29-a0ae-461e-b460-444a84d2b84a to user 435204858
2025-06-14 19:50:50,817 - aiogram.event - INFO - Update id=449602657 is handled. Duration 672 ms by bot id=7921957055
2025-06-14 19:50:50,818 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:50:50 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:50:59,236 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfe65a-000f-5000-8000-11c7501207ec",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfe65a-000f-5000-8000-11c7501207ec",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:50:58.963Z",
    "created_at" : "2025-06-14T19:50:50.523Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "89b74b29-a0ae-461e-b460-444a84d2b84a"
    }
  }
}
2025-06-14 19:50:59,287 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfe65a-000f-5000-8000-11c7501207ec, status=succeeded
2025-06-14 19:50:59,344 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:50:59,351 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:50:59,351 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:51:02,492 - bot.handlers.payments - INFO - Payment succeeded: payment_id=89b74b29-a0ae-461e-b460-444a84d2b84a, yookassa_id=2fdfe65a-000f-5000-8000-11c7501207ec, user=435204858
2025-06-14 19:51:02,493 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:50:59 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 19:51:20,000 - __main__ - INFO - Received webhook request: {"update_id":449602658,
"message":{"message_id":1603,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930679,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:51:20,001 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:51:20,078 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 19:51:20,078 - aiogram.event - INFO - Update id=449602658 is handled. Duration 77 ms by bot id=7921957055
2025-06-14 19:51:20,079 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:51:20 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:51:33,756 - __main__ - INFO - Bot stopped by user
2025-06-14 19:52:22,018 - __main__ - INFO - Starting bot...
2025-06-14 19:52:22,018 - __main__ - INFO - Routers and middleware included
2025-06-14 19:52:22,019 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 19:52:22,019 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 19:52:22,020 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 19:52:22,020 - scheduler - INFO - Scheduler set up
2025-06-14 19:52:22,043 - __main__ - INFO - Webhook set successfully
2025-06-14 19:52:22,044 - __main__ - INFO - Web server started on port 8443
2025-06-14 19:52:25,430 - __main__ - INFO - Received webhook request: {"update_id":449602659,
"message":{"message_id":1605,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930745,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:52:25,431 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 19:52:25,480 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-14 19:52:25,480 - aiogram.event - INFO - Update id=449602659 is handled. Duration 49 ms by bot id=7921957055
2025-06-14 19:52:25,482 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:52:25 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:52:32,031 - __main__ - INFO - Received webhook request: {"update_id":449602660,
"message":{"message_id":1607,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930752,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-14 19:52:32,033 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-14 19:52:32,356 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-14 19:52:32,356 - aiogram.event - INFO - Update id=449602660 is handled. Duration 324 ms by bot id=7921957055
2025-06-14 19:52:32,357 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:52:32 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:52:39,086 - __main__ - INFO - Received webhook request: {"update_id":449602661,
"callback_query":{"id":"1869190632686348136","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1608,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930752,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"3791523253817970959","data":"status_associate"}}
2025-06-14 19:52:39,088 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-14 19:52:39,220 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:52:39,222 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:52:39,223 - dao.user_dao - INFO - Created user 435204858
2025-06-14 19:52:39,493 - aiogram.event - INFO - Update id=449602661 is handled. Duration 405 ms by bot id=7921957055
2025-06-14 19:52:39,493 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:52:39 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:52:43,267 - __main__ - INFO - Received webhook request: {"update_id":449602662,
"callback_query":{"id":"1869190635428348041","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1609,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930759,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 19:52:43,274 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 19:52:43,705 - dao.payment_dao - INFO - Saved payment: payment_id=a2468754-8f79-49cf-97d6-a055c1efc2ff, yookassa_id=2fdfe6cb-000f-5000-8000-1411641de452, telegram_id=435204858
2025-06-14 19:52:43,747 - bot.handlers.payments - INFO - Sent payment link a2468754-8f79-49cf-97d6-a055c1efc2ff to user 435204858
2025-06-14 19:52:43,762 - aiogram.event - INFO - Update id=449602662 is handled. Duration 493 ms by bot id=7921957055
2025-06-14 19:52:43,762 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:52:43 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:52:50,723 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfe6cb-000f-5000-8000-1411641de452",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfe6cb-000f-5000-8000-1411641de452",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:52:50.419Z",
    "created_at" : "2025-06-14T19:52:43.592Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a2468754-8f79-49cf-97d6-a055c1efc2ff"
    }
  }
}
2025-06-14 19:52:50,776 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfe6cb-000f-5000-8000-1411641de452, status=succeeded
2025-06-14 19:52:50,827 - dao.user_dao - INFO - Retrieved 3 users
2025-06-14 19:52:50,831 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-14 19:52:50,831 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 19:52:53,922 - bot.handlers.payments - INFO - Payment succeeded: payment_id=a2468754-8f79-49cf-97d6-a055c1efc2ff, yookassa_id=2fdfe6cb-000f-5000-8000-1411641de452, user=435204858
2025-06-14 19:52:53,923 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:52:50 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 19:55:39,815 - __main__ - INFO - Received webhook request: {"update_id":449602663,
"message":{"message_id":1613,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749930939,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 19:55:39,819 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-14 19:55:39,905 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-14 19:55:39,905 - aiogram.event - INFO - Update id=449602663 is handled. Duration 87 ms by bot id=7921957055
2025-06-14 19:55:39,906 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:55:39 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:55:52,970 - __main__ - INFO - Received webhook request: {"update_id":449602664,
"message":{"message_id":1615,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749930952,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-14 19:55:52,972 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-14 19:55:53,311 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-14 19:55:53,311 - aiogram.event - INFO - Update id=449602664 is handled. Duration 340 ms by bot id=7921957055
2025-06-14 19:55:53,312 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:55:52 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:55:57,213 - __main__ - INFO - Received webhook request: {"update_id":449602665,
"callback_query":{"id":"1936887765303630328","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":1616,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749930953,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"1992604891925527195","data":"status_associate"}}
2025-06-14 19:55:57,215 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-14 19:55:57,466 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 19:55:57,472 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 19:55:57,472 - dao.user_dao - INFO - Created user 450966825
2025-06-14 19:55:57,548 - aiogram.event - INFO - Update id=449602665 is handled. Duration 333 ms by bot id=7921957055
2025-06-14 19:55:57,548 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:55:57 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:56:02,782 - __main__ - INFO - Received webhook request: {"update_id":449602666,
"callback_query":{"id":"1936887765388164711","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":1617,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749930957,"text":"\u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":221,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"1992604891925527195","data":"pay"}}
2025-06-14 19:56:02,811 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-14 19:56:03,168 - dao.payment_dao - INFO - Saved payment: payment_id=335fb0bb-1c57-43a4-811d-a6c7c3ff7dbb, yookassa_id=2fdfe793-000f-5000-b000-17173b5561f8, telegram_id=450966825
2025-06-14 19:56:03,271 - bot.handlers.payments - INFO - Sent payment link 335fb0bb-1c57-43a4-811d-a6c7c3ff7dbb to user 450966825
2025-06-14 19:56:03,346 - aiogram.event - INFO - Update id=449602666 is handled. Duration 535 ms by bot id=7921957055
2025-06-14 19:56:03,347 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:56:02 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 19:56:15,031 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdfe793-000f-5000-b000-17173b5561f8",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdfe793-000f-5000-b000-17173b5561f8",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T19:56:14.756Z",
    "created_at" : "2025-06-14T19:56:03.042Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "335fb0bb-1c57-43a4-811d-a6c7c3ff7dbb"
    }
  }
}
2025-06-14 19:56:15,105 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdfe793-000f-5000-b000-17173b5561f8, status=succeeded
2025-06-14 19:56:15,151 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 19:56:15,153 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 19:56:15,153 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-14 19:56:18,343 - bot.handlers.payments - INFO - Payment succeeded: payment_id=335fb0bb-1c57-43a4-811d-a6c7c3ff7dbb, yookassa_id=2fdfe793-000f-5000-b000-17173b5561f8, user=450966825
2025-06-14 19:56:18,344 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:19:56:15 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 19:59:50,163 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:19:59:50 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 19:59:50,340 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:19:59:50 +0000] "GET /version HTTP/1.1" 404 175 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-14 19:59:53,524 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:19:59:53 +0000] "UNKNOWN / HTTP/1.0" 400 203 "-" "-"
2025-06-14 19:59:53,700 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:19:59:53 +0000] "UNKNOWN / HTTP/1.0" 400 203 "-" "-"
2025-06-14 19:59:59,972 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:19:59:59 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 20:00:03,147 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:03 +0000] "GET / HTTP/1.1" 404 175 "-" "-"
2025-06-14 20:00:12,472 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:12 +0000] "GET / HTTP/1.1" 404 175 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-14 20:00:12,649 - aiohttp.server - ERROR - Error handling request from 162.142.125.201
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiohttp/web_protocol.py", line 408, in data_received
    messages, upgraded, tail = self._request_parser.feed_data(data)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "aiohttp/_http_parser.pyx", line 558, in aiohttp._http_parser.HttpParser.feed_data
aiohttp.http_exceptions.BadHttpMessage: 400, message:
  Pause on PRI/Upgrade:

    b''
      ^
2025-06-14 20:00:12,652 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:12 +0000] "UNKNOWN / HTTP/1.0" 400 197 "-" "-"
2025-06-14 20:00:15,840 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:15 +0000] "GET /favicon.ico HTTP/1.1" 404 194 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-14 20:00:16,018 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:16 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 20:00:19,195 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:19 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 20:00:19,379 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:19 +0000] "GET /sitemap.xml HTTP/1.1" 404 175 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-14 20:00:19,564 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:19 +0000] "GET /favicon.ico HTTP/1.1" 404 194 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-14 20:00:19,742 - aiohttp.access - INFO - 162.142.125.201 [14/Jun/2025:20:00:19 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-14 20:08:43,451 - __main__ - INFO - Received webhook request: {"update_id":449602667,
"callback_query":{"id":"1869190635500113471","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1609,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749930759,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 20:08:43,456 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 20:08:43,774 - dao.payment_dao - INFO - Saved payment: payment_id=987957c2-a2ad-4163-9d34-2f5703652587, yookassa_id=2fdfea8b-000f-5001-8000-1d95b50b77cd, telegram_id=435204858
2025-06-14 20:08:43,862 - bot.handlers.payments - INFO - Sent payment link 987957c2-a2ad-4163-9d34-2f5703652587 to user 435204858
2025-06-14 20:08:43,903 - aiogram.event - INFO - Update id=449602667 is handled. Duration 449 ms by bot id=7921957055
2025-06-14 20:08:43,904 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:08:43 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:08:56,844 - __main__ - INFO - Bot stopped by user
2025-06-14 20:39:52,742 - __main__ - INFO - Starting bot...
2025-06-14 20:39:52,742 - __main__ - INFO - Routers and middleware included
2025-06-14 20:39:52,743 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 20:39:52,743 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 20:39:52,744 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 20:39:52,744 - scheduler - INFO - Scheduler set up
2025-06-14 20:39:52,794 - __main__ - INFO - Webhook set successfully
2025-06-14 20:39:52,795 - __main__ - INFO - Web server started on port 8443
2025-06-14 20:40:15,511 - __main__ - INFO - Received webhook request: {"update_id":449602668,
"message":{"message_id":1622,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749933615,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 20:40:15,512 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 20:40:15,582 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 20:40:15,582 - aiogram.event - INFO - Update id=449602668 is handled. Duration 70 ms by bot id=7921957055
2025-06-14 20:40:15,583 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:40:15 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:40:17,339 - __main__ - INFO - Received webhook request: {"update_id":449602669,
"callback_query":{"id":"1869190634860451772","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1623,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749933615,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 20:40:17,341 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 20:40:17,757 - dao.payment_dao - INFO - Saved payment: payment_id=a4bf872c-9f78-47d8-8a9e-f9b74090e99a, yookassa_id=2fdff1f1-000f-5001-9000-1efff6b97cfa, telegram_id=435204858
2025-06-14 20:40:17,833 - bot.handlers.payments - INFO - Sent payment link a4bf872c-9f78-47d8-8a9e-f9b74090e99a to user 435204858
2025-06-14 20:40:17,878 - aiogram.event - INFO - Update id=449602669 is handled. Duration 538 ms by bot id=7921957055
2025-06-14 20:40:17,878 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:40:17 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:40:26,625 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdff1f1-000f-5001-9000-1efff6b97cfa",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdff1f1-000f-5001-9000-1efff6b97cfa",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T20:40:26.236Z",
    "created_at" : "2025-06-14T20:40:17.666Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a4bf872c-9f78-47d8-8a9e-f9b74090e99a"
    }
  }
}
2025-06-14 20:40:26,647 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdff1f1-000f-5001-9000-1efff6b97cfa, status=succeeded
2025-06-14 20:40:26,705 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 20:40:26,708 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 20:40:26,708 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 20:40:29,865 - bot.handlers.payments - INFO - Payment succeeded: payment_id=a4bf872c-9f78-47d8-8a9e-f9b74090e99a, yookassa_id=2fdff1f1-000f-5001-9000-1efff6b97cfa, user=435204858
2025-06-14 20:40:29,865 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:40:26 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 20:43:02,897 - __main__ - INFO - Bot stopped by user
2025-06-14 20:45:14,816 - __main__ - INFO - Starting bot...
2025-06-14 20:45:14,816 - __main__ - INFO - Routers and middleware included
2025-06-14 20:45:14,816 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 20:45:14,817 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 20:45:14,817 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 20:45:14,818 - scheduler - INFO - Scheduler set up
2025-06-14 20:45:14,856 - __main__ - INFO - Webhook set successfully
2025-06-14 20:45:14,857 - __main__ - INFO - Web server started on port 8443
2025-06-14 20:45:37,080 - __main__ - INFO - Received webhook request: {"update_id":449602670,
"message":{"message_id":1627,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749933937,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 20:45:37,082 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 20:45:37,144 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 20:45:37,144 - aiogram.event - INFO - Update id=449602670 is handled. Duration 62 ms by bot id=7921957055
2025-06-14 20:45:37,145 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:45:37 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:45:38,750 - __main__ - INFO - Received webhook request: {"update_id":449602671,
"callback_query":{"id":"1869190633989906595","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1628,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749933937,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 20:45:38,752 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 20:45:39,264 - dao.payment_dao - INFO - Saved payment: payment_id=9326cdc7-576c-4f86-bf50-2adf474ee70c, yookassa_id=2fdff333-000f-5001-8000-13b4db5ffb7d, telegram_id=435204858
2025-06-14 20:45:39,339 - bot.handlers.payments - INFO - Sent payment link 9326cdc7-576c-4f86-bf50-2adf474ee70c to user 435204858
2025-06-14 20:45:39,381 - aiogram.event - INFO - Update id=449602671 is handled. Duration 629 ms by bot id=7921957055
2025-06-14 20:45:39,382 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:45:38 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:45:47,233 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdff333-000f-5001-8000-13b4db5ffb7d",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdff333-000f-5001-8000-13b4db5ffb7d",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T20:45:46.516Z",
    "created_at" : "2025-06-14T20:45:39.119Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "9326cdc7-576c-4f86-bf50-2adf474ee70c"
    }
  }
}
2025-06-14 20:45:47,302 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdff333-000f-5001-8000-13b4db5ffb7d, status=succeeded
2025-06-14 20:45:47,381 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 20:45:47,386 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 20:45:47,386 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 20:45:49,453 - __main__ - INFO - Received webhook request: {"update_id":449602672,
"message":{"message_id":1631,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749933949,"text":"/start payment_success_9326cdc7-576c-4f86-bf50-2adf474ee70c","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 20:45:49,454 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 9326cdc7-576c-4f86-bf50-2adf474ee70c
2025-06-14 20:45:49,652 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 20:45:49,654 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 20:45:49,655 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 20:45:50,477 - bot.handlers.payments - INFO - Payment succeeded: payment_id=9326cdc7-576c-4f86-bf50-2adf474ee70c, yookassa_id=2fdff333-000f-5001-8000-13b4db5ffb7d, user=435204858
2025-06-14 20:45:50,478 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:45:47 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 20:45:52,736 - bot.handlers.start - INFO - Payment 9326cdc7-576c-4f86-bf50-2adf474ee70c confirmed via deep-link for user 435204858
2025-06-14 20:45:52,736 - aiogram.event - INFO - Update id=449602672 is handled. Duration 3282 ms by bot id=7921957055
2025-06-14 20:45:52,768 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:45:49 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:45:52,785 - __main__ - INFO - Received webhook request: {"update_id":449602673,
"message":{"message_id":1634,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749933951,"text":"/start payment_success_9326cdc7-576c-4f86-bf50-2adf474ee70c","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 20:45:52,816 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 9326cdc7-576c-4f86-bf50-2adf474ee70c
2025-06-14 20:45:52,996 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 20:45:52,998 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 20:45:52,998 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 20:45:56,117 - bot.handlers.start - INFO - Payment 9326cdc7-576c-4f86-bf50-2adf474ee70c confirmed via deep-link for user 435204858
2025-06-14 20:45:56,117 - aiogram.event - INFO - Update id=449602673 is handled. Duration 3331 ms by bot id=7921957055
2025-06-14 20:45:56,118 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:45:52 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:45:56,134 - __main__ - INFO - Received webhook request: {"update_id":449602674,
"message":{"message_id":1637,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749933954,"text":"/start payment_success_9326cdc7-576c-4f86-bf50-2adf474ee70c","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 20:45:56,194 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 9326cdc7-576c-4f86-bf50-2adf474ee70c
2025-06-14 20:45:56,389 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 20:45:56,392 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 20:45:56,393 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 20:45:59,548 - bot.handlers.start - INFO - Payment 9326cdc7-576c-4f86-bf50-2adf474ee70c confirmed via deep-link for user 435204858
2025-06-14 20:45:59,548 - aiogram.event - INFO - Update id=449602674 is handled. Duration 3412 ms by bot id=7921957055
2025-06-14 20:45:59,549 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:20:45:56 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 20:51:53,947 - __main__ - INFO - Bot stopped by user
2025-06-14 21:25:32,123 - __main__ - INFO - Starting bot...
2025-06-14 21:25:32,124 - __main__ - INFO - Routers and middleware included
2025-06-14 21:25:32,124 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 21:25:32,125 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 21:25:32,125 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 21:25:32,125 - scheduler - INFO - Scheduler set up
2025-06-14 21:25:32,162 - __main__ - INFO - Webhook set successfully
2025-06-14 21:25:32,163 - __main__ - INFO - Web server started on port 8443
2025-06-14 21:25:36,180 - __main__ - INFO - Received webhook request: {"update_id":449602675,
"message":{"message_id":1641,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749936336,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 21:25:36,181 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 21:25:36,291 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 21:25:36,291 - aiogram.event - INFO - Update id=449602675 is handled. Duration 110 ms by bot id=7921957055
2025-06-14 21:25:36,292 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:21:25:36 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 21:25:37,881 - __main__ - INFO - Received webhook request: {"update_id":449602676,
"callback_query":{"id":"1869190634056868130","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1642,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749936336,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 21:25:37,882 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 21:25:38,435 - dao.payment_dao - INFO - Saved payment: payment_id=7dfeb83b-c3c0-4f7f-a00f-354d5894984d, yookassa_id=2fdffc92-000f-5001-9000-1fae3f00efbf, telegram_id=435204858
2025-06-14 21:25:38,474 - bot.handlers.payments - INFO - Sent payment link 7dfeb83b-c3c0-4f7f-a00f-354d5894984d to user 435204858
2025-06-14 21:25:38,495 - aiogram.event - INFO - Update id=449602676 is handled. Duration 613 ms by bot id=7921957055
2025-06-14 21:25:38,496 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:21:25:37 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 21:25:45,592 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdffc92-000f-5001-9000-1fae3f00efbf",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdffc92-000f-5001-9000-1fae3f00efbf",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T21:25:45.327Z",
    "created_at" : "2025-06-14T21:25:38.210Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "7dfeb83b-c3c0-4f7f-a00f-354d5894984d"
    }
  }
}
2025-06-14 21:25:45,656 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdffc92-000f-5001-9000-1fae3f00efbf, status=succeeded
2025-06-14 21:25:45,729 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 21:25:45,733 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 21:25:45,733 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 21:25:48,836 - bot.handlers.payments - INFO - Payment succeeded: payment_id=7dfeb83b-c3c0-4f7f-a00f-354d5894984d, yookassa_id=2fdffc92-000f-5001-9000-1fae3f00efbf, user=435204858
2025-06-14 21:25:48,836 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:21:25:45 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 21:26:34,817 - __main__ - INFO - Bot stopped by user
2025-06-14 21:31:23,888 - __main__ - INFO - Starting bot...
2025-06-14 21:31:23,888 - __main__ - INFO - Routers and middleware included
2025-06-14 21:31:23,888 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 21:31:23,889 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 21:31:23,889 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 21:31:23,889 - scheduler - INFO - Scheduler set up
2025-06-14 21:31:23,912 - __main__ - INFO - Webhook set successfully
2025-06-14 21:31:23,913 - __main__ - INFO - Web server started on port 8443
2025-06-14 21:31:35,897 - __main__ - INFO - Received webhook request: {"update_id":449602677,
"message":{"message_id":1646,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749936695,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-14 21:31:35,899 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-14 21:31:36,088 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-14 21:31:36,088 - aiogram.event - INFO - Update id=449602677 is handled. Duration 189 ms by bot id=7921957055
2025-06-14 21:31:36,089 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:21:31:35 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 21:31:40,408 - __main__ - INFO - Received webhook request: {"update_id":449602678,
"callback_query":{"id":"1869190635081037149","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1647,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749936696,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-14 21:31:40,410 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-14 21:31:41,093 - dao.payment_dao - INFO - Saved payment: payment_id=a6442d42-e059-4c27-a262-3c1f912b19fa, yookassa_id=2fdffdfc-000f-5001-8000-1ed9c7dd3021, telegram_id=435204858
2025-06-14 21:31:41,131 - bot.handlers.payments - INFO - Sent payment link a6442d42-e059-4c27-a262-3c1f912b19fa to user 435204858
2025-06-14 21:31:41,141 - aiogram.event - INFO - Update id=449602678 is handled. Duration 731 ms by bot id=7921957055
2025-06-14 21:31:41,141 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:21:31:40 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-14 21:31:47,125 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fdffdfc-000f-5001-8000-1ed9c7dd3021",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fdffdfc-000f-5001-8000-1ed9c7dd3021",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-14T21:31:46.823Z",
    "created_at" : "2025-06-14T21:31:40.732Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a6442d42-e059-4c27-a262-3c1f912b19fa"
    }
  }
}
2025-06-14 21:31:47,181 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fdffdfc-000f-5001-8000-1ed9c7dd3021, status=succeeded
2025-06-14 21:31:47,271 - dao.user_dao - INFO - Retrieved 4 users
2025-06-14 21:31:47,276 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-14 21:31:47,277 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-14 21:31:50,333 - bot.handlers.payments - INFO - Payment succeeded: payment_id=a6442d42-e059-4c27-a262-3c1f912b19fa, yookassa_id=2fdffdfc-000f-5001-8000-1ed9c7dd3021, user=435204858
2025-06-14 21:31:50,333 - aiohttp.access - INFO - 127.0.0.1 [14/Jun/2025:21:31:47 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-14 21:32:47,256 - __main__ - INFO - Bot stopped by user
2025-06-14 21:50:28,011 - __main__ - INFO - Starting bot...
2025-06-14 21:50:28,011 - __main__ - INFO - Routers and middleware included
2025-06-14 21:50:28,011 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 21:50:28,012 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 21:50:28,012 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 21:50:28,012 - scheduler - INFO - Scheduler set up
2025-06-14 21:50:28,159 - __main__ - INFO - Webhook set successfully
2025-06-14 21:50:28,160 - __main__ - INFO - Web server started on port 8443
2025-06-14 21:50:29,701 - __main__ - INFO - Bot stopped by user
2025-06-14 21:50:29,818 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7fdcc6ed43d0>, 164898.217431916)])']
connector: <aiohttp.connector.TCPConnector object at 0x7fdcc6ecead0>
2025-06-14 21:50:40,535 - __main__ - INFO - Starting bot...
2025-06-14 21:50:40,536 - __main__ - INFO - Routers and middleware included
2025-06-14 21:50:40,536 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-14 21:50:40,537 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-14 21:50:40,537 - apscheduler.scheduler - INFO - Scheduler started
2025-06-14 21:50:40,537 - scheduler - INFO - Scheduler set up
2025-06-14 21:50:40,554 - __main__ - INFO - Webhook set successfully
2025-06-14 21:50:40,555 - __main__ - INFO - Web server started on port 8443
2025-06-14 21:50:49,629 - __main__ - INFO - Bot stopped by user
2025-06-14 21:50:49,729 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f083cc7c360>, 164910.61289598)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f083cc76f90>
2025-06-15 13:05:48,485 - __main__ - INFO - Starting bot...
2025-06-15 13:05:48,486 - __main__ - INFO - Routers and middleware included
2025-06-15 13:05:48,486 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 13:05:48,487 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 13:05:48,487 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 13:05:48,487 - scheduler - INFO - Scheduler set up
2025-06-15 13:05:48,554 - __main__ - INFO - Webhook set successfully
2025-06-15 13:05:48,555 - __main__ - INFO - Web server started on port 8443
2025-06-15 13:05:59,053 - __main__ - INFO - Received webhook request: {"update_id":449602683,
"message":{"message_id":1655,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749992759,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:05:59,054 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 13:05:59,118 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 13:05:59,118 - aiogram.event - INFO - Update id=449602683 is handled. Duration 64 ms by bot id=7921957055
2025-06-15 13:05:59,119 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:05:59 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:06:03,398 - __main__ - INFO - Received webhook request: {"update_id":449602684,
"callback_query":{"id":"1869190632404344215","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1656,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749992759,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-15 13:06:03,400 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 13:06:03,930 - dao.payment_dao - INFO - Saved payment: payment_id=77127ca9-dc5a-4bc6-a599-8b8bfde453d9, yookassa_id=2fe0d8fb-000f-5000-b000-13f7dcdb57d8, telegram_id=435204858
2025-06-15 13:06:03,988 - bot.handlers.payments - INFO - Sent payment link 77127ca9-dc5a-4bc6-a599-8b8bfde453d9 to user 435204858
2025-06-15 13:06:04,034 - aiogram.event - INFO - Update id=449602684 is handled. Duration 635 ms by bot id=7921957055
2025-06-15 13:06:04,035 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:06:03 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:06:10,777 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0d8fb-000f-5000-b000-13f7dcdb57d8",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0d8fb-000f-5000-b000-13f7dcdb57d8",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T13:06:10.344Z",
    "created_at" : "2025-06-15T13:06:03.748Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "77127ca9-dc5a-4bc6-a599-8b8bfde453d9"
    }
  }
}
2025-06-15 13:06:10,857 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0d8fb-000f-5000-b000-13f7dcdb57d8, status=succeeded
2025-06-15 13:06:10,926 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:06:10,930 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:06:10,930 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:06:14,022 - bot.handlers.payments - INFO - Payment succeeded: payment_id=77127ca9-dc5a-4bc6-a599-8b8bfde453d9, yookassa_id=2fe0d8fb-000f-5000-b000-13f7dcdb57d8, user=435204858
2025-06-15 13:06:14,023 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:06:10 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 13:06:44,393 - __main__ - INFO - Bot stopped by user
2025-06-15 13:17:57,932 - __main__ - INFO - Starting bot...
2025-06-15 13:17:57,932 - __main__ - INFO - Routers and middleware included
2025-06-15 13:17:57,933 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 13:17:57,934 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 13:17:57,934 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 13:17:57,934 - scheduler - INFO - Scheduler set up
2025-06-15 13:17:57,971 - __main__ - INFO - Webhook set successfully
2025-06-15 13:17:57,972 - __main__ - INFO - Web server started on port 8443
2025-06-15 13:18:19,221 - __main__ - INFO - Received webhook request: {"update_id":449602685,
"message":{"message_id":1660,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993499,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:18:19,222 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 13:18:19,295 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-15 13:18:19,295 - aiogram.event - INFO - Update id=449602685 is handled. Duration 73 ms by bot id=7921957055
2025-06-15 13:18:19,296 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:18:19 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:18:23,769 - __main__ - INFO - Received webhook request: {"update_id":449602686,
"message":{"message_id":1662,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993503,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-15 13:18:23,771 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-15 13:18:23,863 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-15 13:18:23,864 - aiogram.event - INFO - Update id=449602686 is handled. Duration 93 ms by bot id=7921957055
2025-06-15 13:18:23,864 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:18:23 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:18:26,172 - __main__ - INFO - Received webhook request: {"update_id":449602687,
"callback_query":{"id":"1869190636408766507","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1663,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993503,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"3791523253817970959","data":"status_associate"}}
2025-06-15 13:18:26,173 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-15 13:18:26,198 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:18:26,202 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:18:26,202 - dao.user_dao - INFO - Created user 435204858
2025-06-15 13:18:26,455 - aiogram.event - INFO - Update id=449602687 is handled. Duration 282 ms by bot id=7921957055
2025-06-15 13:18:26,456 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:18:26 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:18:27,930 - __main__ - INFO - Received webhook request: {"update_id":449602688,
"callback_query":{"id":"1869190633531261782","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1664,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993506,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-15 13:18:27,931 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 13:18:28,383 - dao.payment_dao - INFO - Saved payment: payment_id=5e3ce008-91dc-4f72-b3c2-53c64a336c04, yookassa_id=2fe0dbe4-000f-5000-8000-14e3f3d8a28d, telegram_id=435204858
2025-06-15 13:18:28,422 - bot.handlers.payments - INFO - Sent payment link 5e3ce008-91dc-4f72-b3c2-53c64a336c04 to user 435204858
2025-06-15 13:18:28,434 - aiogram.event - INFO - Update id=449602688 is handled. Duration 503 ms by bot id=7921957055
2025-06-15 13:18:28,435 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:18:27 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:18:34,510 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0dbe4-000f-5000-8000-14e3f3d8a28d",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0dbe4-000f-5000-8000-14e3f3d8a28d",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T13:18:34.209Z",
    "created_at" : "2025-06-15T13:18:28.266Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "5e3ce008-91dc-4f72-b3c2-53c64a336c04"
    }
  }
}
2025-06-15 13:18:34,535 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0dbe4-000f-5000-8000-14e3f3d8a28d, status=succeeded
2025-06-15 13:18:34,577 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:18:34,581 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:18:34,581 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:18:37,852 - bot.handlers.payments - INFO - Payment succeeded: payment_id=5e3ce008-91dc-4f72-b3c2-53c64a336c04, yookassa_id=2fe0dbe4-000f-5000-8000-14e3f3d8a28d, user=435204858
2025-06-15 13:18:37,853 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:18:34 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 13:18:58,034 - __main__ - INFO - Bot stopped by user
2025-06-15 13:25:33,984 - __main__ - INFO - Starting bot...
2025-06-15 13:25:33,985 - __main__ - INFO - Routers and middleware included
2025-06-15 13:25:33,985 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 13:25:33,986 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 13:25:33,986 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 13:25:33,986 - scheduler - INFO - Scheduler set up
2025-06-15 13:25:34,032 - __main__ - INFO - Webhook set successfully
2025-06-15 13:25:34,033 - __main__ - INFO - Web server started on port 8443
2025-06-15 13:25:47,324 - __main__ - INFO - Received webhook request: {"update_id":449602689,
"message":{"message_id":1668,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993947,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:25:47,325 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 13:25:47,455 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 13:25:47,455 - aiogram.event - INFO - Update id=449602689 is handled. Duration 130 ms by bot id=7921957055
2025-06-15 13:25:47,455 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:25:47 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:25:49,529 - __main__ - INFO - Received webhook request: {"update_id":449602690,
"callback_query":{"id":"1869190634930074663","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":1669,"from":{"id":7921957055,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"MIPTPAYBot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993947,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"3791523253817970959","data":"pay"}}
2025-06-15 13:25:49,531 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 13:25:49,966 - dao.payment_dao - INFO - Saved payment: payment_id=45c25cb6-58bb-4156-aa73-e5a82aab3b83, yookassa_id=2fe0dd9d-000f-5001-8000-16d561f489dd, telegram_id=435204858
2025-06-15 13:25:50,018 - bot.handlers.payments - INFO - Sent payment link 45c25cb6-58bb-4156-aa73-e5a82aab3b83 to user 435204858
2025-06-15 13:25:50,049 - aiogram.event - INFO - Update id=449602690 is handled. Duration 519 ms by bot id=7921957055
2025-06-15 13:25:50,050 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:25:49 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:00,699 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0dd9d-000f-5001-8000-16d561f489dd",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0dd9d-000f-5001-8000-16d561f489dd",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T13:26:00.295Z",
    "created_at" : "2025-06-15T13:25:49.879Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "45c25cb6-58bb-4156-aa73-e5a82aab3b83"
    }
  }
}
2025-06-15 13:26:00,746 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0dd9d-000f-5001-8000-16d561f489dd, status=succeeded
2025-06-15 13:26:00,778 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:00,783 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:00,783 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:02,426 - __main__ - INFO - Received webhook request: {"update_id":449602691,
"message":{"message_id":1672,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993962,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:02,428 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:02,624 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:02,628 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:02,628 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:05,876 - bot.handlers.payments - INFO - Payment succeeded: payment_id=45c25cb6-58bb-4156-aa73-e5a82aab3b83, yookassa_id=2fe0dd9d-000f-5001-8000-16d561f489dd, user=435204858
2025-06-15 13:26:05,877 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:00 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 13:26:07,704 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:07,704 - aiogram.event - INFO - Update id=449602691 is handled. Duration 5277 ms by bot id=7921957055
2025-06-15 13:26:07,705 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:02 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:07,722 - __main__ - INFO - Received webhook request: {"update_id":449602692,
"message":{"message_id":1675,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993966,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:07,745 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:07,967 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:07,969 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:07,969 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:13,113 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:13,113 - aiogram.event - INFO - Update id=449602692 is handled. Duration 5390 ms by bot id=7921957055
2025-06-15 13:26:13,114 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:07 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:13,131 - __main__ - INFO - Received webhook request: {"update_id":449602693,
"message":{"message_id":1677,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993967,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:13,217 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:13,416 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:13,418 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:13,418 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:18,562 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:18,563 - aiogram.event - INFO - Update id=449602693 is handled. Duration 5431 ms by bot id=7921957055
2025-06-15 13:26:18,567 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:13 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:18,584 - __main__ - INFO - Received webhook request: {"update_id":449602694,
"message":{"message_id":1679,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993968,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:18,605 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:18,784 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:18,786 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:18,786 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:23,927 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:23,928 - aiogram.event - INFO - Update id=449602694 is handled. Duration 5343 ms by bot id=7921957055
2025-06-15 13:26:23,928 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:18 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:23,949 - __main__ - INFO - Received webhook request: {"update_id":449602695,
"message":{"message_id":1680,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993968,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:24,073 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:24,262 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:24,264 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:24,264 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:29,427 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:29,427 - aiogram.event - INFO - Update id=449602695 is handled. Duration 5477 ms by bot id=7921957055
2025-06-15 13:26:29,431 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:23 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:29,450 - __main__ - INFO - Received webhook request: {"update_id":449602696,
"message":{"message_id":1681,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993968,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:29,506 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:29,710 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:29,713 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:29,713 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:34,822 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:34,823 - aiogram.event - INFO - Update id=449602696 is handled. Duration 5372 ms by bot id=7921957055
2025-06-15 13:26:34,827 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:29 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:34,844 - __main__ - INFO - Received webhook request: {"update_id":449602697,
"message":{"message_id":1682,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993968,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:34,877 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:35,058 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:35,060 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:35,060 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:40,237 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:40,238 - aiogram.event - INFO - Update id=449602697 is handled. Duration 5393 ms by bot id=7921957055
2025-06-15 13:26:40,242 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:34 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:40,259 - __main__ - INFO - Received webhook request: {"update_id":449602698,
"message":{"message_id":1683,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749993972,"text":"/start payment_success_45c25cb6-58bb-4156-aa73-e5a82aab3b83","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:26:40,322 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 45c25cb6-58bb-4156-aa73-e5a82aab3b83
2025-06-15 13:26:40,497 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:26:40,498 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:26:40,499 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:26:40,519 - aiohttp.access - INFO - 44.204.171.168 [15/Jun/2025:13:26:40 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-15 13:26:45,571 - bot.handlers.start - INFO - Payment 45c25cb6-58bb-4156-aa73-e5a82aab3b83 confirmed via deep-link for user 435204858
2025-06-15 13:26:45,572 - aiogram.event - INFO - Update id=449602698 is handled. Duration 5311 ms by bot id=7921957055
2025-06-15 13:26:45,575 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:26:40 +0000] "POST /7921957055:AAH4n2asBu_--W6eYogTrJW4L3SOE_SpdgM HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:26:56,134 - __main__ - INFO - Bot stopped by user
2025-06-15 13:41:06,856 - __main__ - INFO - Starting bot...
2025-06-15 13:41:06,857 - __main__ - INFO - Routers and middleware included
2025-06-15 13:41:06,857 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 13:41:06,858 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 13:41:06,858 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 13:41:06,858 - scheduler - INFO - Scheduler set up
2025-06-15 13:41:10,877 - __main__ - INFO - Webhook set successfully
2025-06-15 13:41:10,878 - __main__ - INFO - Web server started on port 8443
2025-06-15 13:41:16,273 - __main__ - INFO - Received webhook request: {"update_id":441382653,
"message":{"message_id":93,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749994876,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:41:16,288 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 13:41:16,422 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 13:41:16,422 - aiogram.event - INFO - Update id=441382653 is handled. Duration 135 ms by bot id=7187206991
2025-06-15 13:41:16,423 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:41:16 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:41:19,580 - __main__ - INFO - Received webhook request: {"update_id":441382655,
"callback_query":{"id":"1869190634923455991","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":94,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1749994876,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 13:41:19,583 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 13:41:20,011 - dao.payment_dao - INFO - Saved payment: payment_id=7d65bc3a-d8de-49f5-990d-f629c95ee058, yookassa_id=2fe0e13f-000f-5000-b000-13d51f28cba7, telegram_id=435204858
2025-06-15 13:41:20,078 - bot.handlers.payments - INFO - Sent payment link 7d65bc3a-d8de-49f5-990d-f629c95ee058 to user 435204858
2025-06-15 13:41:20,095 - aiogram.event - INFO - Update id=441382655 is handled. Duration 513 ms by bot id=7187206991
2025-06-15 13:41:20,095 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:41:19 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:41:26,761 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0e13f-000f-5000-b000-13d51f28cba7",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0e13f-000f-5000-b000-13d51f28cba7",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T13:41:26.385Z",
    "created_at" : "2025-06-15T13:41:19.875Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "7d65bc3a-d8de-49f5-990d-f629c95ee058"
    }
  }
}
2025-06-15 13:41:26,823 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0e13f-000f-5000-b000-13d51f28cba7, status=succeeded
2025-06-15 13:41:26,940 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:41:26,943 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:41:26,943 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 13:41:32,086 - bot.handlers.payments - INFO - Payment succeeded: payment_id=7d65bc3a-d8de-49f5-990d-f629c95ee058, yookassa_id=2fe0e13f-000f-5000-b000-13d51f28cba7, user=435204858
2025-06-15 13:41:32,086 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:41:26 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 13:45:44,598 - __main__ - INFO - Bot stopped by user
2025-06-15 13:55:19,784 - __main__ - INFO - Starting bot...
2025-06-15 13:55:19,784 - __main__ - INFO - Routers and middleware included
2025-06-15 13:55:19,784 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 13:55:19,785 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 13:55:19,785 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 13:55:19,785 - scheduler - INFO - Scheduler set up
2025-06-15 13:55:19,805 - __main__ - INFO - Webhook set successfully
2025-06-15 13:55:19,806 - __main__ - INFO - Web server started on port 8443
2025-06-15 13:56:32,642 - __main__ - INFO - Received webhook request: {"update_id":441382656,
"message":{"message_id":98,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749995792,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:56:32,644 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-15 13:56:32,707 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-15 13:56:32,708 - aiogram.event - INFO - Update id=441382656 is handled. Duration 64 ms by bot id=7187206991
2025-06-15 13:56:32,708 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:56:32 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:56:34,631 - __main__ - INFO - Received webhook request: {"update_id":441382657,
"callback_query":{"id":"1936887768698299799","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":99,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749995792,"text":"\u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":221,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-15 13:56:34,633 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-15 13:56:35,072 - dao.payment_dao - INFO - Saved payment: payment_id=fdf47abd-78ae-4a7a-8d6d-70f545d2e521, yookassa_id=2fe0e4d2-000f-5001-9000-18b5a1d4ce07, telegram_id=450966825
2025-06-15 13:56:35,108 - bot.handlers.payments - INFO - Sent payment link fdf47abd-78ae-4a7a-8d6d-70f545d2e521 to user 450966825
2025-06-15 13:56:35,119 - aiogram.event - INFO - Update id=441382657 is handled. Duration 487 ms by bot id=7187206991
2025-06-15 13:56:35,119 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:56:34 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:56:35,496 - __main__ - INFO - Received webhook request: {"update_id":441382658,
"message":{"message_id":101,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749995795,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:56:35,497 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-15 13:56:35,537 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-15 13:56:35,537 - aiogram.event - INFO - Update id=441382658 is handled. Duration 40 ms by bot id=7187206991
2025-06-15 13:56:35,538 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:56:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:56:40,538 - __main__ - INFO - Received webhook request: {"update_id":441382659,
"callback_query":{"id":"1936887767064202878","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":102,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749995795,"text":"\u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":221,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-15 13:56:40,539 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-15 13:56:40,911 - dao.payment_dao - INFO - Saved payment: payment_id=6aedd16f-e4b6-45a1-ad50-37954da77257, yookassa_id=2fe0e4d8-000f-5000-b000-18e2bde1d775, telegram_id=450966825
2025-06-15 13:56:40,962 - bot.handlers.payments - INFO - Sent payment link 6aedd16f-e4b6-45a1-ad50-37954da77257 to user 450966825
2025-06-15 13:56:40,979 - aiogram.event - INFO - Update id=441382659 is handled. Duration 440 ms by bot id=7187206991
2025-06-15 13:56:40,979 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:56:40 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:56:48,481 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0e4d8-000f-5000-b000-18e2bde1d775",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0e4d8-000f-5000-b000-18e2bde1d775",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T13:56:48.011Z",
    "created_at" : "2025-06-15T13:56:40.762Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "6aedd16f-e4b6-45a1-ad50-37954da77257"
    }
  }
}
2025-06-15 13:56:48,529 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0e4d8-000f-5000-b000-18e2bde1d775, status=succeeded
2025-06-15 13:56:48,570 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:56:48,576 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:56:48,577 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-15 13:56:52,925 - __main__ - INFO - Received webhook request: {"update_id":441382660,
"message":{"message_id":105,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1749995812,"text":"/start payment_success_6aedd16f-e4b6-45a1-ad50-37954da77257","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 13:56:52,926 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: 6aedd16f-e4b6-45a1-ad50-37954da77257
2025-06-15 13:56:53,108 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 13:56:53,110 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 13:56:53,110 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-15 13:56:53,729 - bot.handlers.payments - INFO - Payment succeeded: payment_id=6aedd16f-e4b6-45a1-ad50-37954da77257, yookassa_id=2fe0e4d8-000f-5000-b000-18e2bde1d775, user=450966825
2025-06-15 13:56:53,729 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:56:48 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 13:56:58,262 - bot.handlers.start - INFO - Payment 6aedd16f-e4b6-45a1-ad50-37954da77257 confirmed via deep-link for user 450966825
2025-06-15 13:56:58,262 - aiogram.event - INFO - Update id=441382660 is handled. Duration 5336 ms by bot id=7187206991
2025-06-15 13:56:58,262 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:13:56:52 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 13:58:18,547 - aiohttp.access - INFO - 80.82.77.202 [15/Jun/2025:13:58:18 +0000] "GET / HTTP/1.0" 404 175 "-" "Mozilla/5.0 (Windows; U; Windows CE 5.1; rv:1.8.1a3) Gecko/20060610 Minimo/0.016"
2025-06-15 13:59:10,907 - aiohttp.access - INFO - 80.82.77.202 [15/Jun/2025:13:59:10 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-15 13:59:10,912 - aiohttp.access - INFO - 80.82.77.202 [15/Jun/2025:13:59:10 +0000] "GET /aaa9 HTTP/1.1" 404 194 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36"
2025-06-15 13:59:10,920 - aiohttp.access - INFO - 80.82.77.202 [15/Jun/2025:13:59:10 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-15 13:59:10,924 - aiohttp.access - INFO - 80.82.77.202 [15/Jun/2025:13:59:10 +0000] "GET /aab9 HTTP/1.1" 404 194 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36"
2025-06-15 13:59:37,595 - __main__ - INFO - Bot stopped by user
2025-06-15 14:33:54,728 - __main__ - INFO - Starting bot...
2025-06-15 14:33:54,729 - __main__ - INFO - Routers and middleware included
2025-06-15 14:33:54,729 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 14:33:54,730 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 14:33:54,730 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 14:33:54,749 - __main__ - INFO - Webhook set successfully
2025-06-15 14:33:54,749 - __main__ - INFO - Web server started on port 8443
2025-06-15 14:34:01,804 - __main__ - INFO - Bot stopped by user
2025-06-15 14:37:04,328 - __main__ - INFO - Starting bot...
2025-06-15 14:37:04,328 - __main__ - INFO - Routers and middleware included
2025-06-15 14:37:04,328 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 14:37:04,329 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 14:37:04,329 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 14:37:04,348 - __main__ - INFO - Webhook set successfully
2025-06-15 14:37:04,349 - __main__ - INFO - Web server started on port 8443
2025-06-15 14:37:16,322 - __main__ - INFO - Bot stopped by user
2025-06-15 14:37:16,414 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7fa3bb5e42f0>, 225294.40747121)])']
connector: <aiohttp.connector.TCPConnector object at 0x7fa3bb5f9fd0>
2025-06-15 15:33:26,113 - __main__ - INFO - Starting bot...
2025-06-15 15:33:26,113 - __main__ - INFO - Routers and middleware included
2025-06-15 15:33:26,113 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 15:33:26,114 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 15:33:26,114 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 15:33:26,140 - __main__ - INFO - Webhook set successfully
2025-06-15 15:33:26,141 - __main__ - INFO - Web server started on port 8443
2025-06-15 15:34:27,013 - __main__ - INFO - Bot stopped by user
2025-06-15 15:34:27,109 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fcbed9824d0>
2025-06-15 15:36:08,434 - __main__ - INFO - Starting bot...
2025-06-15 15:36:08,450 - __main__ - INFO - Routers and middleware included
2025-06-15 15:36:08,450 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 15:36:08,451 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 15:36:08,451 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 15:36:08,508 - __main__ - INFO - Webhook set successfully
2025-06-15 15:36:08,509 - __main__ - INFO - Web server started on port 8443
2025-06-15 15:36:11,346 - __main__ - INFO - Received webhook request: {"update_id":441382663,
"message":{"message_id":111,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750001771,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 15:36:11,347 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 15:36:11,419 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 15:36:11,420 - aiogram.event - INFO - Update id=441382663 is handled. Duration 73 ms by bot id=7187206991
2025-06-15 15:36:11,420 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:36:11 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:36:15,608 - __main__ - INFO - Received webhook request: {"update_id":441382664,
"callback_query":{"id":"1869190636403715263","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":112,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750001771,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 15:36:15,610 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 15:36:16,110 - dao.payment_dao - INFO - Saved payment: payment_id=d700c0f7-192c-40a2-9614-12ddb20306ce, yookassa_id=2fe0fc2f-000f-5000-b000-105a8a60b48c, telegram_id=435204858
2025-06-15 15:36:16,150 - bot.handlers.payments - INFO - Sent payment link d700c0f7-192c-40a2-9614-12ddb20306ce to user 435204858
2025-06-15 15:36:16,169 - aiogram.event - INFO - Update id=441382664 is handled. Duration 559 ms by bot id=7187206991
2025-06-15 15:36:16,169 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:36:15 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:36:30,664 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0fc2f-000f-5000-b000-105a8a60b48c",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0fc2f-000f-5000-b000-105a8a60b48c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T15:36:30.297Z",
    "created_at" : "2025-06-15T15:36:15.967Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "d700c0f7-192c-40a2-9614-12ddb20306ce"
    }
  }
}
2025-06-15 15:36:30,726 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0fc2f-000f-5000-b000-105a8a60b48c, status=succeeded
2025-06-15 15:36:30,808 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 15:36:30,811 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 15:36:30,812 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 15:36:35,901 - bot.handlers.payments - INFO - Payment succeeded: payment_id=d700c0f7-192c-40a2-9614-12ddb20306ce, yookassa_id=2fe0fc2f-000f-5000-b000-105a8a60b48c, user=435204858
2025-06-15 15:36:35,902 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:36:30 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 15:37:11,033 - __main__ - INFO - Bot stopped by user
2025-06-15 15:38:41,796 - __main__ - INFO - Starting bot...
2025-06-15 15:38:41,796 - __main__ - INFO - Routers and middleware included
2025-06-15 15:38:41,797 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 15:38:41,798 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 15:38:41,798 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 15:38:41,816 - __main__ - INFO - Webhook set successfully
2025-06-15 15:38:41,817 - __main__ - INFO - Web server started on port 8443
2025-06-15 15:38:48,604 - __main__ - INFO - Received webhook request: {"update_id":441382666,
"message":{"message_id":117,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750001928,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 15:38:48,606 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 15:38:48,661 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 15:38:48,662 - aiogram.event - INFO - Update id=441382666 is handled. Duration 56 ms by bot id=7187206991
2025-06-15 15:38:48,662 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:38:48 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:39:02,865 - __main__ - INFO - Received webhook request: {"update_id":441382667,
"message":{"message_id":119,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750001942,"text":"/users","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 15:39:02,866 - bot.handlers.admin - INFO - Export requested by admin 435204858
2025-06-15 15:39:02,869 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 15:39:03,023 - bot.handlers.admin - ERROR - Error exporting users: name 'FSInputFile' is not defined
2025-06-15 15:39:03,191 - aiogram.event - INFO - Update id=441382667 is handled. Duration 326 ms by bot id=7187206991
2025-06-15 15:39:03,192 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:39:02 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:40:02,973 - __main__ - INFO - Bot stopped by user
2025-06-15 15:40:22,815 - __main__ - INFO - Starting bot...
2025-06-15 15:40:22,816 - __main__ - INFO - Routers and middleware included
2025-06-15 15:40:22,816 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 15:40:22,817 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 15:40:22,817 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 15:40:22,853 - __main__ - INFO - Webhook set successfully
2025-06-15 15:40:22,853 - __main__ - INFO - Web server started on port 8443
2025-06-15 15:40:36,515 - __main__ - INFO - Received webhook request: {"update_id":441382668,
"message":{"message_id":121,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002036,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 15:40:36,517 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 15:40:36,620 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 15:40:36,620 - aiogram.event - INFO - Update id=441382668 is handled. Duration 103 ms by bot id=7187206991
2025-06-15 15:40:36,621 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:40:36 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:40:38,104 - __main__ - INFO - Received webhook request: {"update_id":441382669,
"callback_query":{"id":"1869190633692681084","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":122,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002036,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 15:40:38,106 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 15:40:38,572 - dao.payment_dao - INFO - Saved payment: payment_id=ec7839fa-4ca6-4853-99c1-76718d7ff804, yookassa_id=2fe0fd36-000f-5000-b000-1481d1e3c51a, telegram_id=435204858
2025-06-15 15:40:38,614 - bot.handlers.payments - INFO - Sent payment link ec7839fa-4ca6-4853-99c1-76718d7ff804 to user 435204858
2025-06-15 15:40:38,635 - aiogram.event - INFO - Update id=441382669 is handled. Duration 529 ms by bot id=7187206991
2025-06-15 15:40:38,635 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:40:38 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:40:50,357 - __main__ - INFO - Received webhook request: {"update_id":441382670,
"message":{"message_id":124,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002050,"text":"/users","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 15:40:50,448 - aiogram.event - INFO - Update id=441382670 is handled. Duration 90 ms by bot id=7187206991
2025-06-15 15:40:50,449 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:40:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:41:03,593 - __main__ - INFO - Bot stopped by user
2025-06-15 15:41:46,984 - __main__ - INFO - Starting bot...
2025-06-15 15:41:46,984 - __main__ - INFO - Routers and middleware included
2025-06-15 15:41:46,985 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 15:41:46,986 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 15:41:46,986 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 15:41:47,028 - __main__ - INFO - Webhook set successfully
2025-06-15 15:41:47,029 - __main__ - INFO - Web server started on port 8443
2025-06-15 15:41:51,233 - __main__ - INFO - Bot stopped by user
2025-06-15 15:41:51,317 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7fc561eb8130>, 229177.087030278)])']
connector: <aiohttp.connector.TCPConnector object at 0x7fc561ecdf90>
2025-06-15 15:42:19,624 - __main__ - INFO - Starting bot...
2025-06-15 15:42:19,624 - __main__ - INFO - Routers and middleware included
2025-06-15 15:42:19,625 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 15:42:19,626 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 15:42:19,626 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 15:42:19,664 - __main__ - INFO - Webhook set successfully
2025-06-15 15:42:19,665 - __main__ - INFO - Web server started on port 8443
2025-06-15 15:42:35,953 - __main__ - INFO - Received webhook request: {"update_id":441382671,
"message":{"message_id":126,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002155,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 15:42:35,955 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 15:42:36,006 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 15:42:36,006 - aiogram.event - INFO - Update id=441382671 is handled. Duration 52 ms by bot id=7187206991
2025-06-15 15:42:36,007 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:42:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:42:37,352 - __main__ - INFO - Received webhook request: {"update_id":441382672,
"callback_query":{"id":"1869190635529336371","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":127,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002155,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 15:42:37,354 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 15:42:37,735 - dao.payment_dao - INFO - Saved payment: payment_id=9ddb5d3d-e99c-4ff9-b320-e81c55692002, yookassa_id=2fe0fdad-000f-5000-b000-1ca455d64c08, telegram_id=435204858
2025-06-15 15:42:37,815 - bot.handlers.payments - INFO - Sent payment link 9ddb5d3d-e99c-4ff9-b320-e81c55692002 to user 435204858
2025-06-15 15:42:37,859 - aiogram.event - INFO - Update id=441382672 is handled. Duration 506 ms by bot id=7187206991
2025-06-15 15:42:37,859 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:42:37 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:42:45,967 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0fdad-000f-5000-b000-1ca455d64c08",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0fdad-000f-5000-b000-1ca455d64c08",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T15:42:45.727Z",
    "created_at" : "2025-06-15T15:42:37.598Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "9ddb5d3d-e99c-4ff9-b320-e81c55692002"
    }
  }
}
2025-06-15 15:42:46,042 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0fdad-000f-5000-b000-1ca455d64c08, status=succeeded
2025-06-15 15:42:46,139 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 15:42:46,145 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 15:42:46,145 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 15:42:51,358 - bot.handlers.payments - INFO - Payment succeeded: payment_id=9ddb5d3d-e99c-4ff9-b320-e81c55692002, yookassa_id=2fe0fdad-000f-5000-b000-1ca455d64c08, user=435204858
2025-06-15 15:42:51,358 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:42:45 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 15:42:58,272 - __main__ - INFO - Received webhook request: {"update_id":441382673,
"message":{"message_id":131,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002178,"text":"/users","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 15:42:58,274 - bot.handlers.admin - INFO - Export requested by admin 435204858
2025-06-15 15:42:58,275 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 15:42:58,473 - bot.handlers.admin - INFO - Exported 4 users to Excel
2025-06-15 15:42:58,474 - aiogram.event - INFO - Update id=441382673 is handled. Duration 200 ms by bot id=7187206991
2025-06-15 15:42:58,474 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:42:58 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:48:00,094 - __main__ - INFO - Received webhook request: {"update_id":441382674,
"callback_query":{"id":"1869190632772134515","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":127,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002155,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 15:48:00,099 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 15:48:00,906 - dao.payment_dao - INFO - Saved payment: payment_id=2abc9331-329f-4e41-88a7-cea8a1155261, yookassa_id=2fe0fef0-000f-5000-b000-1a24dd0446eb, telegram_id=435204858
2025-06-15 15:48:00,985 - bot.handlers.payments - INFO - Sent payment link 2abc9331-329f-4e41-88a7-cea8a1155261 to user 435204858
2025-06-15 15:48:01,024 - aiogram.event - INFO - Update id=441382674 is handled. Duration 927 ms by bot id=7187206991
2025-06-15 15:48:01,028 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:48:00 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:48:09,127 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0fef0-000f-5000-b000-1a24dd0446eb",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0fef0-000f-5000-b000-1a24dd0446eb",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T15:48:08.722Z",
    "created_at" : "2025-06-15T15:48:00.455Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "2abc9331-329f-4e41-88a7-cea8a1155261"
    }
  }
}
2025-06-15 15:48:09,219 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0fef0-000f-5000-b000-1a24dd0446eb, status=succeeded
2025-06-15 15:48:09,324 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 15:48:09,329 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 15:48:09,329 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 15:48:14,440 - bot.handlers.payments - INFO - Payment succeeded: payment_id=2abc9331-329f-4e41-88a7-cea8a1155261, yookassa_id=2fe0fef0-000f-5000-b000-1a24dd0446eb, user=435204858
2025-06-15 15:48:14,440 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:48:09 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 15:48:42,754 - __main__ - INFO - Bot stopped by user
2025-06-15 15:50:52,557 - __main__ - INFO - Starting bot...
2025-06-15 15:50:52,557 - __main__ - INFO - Routers and middleware included
2025-06-15 15:50:52,558 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 15:50:52,559 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 15:50:52,559 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 15:50:52,576 - __main__ - INFO - Webhook set successfully
2025-06-15 15:50:52,577 - __main__ - INFO - Web server started on port 8443
2025-06-15 15:51:01,819 - __main__ - INFO - Received webhook request: {"update_id":441382675,
"callback_query":{"id":"1869190632834374001","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":127,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750002155,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 15:51:01,822 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 15:51:02,658 - dao.payment_dao - INFO - Saved payment: payment_id=d9ed2ea6-e253-4098-b0e1-388d2178fcaf, yookassa_id=2fe0ffa6-000f-5000-b000-11de09345c20, telegram_id=435204858
2025-06-15 15:51:02,798 - bot.handlers.payments - INFO - Sent payment link d9ed2ea6-e253-4098-b0e1-388d2178fcaf to user 435204858
2025-06-15 15:51:02,886 - aiogram.event - INFO - Update id=441382675 is handled. Duration 1065 ms by bot id=7187206991
2025-06-15 15:51:02,887 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:51:01 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 15:51:12,273 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe0ffa6-000f-5000-b000-11de09345c20",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0ffa6-000f-5000-b000-11de09345c20",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T15:51:11.606Z",
    "created_at" : "2025-06-15T15:51:02.189Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "d9ed2ea6-e253-4098-b0e1-388d2178fcaf"
    }
  }
}
2025-06-15 15:51:12,393 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe0ffa6-000f-5000-b000-11de09345c20, status=succeeded
2025-06-15 15:51:12,466 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 15:51:12,470 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 15:51:12,470 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 15:51:17,590 - bot.handlers.payments - INFO - Payment succeeded: payment_id=d9ed2ea6-e253-4098-b0e1-388d2178fcaf, yookassa_id=2fe0ffa6-000f-5000-b000-11de09345c20, user=435204858
2025-06-15 15:51:17,590 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:15:51:12 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 15:51:20,454 - __main__ - INFO - Bot stopped by user
2025-06-15 17:16:27,632 - __main__ - INFO - Starting bot...
2025-06-15 17:16:27,633 - __main__ - INFO - Routers and middleware included
2025-06-15 17:16:27,633 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:16:27,634 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:16:27,634 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:16:27,654 - __main__ - INFO - Webhook set successfully
2025-06-15 17:16:27,655 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:17:30,213 - __main__ - INFO - Bot stopped by user
2025-06-15 17:22:03,174 - __main__ - INFO - Starting bot...
2025-06-15 17:22:03,175 - __main__ - INFO - Routers and middleware included
2025-06-15 17:22:03,175 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:22:03,177 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:22:03,178 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:22:03,207 - __main__ - INFO - Webhook set successfully
2025-06-15 17:22:03,208 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:22:20,166 - __main__ - INFO - Received webhook request: {"update_id":441382676,
"message":{"message_id":139,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750008140,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 17:22:20,167 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 17:22:20,226 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 17:22:20,226 - aiogram.event - INFO - Update id=441382676 is handled. Duration 59 ms by bot id=7187206991
2025-06-15 17:22:20,227 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:17:22:20 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 17:22:21,840 - __main__ - INFO - Received webhook request: {"update_id":441382677,
"callback_query":{"id":"1869190632489640641","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":140,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750008140,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 17:22:21,842 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 17:22:22,315 - dao.payment_dao - INFO - Saved payment: payment_id=7a817732-e552-4635-a0b9-f32d659f8904, yookassa_id=2fe1150e-000f-5001-9000-13069c8a6441, telegram_id=435204858
2025-06-15 17:22:22,350 - bot.handlers.payments - INFO - Sent payment link 7a817732-e552-4635-a0b9-f32d659f8904 to user 435204858
2025-06-15 17:22:22,362 - aiogram.event - INFO - Update id=441382677 is handled. Duration 520 ms by bot id=7187206991
2025-06-15 17:22:22,363 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:17:22:21 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 17:22:29,942 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1150e-000f-5001-9000-13069c8a6441",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1150e-000f-5001-9000-13069c8a6441",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T17:22:29.624Z",
    "created_at" : "2025-06-15T17:22:22.168Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "7a817732-e552-4635-a0b9-f32d659f8904"
    }
  }
}
2025-06-15 17:22:30,302 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1150e-000f-5001-9000-13069c8a6441, status=succeeded
2025-06-15 17:22:30,518 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:22:30,521 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 17:22:30,521 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 17:22:35,861 - bot.handlers.payments - INFO - Payment succeeded: payment_id=7a817732-e552-4635-a0b9-f32d659f8904, yookassa_id=2fe1150e-000f-5001-9000-13069c8a6441, user=435204858
2025-06-15 17:22:35,904 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:17:22:29 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 17:23:05,313 - __main__ - INFO - Bot stopped by user
2025-06-15 17:23:39,964 - __main__ - INFO - Starting bot...
2025-06-15 17:23:39,964 - __main__ - INFO - Routers and middleware included
2025-06-15 17:23:39,964 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:23:39,965 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:23:39,965 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:23:40,007 - __main__ - INFO - Webhook set successfully
2025-06-15 17:23:40,008 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:24:00,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:26:00 UTC)" (scheduled at 2025-06-15 17:24:00+00:00)
2025-06-15 17:24:00,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:24:00,007 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:24:01,461 - scheduler - ERROR - ❌ Error renewing subscription for user 450966825: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 17:24:01,529 - scheduler - ERROR - Error checking subscriptions: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 17:24:01,529 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:26:00 UTC)" executed successfully
2025-06-15 17:24:01,973 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe11570-000f-5000-b000-1abe43278679",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0e4d8-000f-5000-b000-18e2bde1d775",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "created_at" : "2025-06-15T17:24:00.378Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "4ea7b513-b78f-4e6b-8f3a-98c349f7d1b8"
    },
    "cancellation_details" : {
      "party" : "payment_network",
      "reason" : "identification_required"
    }
  }
}
2025-06-15 17:24:01,974 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:17:24:01 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 17:25:17,036 - __main__ - INFO - Bot stopped by user
2025-06-15 17:25:31,295 - __main__ - INFO - Starting bot...
2025-06-15 17:25:31,295 - __main__ - INFO - Routers and middleware included
2025-06-15 17:25:31,296 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:25:31,296 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:25:31,297 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:25:31,322 - __main__ - INFO - Webhook set successfully
2025-06-15 17:25:31,323 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:26:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:28:00 UTC)" (scheduled at 2025-06-15 17:26:00+00:00)
2025-06-15 17:26:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:26:00,014 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:26:01,463 - scheduler - ERROR - ❌ Error renewing subscription for user 450966825: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 17:26:01,464 - scheduler - ERROR - Error checking subscriptions: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 17:26:01,464 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:28:00 UTC)" executed successfully
2025-06-15 17:26:01,873 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe115e8-000f-5000-b000-1cd0d924f8b5",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe0e4d8-000f-5000-b000-18e2bde1d775",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "created_at" : "2025-06-15T17:26:00.351Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "355e6809-4467-44a9-ad20-ea6348ed8011"
    },
    "cancellation_details" : {
      "party" : "payment_network",
      "reason" : "identification_required"
    }
  }
}
2025-06-15 17:26:01,874 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:17:26:01 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 17:26:21,033 - __main__ - INFO - Bot stopped by user
2025-06-15 17:26:21,135 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fe66b440cd0>
2025-06-15 17:27:53,163 - __main__ - INFO - Starting bot...
2025-06-15 17:27:53,163 - __main__ - INFO - Routers and middleware included
2025-06-15 17:27:53,164 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:27:53,164 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:27:53,164 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:27:53,187 - __main__ - INFO - Webhook set successfully
2025-06-15 17:27:53,188 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:28:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:30:00 UTC)" (scheduled at 2025-06-15 17:28:00+00:00)
2025-06-15 17:28:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:28:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:28:01,554 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 17:28:01,555 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:30:00 UTC)" executed successfully
2025-06-15 17:30:00,078 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:32:00 UTC)" (scheduled at 2025-06-15 17:30:00+00:00)
2025-06-15 17:30:00,079 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:30:00,082 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:30:01,718 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 17:30:01,719 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:32:00 UTC)" executed successfully
2025-06-15 17:32:00,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:34:00 UTC)" (scheduled at 2025-06-15 17:32:00+00:00)
2025-06-15 17:32:00,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:32:00,007 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:32:01,558 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 17:32:01,559 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:34:00 UTC)" executed successfully
2025-06-15 17:32:50,994 - __main__ - INFO - Bot stopped by user
2025-06-15 17:32:51,147 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fd0d1d4e050>
2025-06-15 17:40:10,709 - __main__ - INFO - Starting bot...
2025-06-15 17:40:10,709 - __main__ - INFO - Routers and middleware included
2025-06-15 17:40:10,710 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:40:10,711 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:40:10,711 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:40:10,751 - __main__ - INFO - Webhook set successfully
2025-06-15 17:40:10,753 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:42:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:44:00 UTC)" (scheduled at 2025-06-15 17:42:00+00:00)
2025-06-15 17:42:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:42:00,007 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:42:01,628 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 17:42:01,629 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:44:00 UTC)" executed successfully
2025-06-15 17:42:11,397 - __main__ - INFO - Bot stopped by user
2025-06-15 17:42:11,546 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f82b85edb90>
2025-06-15 17:48:08,030 - __main__ - INFO - Starting bot...
2025-06-15 17:48:08,030 - __main__ - INFO - Routers and middleware included
2025-06-15 17:48:08,031 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:48:08,032 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:48:08,032 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:48:08,066 - __main__ - INFO - Webhook set successfully
2025-06-15 17:48:08,067 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:50:00,073 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:52:00 UTC)" (scheduled at 2025-06-15 17:50:00+00:00)
2025-06-15 17:50:00,074 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:50:00,080 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:50:02,425 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 17:50:02,425 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:52:00 UTC)" executed successfully
2025-06-15 17:50:14,902 - __main__ - INFO - Bot stopped by user
2025-06-15 17:50:15,021 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f14aa14fd90>
2025-06-15 17:55:50,039 - __main__ - INFO - Starting bot...
2025-06-15 17:55:50,040 - __main__ - INFO - Routers and middleware included
2025-06-15 17:55:50,040 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 17:55:50,041 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 17:55:50,041 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 17:55:50,111 - __main__ - INFO - Webhook set successfully
2025-06-15 17:55:50,112 - __main__ - INFO - Web server started on port 8443
2025-06-15 17:56:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:58:00 UTC)" (scheduled at 2025-06-15 17:56:00+00:00)
2025-06-15 17:56:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:56:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:56:01,569 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 17:56:01,569 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 17:58:00 UTC)" executed successfully
2025-06-15 17:58:00,061 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:00:00 UTC)" (scheduled at 2025-06-15 17:58:00+00:00)
2025-06-15 17:58:00,063 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 17:58:00,071 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 17:58:01,586 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 17:58:01,587 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:00:00 UTC)" executed successfully
2025-06-15 17:58:21,132 - __main__ - INFO - Bot stopped by user
2025-06-15 17:58:21,272 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f4099fec910>
2025-06-15 18:01:19,567 - __main__ - INFO - Starting bot...
2025-06-15 18:01:19,567 - __main__ - INFO - Routers and middleware included
2025-06-15 18:01:19,568 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 18:01:19,568 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 18:01:19,568 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 18:01:19,607 - __main__ - INFO - Webhook set successfully
2025-06-15 18:01:19,608 - __main__ - INFO - Web server started on port 8443
2025-06-15 18:02:00,026 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:04:00 UTC)" (scheduled at 2025-06-15 18:02:00+00:00)
2025-06-15 18:02:00,027 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:02:00,034 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:02:01,505 - scheduler - ERROR - ❌ Error renewing subscription for user 450966825: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 18:02:01,505 - scheduler - ERROR - Error checking subscriptions: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 18:02:01,506 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:04:00 UTC)" executed successfully
2025-06-15 18:02:43,632 - __main__ - INFO - Bot stopped by user
2025-06-15 18:05:21,006 - __main__ - INFO - Starting bot...
2025-06-15 18:05:21,006 - __main__ - INFO - Routers and middleware included
2025-06-15 18:05:21,006 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 18:05:21,007 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 18:05:21,007 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 18:05:21,048 - __main__ - INFO - Webhook set successfully
2025-06-15 18:05:21,049 - __main__ - INFO - Web server started on port 8443
2025-06-15 18:06:00,024 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:08:00 UTC)" (scheduled at 2025-06-15 18:06:00+00:00)
2025-06-15 18:06:00,025 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:06:00,029 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:06:01,334 - scheduler - ERROR - ❌ Error renewing subscription for user 450966825: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 18:06:01,334 - scheduler - ERROR - Error checking subscriptions: (sqlite3.OperationalError) unable to open database file
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-15 18:06:01,335 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:08:00 UTC)" executed successfully
2025-06-15 18:06:50,723 - __main__ - INFO - Bot stopped by user
2025-06-15 18:06:51,082 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f7227737c50>
2025-06-15 18:09:41,466 - __main__ - INFO - Starting bot...
2025-06-15 18:09:41,466 - __main__ - INFO - Routers and middleware included
2025-06-15 18:09:41,466 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 18:09:41,467 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 18:09:41,467 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 18:09:41,485 - __main__ - INFO - Webhook set successfully
2025-06-15 18:09:41,485 - __main__ - INFO - Web server started on port 8443
2025-06-15 18:10:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:12:00 UTC)" (scheduled at 2025-06-15 18:10:00+00:00)
2025-06-15 18:10:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:10:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:10:01,531 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 18:10:01,532 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:12:00 UTC)" executed successfully
2025-06-15 18:12:00,102 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:14:00 UTC)" (scheduled at 2025-06-15 18:12:00+00:00)
2025-06-15 18:12:00,104 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:12:00,108 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:12:01,579 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 18:12:01,579 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:14:00 UTC)" executed successfully
2025-06-15 18:12:12,103 - __main__ - INFO - Bot stopped by user
2025-06-15 18:32:33,583 - __main__ - INFO - Starting bot...
2025-06-15 18:32:33,584 - __main__ - INFO - Routers and middleware included
2025-06-15 18:32:33,584 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 18:32:33,585 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 18:32:33,585 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 18:32:33,642 - __main__ - INFO - Webhook set successfully
2025-06-15 18:32:33,642 - __main__ - INFO - Web server started on port 8443
2025-06-15 18:34:00,006 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:36:00 UTC)" (scheduled at 2025-06-15 18:34:00+00:00)
2025-06-15 18:34:00,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:34:00,013 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:34:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:36:00 UTC)" executed successfully
2025-06-15 18:36:00,101 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:38:00 UTC)" (scheduled at 2025-06-15 18:36:00+00:00)
2025-06-15 18:36:00,102 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:36:00,105 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:36:00,105 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:38:00 UTC)" executed successfully
2025-06-15 18:36:36,441 - aiohttp.access - INFO - 86.107.101.21 [15/Jun/2025:18:36:36 +0000] "CONNECT  HTTP/1.1" 404 175 "-" "Go-http-client/1.1"
2025-06-15 18:36:49,227 - __main__ - INFO - Bot stopped by user
2025-06-15 18:36:49,375 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f488af6ed90>
2025-06-15 18:51:00,553 - __main__ - INFO - Starting bot...
2025-06-15 18:51:00,553 - __main__ - INFO - Routers and middleware included
2025-06-15 18:51:00,553 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 18:51:00,554 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 18:51:00,554 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 18:51:00,576 - __main__ - INFO - Webhook set successfully
2025-06-15 18:51:00,577 - __main__ - INFO - Web server started on port 8443
2025-06-15 18:51:02,895 - __main__ - INFO - Bot stopped by user
2025-06-15 18:51:02,989 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7fa24d48c2f0>, 240530.635220253)])']
connector: <aiohttp.connector.TCPConnector object at 0x7fa24d49e450>
2025-06-15 18:52:46,621 - __main__ - INFO - Starting bot...
2025-06-15 18:52:46,621 - __main__ - INFO - Routers and middleware included
2025-06-15 18:52:46,622 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 18:52:46,622 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 18:52:46,622 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 18:52:46,642 - __main__ - INFO - Webhook set successfully
2025-06-15 18:52:46,643 - __main__ - INFO - Web server started on port 8443
2025-06-15 18:54:00,032 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:56:00 UTC)" (scheduled at 2025-06-15 18:54:00+00:00)
2025-06-15 18:54:00,032 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:54:00,035 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:54:01,814 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 18:54:01,814 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:56:00 UTC)" executed successfully
2025-06-15 18:56:00,070 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:58:00 UTC)" (scheduled at 2025-06-15 18:56:00+00:00)
2025-06-15 18:56:00,071 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:56:00,075 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:56:01,700 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 18:56:01,700 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 18:58:00 UTC)" executed successfully
2025-06-15 18:58:00,052 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:00:00 UTC)" (scheduled at 2025-06-15 18:58:00+00:00)
2025-06-15 18:58:00,053 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 18:58:00,058 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 18:58:01,569 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 18:58:01,569 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:00:00 UTC)" executed successfully
2025-06-15 18:58:20,662 - __main__ - INFO - Bot stopped by user
2025-06-15 19:03:04,116 - __main__ - INFO - Starting bot...
2025-06-15 19:03:04,116 - __main__ - INFO - Routers and middleware included
2025-06-15 19:03:04,117 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 19:03:04,117 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 19:03:04,118 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 19:03:04,171 - __main__ - INFO - Webhook set successfully
2025-06-15 19:03:04,171 - __main__ - INFO - Web server started on port 8443
2025-06-15 19:04:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:06:00 UTC)" (scheduled at 2025-06-15 19:04:00+00:00)
2025-06-15 19:04:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:04:00,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:04:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:06:00 UTC)" executed successfully
2025-06-15 19:04:13,990 - __main__ - INFO - Bot stopped by user
2025-06-15 19:04:14,094 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fafaeaced10>
2025-06-15 19:05:11,804 - __main__ - INFO - Starting bot...
2025-06-15 19:05:11,804 - __main__ - INFO - Routers and middleware included
2025-06-15 19:05:11,804 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 19:05:11,805 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 19:05:11,805 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 19:05:11,823 - __main__ - INFO - Webhook set successfully
2025-06-15 19:05:11,823 - __main__ - INFO - Web server started on port 8443
2025-06-15 19:06:00,036 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:08:00 UTC)" (scheduled at 2025-06-15 19:06:00+00:00)
2025-06-15 19:06:00,037 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:06:00,042 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:06:01,140 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 19:06:01,140 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:08:00 UTC)" executed successfully
2025-06-15 19:08:00,075 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:10:00 UTC)" (scheduled at 2025-06-15 19:08:00+00:00)
2025-06-15 19:08:00,076 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:08:00,078 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:08:01,762 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 19:08:01,762 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:10:00 UTC)" executed successfully
2025-06-15 19:10:00,102 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:12:00 UTC)" (scheduled at 2025-06-15 19:10:00+00:00)
2025-06-15 19:10:00,102 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:10:00,105 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:10:01,750 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 19:10:01,750 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:12:00 UTC)" executed successfully
2025-06-15 19:12:00,090 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:14:00 UTC)" (scheduled at 2025-06-15 19:12:00+00:00)
2025-06-15 19:12:00,091 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:12:00,094 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:12:01,409 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 19:12:01,409 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:14:00 UTC)" executed successfully
2025-06-15 19:13:28,274 - __main__ - INFO - Bot stopped by user
2025-06-15 19:14:06,224 - __main__ - INFO - Starting bot...
2025-06-15 19:14:06,224 - __main__ - INFO - Routers and middleware included
2025-06-15 19:14:06,224 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 19:14:06,225 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 19:14:06,225 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 19:14:06,246 - __main__ - INFO - Webhook set successfully
2025-06-15 19:14:06,247 - __main__ - INFO - Web server started on port 8443
2025-06-15 19:16:00,100 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:18:00 UTC)" (scheduled at 2025-06-15 19:16:00+00:00)
2025-06-15 19:16:00,101 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:16:00,106 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:16:01,645 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 19:16:01,646 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:18:00 UTC)" executed successfully
2025-06-15 19:18:00,047 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:20:00 UTC)" (scheduled at 2025-06-15 19:18:00+00:00)
2025-06-15 19:18:00,048 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:18:00,052 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:18:00,055 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:20:00 UTC)" executed successfully
2025-06-15 19:20:00,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:22:00 UTC)" (scheduled at 2025-06-15 19:20:00+00:00)
2025-06-15 19:20:00,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:20:00,008 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:20:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:22:00 UTC)" executed successfully
2025-06-15 19:22:00,024 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:24:00 UTC)" (scheduled at 2025-06-15 19:22:00+00:00)
2025-06-15 19:22:00,025 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:22:00,028 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:22:00,031 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:24:00 UTC)" executed successfully
2025-06-15 19:22:27,797 - __main__ - INFO - Bot stopped by user
2025-06-15 19:22:45,437 - __main__ - INFO - Starting bot...
2025-06-15 19:22:45,438 - __main__ - INFO - Routers and middleware included
2025-06-15 19:22:45,438 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 19:22:45,439 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 19:22:45,439 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 19:22:45,502 - __main__ - INFO - Webhook set successfully
2025-06-15 19:22:45,503 - __main__ - INFO - Web server started on port 8443
2025-06-15 19:23:21,160 - __main__ - INFO - Received webhook request: {"update_id":441382684,
"message":{"message_id":167,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750015401,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 19:23:21,162 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 19:23:21,224 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 19:23:21,224 - aiogram.event - INFO - Update id=441382684 is handled. Duration 63 ms by bot id=7187206991
2025-06-15 19:23:21,225 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:23:21 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 19:23:23,671 - __main__ - INFO - Received webhook request: {"update_id":441382685,
"callback_query":{"id":"1869190633683094607","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":168,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750015401,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 19:23:23,673 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 19:23:24,186 - dao.payment_dao - INFO - Saved payment: payment_id=734e0168-4cd1-4ef4-a7e2-81d356923d83, yookassa_id=2fe1316c-000f-5000-b000-1fc6e8c64f2c, telegram_id=435204858
2025-06-15 19:23:24,227 - bot.handlers.payments - INFO - Sent payment link 734e0168-4cd1-4ef4-a7e2-81d356923d83 to user 435204858
2025-06-15 19:23:24,243 - aiogram.event - INFO - Update id=441382685 is handled. Duration 570 ms by bot id=7187206991
2025-06-15 19:23:24,243 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:23:23 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 19:23:31,459 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1316c-000f-5000-b000-1fc6e8c64f2c",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1316c-000f-5000-b000-1fc6e8c64f2c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T19:23:30.939Z",
    "created_at" : "2025-06-15T19:23:24.019Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "734e0168-4cd1-4ef4-a7e2-81d356923d83"
    }
  }
}
2025-06-15 19:23:31,551 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1316c-000f-5000-b000-1fc6e8c64f2c, status=succeeded
2025-06-15 19:23:31,613 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:23:31,617 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 19:23:31,618 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 19:23:36,683 - bot.handlers.payments - INFO - Payment succeeded: payment_id=734e0168-4cd1-4ef4-a7e2-81d356923d83, yookassa_id=2fe1316c-000f-5000-b000-1fc6e8c64f2c, user=435204858
2025-06-15 19:23:36,684 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:23:31 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 19:24:00,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:26:00 UTC)" (scheduled at 2025-06-15 19:24:00+00:00)
2025-06-15 19:24:00,010 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:24:00,013 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:24:00,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:26:00 UTC)" executed successfully
2025-06-15 19:25:31,752 - __main__ - INFO - Received webhook request: {"update_id":441382686,
"message":{"message_id":172,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750015531,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 19:25:31,757 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-15 19:25:31,854 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-15 19:25:31,854 - aiogram.event - INFO - Update id=441382686 is handled. Duration 99 ms by bot id=7187206991
2025-06-15 19:25:31,855 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:25:31 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 19:25:39,564 - __main__ - INFO - Received webhook request: {"update_id":441382687,
"message":{"message_id":174,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750015539,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 19:25:39,565 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-15 19:25:39,650 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-15 19:25:39,650 - aiogram.event - INFO - Update id=441382687 is handled. Duration 85 ms by bot id=7187206991
2025-06-15 19:25:39,651 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:25:39 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 19:26:00,013 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:28:00 UTC)" (scheduled at 2025-06-15 19:26:00+00:00)
2025-06-15 19:26:00,014 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:26:00,017 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:26:00,020 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:28:00 UTC)" executed successfully
2025-06-15 19:26:44,433 - __main__ - INFO - Received webhook request: {"update_id":441382688,
"callback_query":{"id":"1936887765015889312","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":175,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750015539,"text":"\u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":221,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-15 19:26:44,438 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-15 19:26:44,862 - dao.payment_dao - INFO - Saved payment: payment_id=f3bb6e6f-7659-4372-9fd1-5b8912e5b93c, yookassa_id=2fe13234-000f-5000-b000-1a835562926c, telegram_id=450966825
2025-06-15 19:26:44,961 - bot.handlers.payments - INFO - Sent payment link f3bb6e6f-7659-4372-9fd1-5b8912e5b93c to user 450966825
2025-06-15 19:26:44,995 - aiogram.event - INFO - Update id=441382688 is handled. Duration 558 ms by bot id=7187206991
2025-06-15 19:26:44,995 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:26:44 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 19:26:51,145 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe13234-000f-5000-b000-1a835562926c",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe13234-000f-5000-b000-1a835562926c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T19:26:50.800Z",
    "created_at" : "2025-06-15T19:26:44.694Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "f3bb6e6f-7659-4372-9fd1-5b8912e5b93c"
    }
  }
}
2025-06-15 19:26:51,276 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe13234-000f-5000-b000-1a835562926c, status=succeeded
2025-06-15 19:26:51,368 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:26:51,373 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 19:26:51,374 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-15 19:26:53,960 - __main__ - INFO - Received webhook request: {"update_id":441382689,
"message":{"message_id":178,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750015613,"text":"/start payment_success_f3bb6e6f-7659-4372-9fd1-5b8912e5b93c","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 19:26:53,962 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: f3bb6e6f-7659-4372-9fd1-5b8912e5b93c
2025-06-15 19:26:54,159 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:26:54,161 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 19:26:54,161 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-15 19:26:56,707 - bot.handlers.payments - INFO - Payment succeeded: payment_id=f3bb6e6f-7659-4372-9fd1-5b8912e5b93c, yookassa_id=2fe13234-000f-5000-b000-1a835562926c, user=450966825
2025-06-15 19:26:56,708 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:26:51 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 19:26:59,335 - bot.handlers.start - INFO - Payment f3bb6e6f-7659-4372-9fd1-5b8912e5b93c confirmed via deep-link for user 450966825
2025-06-15 19:26:59,335 - aiogram.event - INFO - Update id=441382689 is handled. Duration 5374 ms by bot id=7187206991
2025-06-15 19:26:59,336 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:26:53 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 19:28:00,034 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:30:00 UTC)" (scheduled at 2025-06-15 19:28:00+00:00)
2025-06-15 19:28:00,035 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:28:00,037 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:28:00,040 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:30:00 UTC)" executed successfully
2025-06-15 19:28:12,318 - __main__ - INFO - Bot stopped by user
2025-06-15 19:35:17,972 - __main__ - INFO - Starting bot...
2025-06-15 19:35:17,973 - __main__ - INFO - Routers and middleware included
2025-06-15 19:35:17,973 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 19:35:17,974 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 19:35:17,974 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 19:35:18,032 - __main__ - INFO - Webhook set successfully
2025-06-15 19:35:18,033 - __main__ - INFO - Web server started on port 8443
2025-06-15 19:35:22,734 - __main__ - INFO - Bot stopped by user
2025-06-15 19:35:22,822 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f8c7c78c210>, 243188.090156894)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f8c7c7a1e50>
2025-06-15 19:46:07,760 - __main__ - INFO - Starting bot...
2025-06-15 19:46:07,760 - __main__ - INFO - Routers and middleware included
2025-06-15 19:46:07,761 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 19:46:07,761 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 19:46:07,762 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 19:46:07,803 - __main__ - INFO - Webhook set successfully
2025-06-15 19:46:07,804 - __main__ - INFO - Web server started on port 8443
2025-06-15 19:48:00,062 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:50:00 UTC)" (scheduled at 2025-06-15 19:48:00+00:00)
2025-06-15 19:48:00,063 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:48:00,070 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:48:01,996 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe13730-000f-5001-9000-15bf9ed5c755",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe13234-000f-5000-b000-1a835562926c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "created_at" : "2025-06-15T19:48:00.476Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "95122da7-cddc-43ec-b102-d17eec6da9b5"
    },
    "cancellation_details" : {
      "party" : "payment_network",
      "reason" : "identification_required"
    }
  }
}
2025-06-15 19:48:02,003 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:19:48:01 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 19:48:02,077 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 19:48:02,078 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:50:00 UTC)" executed successfully
2025-06-15 19:50:00,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:52:00 UTC)" (scheduled at 2025-06-15 19:50:00+00:00)
2025-06-15 19:50:00,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:50:00,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:50:00,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:52:00 UTC)" executed successfully
2025-06-15 19:52:00,101 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:54:00 UTC)" (scheduled at 2025-06-15 19:52:00+00:00)
2025-06-15 19:52:00,102 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:52:00,105 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:52:00,108 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:54:00 UTC)" executed successfully
2025-06-15 19:53:08,113 - __main__ - INFO - Bot stopped by user
2025-06-15 19:53:08,261 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f916fbfe690>
2025-06-15 19:53:45,199 - __main__ - INFO - Starting bot...
2025-06-15 19:53:45,200 - __main__ - INFO - Routers and middleware included
2025-06-15 19:53:45,200 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 19:53:45,201 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 19:53:45,201 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 19:53:45,225 - __main__ - INFO - Webhook set successfully
2025-06-15 19:53:45,226 - __main__ - INFO - Web server started on port 8443
2025-06-15 19:54:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:56:00 UTC)" (scheduled at 2025-06-15 19:54:00+00:00)
2025-06-15 19:54:00,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:54:00,017 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:54:00,021 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:56:00 UTC)" executed successfully
2025-06-15 19:56:00,101 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:58:00 UTC)" (scheduled at 2025-06-15 19:56:00+00:00)
2025-06-15 19:56:00,102 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:56:00,104 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:56:00,106 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 19:58:00 UTC)" executed successfully
2025-06-15 19:58:00,101 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:00:00 UTC)" (scheduled at 2025-06-15 19:58:00+00:00)
2025-06-15 19:58:00,102 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 19:58:00,104 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 19:58:00,106 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:00:00 UTC)" executed successfully
2025-06-15 20:00:00,102 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:02:00 UTC)" (scheduled at 2025-06-15 20:00:00+00:00)
2025-06-15 20:00:00,103 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:00:00,106 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:00:00,109 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:02:00 UTC)" executed successfully
2025-06-15 20:02:00,095 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:04:00 UTC)" (scheduled at 2025-06-15 20:02:00+00:00)
2025-06-15 20:02:00,096 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:02:00,098 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:02:00,100 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:04:00 UTC)" executed successfully
2025-06-15 20:04:00,101 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:06:00 UTC)" (scheduled at 2025-06-15 20:04:00+00:00)
2025-06-15 20:04:00,103 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:04:00,105 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:04:00,108 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:06:00 UTC)" executed successfully
2025-06-15 20:04:04,350 - __main__ - INFO - Bot stopped by user
2025-06-15 20:08:09,633 - __main__ - INFO - Starting bot...
2025-06-15 20:08:09,633 - __main__ - INFO - Routers and middleware included
2025-06-15 20:08:09,633 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 20:08:09,634 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 20:08:09,634 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 20:08:09,663 - __main__ - INFO - Webhook set successfully
2025-06-15 20:08:09,665 - __main__ - INFO - Web server started on port 8443
2025-06-15 20:10:00,046 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:12:00 UTC)" (scheduled at 2025-06-15 20:10:00+00:00)
2025-06-15 20:10:00,047 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:10:00,060 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:10:01,701 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe13c58-000f-5000-b000-1931131df1d8",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe13234-000f-5000-b000-1a835562926c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "created_at" : "2025-06-15T20:10:00.437Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "8d5cb6eb-0a90-4214-a1a7-9a3304c5aa86"
    },
    "cancellation_details" : {
      "party" : "payment_network",
      "reason" : "identification_required"
    }
  }
}
2025-06-15 20:10:01,710 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:20:10:01 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 20:10:01,772 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 20:10:01,773 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:12:00 UTC)" executed successfully
2025-06-15 20:12:00,028 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:14:00 UTC)" (scheduled at 2025-06-15 20:12:00+00:00)
2025-06-15 20:12:00,028 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:12:00,029 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:12:00,031 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:14:00 UTC)" executed successfully
2025-06-15 20:14:00,102 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:16:00 UTC)" (scheduled at 2025-06-15 20:14:00+00:00)
2025-06-15 20:14:00,103 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:14:00,107 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:14:00,110 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:16:00 UTC)" executed successfully
2025-06-15 20:16:00,102 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:18:00 UTC)" (scheduled at 2025-06-15 20:16:00+00:00)
2025-06-15 20:16:00,103 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:16:00,107 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:16:00,110 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:18:00 UTC)" executed successfully
2025-06-15 20:18:00,101 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:20:00 UTC)" (scheduled at 2025-06-15 20:18:00+00:00)
2025-06-15 20:18:00,102 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:18:00,104 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:18:00,107 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:20:00 UTC)" executed successfully
2025-06-15 20:20:00,041 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:22:00 UTC)" (scheduled at 2025-06-15 20:20:00+00:00)
2025-06-15 20:20:00,042 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:20:00,044 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:20:00,046 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:22:00 UTC)" executed successfully
2025-06-15 20:21:05,031 - __main__ - INFO - Bot stopped by user
2025-06-15 20:21:47,724 - __main__ - INFO - Starting bot...
2025-06-15 20:21:47,725 - __main__ - INFO - Routers and middleware included
2025-06-15 20:21:47,725 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 20:21:47,726 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 20:21:47,726 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 20:21:47,762 - __main__ - INFO - Webhook set successfully
2025-06-15 20:21:47,763 - __main__ - INFO - Web server started on port 8443
2025-06-15 20:22:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:24:00 UTC)" (scheduled at 2025-06-15 20:22:00+00:00)
2025-06-15 20:22:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:22:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:22:01,522 - scheduler - INFO - Уведомление отправлено пользователю 450966825
2025-06-15 20:22:01,523 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:24:00 UTC)" executed successfully
2025-06-15 20:22:01,614 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe13f28-000f-5000-b000-1324814855d8",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe13234-000f-5000-b000-1a835562926c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "created_at" : "2025-06-15T20:22:00.404Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "f621162c-7fb2-407f-9919-d5e02b4454fb"
    },
    "cancellation_details" : {
      "party" : "payment_network",
      "reason" : "identification_required"
    }
  }
}
2025-06-15 20:22:01,615 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:20:22:01 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 20:22:34,410 - __main__ - INFO - Bot stopped by user
2025-06-15 20:22:34,503 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f969331e850>
2025-06-15 20:23:35,730 - __main__ - INFO - Starting bot...
2025-06-15 20:23:35,730 - __main__ - INFO - Routers and middleware included
2025-06-15 20:23:35,731 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 20:23:35,731 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 20:23:35,732 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 20:23:35,765 - __main__ - INFO - Webhook set successfully
2025-06-15 20:23:35,766 - __main__ - INFO - Web server started on port 8443
2025-06-15 20:24:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:26:00 UTC)" (scheduled at 2025-06-15 20:24:00+00:00)
2025-06-15 20:24:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:24:00,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:24:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:26:00 UTC)" executed successfully
2025-06-15 20:25:10,136 - __main__ - INFO - Bot stopped by user
2025-06-15 20:25:10,253 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f3834e168d0>
2025-06-15 20:38:56,302 - __main__ - INFO - Starting bot...
2025-06-15 20:38:56,302 - __main__ - INFO - Routers and middleware included
2025-06-15 20:38:56,302 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 20:38:56,303 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 20:38:56,303 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 20:38:56,361 - __main__ - INFO - Webhook set successfully
2025-06-15 20:38:56,362 - __main__ - INFO - Web server started on port 8443
2025-06-15 20:40:00,044 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:42:00 UTC)" (scheduled at 2025-06-15 20:40:00+00:00)
2025-06-15 20:40:00,045 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:40:00,049 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:40:00,049 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:40:00,049 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:40:00,053 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:40:00,053 - scheduler - INFO - Skipping user 450966825: days_since_fail=2 not in (1, 10, 13, 14)
2025-06-15 20:40:00,054 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:40:00,054 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:42:00 UTC)" executed successfully
2025-06-15 20:42:00,103 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:44:00 UTC)" (scheduled at 2025-06-15 20:42:00+00:00)
2025-06-15 20:42:00,104 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:42:00,108 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:42:00,108 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:42:00,108 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:42:00,110 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:42:00,111 - scheduler - INFO - Skipping user 450966825: days_since_fail=2 not in (1, 10, 13, 14)
2025-06-15 20:42:00,111 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:42:00,111 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/2'], next run at: 2025-06-15 20:44:00 UTC)" executed successfully
2025-06-15 20:43:41,089 - __main__ - INFO - Bot stopped by user
2025-06-15 20:50:36,001 - __main__ - INFO - Starting bot...
2025-06-15 20:50:36,002 - __main__ - INFO - Routers and middleware included
2025-06-15 20:50:36,002 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 20:50:36,003 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 20:50:36,003 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 20:50:36,038 - __main__ - INFO - Webhook set successfully
2025-06-15 20:50:36,039 - __main__ - INFO - Web server started on port 8443
2025-06-15 20:51:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:52:00 UTC)" (scheduled at 2025-06-15 20:51:00+00:00)
2025-06-15 20:51:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:51:00,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:51:00,011 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:51:00,011 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:51:00,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:51:00,015 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:51:00,015 - scheduler - INFO - Skipping admin notification for user 450966825: no username
2025-06-15 20:51:00,015 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:51:00,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:52:00 UTC)" executed successfully
2025-06-15 20:51:29,423 - __main__ - INFO - Bot stopped by user
2025-06-15 20:51:29,535 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fbd606beb90>
2025-06-15 20:54:21,428 - __main__ - INFO - Starting bot...
2025-06-15 20:54:21,428 - __main__ - INFO - Routers and middleware included
2025-06-15 20:54:21,428 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 20:54:21,429 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 20:54:21,429 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 20:54:21,446 - __main__ - INFO - Webhook set successfully
2025-06-15 20:54:21,447 - __main__ - INFO - Web server started on port 8443
2025-06-15 20:55:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:56:00 UTC)" (scheduled at 2025-06-15 20:55:00+00:00)
2025-06-15 20:55:00,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:55:00,013 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:55:00,013 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:55:00,013 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:55:00,017 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:55:00,018 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:55:00,019 - scheduler - ERROR - Не удалось отправить уведомление админу ['435204858']: 2 validation errors for SendMessage
chat_id.int
  Input should be a valid integer [type=int_type, input_value=['435204858'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/int_type
chat_id.str
  Input should be a valid string [type=string_type, input_value=['435204858'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-15 20:55:00,019 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:55:00,020 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:56:00 UTC)" executed successfully
2025-06-15 20:56:00,061 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:57:00 UTC)" (scheduled at 2025-06-15 20:56:00+00:00)
2025-06-15 20:56:00,062 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:56:00,064 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:56:00,065 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:56:00,065 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:56:00,066 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:56:00,067 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:56:00,068 - scheduler - ERROR - Не удалось отправить уведомление админу ['435204858']: 2 validation errors for SendMessage
chat_id.int
  Input should be a valid integer [type=int_type, input_value=['435204858'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/int_type
chat_id.str
  Input should be a valid string [type=string_type, input_value=['435204858'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-15 20:56:00,068 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:56:00,069 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:57:00 UTC)" executed successfully
2025-06-15 20:57:00,062 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:58:00 UTC)" (scheduled at 2025-06-15 20:57:00+00:00)
2025-06-15 20:57:00,062 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:57:00,064 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:57:00,064 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:57:00,064 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:57:00,065 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:57:00,065 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:57:00,066 - scheduler - ERROR - Не удалось отправить уведомление админу ['435204858']: 2 validation errors for SendMessage
chat_id.int
  Input should be a valid integer [type=int_type, input_value=['435204858'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/int_type
chat_id.str
  Input should be a valid string [type=string_type, input_value=['435204858'], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-15 20:57:00,066 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:57:00,066 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:58:00 UTC)" executed successfully
2025-06-15 20:57:18,852 - __main__ - INFO - Bot stopped by user
2025-06-15 20:57:19,000 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f11d403b990>
2025-06-15 20:57:24,230 - __main__ - INFO - Starting bot...
2025-06-15 20:57:24,231 - __main__ - INFO - Routers and middleware included
2025-06-15 20:57:24,231 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 20:57:24,232 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 20:57:24,232 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 20:57:24,272 - __main__ - INFO - Webhook set successfully
2025-06-15 20:57:24,272 - __main__ - INFO - Web server started on port 8443
2025-06-15 20:58:00,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:59:00 UTC)" (scheduled at 2025-06-15 20:58:00+00:00)
2025-06-15 20:58:00,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:58:00,014 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:58:00,014 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:58:00,014 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:58:00,018 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:58:00,018 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:58:00,077 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:58:00,077 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:58:00,078 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 20:59:00 UTC)" executed successfully
2025-06-15 20:59:00,035 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 21:00:00 UTC)" (scheduled at 2025-06-15 20:59:00+00:00)
2025-06-15 20:59:00,036 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 20:59:00,038 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 20:59:00,039 - scheduler - INFO - Retrieved 4 users
2025-06-15 20:59:00,039 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 20:59:00,041 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 20:59:00,041 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:59:00,078 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 20:59:00,078 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 20:59:00,078 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[minute='*/1'], next run at: 2025-06-15 21:00:00 UTC)" executed successfully
2025-06-15 20:59:06,092 - __main__ - INFO - Bot stopped by user
2025-06-15 20:59:06,230 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f00b837a4d0>
2025-06-15 21:07:49,110 - __main__ - INFO - Starting bot...
2025-06-15 21:07:49,110 - __main__ - INFO - Routers and middleware included
2025-06-15 21:07:49,111 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 21:07:49,112 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 21:07:49,112 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 21:07:49,131 - __main__ - INFO - Webhook set successfully
2025-06-15 21:07:49,132 - __main__ - INFO - Web server started on port 8443
2025-06-15 21:07:50,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:08:00 UTC)" (scheduled at 2025-06-15 21:07:50+00:00)
2025-06-15 21:07:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:07:50,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:07:50,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:07:50,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:07:50,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:07:50,011 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 21:07:50,127 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 21:07:50,263 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:07:50,263 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:08:00 UTC)" executed successfully
2025-06-15 21:08:00,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:08:10 UTC)" (scheduled at 2025-06-15 21:08:00+00:00)
2025-06-15 21:08:00,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:08:00,013 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:08:00,013 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:08:00,013 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:08:00,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:08:00,015 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:08:00,015 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:08:00,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:08:10 UTC)" executed successfully
2025-06-15 21:08:04,438 - __main__ - INFO - Bot stopped by user
2025-06-15 21:08:04,553 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fcaeef9add0>
2025-06-15 21:08:04,553 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7fcaeef842f0>, 248739.189963655)])']
connector: <aiohttp.connector.TCPConnector object at 0x7fcaf0231f50>
2025-06-15 21:08:41,712 - __main__ - INFO - Starting bot...
2025-06-15 21:08:41,712 - __main__ - INFO - Routers and middleware included
2025-06-15 21:08:41,712 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 21:08:41,713 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 21:08:41,713 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 21:08:41,754 - __main__ - INFO - Webhook set successfully
2025-06-15 21:08:41,755 - __main__ - INFO - Web server started on port 8443
2025-06-15 21:08:50,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:00 UTC)" (scheduled at 2025-06-15 21:08:50+00:00)
2025-06-15 21:08:50,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:08:50,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:08:50,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:08:50,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:08:50,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:08:50,015 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:08:50,016 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:08:50,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:00 UTC)" executed successfully
2025-06-15 21:09:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:10 UTC)" (scheduled at 2025-06-15 21:09:00+00:00)
2025-06-15 21:09:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:09:00,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:09:00,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:09:00,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:09:00,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:09:00,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:09:00,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:09:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:10 UTC)" executed successfully
2025-06-15 21:09:10,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:20 UTC)" (scheduled at 2025-06-15 21:09:10+00:00)
2025-06-15 21:09:10,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:09:10,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:09:10,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:09:10,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:09:10,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:09:10,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:09:10,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:09:10,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:20 UTC)" executed successfully
2025-06-15 21:09:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:30 UTC)" (scheduled at 2025-06-15 21:09:20+00:00)
2025-06-15 21:09:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:09:20,014 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:09:20,014 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:09:20,014 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:09:20,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:09:20,016 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:09:20,016 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:09:20,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:30 UTC)" executed successfully
2025-06-15 21:09:30,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:40 UTC)" (scheduled at 2025-06-15 21:09:30+00:00)
2025-06-15 21:09:30,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:09:30,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:09:30,012 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:09:30,012 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:09:30,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:09:30,014 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:09:30,014 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:09:30,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:40 UTC)" executed successfully
2025-06-15 21:09:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:50 UTC)" (scheduled at 2025-06-15 21:09:40+00:00)
2025-06-15 21:09:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:09:40,013 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:09:40,014 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:09:40,014 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:09:40,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:09:40,015 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:09:40,016 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:09:40,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:09:50 UTC)" executed successfully
2025-06-15 21:09:50,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:00 UTC)" (scheduled at 2025-06-15 21:09:50+00:00)
2025-06-15 21:09:50,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:09:50,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:09:50,013 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:09:50,013 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:09:50,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:09:50,015 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:09:50,015 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:09:50,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:00 UTC)" executed successfully
2025-06-15 21:10:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:10 UTC)" (scheduled at 2025-06-15 21:10:00+00:00)
2025-06-15 21:10:00,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:10:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:10:00,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:10:00,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:10:00,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:10:00,009 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:10:00,009 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:10:00,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:10 UTC)" executed successfully
2025-06-15 21:10:10,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:20 UTC)" (scheduled at 2025-06-15 21:10:10+00:00)
2025-06-15 21:10:10,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:10:10,007 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:10:10,008 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:10:10,008 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:10:10,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:10:10,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:10:10,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:10:10,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:20 UTC)" executed successfully
2025-06-15 21:10:20,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:30 UTC)" (scheduled at 2025-06-15 21:10:20+00:00)
2025-06-15 21:10:20,010 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:10:20,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:10:20,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:10:20,011 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:10:20,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:10:20,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:10:20,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:10:20,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:30 UTC)" executed successfully
2025-06-15 21:10:30,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:40 UTC)" (scheduled at 2025-06-15 21:10:30+00:00)
2025-06-15 21:10:30,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:10:30,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:10:30,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:10:30,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:10:30,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:10:30,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:10:30,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:10:30,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:40 UTC)" executed successfully
2025-06-15 21:10:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:50 UTC)" (scheduled at 2025-06-15 21:10:40+00:00)
2025-06-15 21:10:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:10:40,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:10:40,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:10:40,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:10:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:10:40,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:10:40,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:10:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:10:50 UTC)" executed successfully
2025-06-15 21:10:50,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:11:00 UTC)" (scheduled at 2025-06-15 21:10:50+00:00)
2025-06-15 21:10:50,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 21:10:50,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 21:10:50,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 21:10:50,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 21:10:50,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 21:10:50,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 21:10:50,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 21:10:50,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 21:11:00 UTC)" executed successfully
2025-06-15 21:10:53,590 - __main__ - INFO - Bot stopped by user
2025-06-15 23:28:34,401 - __main__ - INFO - Starting bot...
2025-06-15 23:28:34,402 - __main__ - INFO - Routers and middleware included
2025-06-15 23:28:34,402 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 23:28:34,403 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 23:28:34,403 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 23:28:34,438 - __main__ - INFO - Webhook set successfully
2025-06-15 23:28:34,439 - __main__ - INFO - Web server started on port 8443
2025-06-15 23:28:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:28:50 UTC)" (scheduled at 2025-06-15 23:28:40+00:00)
2025-06-15 23:28:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:28:40,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:28:40,007 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:28:40,007 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:28:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:28:40,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:28:40,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:28:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:28:50 UTC)" executed successfully
2025-06-15 23:28:50,000 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:00 UTC)" (scheduled at 2025-06-15 23:28:50+00:00)
2025-06-15 23:28:50,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:28:50,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:28:50,002 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:28:50,002 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:28:50,003 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:28:50,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:28:50,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:28:50,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:00 UTC)" executed successfully
2025-06-15 23:29:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:10 UTC)" (scheduled at 2025-06-15 23:29:00+00:00)
2025-06-15 23:29:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:29:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:29:00,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:29:00,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:29:00,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:29:00,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:29:00,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:29:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:10 UTC)" executed successfully
2025-06-15 23:29:10,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:20 UTC)" (scheduled at 2025-06-15 23:29:10+00:00)
2025-06-15 23:29:10,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:29:10,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:29:10,012 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:29:10,012 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:29:10,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:29:10,014 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:29:10,014 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:29:10,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:20 UTC)" executed successfully
2025-06-15 23:29:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:30 UTC)" (scheduled at 2025-06-15 23:29:20+00:00)
2025-06-15 23:29:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:29:20,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:29:20,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:29:20,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:29:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:29:20,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:29:20,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:29:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:30 UTC)" executed successfully
2025-06-15 23:29:21,050 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:21 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:23,050 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:23 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:25,045 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:25 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:27,045 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:27 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:29,045 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:29 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:30,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:40 UTC)" (scheduled at 2025-06-15 23:29:30+00:00)
2025-06-15 23:29:30,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:29:30,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:29:30,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:29:30,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:29:30,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:29:30,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:29:30,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:29:30,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:40 UTC)" executed successfully
2025-06-15 23:29:31,046 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:31 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:33,052 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:33 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:35,053 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:35 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:37,053 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:37 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:39,047 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:39 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:40,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:50 UTC)" (scheduled at 2025-06-15 23:29:40+00:00)
2025-06-15 23:29:40,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:29:40,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:29:40,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:29:40,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:29:40,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:29:40,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:29:40,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:29:40,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:29:50 UTC)" executed successfully
2025-06-15 23:29:41,048 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:41 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:43,048 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:43 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:45,055 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:45 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:47,055 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:47 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:49,056 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:49 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:50,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:30:00 UTC)" (scheduled at 2025-06-15 23:29:50+00:00)
2025-06-15 23:29:50,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:29:50,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:29:50,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:29:50,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:29:50,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:29:50,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:29:50,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:29:50,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:30:00 UTC)" executed successfully
2025-06-15 23:29:51,056 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:51 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:53,057 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:53 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:55,060 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:55 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:57,059 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:57 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:29:59,060 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:29:59 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:30:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:30:10 UTC)" (scheduled at 2025-06-15 23:30:00+00:00)
2025-06-15 23:30:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:30:00,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:30:00,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:30:00,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:30:00,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:30:00,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:30:00,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:30:00,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:30:10 UTC)" executed successfully
2025-06-15 23:30:00,458 - __main__ - INFO - Bot stopped by user
2025-06-15 23:30:00,571 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f7e76ca7390>
2025-06-15 23:31:26,751 - __main__ - INFO - Starting bot...
2025-06-15 23:31:26,751 - __main__ - INFO - Routers and middleware included
2025-06-15 23:31:26,751 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 23:31:26,752 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 23:31:26,752 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 23:31:26,803 - __main__ - INFO - Webhook set successfully
2025-06-15 23:31:26,804 - __main__ - INFO - Web server started on port 8443
2025-06-15 23:31:30,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:31:40 UTC)" (scheduled at 2025-06-15 23:31:30+00:00)
2025-06-15 23:31:30,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:31:30,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:31:30,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:31:30,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:31:30,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:31:30,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:31:30,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:31:30,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:31:40 UTC)" executed successfully
2025-06-15 23:31:34,535 - __main__ - INFO - Received webhook request: {"update_id":441382691,
"message":{"message_id":189,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030294,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 23:31:34,536 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 23:31:34,592 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 23:31:34,592 - aiogram.event - INFO - Update id=441382691 is handled. Duration 56 ms by bot id=7187206991
2025-06-15 23:31:34,592 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:31:34 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:31:37,553 - __main__ - INFO - Received webhook request: {"update_id":441382692,
"callback_query":{"id":"1869190634109349429","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":190,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030294,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 23:31:37,555 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 23:31:38,031 - dao.payment_dao - INFO - Saved payment: payment_id=06d80614-da07-4413-be9c-96e9efa3a871, yookassa_id=2fe16b99-000f-5001-8000-1dc29531d1b1, telegram_id=435204858
2025-06-15 23:31:38,089 - bot.handlers.payments - INFO - Sent payment link 06d80614-da07-4413-be9c-96e9efa3a871 to user 435204858
2025-06-15 23:31:38,111 - aiogram.event - INFO - Update id=441382692 is handled. Duration 556 ms by bot id=7187206991
2025-06-15 23:31:38,112 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:31:37 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:31:40,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:31:50 UTC)" (scheduled at 2025-06-15 23:31:40+00:00)
2025-06-15 23:31:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:31:40,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:31:40,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:31:40,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:31:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:31:40,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:31:40,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:31:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:31:50 UTC)" executed successfully
2025-06-15 23:31:45,498 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:31:45 +0000] "POST / HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:31:50,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:00 UTC)" (scheduled at 2025-06-15 23:31:50+00:00)
2025-06-15 23:31:50,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:31:50,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:31:50,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:31:50,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:31:50,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:31:50,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:31:50,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:31:50,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:00 UTC)" executed successfully
2025-06-15 23:31:55,540 - __main__ - INFO - Received webhook request: {"update_id":441382693,
"message":{"message_id":192,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030315,"text":"/start payment_success_06d80614-da07-4413-be9c-96e9efa3a871","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 23:31:55,541 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 06d80614-da07-4413-be9c-96e9efa3a871
2025-06-15 23:31:55,813 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:31:55,816 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 23:31:55,816 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 23:31:55,886 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:31:55 +0000] "POST / HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:32:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:10 UTC)" (scheduled at 2025-06-15 23:32:00+00:00)
2025-06-15 23:32:00,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:32:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:32:00,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:32:00,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:32:00,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:32:00,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:32:00,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:32:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:10 UTC)" executed successfully
2025-06-15 23:32:00,907 - bot.handlers.start - INFO - Payment 06d80614-da07-4413-be9c-96e9efa3a871 confirmed via deep-link for user 435204858
2025-06-15 23:32:00,907 - aiogram.event - INFO - Update id=441382693 is handled. Duration 5366 ms by bot id=7187206991
2025-06-15 23:32:00,911 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:31:55 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:32:10,010 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:20 UTC)" (scheduled at 2025-06-15 23:32:10+00:00)
2025-06-15 23:32:10,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:32:10,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:32:10,012 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:32:10,012 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:32:10,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:32:10,013 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:32:10,013 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:32:10,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:20 UTC)" executed successfully
2025-06-15 23:32:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:30 UTC)" (scheduled at 2025-06-15 23:32:20+00:00)
2025-06-15 23:32:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:32:20,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:32:20,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:32:20,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:32:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:32:20,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:32:20,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:32:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:32:30 UTC)" executed successfully
2025-06-15 23:32:22,119 - __main__ - INFO - Bot stopped by user
2025-06-15 23:33:25,833 - __main__ - INFO - Starting bot...
2025-06-15 23:33:25,833 - __main__ - INFO - Routers and middleware included
2025-06-15 23:33:25,833 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 23:33:25,834 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 23:33:25,834 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 23:33:25,870 - __main__ - INFO - Webhook set successfully
2025-06-15 23:33:25,870 - __main__ - INFO - Web server started on port 8443
2025-06-15 23:33:30,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:33:40 UTC)" (scheduled at 2025-06-15 23:33:30+00:00)
2025-06-15 23:33:30,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:33:30,008 - dao.user_dao - INFO - Retrieved 3 users
2025-06-15 23:33:30,008 - scheduler - INFO - Retrieved 3 users
2025-06-15 23:33:30,008 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:33:30,011 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-15 23:33:30,012 - scheduler - INFO - Skipping admin notification for user 450966825: no username
2025-06-15 23:33:30,323 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:33:30,323 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:33:40 UTC)" executed successfully
2025-06-15 23:33:39,893 - __main__ - INFO - Received webhook request: {"update_id":441382694,
"message":{"message_id":195,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030419,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 23:33:39,894 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 23:33:39,943 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-15 23:33:39,943 - aiogram.event - INFO - Update id=441382694 is handled. Duration 49 ms by bot id=7187206991
2025-06-15 23:33:39,944 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:33:39 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:33:40,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:33:50 UTC)" (scheduled at 2025-06-15 23:33:40+00:00)
2025-06-15 23:33:40,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:33:40,002 - dao.user_dao - INFO - Retrieved 3 users
2025-06-15 23:33:40,002 - scheduler - INFO - Retrieved 3 users
2025-06-15 23:33:40,002 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:33:40,003 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:33:40,003 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:33:40,003 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:33:50 UTC)" executed successfully
2025-06-15 23:33:47,448 - __main__ - INFO - Received webhook request: {"update_id":441382695,
"message":{"message_id":197,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030427,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-15 23:33:47,449 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-15 23:33:47,505 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-15 23:33:47,505 - aiogram.event - INFO - Update id=441382695 is handled. Duration 56 ms by bot id=7187206991
2025-06-15 23:33:47,505 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:33:47 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:33:48,892 - __main__ - INFO - Received webhook request: {"update_id":441382696,
"callback_query":{"id":"1869190635427681462","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":198,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030427,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-5253664427425224793","data":"status_associate"}}
2025-06-15 23:33:48,894 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-15 23:33:48,995 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:33:48,999 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 23:33:48,999 - dao.user_dao - INFO - Created user 435204858
2025-06-15 23:33:49,061 - aiogram.event - INFO - Update id=441382696 is handled. Duration 167 ms by bot id=7187206991
2025-06-15 23:33:49,062 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:33:48 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:33:50,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:00 UTC)" (scheduled at 2025-06-15 23:33:50+00:00)
2025-06-15 23:33:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:33:50,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:33:50,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:33:50,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:33:50,003 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-15 23:33:50,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:33:50,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:33:50,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:00 UTC)" executed successfully
2025-06-15 23:33:51,146 - __main__ - INFO - Received webhook request: {"update_id":441382697,
"callback_query":{"id":"1869190634288002533","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":199,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030429,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 23:33:51,148 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 23:33:51,645 - dao.payment_dao - INFO - Saved payment: payment_id=3f81361b-084d-44d7-bff7-45ec9af04ae6, yookassa_id=2fe16c1f-000f-5000-b000-1deb3df069c4, telegram_id=435204858
2025-06-15 23:33:51,730 - bot.handlers.payments - INFO - Sent payment link 3f81361b-084d-44d7-bff7-45ec9af04ae6 to user 435204858
2025-06-15 23:33:51,782 - aiogram.event - INFO - Update id=441382697 is handled. Duration 635 ms by bot id=7187206991
2025-06-15 23:33:51,783 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:33:51 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:33:58,169 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:33:58 +0000] "POST / HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:34:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:10 UTC)" (scheduled at 2025-06-15 23:34:00+00:00)
2025-06-15 23:34:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:34:00,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:34:00,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:34:00,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:34:00,004 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-15 23:34:00,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:34:00,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:34:00,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:10 UTC)" executed successfully
2025-06-15 23:34:01,719 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:34:01 +0000] "POST / HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:34:07,994 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:34:07 +0000] "POST / HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:34:10,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:20 UTC)" (scheduled at 2025-06-15 23:34:10+00:00)
2025-06-15 23:34:10,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:34:10,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:34:10,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:34:10,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:34:10,005 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-15 23:34:10,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:34:10,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:34:10,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:20 UTC)" executed successfully
2025-06-15 23:34:14,890 - __main__ - INFO - Received webhook request: {"update_id":441382698,
"message":{"message_id":201,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030454,"text":"/start payment_success_3f81361b-084d-44d7-bff7-45ec9af04ae6","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 23:34:14,891 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 3f81361b-084d-44d7-bff7-45ec9af04ae6
2025-06-15 23:34:15,158 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:34:15,160 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 23:34:15,160 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 23:34:20,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:30 UTC)" (scheduled at 2025-06-15 23:34:20+00:00)
2025-06-15 23:34:20,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:34:20,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:34:20,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:34:20,007 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:34:20,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:34:20,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:34:20,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:34:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:30 UTC)" executed successfully
2025-06-15 23:34:20,217 - bot.handlers.start - INFO - Payment 3f81361b-084d-44d7-bff7-45ec9af04ae6 confirmed via deep-link for user 435204858
2025-06-15 23:34:20,217 - aiogram.event - INFO - Update id=441382698 is handled. Duration 5326 ms by bot id=7187206991
2025-06-15 23:34:20,221 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:34:14 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:34:30,010 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:40 UTC)" (scheduled at 2025-06-15 23:34:30+00:00)
2025-06-15 23:34:30,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:34:30,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:34:30,012 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:34:30,012 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:34:30,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:34:30,014 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:34:30,014 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:34:30,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:40 UTC)" executed successfully
2025-06-15 23:34:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:50 UTC)" (scheduled at 2025-06-15 23:34:40+00:00)
2025-06-15 23:34:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:34:40,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:34:40,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:34:40,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:34:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:34:40,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:34:40,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:34:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:34:50 UTC)" executed successfully
2025-06-15 23:34:49,897 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:34:49 +0000] "POST / HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:34:50,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:00 UTC)" (scheduled at 2025-06-15 23:34:50+00:00)
2025-06-15 23:34:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:34:50,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:34:50,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:34:50,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:34:50,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:34:50,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:34:50,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:34:50,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:00 UTC)" executed successfully
2025-06-15 23:34:51,012 - __main__ - INFO - Received webhook request: {"update_id":441382699,
"callback_query":{"id":"1869190635493106858","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":199,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030429,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 23:34:51,014 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 23:34:51,455 - dao.payment_dao - INFO - Saved payment: payment_id=6ff4e967-6964-4308-a592-f5b9e61a5384, yookassa_id=2fe16c5b-000f-5001-9000-17d060a96de0, telegram_id=435204858
2025-06-15 23:34:51,488 - bot.handlers.payments - INFO - Sent payment link 6ff4e967-6964-4308-a592-f5b9e61a5384 to user 435204858
2025-06-15 23:34:51,495 - aiogram.event - INFO - Update id=441382699 is handled. Duration 481 ms by bot id=7187206991
2025-06-15 23:34:51,496 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:34:51 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:34:58,450 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:34:58 +0000] "POST /webhook/yookassa HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:35:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:10 UTC)" (scheduled at 2025-06-15 23:35:00+00:00)
2025-06-15 23:35:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:35:00,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:35:00,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:35:00,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:35:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:35:00,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:35:00,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:35:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:10 UTC)" executed successfully
2025-06-15 23:35:07,431 - __main__ - INFO - Received webhook request: {"update_id":441382700,
"message":{"message_id":205,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030507,"text":"/start payment_success_6ff4e967-6964-4308-a592-f5b9e61a5384","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 23:35:07,433 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 6ff4e967-6964-4308-a592-f5b9e61a5384
2025-06-15 23:35:07,686 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:35:07,689 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 23:35:07,689 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 23:35:08,493 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:35:08 +0000] "POST /webhook/yookassa HTTP/1.1" 404 175 "-" "AHC/2.1"
2025-06-15 23:35:10,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:20 UTC)" (scheduled at 2025-06-15 23:35:10+00:00)
2025-06-15 23:35:10,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:35:10,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:35:10,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:35:10,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:35:10,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:35:10,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:35:10,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:35:10,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:20 UTC)" executed successfully
2025-06-15 23:35:12,751 - bot.handlers.start - INFO - Payment 6ff4e967-6964-4308-a592-f5b9e61a5384 confirmed via deep-link for user 435204858
2025-06-15 23:35:12,751 - aiogram.event - INFO - Update id=441382700 is handled. Duration 5318 ms by bot id=7187206991
2025-06-15 23:35:12,756 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:35:07 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:35:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:30 UTC)" (scheduled at 2025-06-15 23:35:20+00:00)
2025-06-15 23:35:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:35:20,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:35:20,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:35:20,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:35:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:35:20,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:35:20,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:35:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:30 UTC)" executed successfully
2025-06-15 23:35:30,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:40 UTC)" (scheduled at 2025-06-15 23:35:30+00:00)
2025-06-15 23:35:30,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:35:30,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:35:30,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:35:30,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:35:30,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:35:30,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:35:30,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:35:30,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:35:40 UTC)" executed successfully
2025-06-15 23:35:36,619 - __main__ - INFO - Bot stopped by user
2025-06-15 23:39:10,524 - __main__ - INFO - Starting bot...
2025-06-15 23:39:10,524 - __main__ - INFO - Routers and middleware included
2025-06-15 23:39:10,524 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 23:39:10,525 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 23:39:10,525 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 23:39:10,567 - __main__ - INFO - Webhook set successfully
2025-06-15 23:39:10,568 - __main__ - INFO - Web server started on port 8443
2025-06-15 23:39:19,066 - __main__ - INFO - Received webhook request: {"update_id":441382701,
"message":{"message_id":208,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030759,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 23:39:19,068 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 23:39:19,117 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 23:39:19,118 - aiogram.event - INFO - Update id=441382701 is handled. Duration 50 ms by bot id=7187206991
2025-06-15 23:39:19,118 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:39:19 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:39:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:39:30 UTC)" (scheduled at 2025-06-15 23:39:20+00:00)
2025-06-15 23:39:20,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:39:20,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:39:20,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:39:20,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:39:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:39:20,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:39:20,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:39:20,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:39:30 UTC)" executed successfully
2025-06-15 23:39:20,495 - __main__ - INFO - Received webhook request: {"update_id":441382702,
"callback_query":{"id":"1869190632643036943","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":209,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750030759,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 23:39:20,497 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 23:39:20,947 - dao.payment_dao - INFO - Saved payment: payment_id=9397eeb8-aee1-480c-8cf5-2573264eeed9, yookassa_id=2fe16d68-000f-5001-8000-1c74f690ef9c, telegram_id=435204858
2025-06-15 23:39:20,988 - bot.handlers.payments - INFO - Sent payment link 9397eeb8-aee1-480c-8cf5-2573264eeed9 to user 435204858
2025-06-15 23:39:21,004 - aiogram.event - INFO - Update id=441382702 is handled. Duration 508 ms by bot id=7187206991
2025-06-15 23:39:21,005 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:39:20 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:39:27,014 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe16d68-000f-5001-8000-1c74f690ef9c",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe16d68-000f-5001-8000-1c74f690ef9c",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T23:39:26.155Z",
    "created_at" : "2025-06-15T23:39:20.790Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "9397eeb8-aee1-480c-8cf5-2573264eeed9"
    }
  }
}
2025-06-15 23:39:27,107 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe16d68-000f-5001-8000-1c74f690ef9c, status=succeeded
2025-06-15 23:39:27,199 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:39:27,202 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 23:39:27,203 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 23:39:30,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:39:40 UTC)" (scheduled at 2025-06-15 23:39:30+00:00)
2025-06-15 23:39:30,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:39:30,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:39:30,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:39:30,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:39:30,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:39:30,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:39:30,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:39:30,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:39:40 UTC)" executed successfully
2025-06-15 23:39:32,268 - bot.handlers.payments - INFO - Payment succeeded: payment_id=9397eeb8-aee1-480c-8cf5-2573264eeed9, yookassa_id=2fe16d68-000f-5001-8000-1c74f690ef9c, user=435204858
2025-06-15 23:39:32,269 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:39:27 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 23:39:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:39:50 UTC)" (scheduled at 2025-06-15 23:39:40+00:00)
2025-06-15 23:39:40,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:39:40,011 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:39:40,011 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:39:40,011 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:39:40,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:39:40,013 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:39:40,013 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:39:40,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:39:50 UTC)" executed successfully
2025-06-15 23:39:50,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:00 UTC)" (scheduled at 2025-06-15 23:39:50+00:00)
2025-06-15 23:39:50,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:39:50,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:39:50,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:39:50,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:39:50,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:39:50,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:39:50,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:39:50,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:00 UTC)" executed successfully
2025-06-15 23:40:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:10 UTC)" (scheduled at 2025-06-15 23:40:00+00:00)
2025-06-15 23:40:00,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:40:00,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:40:00,002 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:40:00,002 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:40:00,003 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:40:00,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:40:00,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:40:00,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:10 UTC)" executed successfully
2025-06-15 23:40:10,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:20 UTC)" (scheduled at 2025-06-15 23:40:10+00:00)
2025-06-15 23:40:10,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:40:10,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:40:10,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:40:10,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:40:10,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:40:10,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:40:10,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:40:10,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:20 UTC)" executed successfully
2025-06-15 23:40:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:30 UTC)" (scheduled at 2025-06-15 23:40:20+00:00)
2025-06-15 23:40:20,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:40:20,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:40:20,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:40:20,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:40:20,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:40:20,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:40:20,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:40:20,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:30 UTC)" executed successfully
2025-06-15 23:40:30,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:40 UTC)" (scheduled at 2025-06-15 23:40:30+00:00)
2025-06-15 23:40:30,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:40:30,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:40:30,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:40:30,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:40:30,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:40:30,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:40:30,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:40:30,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:40 UTC)" executed successfully
2025-06-15 23:40:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:50 UTC)" (scheduled at 2025-06-15 23:40:40+00:00)
2025-06-15 23:40:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:40:40,008 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:40:40,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:40:40,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:40:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:40:40,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:40:40,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:40:40,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:40:50 UTC)" executed successfully
2025-06-15 23:40:50,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:00 UTC)" (scheduled at 2025-06-15 23:40:50+00:00)
2025-06-15 23:40:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:40:50,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:40:50,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:40:50,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:40:50,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:40:50,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:40:50,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:40:50,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:00 UTC)" executed successfully
2025-06-15 23:41:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:10 UTC)" (scheduled at 2025-06-15 23:41:00+00:00)
2025-06-15 23:41:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:41:00,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:41:00,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:41:00,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:41:00,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:41:00,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:41:00,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:41:00,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:10 UTC)" executed successfully
2025-06-15 23:41:10,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:20 UTC)" (scheduled at 2025-06-15 23:41:10+00:00)
2025-06-15 23:41:10,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:41:10,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:41:10,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:41:10,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:41:10,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:41:10,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:41:10,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:41:10,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:20 UTC)" executed successfully
2025-06-15 23:41:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:30 UTC)" (scheduled at 2025-06-15 23:41:20+00:00)
2025-06-15 23:41:20,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:41:20,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:41:20,012 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:41:20,012 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:41:20,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:41:20,014 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:41:20,014 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:41:20,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:30 UTC)" executed successfully
2025-06-15 23:41:30,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:40 UTC)" (scheduled at 2025-06-15 23:41:30+00:00)
2025-06-15 23:41:30,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:41:30,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:41:30,002 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:41:30,002 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:41:30,003 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:41:30,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:41:30,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:41:30,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:40 UTC)" executed successfully
2025-06-15 23:41:40,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:50 UTC)" (scheduled at 2025-06-15 23:41:40+00:00)
2025-06-15 23:41:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:41:40,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:41:40,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:41:40,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:41:40,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:41:40,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:41:40,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:41:40,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:41:50 UTC)" executed successfully
2025-06-15 23:41:50,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:00 UTC)" (scheduled at 2025-06-15 23:41:50+00:00)
2025-06-15 23:41:50,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:41:50,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:41:50,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:41:50,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:41:50,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:41:50,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:41:50,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:41:50,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:00 UTC)" executed successfully
2025-06-15 23:42:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:10 UTC)" (scheduled at 2025-06-15 23:42:00+00:00)
2025-06-15 23:42:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:42:00,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:42:00,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:42:00,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:42:00,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:42:00,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:42:00,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:42:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:10 UTC)" executed successfully
2025-06-15 23:42:10,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:20 UTC)" (scheduled at 2025-06-15 23:42:10+00:00)
2025-06-15 23:42:10,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:42:10,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:42:10,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:42:10,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:42:10,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:42:10,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:42:10,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:42:10,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:20 UTC)" executed successfully
2025-06-15 23:42:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:30 UTC)" (scheduled at 2025-06-15 23:42:20+00:00)
2025-06-15 23:42:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:42:20,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:42:20,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:42:20,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:42:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:42:20,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:42:20,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:42:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:30 UTC)" executed successfully
2025-06-15 23:42:30,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:40 UTC)" (scheduled at 2025-06-15 23:42:30+00:00)
2025-06-15 23:42:30,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:42:30,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:42:30,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:42:30,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:42:30,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:42:30,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:42:30,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:42:30,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:40 UTC)" executed successfully
2025-06-15 23:42:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:50 UTC)" (scheduled at 2025-06-15 23:42:40+00:00)
2025-06-15 23:42:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:42:40,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:42:40,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:42:40,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:42:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:42:40,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:42:40,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:42:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:42:50 UTC)" executed successfully
2025-06-15 23:42:50,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:43:00 UTC)" (scheduled at 2025-06-15 23:42:50+00:00)
2025-06-15 23:42:50,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:42:50,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:42:50,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:42:50,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:42:50,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:42:50,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:42:50,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:42:50,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:43:00 UTC)" executed successfully
2025-06-15 23:42:54,220 - __main__ - INFO - Bot stopped by user
2025-06-15 23:44:28,695 - __main__ - INFO - Starting bot...
2025-06-15 23:44:28,695 - __main__ - INFO - Routers and middleware included
2025-06-15 23:44:28,695 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 23:44:28,696 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 23:44:28,696 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 23:44:28,716 - __main__ - INFO - Webhook set successfully
2025-06-15 23:44:28,717 - __main__ - INFO - Web server started on port 8443
2025-06-15 23:44:30,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:44:40 UTC)" (scheduled at 2025-06-15 23:44:30+00:00)
2025-06-15 23:44:30,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:44:30,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:44:30,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:44:30,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:44:30,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:44:30,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:44:30,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:44:30,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:44:40 UTC)" executed successfully
2025-06-15 23:44:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:44:50 UTC)" (scheduled at 2025-06-15 23:44:40+00:00)
2025-06-15 23:44:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:44:40,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:44:40,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:44:40,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:44:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:44:40,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:44:40,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:44:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:44:50 UTC)" executed successfully
2025-06-15 23:44:48,644 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:44:48 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:44:50,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:45:00 UTC)" (scheduled at 2025-06-15 23:44:50+00:00)
2025-06-15 23:44:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:44:50,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:44:50,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:44:50,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:44:50,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:44:50,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:44:50,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:44:50,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:45:00 UTC)" executed successfully
2025-06-15 23:44:50,644 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:44:50 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:44:52,650 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:44:52 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:44:54,653 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:44:54 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:44:56,651 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:44:56 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:44:58,652 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:44:58 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:45:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:45:10 UTC)" (scheduled at 2025-06-15 23:45:00+00:00)
2025-06-15 23:45:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:45:00,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:45:00,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:45:00,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:45:00,003 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:45:00,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:45:00,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:45:00,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:45:10 UTC)" executed successfully
2025-06-15 23:45:00,646 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:45:00 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:45:02,654 - aiohttp.access - INFO - 91.108.5.164 [15/Jun/2025:23:45:02 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-15 23:45:04,118 - __main__ - INFO - Bot stopped by user
2025-06-15 23:45:04,213 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f361b5a4dd0>
2025-06-15 23:45:49,063 - __main__ - INFO - Starting bot...
2025-06-15 23:45:49,063 - __main__ - INFO - Routers and middleware included
2025-06-15 23:45:49,063 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-15 23:45:49,064 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-15 23:45:49,064 - apscheduler.scheduler - INFO - Scheduler started
2025-06-15 23:45:49,094 - __main__ - INFO - Webhook set successfully
2025-06-15 23:45:49,095 - __main__ - INFO - Web server started on port 8443
2025-06-15 23:45:50,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:00 UTC)" (scheduled at 2025-06-15 23:45:50+00:00)
2025-06-15 23:45:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:45:50,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:45:50,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:45:50,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:45:50,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:45:50,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:45:50,009 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:45:50,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:00 UTC)" executed successfully
2025-06-15 23:45:57,834 - __main__ - INFO - Received webhook request: {"update_id":441382704,
"message":{"message_id":214,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750031157,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-15 23:45:57,836 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-15 23:45:57,880 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-15 23:45:57,880 - aiogram.event - INFO - Update id=441382704 is handled. Duration 45 ms by bot id=7187206991
2025-06-15 23:45:57,881 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:45:57 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:46:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:10 UTC)" (scheduled at 2025-06-15 23:46:00+00:00)
2025-06-15 23:46:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:46:00,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:46:00,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:46:00,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:46:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:46:00,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:46:00,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:46:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:10 UTC)" executed successfully
2025-06-15 23:46:02,186 - __main__ - INFO - Received webhook request: {"update_id":441382705,
"callback_query":{"id":"1869190634004257578","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":215,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750031157,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-15 23:46:02,189 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-15 23:46:02,859 - dao.payment_dao - INFO - Saved payment: payment_id=a50459cd-2e8d-457f-8f96-c8a30aa27f76, yookassa_id=2fe16efa-000f-5000-b000-169609d675d4, telegram_id=435204858
2025-06-15 23:46:02,892 - bot.handlers.payments - INFO - Sent payment link a50459cd-2e8d-457f-8f96-c8a30aa27f76 to user 435204858
2025-06-15 23:46:02,904 - aiogram.event - INFO - Update id=441382705 is handled. Duration 716 ms by bot id=7187206991
2025-06-15 23:46:02,904 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:46:02 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-15 23:46:10,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:20 UTC)" (scheduled at 2025-06-15 23:46:10+00:00)
2025-06-15 23:46:10,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:46:10,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:46:10,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:46:10,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:46:10,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:46:10,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:46:10,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:46:10,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:20 UTC)" executed successfully
2025-06-15 23:46:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:30 UTC)" (scheduled at 2025-06-15 23:46:20+00:00)
2025-06-15 23:46:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:46:20,013 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:46:20,013 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:46:20,013 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:46:20,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:46:20,014 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:46:20,014 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:46:20,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:30 UTC)" executed successfully
2025-06-15 23:46:30,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:40 UTC)" (scheduled at 2025-06-15 23:46:30+00:00)
2025-06-15 23:46:30,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:46:30,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:46:30,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:46:30,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:46:30,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:46:30,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:46:30,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:46:30,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:40 UTC)" executed successfully
2025-06-15 23:46:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:50 UTC)" (scheduled at 2025-06-15 23:46:40+00:00)
2025-06-15 23:46:40,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:46:40,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:46:40,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:46:40,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:46:40,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:46:40,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:46:40,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:46:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:46:50 UTC)" executed successfully
2025-06-15 23:46:50,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:00 UTC)" (scheduled at 2025-06-15 23:46:50+00:00)
2025-06-15 23:46:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:46:50,004 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:46:50,004 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:46:50,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:46:50,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:46:50,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:46:50,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:46:50,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:00 UTC)" executed successfully
2025-06-15 23:47:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:10 UTC)" (scheduled at 2025-06-15 23:47:00+00:00)
2025-06-15 23:47:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:47:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:47:00,006 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:47:00,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:47:00,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:47:00,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:47:00,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:47:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:10 UTC)" executed successfully
2025-06-15 23:47:10,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:20 UTC)" (scheduled at 2025-06-15 23:47:10+00:00)
2025-06-15 23:47:10,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:47:10,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:47:10,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:47:10,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:47:10,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:47:10,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:47:10,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:47:10,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:20 UTC)" executed successfully
2025-06-15 23:47:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:30 UTC)" (scheduled at 2025-06-15 23:47:20+00:00)
2025-06-15 23:47:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:47:20,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:47:20,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:47:20,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:47:20,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:47:20,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:47:20,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:47:20,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:30 UTC)" executed successfully
2025-06-15 23:47:30,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:40 UTC)" (scheduled at 2025-06-15 23:47:30+00:00)
2025-06-15 23:47:30,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:47:30,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:47:30,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:47:30,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:47:30,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:47:30,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:47:30,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:47:30,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:40 UTC)" executed successfully
2025-06-15 23:47:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:50 UTC)" (scheduled at 2025-06-15 23:47:40+00:00)
2025-06-15 23:47:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:47:40,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:47:40,009 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:47:40,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:47:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:47:40,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:47:40,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:47:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:47:50 UTC)" executed successfully
2025-06-15 23:47:50,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:00 UTC)" (scheduled at 2025-06-15 23:47:50+00:00)
2025-06-15 23:47:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:47:50,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:47:50,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:47:50,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:47:50,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:47:50,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:47:50,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:47:50,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:00 UTC)" executed successfully
2025-06-15 23:48:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:10 UTC)" (scheduled at 2025-06-15 23:48:00+00:00)
2025-06-15 23:48:00,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:48:00,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:48:00,010 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:48:00,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:48:00,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:48:00,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:48:00,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:48:00,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:10 UTC)" executed successfully
2025-06-15 23:48:08,871 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe16efa-000f-5000-b000-169609d675d4",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe16efa-000f-5000-b000-169609d675d4",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-15T23:48:08.520Z",
    "created_at" : "2025-06-15T23:46:02.632Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a50459cd-2e8d-457f-8f96-c8a30aa27f76"
    }
  }
}
2025-06-15 23:48:09,100 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe16efa-000f-5000-b000-169609d675d4, status=succeeded
2025-06-15 23:48:09,192 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:48:09,200 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-15 23:48:09,200 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-15 23:48:10,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:20 UTC)" (scheduled at 2025-06-15 23:48:10+00:00)
2025-06-15 23:48:10,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:48:10,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:48:10,003 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:48:10,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:48:10,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:48:10,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:48:10,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:48:10,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:20 UTC)" executed successfully
2025-06-15 23:48:14,270 - bot.handlers.payments - INFO - Payment succeeded: payment_id=a50459cd-2e8d-457f-8f96-c8a30aa27f76, yookassa_id=2fe16efa-000f-5000-b000-169609d675d4, user=435204858
2025-06-15 23:48:14,271 - aiohttp.access - INFO - 127.0.0.1 [15/Jun/2025:23:48:08 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-15 23:48:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:30 UTC)" (scheduled at 2025-06-15 23:48:20+00:00)
2025-06-15 23:48:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:48:20,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:48:20,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:48:20,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:48:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:48:20,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:48:20,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:48:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:30 UTC)" executed successfully
2025-06-15 23:48:30,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:40 UTC)" (scheduled at 2025-06-15 23:48:30+00:00)
2025-06-15 23:48:30,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-15 23:48:30,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-15 23:48:30,005 - scheduler - INFO - Retrieved 4 users
2025-06-15 23:48:30,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-15 23:48:30,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-15 23:48:30,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-15 23:48:30,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-15 23:48:30,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-15 23:48:40 UTC)" executed successfully
2025-06-15 23:48:32,300 - __main__ - INFO - Bot stopped by user
2025-06-16 08:09:36,177 - __main__ - INFO - Starting bot...
2025-06-16 08:09:36,177 - __main__ - INFO - Routers and middleware included
2025-06-16 08:09:36,177 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 08:09:36,178 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 08:09:36,178 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 08:09:36,243 - __main__ - INFO - Webhook set successfully
2025-06-16 08:09:36,244 - __main__ - INFO - Web server started on port 8443
2025-06-16 08:09:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:09:50 UTC)" (scheduled at 2025-06-16 08:09:40+00:00)
2025-06-16 08:09:40,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:09:40,007 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:09:40,007 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:09:40,007 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:09:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-15
2025-06-16 08:09:40,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:09:40,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:09:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:09:50 UTC)" executed successfully
2025-06-16 08:09:45,470 - __main__ - INFO - Bot stopped by user
2025-06-16 08:09:45,564 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7ffb8ae56750>
2025-06-16 08:09:45,564 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7ffb8ae44130>, 288446.301957232)])']
connector: <aiohttp.connector.TCPConnector object at 0x7ffb8d71ac10>
2025-06-16 08:11:06,305 - __main__ - INFO - Starting bot...
2025-06-16 08:11:06,305 - __main__ - INFO - Routers and middleware included
2025-06-16 08:11:06,305 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 08:11:06,306 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 08:11:06,307 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 08:11:06,329 - __main__ - INFO - Webhook set successfully
2025-06-16 08:11:06,329 - __main__ - INFO - Web server started on port 8443
2025-06-16 08:11:10,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:20 UTC)" (scheduled at 2025-06-16 08:11:10+00:00)
2025-06-16 08:11:10,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:11:10,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 08:11:10,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 08:11:10,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:11:10,010 - scheduler - INFO - Sending admin notification for user 450966825
2025-06-16 08:11:10,011 - scheduler - INFO - Skipping admin notification for user 450966825: no username
2025-06-16 08:11:10,087 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:11:10,087 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:20 UTC)" executed successfully
2025-06-16 08:11:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:30 UTC)" (scheduled at 2025-06-16 08:11:20+00:00)
2025-06-16 08:11:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:11:20,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 08:11:20,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 08:11:20,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:11:20,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:11:20,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:11:20,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:30 UTC)" executed successfully
2025-06-16 08:11:28,012 - __main__ - INFO - Received webhook request: {"update_id":441382708,
"message":{"message_id":221,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750061487,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:11:28,013 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 08:11:28,133 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-16 08:11:28,133 - aiogram.event - INFO - Update id=441382708 is handled. Duration 120 ms by bot id=7187206991
2025-06-16 08:11:28,134 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:11:28 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:11:30,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:40 UTC)" (scheduled at 2025-06-16 08:11:30+00:00)
2025-06-16 08:11:30,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:11:30,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 08:11:30,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 08:11:30,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:11:30,005 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:11:30,005 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:11:30,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:40 UTC)" executed successfully
2025-06-16 08:11:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:50 UTC)" (scheduled at 2025-06-16 08:11:40+00:00)
2025-06-16 08:11:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:11:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 08:11:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 08:11:40,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:11:40,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:11:40,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:11:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:11:50 UTC)" executed successfully
2025-06-16 08:11:47,702 - __main__ - INFO - Received webhook request: {"update_id":441382709,
"message":{"message_id":223,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750061507,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 08:11:47,703 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-16 08:11:48,106 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-16 08:11:48,106 - aiogram.event - INFO - Update id=441382709 is handled. Duration 403 ms by bot id=7187206991
2025-06-16 08:11:48,107 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:11:47 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:11:49,595 - __main__ - INFO - Received webhook request: {"update_id":441382710,
"callback_query":{"id":"1869190635130729139","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":224,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750061508,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-5253664427425224793","data":"status_associate"}}
2025-06-16 08:11:49,597 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-16 08:11:49,979 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:11:49,982 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-16 08:11:49,983 - dao.user_dao - INFO - Created user 435204858
2025-06-16 08:11:50,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:12:00 UTC)" (scheduled at 2025-06-16 08:11:50+00:00)
2025-06-16 08:11:50,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:11:50,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:11:50,002 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:11:50,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:11:50,003 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-16 08:11:50,003 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:11:50,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:11:50,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:12:00 UTC)" executed successfully
2025-06-16 08:11:50,128 - aiogram.event - INFO - Update id=441382710 is handled. Duration 531 ms by bot id=7187206991
2025-06-16 08:11:50,128 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:11:49 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:11:55,067 - __main__ - INFO - Received webhook request: {"update_id":441382711,
"callback_query":{"id":"1869190632936933832","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":225,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750061510,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 08:11:55,069 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 08:11:55,648 - dao.payment_dao - INFO - Saved payment: payment_id=ae37df95-841f-4314-90db-297c4150794a, yookassa_id=2fe1e58b-000f-5001-9000-173c508a0487, telegram_id=435204858
2025-06-16 08:11:55,770 - bot.handlers.payments - INFO - Sent payment link ae37df95-841f-4314-90db-297c4150794a to user 435204858
2025-06-16 08:11:55,826 - aiogram.event - INFO - Update id=441382711 is handled. Duration 757 ms by bot id=7187206991
2025-06-16 08:11:55,826 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:11:55 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:12:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:12:10 UTC)" (scheduled at 2025-06-16 08:12:00+00:00)
2025-06-16 08:12:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:12:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:12:00,006 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:12:00,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:12:00,006 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-16 08:12:00,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:12:00,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:12:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:12:10 UTC)" executed successfully
2025-06-16 08:12:03,034 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1e58b-000f-5001-9000-173c508a0487",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1e58b-000f-5001-9000-173c508a0487",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T08:12:02.233Z",
    "created_at" : "2025-06-16T08:11:55.507Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "ae37df95-841f-4314-90db-297c4150794a"
    }
  }
}
2025-06-16 08:12:03,116 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1e58b-000f-5001-9000-173c508a0487, status=succeeded
2025-06-16 08:12:03,166 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:12:03,170 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-16 08:12:03,171 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 08:12:08,287 - bot.handlers.payments - INFO - Payment succeeded: payment_id=ae37df95-841f-4314-90db-297c4150794a, yookassa_id=2fe1e58b-000f-5001-9000-173c508a0487, user=435204858
2025-06-16 08:12:08,287 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:12:03 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 08:12:10,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:12:20 UTC)" (scheduled at 2025-06-16 08:12:10+00:00)
2025-06-16 08:12:10,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:12:10,003 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:12:10,004 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:12:10,004 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:12:10,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:12:10,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:12:10,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:12:10,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:12:20 UTC)" executed successfully
2025-06-16 08:12:15,883 - __main__ - INFO - Bot stopped by user
2025-06-16 08:14:41,381 - __main__ - INFO - Starting bot...
2025-06-16 08:14:41,382 - __main__ - INFO - Routers and middleware included
2025-06-16 08:14:41,382 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 08:14:41,383 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 08:14:41,383 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 08:14:41,405 - __main__ - INFO - Webhook set successfully
2025-06-16 08:14:41,406 - __main__ - INFO - Web server started on port 8443
2025-06-16 08:14:45,591 - __main__ - INFO - Received webhook request: {"update_id":441382712,
"message":{"message_id":229,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750061685,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:14:45,592 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 08:14:45,792 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 08:14:45,793 - aiogram.event - INFO - Update id=441382712 is handled. Duration 201 ms by bot id=7187206991
2025-06-16 08:14:45,793 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:14:45 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:14:50,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:00 UTC)" (scheduled at 2025-06-16 08:14:50+00:00)
2025-06-16 08:14:50,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:14:50,008 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:14:50,008 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:14:50,008 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:14:50,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:14:50,013 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:14:50,013 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:14:50,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:00 UTC)" executed successfully
2025-06-16 08:14:50,303 - __main__ - INFO - Received webhook request: {"update_id":441382713,
"callback_query":{"id":"1869190633404071081","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":230,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750061685,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 08:14:50,305 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 08:14:50,848 - dao.payment_dao - INFO - Saved payment: payment_id=2f734311-cff5-46a7-a409-77c956ed5448, yookassa_id=2fe1e63a-000f-5000-b000-1c43f02c4d7b, telegram_id=435204858
2025-06-16 08:14:50,912 - bot.handlers.payments - INFO - Sent payment link 2f734311-cff5-46a7-a409-77c956ed5448 to user 435204858
2025-06-16 08:14:50,962 - aiogram.event - INFO - Update id=441382713 is handled. Duration 658 ms by bot id=7187206991
2025-06-16 08:14:50,962 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:14:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:14:57,460 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1e63a-000f-5000-b000-1c43f02c4d7b",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1e63a-000f-5000-b000-1c43f02c4d7b",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T08:14:57.136Z",
    "created_at" : "2025-06-16T08:14:50.605Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "2f734311-cff5-46a7-a409-77c956ed5448"
    }
  }
}
2025-06-16 08:14:57,523 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1e63a-000f-5000-b000-1c43f02c4d7b, status=succeeded
2025-06-16 08:14:57,598 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:14:57,601 - dao.user_dao - INFO - Saved 4 users to users.csv
2025-06-16 08:14:57,601 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 08:15:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:10 UTC)" (scheduled at 2025-06-16 08:15:00+00:00)
2025-06-16 08:15:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:15:00,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:15:00,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:15:00,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:15:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:15:00,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:15:00,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:15:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:10 UTC)" executed successfully
2025-06-16 08:15:02,703 - bot.handlers.payments - INFO - Payment succeeded: payment_id=2f734311-cff5-46a7-a409-77c956ed5448, yookassa_id=2fe1e63a-000f-5000-b000-1c43f02c4d7b, user=435204858
2025-06-16 08:15:02,704 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:14:57 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 08:15:10,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:20 UTC)" (scheduled at 2025-06-16 08:15:10+00:00)
2025-06-16 08:15:10,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:15:10,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:15:10,009 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:15:10,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:15:10,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:15:10,011 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:15:10,011 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:15:10,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:20 UTC)" executed successfully
2025-06-16 08:15:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:30 UTC)" (scheduled at 2025-06-16 08:15:20+00:00)
2025-06-16 08:15:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:15:20,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:15:20,009 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:15:20,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:15:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:15:20,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:15:20,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:15:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:30 UTC)" executed successfully
2025-06-16 08:15:30,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:40 UTC)" (scheduled at 2025-06-16 08:15:30+00:00)
2025-06-16 08:15:30,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:15:30,002 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:15:30,003 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:15:30,003 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:15:30,003 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:15:30,004 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:15:30,004 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:15:30,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:40 UTC)" executed successfully
2025-06-16 08:15:30,173 - __main__ - INFO - Received webhook request: {"update_id":441382714,
"message":{"message_id":234,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750061730,"text":"/users","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:15:30,174 - bot.handlers.admin - INFO - Export requested by admin 435204858
2025-06-16 08:15:30,175 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:15:30,388 - bot.handlers.admin - INFO - Exported 4 users to Excel
2025-06-16 08:15:30,388 - aiogram.event - INFO - Update id=441382714 is handled. Duration 214 ms by bot id=7187206991
2025-06-16 08:15:30,389 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:15:30 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:15:40,010 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:50 UTC)" (scheduled at 2025-06-16 08:15:40+00:00)
2025-06-16 08:15:40,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:15:40,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:15:40,012 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:15:40,012 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:15:40,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:15:40,013 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:15:40,013 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:15:40,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:15:50 UTC)" executed successfully
2025-06-16 08:15:50,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:00 UTC)" (scheduled at 2025-06-16 08:15:50+00:00)
2025-06-16 08:15:50,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:15:50,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:15:50,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:15:50,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:15:50,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:15:50,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:15:50,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:15:50,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:00 UTC)" executed successfully
2025-06-16 08:16:00,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:10 UTC)" (scheduled at 2025-06-16 08:16:00+00:00)
2025-06-16 08:16:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:16:00,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:16:00,009 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:16:00,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:16:00,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:16:00,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:16:00,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:16:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:10 UTC)" executed successfully
2025-06-16 08:16:10,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:20 UTC)" (scheduled at 2025-06-16 08:16:10+00:00)
2025-06-16 08:16:10,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:16:10,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:16:10,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:16:10,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:16:10,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:16:10,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:16:10,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:16:10,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:20 UTC)" executed successfully
2025-06-16 08:16:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:30 UTC)" (scheduled at 2025-06-16 08:16:20+00:00)
2025-06-16 08:16:20,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:16:20,007 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:16:20,007 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:16:20,007 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:16:20,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:16:20,009 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:16:20,009 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:16:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:30 UTC)" executed successfully
2025-06-16 08:16:30,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:40 UTC)" (scheduled at 2025-06-16 08:16:30+00:00)
2025-06-16 08:16:30,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:16:30,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:16:30,006 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:16:30,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:16:30,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:16:30,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:16:30,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:16:30,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:40 UTC)" executed successfully
2025-06-16 08:16:40,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:50 UTC)" (scheduled at 2025-06-16 08:16:40+00:00)
2025-06-16 08:16:40,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:16:40,011 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:16:40,011 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:16:40,011 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:16:40,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:16:40,013 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:16:40,013 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:16:40,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:16:50 UTC)" executed successfully
2025-06-16 08:16:50,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:00 UTC)" (scheduled at 2025-06-16 08:16:50+00:00)
2025-06-16 08:16:50,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:16:50,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:16:50,006 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:16:50,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:16:50,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:16:50,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:16:50,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:16:50,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:00 UTC)" executed successfully
2025-06-16 08:17:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:10 UTC)" (scheduled at 2025-06-16 08:17:00+00:00)
2025-06-16 08:17:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:17:00,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:17:00,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:17:00,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:17:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:17:00,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:17:00,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:17:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:10 UTC)" executed successfully
2025-06-16 08:17:10,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:20 UTC)" (scheduled at 2025-06-16 08:17:10+00:00)
2025-06-16 08:17:10,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:17:10,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:17:10,006 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:17:10,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:17:10,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:17:10,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:17:10,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:17:10,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:20 UTC)" executed successfully
2025-06-16 08:17:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:30 UTC)" (scheduled at 2025-06-16 08:17:20+00:00)
2025-06-16 08:17:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:17:20,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:17:20,006 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:17:20,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:17:20,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:17:20,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:17:20,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:17:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:30 UTC)" executed successfully
2025-06-16 08:17:30,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:40 UTC)" (scheduled at 2025-06-16 08:17:30+00:00)
2025-06-16 08:17:30,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:17:30,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:17:30,010 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:17:30,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:17:30,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:17:30,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:17:30,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:17:30,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:40 UTC)" executed successfully
2025-06-16 08:17:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:50 UTC)" (scheduled at 2025-06-16 08:17:40+00:00)
2025-06-16 08:17:40,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:17:40,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:17:40,012 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:17:40,013 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:17:40,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:17:40,014 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:17:40,014 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:17:40,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:17:50 UTC)" executed successfully
2025-06-16 08:17:50,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:00 UTC)" (scheduled at 2025-06-16 08:17:50+00:00)
2025-06-16 08:17:50,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:17:50,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:17:50,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:17:50,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:17:50,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:17:50,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:17:50,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:17:50,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:00 UTC)" executed successfully
2025-06-16 08:18:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:10 UTC)" (scheduled at 2025-06-16 08:18:00+00:00)
2025-06-16 08:18:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:18:00,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:18:00,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:18:00,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:18:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:18:00,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:18:00,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:18:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:10 UTC)" executed successfully
2025-06-16 08:18:10,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:20 UTC)" (scheduled at 2025-06-16 08:18:10+00:00)
2025-06-16 08:18:10,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:18:10,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:18:10,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:18:10,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:18:10,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:18:10,007 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:18:10,007 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:18:10,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:20 UTC)" executed successfully
2025-06-16 08:18:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:30 UTC)" (scheduled at 2025-06-16 08:18:20+00:00)
2025-06-16 08:18:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:18:20,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:18:20,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:18:20,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:18:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:18:20,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:18:20,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:18:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:30 UTC)" executed successfully
2025-06-16 08:18:30,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:40 UTC)" (scheduled at 2025-06-16 08:18:30+00:00)
2025-06-16 08:18:30,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:18:30,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:18:30,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:18:30,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:18:30,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:18:30,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:18:30,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:18:30,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:40 UTC)" executed successfully
2025-06-16 08:18:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:50 UTC)" (scheduled at 2025-06-16 08:18:40+00:00)
2025-06-16 08:18:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:18:40,005 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:18:40,005 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:18:40,005 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:18:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:18:40,006 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:18:40,006 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:18:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:18:50 UTC)" executed successfully
2025-06-16 08:18:50,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:00 UTC)" (scheduled at 2025-06-16 08:18:50+00:00)
2025-06-16 08:18:50,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:18:50,009 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:18:50,009 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:18:50,009 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:18:50,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:18:50,010 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:18:50,010 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:18:50,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:00 UTC)" executed successfully
2025-06-16 08:19:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:10 UTC)" (scheduled at 2025-06-16 08:19:00+00:00)
2025-06-16 08:19:00,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:19:00,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:19:00,006 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:19:00,007 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:19:00,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:19:00,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:19:00,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:19:00,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:10 UTC)" executed successfully
2025-06-16 08:19:10,010 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:20 UTC)" (scheduled at 2025-06-16 08:19:10+00:00)
2025-06-16 08:19:10,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:19:10,012 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:19:10,012 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:19:10,012 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:19:10,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:19:10,013 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:19:10,013 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:19:10,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:20 UTC)" executed successfully
2025-06-16 08:19:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:30 UTC)" (scheduled at 2025-06-16 08:19:20+00:00)
2025-06-16 08:19:20,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:19:20,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:19:20,010 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:19:20,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:19:20,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:19:20,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:19:20,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:19:20,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:30 UTC)" executed successfully
2025-06-16 08:19:30,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:40 UTC)" (scheduled at 2025-06-16 08:19:30+00:00)
2025-06-16 08:19:30,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:19:30,006 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:19:30,006 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:19:30,006 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:19:30,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:19:30,008 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:19:30,008 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:19:30,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:40 UTC)" executed successfully
2025-06-16 08:19:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:50 UTC)" (scheduled at 2025-06-16 08:19:40+00:00)
2025-06-16 08:19:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 08:19:40,010 - dao.user_dao - INFO - Retrieved 4 users
2025-06-16 08:19:40,010 - scheduler - INFO - Retrieved 4 users
2025-06-16 08:19:40,010 - scheduler - INFO - Skipping user 123456789: no last_payment_date or payment_method_id
2025-06-16 08:19:40,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 08:19:40,012 - scheduler - INFO - Already notified admin about user 450966825, skipping
2025-06-16 08:19:40,012 - scheduler - INFO - Skipping user 987654321: no last_payment_date or payment_method_id
2025-06-16 08:19:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/10'], next run at: 2025-06-16 08:19:50 UTC)" executed successfully
2025-06-16 08:19:46,051 - __main__ - INFO - Bot stopped by user
2025-06-16 08:24:48,688 - __main__ - INFO - Starting bot...
2025-06-16 08:24:48,688 - __main__ - INFO - Routers and middleware included
2025-06-16 08:24:48,689 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 08:24:48,690 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 08:24:48,690 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 08:24:48,734 - __main__ - INFO - Webhook set successfully
2025-06-16 08:24:48,734 - __main__ - INFO - Web server started on port 8443
2025-06-16 08:24:53,549 - __main__ - INFO - Received webhook request: {"update_id":441382716,
"message":{"message_id":237,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750062293,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:24:53,574 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 08:24:53,681 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-16 08:24:53,681 - aiogram.event - INFO - Update id=441382716 is handled. Duration 107 ms by bot id=7187206991
2025-06-16 08:24:53,682 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:24:53 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:25:01,349 - __main__ - INFO - Received webhook request: {"update_id":441382717,
"message":{"message_id":239,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750062301,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 08:25:01,350 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-16 08:25:01,447 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-16 08:25:01,448 - aiogram.event - INFO - Update id=441382717 is handled. Duration 98 ms by bot id=7187206991
2025-06-16 08:25:01,448 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:25:01 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:25:02,590 - __main__ - INFO - Received webhook request: {"update_id":441382718,
"callback_query":{"id":"1869190634873569774","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":240,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750062301,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-5253664427425224793","data":"status_associate"}}
2025-06-16 08:25:02,592 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-16 08:25:02,717 - dao.user_dao - INFO - Retrieved 1 users
2025-06-16 08:25:02,720 - dao.user_dao - INFO - Saved 1 users to users.csv
2025-06-16 08:25:02,721 - dao.user_dao - INFO - Created user 435204858
2025-06-16 08:25:02,876 - aiogram.event - INFO - Update id=441382718 is handled. Duration 285 ms by bot id=7187206991
2025-06-16 08:25:02,877 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:25:02 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:25:06,438 - __main__ - INFO - Received webhook request: {"update_id":441382719,
"callback_query":{"id":"1869190634491361981","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":241,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750062302,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 08:25:06,440 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 08:25:06,957 - dao.payment_dao - INFO - Saved payment: payment_id=5d8528f6-9110-4adc-8232-79dfdcc4c046, yookassa_id=2fe1e8a2-000f-5001-9000-17c4657eca7b, telegram_id=435204858
2025-06-16 08:25:07,037 - bot.handlers.payments - INFO - Sent payment link 5d8528f6-9110-4adc-8232-79dfdcc4c046 to user 435204858
2025-06-16 08:25:07,075 - aiogram.event - INFO - Update id=441382719 is handled. Duration 635 ms by bot id=7187206991
2025-06-16 08:25:07,075 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:25:06 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:25:13,878 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1e8a2-000f-5001-9000-17c4657eca7b",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1e8a2-000f-5001-9000-17c4657eca7b",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T08:25:13.496Z",
    "created_at" : "2025-06-16T08:25:06.768Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "5d8528f6-9110-4adc-8232-79dfdcc4c046"
    }
  }
}
2025-06-16 08:25:14,085 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1e8a2-000f-5001-9000-17c4657eca7b, status=succeeded
2025-06-16 08:25:14,320 - dao.user_dao - INFO - Retrieved 1 users
2025-06-16 08:25:14,322 - dao.user_dao - INFO - Saved 1 users to users.csv
2025-06-16 08:25:14,322 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 08:25:19,442 - bot.handlers.payments - INFO - Payment succeeded: payment_id=5d8528f6-9110-4adc-8232-79dfdcc4c046, yookassa_id=2fe1e8a2-000f-5001-9000-17c4657eca7b, user=435204858
2025-06-16 08:25:19,443 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:25:13 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 08:25:48,473 - __main__ - INFO - Bot stopped by user
2025-06-16 08:30:14,150 - __main__ - INFO - Starting bot...
2025-06-16 08:30:14,150 - __main__ - INFO - Routers and middleware included
2025-06-16 08:30:14,172 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 08:30:14,173 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 08:30:14,173 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 08:30:14,197 - __main__ - INFO - Webhook set successfully
2025-06-16 08:30:14,198 - __main__ - INFO - Web server started on port 8443
2025-06-16 08:30:27,542 - __main__ - INFO - Received webhook request: {"update_id":441382720,
"message":{"message_id":245,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750062627,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:30:27,543 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 08:30:27,620 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 08:30:27,620 - aiogram.event - INFO - Update id=441382720 is handled. Duration 77 ms by bot id=7187206991
2025-06-16 08:30:27,621 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:30:27 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:31:34,180 - __main__ - INFO - Received webhook request: {"update_id":441382721,
"message":{"message_id":247,"from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750062694,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:31:34,181 - bot.handlers.start - INFO - Processing /start for user 1013170672
2025-06-16 08:31:34,259 - bot.handlers.start - INFO - Sent welcome message to user 1013170672
2025-06-16 08:31:34,259 - aiogram.event - INFO - Update id=441382721 is handled. Duration 78 ms by bot id=7187206991
2025-06-16 08:31:34,260 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:31:34 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:31:52,665 - __main__ - INFO - Received webhook request: {"update_id":441382722,
"callback_query":{"id":"4351534903636674934","from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"message":{"message_id":248,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750062694,"text":"\u0414\u0430\u043d\u0438\u043b\u0430 \u041e\u043b\u0435\u0433\u043e\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"9188539885988141158","data":"pay"}}
2025-06-16 08:31:52,668 - bot.handlers.payments - INFO - Processing payment for user 1013170672
2025-06-16 08:31:53,813 - dao.payment_dao - INFO - Saved payment: payment_id=1da427de-957c-41a1-b213-fe10092febe2, yookassa_id=2fe1ea38-000f-5001-8000-17b55b2b10d3, telegram_id=1013170672
2025-06-16 08:31:53,894 - bot.handlers.payments - INFO - Sent payment link 1da427de-957c-41a1-b213-fe10092febe2 to user 1013170672
2025-06-16 08:31:53,929 - aiogram.event - INFO - Update id=441382722 is handled. Duration 1262 ms by bot id=7187206991
2025-06-16 08:31:53,930 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:31:52 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:32:13,518 - __main__ - INFO - Received webhook request: {"update_id":441382723,
"callback_query":{"id":"1869190633222496239","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":246,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750062627,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 08:32:13,521 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 08:32:13,983 - dao.payment_dao - INFO - Saved payment: payment_id=881ac42e-a290-4033-8a26-6e8f0014f87f, yookassa_id=2fe1ea4d-000f-5001-9000-1f859a66d625, telegram_id=435204858
2025-06-16 08:32:14,044 - bot.handlers.payments - INFO - Sent payment link 881ac42e-a290-4033-8a26-6e8f0014f87f to user 435204858
2025-06-16 08:32:14,055 - aiogram.event - INFO - Update id=441382723 is handled. Duration 535 ms by bot id=7187206991
2025-06-16 08:32:14,056 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:32:13 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:32:20,586 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1ea4d-000f-5001-9000-1f859a66d625",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1ea4d-000f-5001-9000-1f859a66d625",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T08:32:20.250Z",
    "created_at" : "2025-06-16T08:32:13.774Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "881ac42e-a290-4033-8a26-6e8f0014f87f"
    }
  }
}
2025-06-16 08:32:20,680 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1ea4d-000f-5001-9000-1f859a66d625, status=succeeded
2025-06-16 08:32:20,771 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 08:32:20,776 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 08:32:20,776 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 08:32:25,916 - bot.handlers.payments - INFO - Payment succeeded: payment_id=881ac42e-a290-4033-8a26-6e8f0014f87f, yookassa_id=2fe1ea4d-000f-5001-9000-1f859a66d625, user=435204858
2025-06-16 08:32:25,917 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:32:20 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 08:32:26,928 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1ea38-000f-5001-8000-17b55b2b10d3",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "bank_card",
      "id" : "2fe1ea38-000f-5001-8000-17b55b2b10d3",
      "saved" : true,
      "status" : "active",
      "title" : "Bank card *4444",
      "card" : {
        "first6" : "555555",
        "last4" : "4444",
        "expiry_year" : "2031",
        "expiry_month" : "01",
        "card_type" : "MasterCard",
        "card_product" : {
          "code" : "E"
        },
        "issuer_country" : "US"
      }
    },
    "captured_at" : "2025-06-16T08:32:26.473Z",
    "created_at" : "2025-06-16T08:31:52.997Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "1013170672",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "1da427de-957c-41a1-b213-fe10092febe2"
    },
    "authorization_details" : {
      "rrn" : "578831205245330",
      "auth_code" : "772587",
      "three_d_secure" : {
        "applied" : false,
        "method_completed" : false,
        "challenge_completed" : false
      }
    }
  }
}
2025-06-16 08:32:27,067 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1ea38-000f-5001-8000-17b55b2b10d3, status=succeeded
2025-06-16 08:32:27,178 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 08:32:27,182 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 08:32:27,183 - dao.user_dao - INFO - Updated payment for user 1013170672
2025-06-16 08:32:32,359 - bot.handlers.payments - INFO - Payment succeeded: payment_id=1da427de-957c-41a1-b213-fe10092febe2, yookassa_id=2fe1ea38-000f-5001-8000-17b55b2b10d3, user=1013170672
2025-06-16 08:32:32,392 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:32:26 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 08:35:50,312 - __main__ - INFO - Received webhook request: {"update_id":441382724,
"message":{"message_id":255,"from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750062950,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:35:50,316 - bot.handlers.start - INFO - Processing /start for user 1013170672
2025-06-16 08:35:50,370 - bot.handlers.start - INFO - Sent welcome message to user 1013170672
2025-06-16 08:35:50,371 - aiogram.event - INFO - Update id=441382724 is handled. Duration 55 ms by bot id=7187206991
2025-06-16 08:35:50,371 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:35:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:41:28,139 - __main__ - INFO - Received webhook request: {"update_id":441382725,
"callback_query":{"id":"1869190633186232950","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":246,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750062627,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 08:41:28,145 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 08:41:28,560 - dao.payment_dao - INFO - Saved payment: payment_id=9f143f87-4ba0-4b92-9488-06b711b71b9d, yookassa_id=2fe1ec78-000f-5000-b000-185d07d29af2, telegram_id=435204858
2025-06-16 08:41:28,668 - bot.handlers.payments - INFO - Sent payment link 9f143f87-4ba0-4b92-9488-06b711b71b9d to user 435204858
2025-06-16 08:41:28,700 - aiogram.event - INFO - Update id=441382725 is handled. Duration 557 ms by bot id=7187206991
2025-06-16 08:41:28,701 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:41:28 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:47:24,896 - __main__ - INFO - Bot stopped by user
2025-06-16 08:48:32,829 - __main__ - INFO - Starting bot...
2025-06-16 08:48:32,830 - __main__ - INFO - Routers and middleware included
2025-06-16 08:48:32,830 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 08:48:32,831 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 08:48:32,831 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 08:48:32,889 - __main__ - INFO - Webhook set successfully
2025-06-16 08:48:32,890 - __main__ - INFO - Web server started on port 8443
2025-06-16 08:49:54,215 - __main__ - INFO - Received webhook request: {"update_id":441382726,
"message":{"message_id":258,"from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750063794,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:49:54,216 - bot.handlers.start - INFO - Processing /start for user 1013170672
2025-06-16 08:49:54,293 - bot.handlers.start - INFO - Started registration for user 1013170672
2025-06-16 08:49:54,293 - aiogram.event - INFO - Update id=441382726 is handled. Duration 77 ms by bot id=7187206991
2025-06-16 08:49:54,294 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:49:54 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:50:05,997 - __main__ - INFO - Received webhook request: {"update_id":441382727,
"message":{"message_id":260,"from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750063805,"text":"\u0412\u0438\u043d\u043e\u0433\u0440\u0430\u0434\u043e\u0432 \u0414\u0430\u043d\u0438\u043b\u0430 \u041e\u043b\u0435\u0433\u043e\u0432\u0438\u0447"}}
2025-06-16 08:50:05,999 - bot.handlers.registration - INFO - Processing FIO for user 1013170672
2025-06-16 08:50:06,301 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 1013170672
2025-06-16 08:50:06,302 - aiogram.event - INFO - Update id=441382727 is handled. Duration 303 ms by bot id=7187206991
2025-06-16 08:50:06,302 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:50:05 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:50:26,285 - __main__ - INFO - Received webhook request: {"update_id":441382728,
"callback_query":{"id":"4351534902973583654","from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"message":{"message_id":261,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750063806,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"9188539885988141158","data":"status_associate"}}
2025-06-16 08:50:26,287 - bot.handlers.menu - INFO - Processing status selection for user 1013170672
2025-06-16 08:50:26,334 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 08:50:26,338 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 08:50:26,338 - dao.user_dao - INFO - Created user 1013170672
2025-06-16 08:50:26,540 - aiogram.event - INFO - Update id=441382728 is handled. Duration 253 ms by bot id=7187206991
2025-06-16 08:50:26,541 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:50:26 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:51:54,445 - __main__ - INFO - Received webhook request: {"update_id":441382729,
"callback_query":{"id":"4351534904911617785","from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"message":{"message_id":262,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750063826,"text":"\u0414\u0430\u043d\u0438\u043b\u0430 \u041e\u043b\u0435\u0433\u043e\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"9188539885988141158","data":"pay"}}
2025-06-16 08:51:54,451 - bot.handlers.payments - INFO - Processing payment for user 1013170672
2025-06-16 08:51:55,002 - dao.payment_dao - INFO - Saved payment: payment_id=c4de06f1-627b-43ee-8632-b10c696ed70c, yookassa_id=2fe1eeea-000f-5000-b000-1421692a6c10, telegram_id=1013170672
2025-06-16 08:51:55,082 - bot.handlers.payments - INFO - Sent payment link c4de06f1-627b-43ee-8632-b10c696ed70c to user 1013170672
2025-06-16 08:51:55,097 - aiogram.event - INFO - Update id=441382729 is handled. Duration 649 ms by bot id=7187206991
2025-06-16 08:51:55,098 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:51:54 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:53:15,359 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1eeea-000f-5000-b000-1421692a6c10",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "bank_card",
      "id" : "2fe1eeea-000f-5000-b000-1421692a6c10",
      "saved" : true,
      "status" : "active",
      "title" : "Bank card *8453",
      "card" : {
        "first6" : "675964",
        "last4" : "8453",
        "expiry_year" : "2032",
        "expiry_month" : "01",
        "card_type" : "MasterCard",
        "card_product" : {
          "code" : "E"
        },
        "issuer_country" : "US"
      }
    },
    "captured_at" : "2025-06-16T08:53:14.662Z",
    "created_at" : "2025-06-16T08:51:54.849Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "1013170672",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "c4de06f1-627b-43ee-8632-b10c696ed70c"
    },
    "authorization_details" : {
      "rrn" : "111139414143083",
      "auth_code" : "446656",
      "three_d_secure" : {
        "applied" : false,
        "method_completed" : false,
        "challenge_completed" : false
      }
    }
  }
}
2025-06-16 08:53:15,459 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe1eeea-000f-5000-b000-1421692a6c10, status=succeeded
2025-06-16 08:53:15,571 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 08:53:15,576 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 08:53:15,577 - dao.user_dao - INFO - Updated payment for user 1013170672
2025-06-16 08:53:20,766 - bot.handlers.payments - INFO - Payment succeeded: payment_id=c4de06f1-627b-43ee-8632-b10c696ed70c, yookassa_id=2fe1eeea-000f-5000-b000-1421692a6c10, user=1013170672
2025-06-16 08:53:20,768 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:53:15 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 08:55:08,325 - __main__ - INFO - Received webhook request: {"update_id":441382730,
"message":{"message_id":266,"from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750064108,"text":"/start payment_success_c4de06f1-627b-43ee-8632-b10c696ed70c","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 08:55:08,329 - bot.handlers.start - INFO - Checking payment via deep-link for user 1013170672: c4de06f1-627b-43ee-8632-b10c696ed70c
2025-06-16 08:55:08,554 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 08:55:08,560 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 08:55:08,560 - dao.user_dao - INFO - Updated payment for user 1013170672
2025-06-16 08:55:13,811 - bot.handlers.start - INFO - Payment c4de06f1-627b-43ee-8632-b10c696ed70c confirmed via deep-link for user 1013170672
2025-06-16 08:55:13,811 - aiogram.event - INFO - Update id=441382730 is handled. Duration 5483 ms by bot id=7187206991
2025-06-16 08:55:13,812 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:08:55:08 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 08:56:35,727 - __main__ - INFO - Bot stopped by user
2025-06-16 09:06:33,130 - __main__ - INFO - Starting bot...
2025-06-16 09:06:33,130 - __main__ - INFO - Routers and middleware included
2025-06-16 09:07:20,672 - __main__ - INFO - Starting bot...
2025-06-16 09:07:20,673 - __main__ - INFO - Routers and middleware included
2025-06-16 09:07:20,673 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:07:20,674 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:07:20,674 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:07:20,692 - __main__ - INFO - Webhook set successfully
2025-06-16 09:07:20,693 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:07:23,440 - __main__ - INFO - Received webhook request: {"update_id":441382731,
"message":{"message_id":269,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750064843,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 09:07:23,441 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 09:07:23,656 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 09:07:23,656 - aiogram.event - INFO - Update id=441382731 is handled. Duration 215 ms by bot id=7187206991
2025-06-16 09:07:23,657 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:07:23 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:08:20,013 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:09:20 UTC)" (scheduled at 2025-06-16 09:08:20+00:00)
2025-06-16 09:08:20,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:08:20,017 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:08:20,017 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:08:20,021 - scheduler - INFO - Attempting payment for user 435204858
2025-06-16 09:08:21,640 - scheduler - INFO - Updated last_failed_payment_date for user 435204858 to 2025-06-16 00:00:00
2025-06-16 09:08:21,643 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe1f2c4-000f-5000-b000-1c03f7dca068",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1ea4d-000f-5001-9000-1f859a66d625",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "created_at" : "2025-06-16T09:08:20.363Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "261d3992-c0c2-455b-b3c5-7b3e0b577894"
    },
    "cancellation_details" : {
      "party" : "payment_network",
      "reason" : "identification_required"
    }
  }
}
2025-06-16 09:08:21,644 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:08:21 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 09:08:21,726 - scheduler - INFO - Уведомление отправлено пользователю 435204858
2025-06-16 09:08:21,728 - scheduler - INFO - Attempting payment for user 1013170672
2025-06-16 09:08:23,195 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:08:23,199 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 09:08:23,200 - dao.user_dao - INFO - Updated payment for user 1013170672
2025-06-16 09:08:23,201 - scheduler - INFO - ✅ Renewed subscription for user 1013170672
2025-06-16 09:08:23,246 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe1f2c5-000f-5001-9000-17b71524a0d3",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "bank_card",
      "id" : "2fe1eeea-000f-5000-b000-1421692a6c10",
      "saved" : true,
      "status" : "active",
      "title" : "Bank card *8453",
      "card" : {
        "first6" : "675964",
        "last4" : "8453",
        "expiry_year" : "2032",
        "expiry_month" : "01",
        "card_type" : "MasterCard",
        "card_product" : {
          "code" : "E"
        },
        "issuer_country" : "US"
      }
    },
    "captured_at" : "2025-06-16T09:08:22.977Z",
    "created_at" : "2025-06-16T09:08:22.007Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "1013170672",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "142aff0d-769c-4d74-a32c-499f7a29c1de"
    },
    "authorization_details" : {
      "rrn" : "161182483404647",
      "auth_code" : "816429",
      "three_d_secure" : {
        "applied" : false,
        "method_completed" : false,
        "challenge_completed" : false
      }
    }
  }
}
2025-06-16 09:08:23,250 - dao.payment_dao - WARNING - No payment found for yookassa_id=2fe1f2c5-000f-5001-9000-17b71524a0d3
2025-06-16 09:08:23,253 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:08:23,255 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 09:08:23,255 - dao.user_dao - INFO - Updated payment for user 1013170672
2025-06-16 09:08:23,294 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:09:20 UTC)" executed successfully
2025-06-16 09:08:28,406 - bot.handlers.payments - INFO - Payment succeeded: payment_id=142aff0d-769c-4d74-a32c-499f7a29c1de, yookassa_id=2fe1f2c5-000f-5001-9000-17b71524a0d3, user=1013170672
2025-06-16 09:08:28,407 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:08:23 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 09:09:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:10:20 UTC)" (scheduled at 2025-06-16 09:09:20+00:00)
2025-06-16 09:09:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:09:20,006 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:09:20,006 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:09:20,007 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:09:20,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:09:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:10:20 UTC)" executed successfully
2025-06-16 09:10:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:11:20 UTC)" (scheduled at 2025-06-16 09:10:20+00:00)
2025-06-16 09:10:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:10:20,025 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:10:20,025 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:10:20,027 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:10:20,028 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:10:20,028 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:11:20 UTC)" executed successfully
2025-06-16 09:11:20,060 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:12:20 UTC)" (scheduled at 2025-06-16 09:11:20+00:00)
2025-06-16 09:11:20,062 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:11:20,063 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:11:20,064 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:11:20,065 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:11:20,066 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:11:20,066 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:12:20 UTC)" executed successfully
2025-06-16 09:12:20,063 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:13:20 UTC)" (scheduled at 2025-06-16 09:12:20+00:00)
2025-06-16 09:12:20,064 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:12:20,066 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:12:20,066 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:12:20,067 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:12:20,068 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:12:20,068 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:13:20 UTC)" executed successfully
2025-06-16 09:13:18,260 - __main__ - INFO - Received webhook request: {"update_id":441382732,
"callback_query":{"id":"1869190634151119510","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":270,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750064843,"text":"\u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":218,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 09:13:18,265 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 09:13:18,972 - dao.payment_dao - INFO - Saved payment: payment_id=f4bc3ded-f30d-46f5-9549-88560a24c106, yookassa_id=2fe1f3ee-000f-5001-9000-1e05e52fe861, telegram_id=435204858
2025-06-16 09:13:19,051 - bot.handlers.payments - INFO - Sent payment link f4bc3ded-f30d-46f5-9549-88560a24c106 to user 435204858
2025-06-16 09:13:19,073 - aiogram.event - INFO - Update id=441382732 is handled. Duration 810 ms by bot id=7187206991
2025-06-16 09:13:19,075 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:13:18 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:13:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:14:20 UTC)" (scheduled at 2025-06-16 09:13:20+00:00)
2025-06-16 09:13:20,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:13:20,006 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:13:20,007 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:13:20,008 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:13:20,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:13:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:14:20 UTC)" executed successfully
2025-06-16 09:14:20,040 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:15:20 UTC)" (scheduled at 2025-06-16 09:14:20+00:00)
2025-06-16 09:14:20,041 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:14:20,042 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:14:20,042 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:14:20,043 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:14:20,044 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:14:20,044 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:15:20 UTC)" executed successfully
2025-06-16 09:15:20,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:16:20 UTC)" (scheduled at 2025-06-16 09:15:20+00:00)
2025-06-16 09:15:20,010 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:15:20,014 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:15:20,014 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:15:20,017 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:15:20,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:15:20,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:16:20 UTC)" executed successfully
2025-06-16 09:16:20,043 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:17:20 UTC)" (scheduled at 2025-06-16 09:16:20+00:00)
2025-06-16 09:16:20,044 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:16:20,045 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:16:20,045 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:16:20,046 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:16:20,046 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:16:20,046 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='20'], next run at: 2025-06-16 09:17:20 UTC)" executed successfully
2025-06-16 09:17:09,603 - __main__ - INFO - Bot stopped by user
2025-06-16 09:17:59,367 - __main__ - INFO - Starting bot...
2025-06-16 09:17:59,367 - __main__ - INFO - Routers and middleware included
2025-06-16 09:17:59,368 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:17:59,368 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:17:59,369 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:17:59,456 - __main__ - INFO - Webhook set successfully
2025-06-16 09:17:59,457 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:18:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:18:20 UTC)" (scheduled at 2025-06-16 09:18:00+00:00)
2025-06-16 09:18:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:18:00,004 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:18:00,004 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:18:00,007 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:18:00,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:18:00,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:18:20 UTC)" executed successfully
2025-06-16 09:18:20,006 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:18:40 UTC)" (scheduled at 2025-06-16 09:18:20+00:00)
2025-06-16 09:18:20,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:18:20,007 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:18:20,007 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:18:20,008 - scheduler - INFO - Skipping user 435204858: already attempted today
2025-06-16 09:18:20,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:18:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:18:40 UTC)" executed successfully
2025-06-16 09:18:37,193 - __main__ - INFO - Bot stopped by user
2025-06-16 09:18:37,286 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f7705bba310>
2025-06-16 09:20:54,400 - __main__ - INFO - Starting bot...
2025-06-16 09:20:54,400 - __main__ - INFO - Routers and middleware included
2025-06-16 09:20:54,401 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:20:54,402 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:20:54,402 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:20:54,424 - __main__ - INFO - Webhook set successfully
2025-06-16 09:20:54,424 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:21:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:21:20 UTC)" (scheduled at 2025-06-16 09:21:00+00:00)
2025-06-16 09:21:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:21:00,007 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:21:00,007 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:21:00,011 - scheduler - INFO - Attempting payment for user 435204858
2025-06-16 09:21:01,066 - scheduler - INFO - Updated last_failed_payment_date for user 435204858 to 2025-06-16 00:00:00
2025-06-16 09:21:01,242 - scheduler - INFO - Уведомление отправлено пользователю 435204858
2025-06-16 09:21:01,243 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:21:01,243 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:21:20 UTC)" executed successfully
2025-06-16 09:21:02,378 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe1f5bc-000f-5000-b000-103a99dcced5",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Ежегодный членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe1ea4d-000f-5001-9000-1f859a66d625",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "created_at" : "2025-06-16T09:21:00.369Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "6b69892e-bcb3-4158-8b30-b28fb9d5cc9e"
    },
    "cancellation_details" : {
      "party" : "payment_network",
      "reason" : "identification_required"
    }
  }
}
2025-06-16 09:21:02,379 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:21:02 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 09:21:06,494 - __main__ - INFO - Bot stopped by user
2025-06-16 09:21:06,581 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f7d32ed8e90>
2025-06-16 09:21:06,582 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f7d2fe342f0>, 292724.482691569)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f7d30036950>
2025-06-16 09:21:06,670 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f7d2fe5d5d0>
2025-06-16 09:21:06,671 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f7d2fe351d0>, 292731.298632535)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f7d304ccbd0>
2025-06-16 09:24:17,900 - __main__ - INFO - Starting bot...
2025-06-16 09:24:17,900 - __main__ - INFO - Routers and middleware included
2025-06-16 09:24:17,901 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:24:17,901 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:24:17,902 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:24:17,926 - __main__ - INFO - Webhook set successfully
2025-06-16 09:24:17,927 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:24:17,974 - __main__ - INFO - Bot stopped by user
2025-06-16 09:24:18,075 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7fd8222042f0>, 292927.985284733)])']
connector: <aiohttp.connector.TCPConnector object at 0x7fd8245faad0>
2025-06-16 09:24:58,432 - __main__ - INFO - Starting bot...
2025-06-16 09:24:58,433 - __main__ - INFO - Routers and middleware included
2025-06-16 09:24:58,433 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:24:58,434 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:24:58,434 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:24:58,471 - __main__ - INFO - Webhook set successfully
2025-06-16 09:24:58,472 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:25:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:25:20 UTC)" (scheduled at 2025-06-16 09:25:00+00:00)
2025-06-16 09:25:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:25:00,005 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:25:00,005 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:25:00,008 - scheduler - INFO - Sending admin notification for user 435204858
2025-06-16 09:25:00,008 - scheduler - INFO - Skipping admin notification for user 435204858: no username
2025-06-16 09:25:00,110 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:25:00,110 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:25:20 UTC)" executed successfully
2025-06-16 09:25:06,400 - __main__ - INFO - Bot stopped by user
2025-06-16 09:25:06,488 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f6aa5c0e290>
2025-06-16 09:25:06,488 - asyncio - ERROR - Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7f6aa5c102f0>, 292968.530141895)])']
connector: <aiohttp.connector.TCPConnector object at 0x7f6aa5deb450>
2025-06-16 09:26:06,883 - __main__ - INFO - Starting bot...
2025-06-16 09:26:06,884 - __main__ - INFO - Routers and middleware included
2025-06-16 09:26:06,884 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:26:06,885 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:26:06,885 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:26:06,904 - __main__ - INFO - Webhook set successfully
2025-06-16 09:26:06,904 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:26:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:26:40 UTC)" (scheduled at 2025-06-16 09:26:20+00:00)
2025-06-16 09:26:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:26:20,014 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:26:20,014 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:26:20,017 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:26:20,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:26:20,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:26:40 UTC)" executed successfully
2025-06-16 09:26:40,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:27:00 UTC)" (scheduled at 2025-06-16 09:26:40+00:00)
2025-06-16 09:26:40,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:26:40,017 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:26:40,017 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:26:40,018 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:26:40,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:26:40,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:27:00 UTC)" executed successfully
2025-06-16 09:26:49,249 - __main__ - INFO - Bot stopped by user
2025-06-16 09:26:49,339 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7fa8cde2ded0>
2025-06-16 09:27:50,348 - __main__ - INFO - Starting bot...
2025-06-16 09:27:50,348 - __main__ - INFO - Routers and middleware included
2025-06-16 09:27:50,349 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:27:50,349 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:27:50,350 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:27:50,371 - __main__ - INFO - Webhook set successfully
2025-06-16 09:27:50,372 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:28:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:28:20 UTC)" (scheduled at 2025-06-16 09:28:00+00:00)
2025-06-16 09:28:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:28:00,010 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:28:00,010 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:28:00,014 - scheduler - INFO - Sending admin notification for user 435204858
2025-06-16 09:28:00,078 - scheduler - INFO - Sending admin notification for user 435204858
2025-06-16 09:28:00,198 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:28:00,198 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:28:20 UTC)" executed successfully
2025-06-16 09:28:20,006 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:28:40 UTC)" (scheduled at 2025-06-16 09:28:20+00:00)
2025-06-16 09:28:20,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:28:20,007 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:28:20,007 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:28:20,008 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:28:20,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:28:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:28:40 UTC)" executed successfully
2025-06-16 09:28:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:29:00 UTC)" (scheduled at 2025-06-16 09:28:40+00:00)
2025-06-16 09:28:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:28:40,009 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:28:40,009 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:28:40,010 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:28:40,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:28:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:29:00 UTC)" executed successfully
2025-06-16 09:29:00,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:29:20 UTC)" (scheduled at 2025-06-16 09:29:00+00:00)
2025-06-16 09:29:00,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:29:00,018 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:29:00,018 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:29:00,019 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:29:00,019 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:29:00,020 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:29:20 UTC)" executed successfully
2025-06-16 09:29:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:29:40 UTC)" (scheduled at 2025-06-16 09:29:20+00:00)
2025-06-16 09:29:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:29:20,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:29:20,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:29:20,024 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:29:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:29:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:29:40 UTC)" executed successfully
2025-06-16 09:29:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:30:00 UTC)" (scheduled at 2025-06-16 09:29:40+00:00)
2025-06-16 09:29:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:29:40,023 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:29:40,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:29:40,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:29:40,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:29:40,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:30:00 UTC)" executed successfully
2025-06-16 09:30:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:30:20 UTC)" (scheduled at 2025-06-16 09:30:00+00:00)
2025-06-16 09:30:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:30:00,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:30:00,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:30:00,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:30:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:30:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:30:20 UTC)" executed successfully
2025-06-16 09:30:13,238 - __main__ - INFO - Received webhook request: {"update_id":441382734,
"message":{"message_id":279,"from":{"id":1013170672,"is_bot":false,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","language_code":"ru","is_premium":true},"chat":{"id":1013170672,"first_name":"Danila","last_name":"Vinogradov","username":"Vin_Danila","type":"private"},"date":1750066213,"text":"/users","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 09:30:13,243 - bot.handlers.admin - INFO - Export requested by admin 1013170672
2025-06-16 09:30:13,246 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:30:13,485 - bot.handlers.admin - INFO - Exported 2 users to Excel
2025-06-16 09:30:13,485 - aiogram.event - INFO - Update id=441382734 is handled. Duration 244 ms by bot id=7187206991
2025-06-16 09:30:13,486 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:30:13 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:30:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:30:40 UTC)" (scheduled at 2025-06-16 09:30:20+00:00)
2025-06-16 09:30:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:30:20,009 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:30:20,009 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:30:20,010 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:30:20,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:30:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:30:40 UTC)" executed successfully
2025-06-16 09:30:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:31:00 UTC)" (scheduled at 2025-06-16 09:30:40+00:00)
2025-06-16 09:30:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:30:40,013 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:30:40,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:30:40,014 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:30:40,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:30:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:31:00 UTC)" executed successfully
2025-06-16 09:31:00,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:31:20 UTC)" (scheduled at 2025-06-16 09:31:00+00:00)
2025-06-16 09:31:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:31:00,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:31:00,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:31:00,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:31:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:31:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:31:20 UTC)" executed successfully
2025-06-16 09:31:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:31:40 UTC)" (scheduled at 2025-06-16 09:31:20+00:00)
2025-06-16 09:31:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:31:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:31:20,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:31:20,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:31:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:31:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:31:40 UTC)" executed successfully
2025-06-16 09:31:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:32:00 UTC)" (scheduled at 2025-06-16 09:31:40+00:00)
2025-06-16 09:31:40,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:31:40,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:31:40,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:31:40,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:31:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:31:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:32:00 UTC)" executed successfully
2025-06-16 09:32:00,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:32:20 UTC)" (scheduled at 2025-06-16 09:32:00+00:00)
2025-06-16 09:32:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:32:00,013 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:32:00,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:32:00,014 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:32:00,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:32:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:32:20 UTC)" executed successfully
2025-06-16 09:32:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:32:40 UTC)" (scheduled at 2025-06-16 09:32:20+00:00)
2025-06-16 09:32:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:32:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:32:20,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:32:20,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:32:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:32:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:32:40 UTC)" executed successfully
2025-06-16 09:32:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:33:00 UTC)" (scheduled at 2025-06-16 09:32:40+00:00)
2025-06-16 09:32:40,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:32:40,023 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:32:40,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:32:40,024 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:32:40,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:32:40,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:33:00 UTC)" executed successfully
2025-06-16 09:33:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:33:20 UTC)" (scheduled at 2025-06-16 09:33:00+00:00)
2025-06-16 09:33:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:33:00,023 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:33:00,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:33:00,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:33:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:33:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:33:20 UTC)" executed successfully
2025-06-16 09:33:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:33:40 UTC)" (scheduled at 2025-06-16 09:33:20+00:00)
2025-06-16 09:33:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:33:20,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:33:20,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:33:20,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:33:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:33:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:33:40 UTC)" executed successfully
2025-06-16 09:33:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:34:00 UTC)" (scheduled at 2025-06-16 09:33:40+00:00)
2025-06-16 09:33:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:33:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:33:40,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:33:40,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:33:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:33:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:34:00 UTC)" executed successfully
2025-06-16 09:34:00,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:34:20 UTC)" (scheduled at 2025-06-16 09:34:00+00:00)
2025-06-16 09:34:00,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:34:00,017 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:34:00,017 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:34:00,018 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:34:00,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:34:00,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:34:20 UTC)" executed successfully
2025-06-16 09:34:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:34:40 UTC)" (scheduled at 2025-06-16 09:34:20+00:00)
2025-06-16 09:34:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:34:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:34:20,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:34:20,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:34:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:34:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:34:40 UTC)" executed successfully
2025-06-16 09:34:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:35:00 UTC)" (scheduled at 2025-06-16 09:34:40+00:00)
2025-06-16 09:34:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:34:40,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:34:40,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:34:40,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:34:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:34:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:35:00 UTC)" executed successfully
2025-06-16 09:35:00,022 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:35:20 UTC)" (scheduled at 2025-06-16 09:35:00+00:00)
2025-06-16 09:35:00,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:35:00,024 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:35:00,025 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:35:00,026 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:35:00,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:35:00,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:35:20 UTC)" executed successfully
2025-06-16 09:35:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:35:40 UTC)" (scheduled at 2025-06-16 09:35:20+00:00)
2025-06-16 09:35:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:35:20,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:35:20,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:35:20,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:35:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:35:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:35:40 UTC)" executed successfully
2025-06-16 09:35:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:36:00 UTC)" (scheduled at 2025-06-16 09:35:40+00:00)
2025-06-16 09:35:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:35:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:35:40,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:35:40,021 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:35:40,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:35:40,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:36:00 UTC)" executed successfully
2025-06-16 09:36:00,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:36:20 UTC)" (scheduled at 2025-06-16 09:36:00+00:00)
2025-06-16 09:36:00,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:36:00,024 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:36:00,024 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:36:00,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:36:00,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:36:00,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:36:20 UTC)" executed successfully
2025-06-16 09:36:20,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:36:40 UTC)" (scheduled at 2025-06-16 09:36:20+00:00)
2025-06-16 09:36:20,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:36:20,018 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:36:20,018 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:36:20,019 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:36:20,020 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:36:20,020 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:36:40 UTC)" executed successfully
2025-06-16 09:36:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:37:00 UTC)" (scheduled at 2025-06-16 09:36:40+00:00)
2025-06-16 09:36:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:36:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:36:40,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:36:40,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:36:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:36:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:37:00 UTC)" executed successfully
2025-06-16 09:37:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:37:20 UTC)" (scheduled at 2025-06-16 09:37:00+00:00)
2025-06-16 09:37:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:37:00,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:37:00,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:37:00,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:37:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:37:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:37:20 UTC)" executed successfully
2025-06-16 09:37:20,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:37:40 UTC)" (scheduled at 2025-06-16 09:37:20+00:00)
2025-06-16 09:37:20,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:37:20,017 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:37:20,017 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:37:20,018 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:37:20,020 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:37:20,021 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:37:40 UTC)" executed successfully
2025-06-16 09:37:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:38:00 UTC)" (scheduled at 2025-06-16 09:37:40+00:00)
2025-06-16 09:37:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:37:40,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:37:40,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:37:40,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:37:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:37:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:38:00 UTC)" executed successfully
2025-06-16 09:38:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:38:20 UTC)" (scheduled at 2025-06-16 09:38:00+00:00)
2025-06-16 09:38:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:38:00,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:38:00,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:38:00,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:38:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:38:00,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:38:20 UTC)" executed successfully
2025-06-16 09:38:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:38:40 UTC)" (scheduled at 2025-06-16 09:38:20+00:00)
2025-06-16 09:38:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:38:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:38:20,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:38:20,021 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:38:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:38:20,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:38:40 UTC)" executed successfully
2025-06-16 09:38:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:39:00 UTC)" (scheduled at 2025-06-16 09:38:40+00:00)
2025-06-16 09:38:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:38:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:38:40,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:38:40,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:38:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:38:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:39:00 UTC)" executed successfully
2025-06-16 09:39:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:39:20 UTC)" (scheduled at 2025-06-16 09:39:00+00:00)
2025-06-16 09:39:00,025 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:39:00,027 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:39:00,027 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:39:00,029 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:39:00,029 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:39:00,030 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:39:20 UTC)" executed successfully
2025-06-16 09:39:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:39:40 UTC)" (scheduled at 2025-06-16 09:39:20+00:00)
2025-06-16 09:39:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:39:20,027 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:39:20,028 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:39:20,029 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:39:20,030 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:39:20,030 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:39:40 UTC)" executed successfully
2025-06-16 09:39:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:40:00 UTC)" (scheduled at 2025-06-16 09:39:40+00:00)
2025-06-16 09:39:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:39:40,005 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:39:40,005 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:39:40,006 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:39:40,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:39:40,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:40:00 UTC)" executed successfully
2025-06-16 09:40:00,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:40:20 UTC)" (scheduled at 2025-06-16 09:40:00+00:00)
2025-06-16 09:40:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:40:00,013 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:40:00,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:40:00,014 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:40:00,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:40:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:40:20 UTC)" executed successfully
2025-06-16 09:40:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:40:40 UTC)" (scheduled at 2025-06-16 09:40:20+00:00)
2025-06-16 09:40:20,019 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:40:20,020 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:40:20,020 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:40:20,021 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:40:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:40:20,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:40:40 UTC)" executed successfully
2025-06-16 09:40:40,022 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:41:00 UTC)" (scheduled at 2025-06-16 09:40:40+00:00)
2025-06-16 09:40:40,023 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:40:40,025 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:40:40,025 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:40:40,027 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:40:40,028 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:40:40,028 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:41:00 UTC)" executed successfully
2025-06-16 09:41:00,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:41:20 UTC)" (scheduled at 2025-06-16 09:41:00+00:00)
2025-06-16 09:41:00,010 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:41:00,012 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:41:00,012 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:41:00,014 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:41:00,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:41:00,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:41:20 UTC)" executed successfully
2025-06-16 09:41:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:41:40 UTC)" (scheduled at 2025-06-16 09:41:20+00:00)
2025-06-16 09:41:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:41:20,024 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:41:20,024 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:41:20,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:41:20,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:41:20,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:41:40 UTC)" executed successfully
2025-06-16 09:41:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:42:00 UTC)" (scheduled at 2025-06-16 09:41:40+00:00)
2025-06-16 09:41:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:41:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:41:40,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:41:40,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:41:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:41:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:42:00 UTC)" executed successfully
2025-06-16 09:42:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:42:20 UTC)" (scheduled at 2025-06-16 09:42:00+00:00)
2025-06-16 09:42:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:42:00,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:42:00,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:42:00,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:42:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:42:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:42:20 UTC)" executed successfully
2025-06-16 09:42:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:42:40 UTC)" (scheduled at 2025-06-16 09:42:20+00:00)
2025-06-16 09:42:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:42:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:42:20,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:42:20,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:42:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:42:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:42:40 UTC)" executed successfully
2025-06-16 09:42:40,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:43:00 UTC)" (scheduled at 2025-06-16 09:42:40+00:00)
2025-06-16 09:42:40,017 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:42:40,019 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:42:40,019 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:42:40,020 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:42:40,021 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:42:40,021 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:43:00 UTC)" executed successfully
2025-06-16 09:43:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:43:20 UTC)" (scheduled at 2025-06-16 09:43:00+00:00)
2025-06-16 09:43:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:43:00,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:43:00,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:43:00,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:43:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:43:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:43:20 UTC)" executed successfully
2025-06-16 09:43:20,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:43:40 UTC)" (scheduled at 2025-06-16 09:43:20+00:00)
2025-06-16 09:43:20,017 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:43:20,018 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:43:20,018 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:43:20,019 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:43:20,020 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:43:20,020 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:43:40 UTC)" executed successfully
2025-06-16 09:43:29,430 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe1ec78-000f-5000-b000-185d07d29af2",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "created_at" : "2025-06-16T08:41:28.401Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "9f143f87-4ba0-4b92-9488-06b711b71b9d"
    },
    "cancellation_details" : {
      "party" : "yoo_money",
      "reason" : "expired_on_confirmation"
    }
  }
}
2025-06-16 09:43:29,432 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:43:29 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 09:43:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:44:00 UTC)" (scheduled at 2025-06-16 09:43:40+00:00)
2025-06-16 09:43:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:43:40,009 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:43:40,009 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:43:40,010 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:43:40,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:43:40,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:44:00 UTC)" executed successfully
2025-06-16 09:44:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:44:20 UTC)" (scheduled at 2025-06-16 09:44:00+00:00)
2025-06-16 09:44:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:44:00,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:44:00,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:44:00,021 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:44:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:44:00,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:44:20 UTC)" executed successfully
2025-06-16 09:44:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:44:40 UTC)" (scheduled at 2025-06-16 09:44:20+00:00)
2025-06-16 09:44:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:44:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:44:20,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:44:20,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:44:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:44:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:44:40 UTC)" executed successfully
2025-06-16 09:44:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:45:00 UTC)" (scheduled at 2025-06-16 09:44:40+00:00)
2025-06-16 09:44:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:44:40,012 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:44:40,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:44:40,013 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:44:40,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:44:40,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:45:00 UTC)" executed successfully
2025-06-16 09:45:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:45:20 UTC)" (scheduled at 2025-06-16 09:45:00+00:00)
2025-06-16 09:45:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:45:00,003 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:45:00,003 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:45:00,004 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:45:00,005 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:45:00,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:45:20 UTC)" executed successfully
2025-06-16 09:45:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:45:40 UTC)" (scheduled at 2025-06-16 09:45:20+00:00)
2025-06-16 09:45:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:45:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:45:20,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:45:20,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:45:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:45:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:45:40 UTC)" executed successfully
2025-06-16 09:45:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:46:00 UTC)" (scheduled at 2025-06-16 09:45:40+00:00)
2025-06-16 09:45:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:45:40,023 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:45:40,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:45:40,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:45:40,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:45:40,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:46:00 UTC)" executed successfully
2025-06-16 09:46:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:46:20 UTC)" (scheduled at 2025-06-16 09:46:00+00:00)
2025-06-16 09:46:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:46:00,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:46:00,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:46:00,023 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:46:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:46:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:46:20 UTC)" executed successfully
2025-06-16 09:46:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:46:40 UTC)" (scheduled at 2025-06-16 09:46:20+00:00)
2025-06-16 09:46:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:46:20,025 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:46:20,025 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:46:20,026 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:46:20,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:46:20,028 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:46:40 UTC)" executed successfully
2025-06-16 09:46:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:47:00 UTC)" (scheduled at 2025-06-16 09:46:40+00:00)
2025-06-16 09:46:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:46:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:46:40,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:46:40,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:46:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:46:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:47:00 UTC)" executed successfully
2025-06-16 09:47:00,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:47:20 UTC)" (scheduled at 2025-06-16 09:47:00+00:00)
2025-06-16 09:47:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:47:00,013 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:47:00,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:47:00,014 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:47:00,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:47:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:47:20 UTC)" executed successfully
2025-06-16 09:47:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:47:40 UTC)" (scheduled at 2025-06-16 09:47:20+00:00)
2025-06-16 09:47:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:47:20,024 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:47:20,024 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:47:20,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:47:20,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:47:20,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:47:40 UTC)" executed successfully
2025-06-16 09:47:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:48:00 UTC)" (scheduled at 2025-06-16 09:47:40+00:00)
2025-06-16 09:47:40,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:47:40,023 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:47:40,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:47:40,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:47:40,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:47:40,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:48:00 UTC)" executed successfully
2025-06-16 09:48:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:48:20 UTC)" (scheduled at 2025-06-16 09:48:00+00:00)
2025-06-16 09:48:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:48:00,023 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:48:00,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:48:00,025 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:48:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:48:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:48:20 UTC)" executed successfully
2025-06-16 09:48:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:48:40 UTC)" (scheduled at 2025-06-16 09:48:20+00:00)
2025-06-16 09:48:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:48:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:48:20,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:48:20,022 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:48:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:48:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:48:40 UTC)" executed successfully
2025-06-16 09:48:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:49:00 UTC)" (scheduled at 2025-06-16 09:48:40+00:00)
2025-06-16 09:48:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:48:40,013 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:48:40,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:48:40,014 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:48:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:48:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:49:00 UTC)" executed successfully
2025-06-16 09:48:44,265 - __main__ - INFO - Bot stopped by user
2025-06-16 09:49:44,933 - __main__ - INFO - Starting bot...
2025-06-16 09:49:44,933 - __main__ - INFO - Routers and middleware included
2025-06-16 09:49:44,933 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:49:44,934 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:49:44,934 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:49:44,998 - __main__ - INFO - Webhook set successfully
2025-06-16 09:49:44,998 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:50:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:50:20 UTC)" (scheduled at 2025-06-16 09:50:00+00:00)
2025-06-16 09:50:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 09:50:00,015 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 09:50:00,016 - scheduler - INFO - Retrieved 2 users
2025-06-16 09:50:00,020 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 09:50:00,021 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 09:50:00,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 09:50:20 UTC)" executed successfully
2025-06-16 09:50:09,312 - __main__ - INFO - Bot stopped by user
2025-06-16 09:50:09,399 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f0af7a69190>
2025-06-16 09:50:14,525 - __main__ - INFO - Starting bot...
2025-06-16 09:50:14,525 - __main__ - INFO - Routers and middleware included
2025-06-16 09:50:14,526 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 09:50:14,526 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 09:50:14,526 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 09:50:14,548 - __main__ - INFO - Webhook set successfully
2025-06-16 09:50:14,548 - __main__ - INFO - Web server started on port 8443
2025-06-16 09:50:32,431 - __main__ - INFO - Received webhook request: {"update_id":441382735,
"message":{"message_id":281,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750067432,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 09:50:32,433 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 09:50:32,615 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 09:50:32,616 - aiogram.event - INFO - Update id=441382735 is handled. Duration 183 ms by bot id=7187206991
2025-06-16 09:50:32,616 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:50:32 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:51:13,658 - __main__ - INFO - Received webhook request: {"update_id":441382736,
"message":{"message_id":283,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750067473,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 09:51:13,661 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 09:51:13,831 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 09:51:13,831 - aiogram.event - INFO - Update id=441382736 is handled. Duration 171 ms by bot id=7187206991
2025-06-16 09:51:13,832 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:51:13 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:51:14,031 - __main__ - INFO - Received webhook request: {"update_id":441382737,
"message":{"message_id":285,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750067473,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 09:51:14,032 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 09:51:14,192 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 09:51:14,193 - aiogram.event - INFO - Update id=441382737 is handled. Duration 161 ms by bot id=7187206991
2025-06-16 09:51:14,193 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:51:14 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:51:36,691 - __main__ - INFO - Received webhook request: {"update_id":441382738,
"message":{"message_id":287,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750067496,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 09:51:36,693 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 09:51:36,847 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 09:51:36,848 - aiogram.event - INFO - Update id=441382738 is handled. Duration 155 ms by bot id=7187206991
2025-06-16 09:51:36,848 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:51:36 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:51:39,061 - __main__ - INFO - Received webhook request: {"update_id":441382739,
"callback_query":{"id":"1936887766669456232","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":288,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750067496,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 09:51:39,062 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 09:51:39,220 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 09:51:39,227 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 09:51:39,227 - dao.user_dao - INFO - Created user 450966825
2025-06-16 09:51:39,294 - aiogram.event - INFO - Update id=441382739 is handled. Duration 231 ms by bot id=7187206991
2025-06-16 09:51:39,295 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:51:39 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 09:51:40,761 - __main__ - INFO - Received webhook request: {"update_id":441382740,
"callback_query":{"id":"1936887766734536527","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":289,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750067499,"text":"\u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447, \u0434\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc8e\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":221,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 09:51:40,763 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 09:51:41,315 - dao.payment_dao - INFO - Saved payment: payment_id=455a6afe-60fc-419d-b111-1af3f3a20934, yookassa_id=2fe1fced-000f-5000-b000-1c23f149f90e, telegram_id=450966825
2025-06-16 09:51:41,361 - bot.handlers.payments - INFO - Sent payment link 455a6afe-60fc-419d-b111-1af3f3a20934 to user 450966825
2025-06-16 09:51:41,373 - aiogram.event - INFO - Update id=441382740 is handled. Duration 611 ms by bot id=7187206991
2025-06-16 09:51:41,373 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:09:51:40 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 10:00:00,104 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[hour='13', minute='0'], next run at: 2025-06-17 13:00:00 MSK)" (scheduled at 2025-06-16 13:00:00+03:00)
2025-06-16 10:00:00,105 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 10:00:00,110 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 10:00:00,111 - scheduler - INFO - Retrieved 3 users
2025-06-16 10:00:00,117 - scheduler - INFO - Already notified admin about user 435204858, skipping
2025-06-16 10:00:00,118 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 10:00:00,118 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 10:00:00,119 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[hour='13', minute='0'], next run at: 2025-06-17 13:00:00 MSK)" executed successfully
2025-06-16 10:15:19,209 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.canceled",
  "object" : {
    "id" : "2fe1f3ee-000f-5001-9000-1e05e52fe861",
    "status" : "canceled",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "created_at" : "2025-06-16T09:13:18.471Z",
    "test" : true,
    "paid" : false,
    "refundable" : false,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "f4bc3ded-f30d-46f5-9549-88560a24c106"
    },
    "cancellation_details" : {
      "party" : "yoo_money",
      "reason" : "expired_on_confirmation"
    }
  }
}
2025-06-16 10:15:19,212 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:10:15:19 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 11:36:15,117 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:15 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 11:36:15,136 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:15 +0000] "GET /version HTTP/1.1" 404 175 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-16 11:36:18,254 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:18 +0000] "UNKNOWN / HTTP/1.0" 400 203 "-" "-"
2025-06-16 11:36:18,320 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:18 +0000] "UNKNOWN / HTTP/1.0" 400 203 "-" "-"
2025-06-16 11:36:24,853 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:24 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 11:36:29,408 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:29 +0000] "GET / HTTP/1.1" 404 175 "-" "-"
2025-06-16 11:36:39,750 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:39 +0000] "GET / HTTP/1.1" 404 175 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-16 11:36:39,792 - aiohttp.server - ERROR - Error handling request from 167.94.146.60
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiohttp/web_protocol.py", line 408, in data_received
    messages, upgraded, tail = self._request_parser.feed_data(data)
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "aiohttp/_http_parser.pyx", line 558, in aiohttp._http_parser.HttpParser.feed_data
aiohttp.http_exceptions.BadHttpMessage: 400, message:
  Pause on PRI/Upgrade:

    b''
      ^
2025-06-16 11:36:39,794 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:39 +0000] "UNKNOWN / HTTP/1.0" 400 197 "-" "-"
2025-06-16 11:36:43,253 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:43 +0000] "GET /favicon.ico HTTP/1.1" 404 194 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-16 11:36:43,272 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:43 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 11:36:46,503 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:46 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 11:36:46,528 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:46 +0000] "GET /security.txt HTTP/1.1" 404 175 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-16 11:36:46,568 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:46 +0000] "GET /favicon.ico HTTP/1.1" 404 194 "-" "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)"
2025-06-16 11:36:46,585 - aiohttp.access - INFO - 167.94.146.60 [16/Jun/2025:11:36:46 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 12:00:48,286 - aiohttp.access - INFO - 54.176.70.29 [16/Jun/2025:12:00:48 +0000] "UNKNOWN / HTTP/1.0" 400 224 "-" "-"
2025-06-16 13:20:51,400 - aiohttp.access - INFO - 45.33.33.184 [16/Jun/2025:13:20:51 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 13:29:09,446 - aiohttp.access - INFO - 144.202.82.88 [16/Jun/2025:13:29:09 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 19:09:29,068 - __main__ - INFO - Starting bot...
2025-06-16 19:09:29,068 - __main__ - INFO - Routers and middleware included
2025-06-16 19:09:29,068 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:09:29,069 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:09:29,069 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:09:29,556 - __main__ - INFO - Webhook set successfully
2025-06-16 19:09:29,557 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:09:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:10:00 UTC)" (scheduled at 2025-06-16 19:09:40+00:00)
2025-06-16 19:09:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:09:40,010 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:09:40,010 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:09:40,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:09:40,013 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:09:40,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:10:00 UTC)" executed successfully
2025-06-16 19:10:00,017 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:10:20 UTC)" (scheduled at 2025-06-16 19:10:00+00:00)
2025-06-16 19:10:00,017 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:10:00,019 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:10:00,019 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:10:00,019 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:10:00,020 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:10:00,020 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:10:20 UTC)" executed successfully
2025-06-16 19:10:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:10:40 UTC)" (scheduled at 2025-06-16 19:10:20+00:00)
2025-06-16 19:10:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:10:20,023 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:10:20,023 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:10:20,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:10:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:10:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:10:40 UTC)" executed successfully
2025-06-16 19:10:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:11:00 UTC)" (scheduled at 2025-06-16 19:10:40+00:00)
2025-06-16 19:10:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:10:40,013 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:10:40,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:10:40,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:10:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:10:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:11:00 UTC)" executed successfully
2025-06-16 19:11:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:11:20 UTC)" (scheduled at 2025-06-16 19:11:00+00:00)
2025-06-16 19:11:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:11:00,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:11:00,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:11:00,021 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:11:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:11:00,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:11:20 UTC)" executed successfully
2025-06-16 19:11:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:11:40 UTC)" (scheduled at 2025-06-16 19:11:20+00:00)
2025-06-16 19:11:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:11:20,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:11:20,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:11:20,021 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:11:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:11:20,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:11:40 UTC)" executed successfully
2025-06-16 19:11:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:12:00 UTC)" (scheduled at 2025-06-16 19:11:40+00:00)
2025-06-16 19:11:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:11:40,009 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:11:40,009 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:11:40,009 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:11:40,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:11:40,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:12:00 UTC)" executed successfully
2025-06-16 19:11:53,462 - __main__ - INFO - Received webhook request: {"update_id":441382743,
"message":{"message_id":293,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101113,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:11:53,465 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:11:53,613 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-16 19:11:53,613 - aiogram.event - INFO - Update id=441382743 is handled. Duration 149 ms by bot id=7187206991
2025-06-16 19:11:53,614 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:11:53 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:12:00,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:12:20 UTC)" (scheduled at 2025-06-16 19:12:00+00:00)
2025-06-16 19:12:00,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:12:00,008 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:12:00,008 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:12:00,008 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:12:00,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:12:00,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:12:20 UTC)" executed successfully
2025-06-16 19:12:00,482 - __main__ - INFO - Received webhook request: {"update_id":441382744,
"message":{"message_id":295,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101120,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 19:12:00,484 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-16 19:12:00,993 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-16 19:12:00,993 - aiogram.event - INFO - Update id=441382744 is handled. Duration 510 ms by bot id=7187206991
2025-06-16 19:12:00,994 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:12:00 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:12:05,262 - __main__ - INFO - Received webhook request: {"update_id":441382745,
"callback_query":{"id":"1869190633476622334","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":296,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101120,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-5253664427425224793","data":"status_associate"}}
2025-06-16 19:12:05,264 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-16 19:12:05,429 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:12:05,435 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:12:05,435 - dao.user_dao - INFO - Created user 435204858
2025-06-16 19:12:05,508 - aiogram.event - INFO - Update id=441382745 is handled. Duration 244 ms by bot id=7187206991
2025-06-16 19:12:05,509 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:12:05 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:12:12,647 - __main__ - INFO - Received webhook request: {"update_id":441382746,
"callback_query":{"id":"1869190634300996412","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":297,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101125,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 19:12:12,650 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 19:12:13,279 - dao.payment_dao - INFO - Saved payment: payment_id=6c420ae0-6519-4537-8225-a5e3ad9746f7, yookassa_id=2fe2804d-000f-5001-8000-1a1ce45d96bc, telegram_id=435204858
2025-06-16 19:12:13,327 - bot.handlers.payments - INFO - Sent payment link 6c420ae0-6519-4537-8225-a5e3ad9746f7 to user 435204858
2025-06-16 19:12:13,400 - aiogram.event - INFO - Update id=441382746 is handled. Duration 751 ms by bot id=7187206991
2025-06-16 19:12:13,400 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:12:12 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:12:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:12:40 UTC)" (scheduled at 2025-06-16 19:12:20+00:00)
2025-06-16 19:12:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:12:20,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:12:20,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:12:20,009 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-16 19:12:20,009 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:12:20,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:12:20,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:12:40 UTC)" executed successfully
2025-06-16 19:12:21,742 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe2804d-000f-5001-8000-1a1ce45d96bc",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe2804d-000f-5001-8000-1a1ce45d96bc",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T19:12:21.067Z",
    "created_at" : "2025-06-16T19:12:13.045Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "6c420ae0-6519-4537-8225-a5e3ad9746f7"
    }
  }
}
2025-06-16 19:12:22,313 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe2804d-000f-5001-8000-1a1ce45d96bc, status=succeeded
2025-06-16 19:12:22,462 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:12:22,465 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:12:22,465 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:12:27,560 - bot.handlers.payments - INFO - Payment succeeded: payment_id=6c420ae0-6519-4537-8225-a5e3ad9746f7, yookassa_id=2fe2804d-000f-5001-8000-1a1ce45d96bc, user=435204858
2025-06-16 19:12:27,561 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:12:21 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 19:12:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:13:00 UTC)" (scheduled at 2025-06-16 19:12:40+00:00)
2025-06-16 19:12:40,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:12:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:12:40,015 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:12:40,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:12:40,016 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:12:40,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:12:40,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:13:00 UTC)" executed successfully
2025-06-16 19:13:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:13:20 UTC)" (scheduled at 2025-06-16 19:13:00+00:00)
2025-06-16 19:13:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:13:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:13:00,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:13:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:13:00,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:13:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:13:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:13:20 UTC)" executed successfully
2025-06-16 19:13:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:13:40 UTC)" (scheduled at 2025-06-16 19:13:20+00:00)
2025-06-16 19:13:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:13:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:13:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:13:20,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:13:20,024 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:13:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:13:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:13:40 UTC)" executed successfully
2025-06-16 19:13:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:14:00 UTC)" (scheduled at 2025-06-16 19:13:40+00:00)
2025-06-16 19:13:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:13:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:13:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:13:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:13:40,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:13:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:13:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:14:00 UTC)" executed successfully
2025-06-16 19:14:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:14:20 UTC)" (scheduled at 2025-06-16 19:14:00+00:00)
2025-06-16 19:14:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:14:00,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:14:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:14:00,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:14:00,005 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:14:00,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:14:00,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:14:20 UTC)" executed successfully
2025-06-16 19:14:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:14:40 UTC)" (scheduled at 2025-06-16 19:14:20+00:00)
2025-06-16 19:14:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:14:20,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:14:20,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:14:20,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:14:20,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:14:20,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:14:20,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:14:40 UTC)" executed successfully
2025-06-16 19:14:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:15:00 UTC)" (scheduled at 2025-06-16 19:14:40+00:00)
2025-06-16 19:14:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:14:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:14:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:14:40,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:14:40,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:14:40,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:14:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:15:00 UTC)" executed successfully
2025-06-16 19:15:00,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:15:20 UTC)" (scheduled at 2025-06-16 19:15:00+00:00)
2025-06-16 19:15:00,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:15:00,024 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:15:00,024 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:15:00,026 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:15:00,026 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:15:00,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:15:00,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:15:20 UTC)" executed successfully
2025-06-16 19:15:17,661 - __main__ - INFO - Received webhook request: {"update_id":441382747,
"message":{"message_id":301,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101317,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:15:17,665 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:15:17,727 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 19:15:17,727 - aiogram.event - INFO - Update id=441382747 is handled. Duration 63 ms by bot id=7187206991
2025-06-16 19:15:17,728 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:15:17 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:15:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:15:40 UTC)" (scheduled at 2025-06-16 19:15:20+00:00)
2025-06-16 19:15:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:15:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:15:20,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:15:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:15:20,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:15:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:15:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:15:40 UTC)" executed successfully
2025-06-16 19:15:25,318 - __main__ - INFO - Received webhook request: {"update_id":441382748,
"message":{"message_id":303,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101325,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:15:25,321 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:15:25,369 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 19:15:25,369 - aiogram.event - INFO - Update id=441382748 is handled. Duration 48 ms by bot id=7187206991
2025-06-16 19:15:25,370 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:15:25 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:15:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:16:00 UTC)" (scheduled at 2025-06-16 19:15:40+00:00)
2025-06-16 19:15:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:15:40,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:15:40,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:15:40,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:15:40,011 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:15:40,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:15:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:16:00 UTC)" executed successfully
2025-06-16 19:16:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:16:20 UTC)" (scheduled at 2025-06-16 19:16:00+00:00)
2025-06-16 19:16:00,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:16:00,015 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:16:00,015 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:16:00,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:16:00,016 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:16:00,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:16:00,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:16:20 UTC)" executed successfully
2025-06-16 19:16:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:16:40 UTC)" (scheduled at 2025-06-16 19:16:20+00:00)
2025-06-16 19:16:20,050 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:16:20,050 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:16:20,051 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:16:20,051 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:16:20,052 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:16:20,052 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:16:20,053 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:16:40 UTC)" executed successfully
2025-06-16 19:16:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:17:00 UTC)" (scheduled at 2025-06-16 19:16:40+00:00)
2025-06-16 19:16:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:16:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:16:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:16:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:16:40,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:16:40,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:16:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:17:00 UTC)" executed successfully
2025-06-16 19:17:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:17:20 UTC)" (scheduled at 2025-06-16 19:17:00+00:00)
2025-06-16 19:17:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:17:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:17:00,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:17:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:17:00,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:17:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:17:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:17:20 UTC)" executed successfully
2025-06-16 19:17:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:17:40 UTC)" (scheduled at 2025-06-16 19:17:20+00:00)
2025-06-16 19:17:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:17:20,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:17:20,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:17:20,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:17:20,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:17:20,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:17:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:17:40 UTC)" executed successfully
2025-06-16 19:17:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:18:00 UTC)" (scheduled at 2025-06-16 19:17:40+00:00)
2025-06-16 19:17:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:17:40,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:17:40,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:17:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:17:40,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:17:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:17:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:18:00 UTC)" executed successfully
2025-06-16 19:18:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:18:20 UTC)" (scheduled at 2025-06-16 19:18:00+00:00)
2025-06-16 19:18:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:18:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:18:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:18:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:18:00,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:18:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:18:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:18:20 UTC)" executed successfully
2025-06-16 19:18:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:18:40 UTC)" (scheduled at 2025-06-16 19:18:20+00:00)
2025-06-16 19:18:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:18:20,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:18:20,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:18:20,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:18:20,024 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:18:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:18:20,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:18:40 UTC)" executed successfully
2025-06-16 19:18:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:19:00 UTC)" (scheduled at 2025-06-16 19:18:40+00:00)
2025-06-16 19:18:40,026 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:18:40,027 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:18:40,028 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:18:40,029 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:18:40,029 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:18:40,030 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:18:40,030 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:19:00 UTC)" executed successfully
2025-06-16 19:19:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:19:20 UTC)" (scheduled at 2025-06-16 19:19:00+00:00)
2025-06-16 19:19:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:19:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:19:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:19:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:19:00,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:19:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:19:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:19:20 UTC)" executed successfully
2025-06-16 19:19:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:19:40 UTC)" (scheduled at 2025-06-16 19:19:20+00:00)
2025-06-16 19:19:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:19:20,024 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:19:20,024 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:19:20,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:19:20,025 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:19:20,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:19:20,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:19:40 UTC)" executed successfully
2025-06-16 19:19:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:20:00 UTC)" (scheduled at 2025-06-16 19:19:40+00:00)
2025-06-16 19:19:40,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:19:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:19:40,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:19:40,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:19:40,015 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:19:40,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:19:40,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:20:00 UTC)" executed successfully
2025-06-16 19:20:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:20:20 UTC)" (scheduled at 2025-06-16 19:20:00+00:00)
2025-06-16 19:20:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:20:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:20:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:20:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:20:00,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:20:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:20:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:20:20 UTC)" executed successfully
2025-06-16 19:20:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:20:40 UTC)" (scheduled at 2025-06-16 19:20:20+00:00)
2025-06-16 19:20:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:20:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:20:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:20:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:20:20,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:20:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:20:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:20:40 UTC)" executed successfully
2025-06-16 19:20:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:21:00 UTC)" (scheduled at 2025-06-16 19:20:40+00:00)
2025-06-16 19:20:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:20:40,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:20:40,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:20:40,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:20:40,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:20:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:20:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:21:00 UTC)" executed successfully
2025-06-16 19:21:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:21:20 UTC)" (scheduled at 2025-06-16 19:21:00+00:00)
2025-06-16 19:21:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:21:00,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:21:00,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:21:00,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:21:00,024 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:21:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:21:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:21:20 UTC)" executed successfully
2025-06-16 19:21:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:21:40 UTC)" (scheduled at 2025-06-16 19:21:20+00:00)
2025-06-16 19:21:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:21:20,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:21:20,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:21:20,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:21:20,024 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:21:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:21:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:21:40 UTC)" executed successfully
2025-06-16 19:21:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:22:00 UTC)" (scheduled at 2025-06-16 19:21:40+00:00)
2025-06-16 19:21:40,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:21:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:21:40,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:21:40,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:21:40,016 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:21:40,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:21:40,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:22:00 UTC)" executed successfully
2025-06-16 19:22:00,018 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:22:20 UTC)" (scheduled at 2025-06-16 19:22:00+00:00)
2025-06-16 19:22:00,019 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:22:00,020 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:22:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:22:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:22:00,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:22:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:22:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:22:20 UTC)" executed successfully
2025-06-16 19:22:20,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:22:40 UTC)" (scheduled at 2025-06-16 19:22:20+00:00)
2025-06-16 19:22:20,017 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:22:20,018 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:22:20,018 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:22:20,019 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:22:20,020 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:22:20,021 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:22:20,021 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:22:40 UTC)" executed successfully
2025-06-16 19:22:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:23:00 UTC)" (scheduled at 2025-06-16 19:22:40+00:00)
2025-06-16 19:22:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:22:40,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:22:40,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:22:40,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:22:40,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:22:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:22:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:23:00 UTC)" executed successfully
2025-06-16 19:22:50,458 - aiohttp.access - INFO - 147.185.132.43 [16/Jun/2025:19:22:50 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 19:22:50,645 - aiohttp.access - INFO - 147.185.132.43 [16/Jun/2025:19:22:50 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 19:23:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:23:20 UTC)" (scheduled at 2025-06-16 19:23:00+00:00)
2025-06-16 19:23:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:23:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:23:00,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:23:00,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:23:00,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:23:00,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:23:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:23:20 UTC)" executed successfully
2025-06-16 19:23:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:23:40 UTC)" (scheduled at 2025-06-16 19:23:20+00:00)
2025-06-16 19:23:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:23:20,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:23:20,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:23:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:23:20,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:23:20,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:23:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:23:40 UTC)" executed successfully
2025-06-16 19:23:25,341 - __main__ - INFO - Bot stopped by user
2025-06-16 19:24:24,175 - __main__ - INFO - Starting bot...
2025-06-16 19:24:24,175 - __main__ - INFO - Routers and middleware included
2025-06-16 19:24:24,176 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:24:24,176 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:24:24,177 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:24:24,217 - __main__ - INFO - Webhook set successfully
2025-06-16 19:24:24,218 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:24:40,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:25:00 UTC)" (scheduled at 2025-06-16 19:24:40+00:00)
2025-06-16 19:24:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:24:40,004 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:24:40,004 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:24:40,004 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:24:40,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:24:40,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:25:00 UTC)" executed successfully
2025-06-16 19:25:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:25:20 UTC)" (scheduled at 2025-06-16 19:25:00+00:00)
2025-06-16 19:25:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:25:00,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:25:00,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:25:00,021 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:25:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:25:00,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:25:20 UTC)" executed successfully
2025-06-16 19:25:01,069 - __main__ - INFO - Received webhook request: {"update_id":441382749,
"message":{"message_id":305,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101901,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:25:01,070 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:25:01,141 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-16 19:25:01,142 - aiogram.event - INFO - Update id=441382749 is handled. Duration 72 ms by bot id=7187206991
2025-06-16 19:25:01,142 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:25:01 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:25:07,073 - __main__ - INFO - Received webhook request: {"update_id":441382750,
"message":{"message_id":307,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101907,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 19:25:07,074 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-16 19:25:07,278 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-16 19:25:07,278 - aiogram.event - INFO - Update id=441382750 is handled. Duration 204 ms by bot id=7187206991
2025-06-16 19:25:07,279 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:25:07 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:25:11,058 - __main__ - INFO - Received webhook request: {"update_id":441382751,
"callback_query":{"id":"1869190635580681658","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":308,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101907,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-5253664427425224793","data":"status_associate"}}
2025-06-16 19:25:11,060 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-16 19:25:11,133 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:25:11,137 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:25:11,137 - dao.user_dao - INFO - Created user 435204858
2025-06-16 19:25:11,213 - aiogram.event - INFO - Update id=441382751 is handled. Duration 153 ms by bot id=7187206991
2025-06-16 19:25:11,214 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:25:11 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:25:14,226 - __main__ - INFO - Received webhook request: {"update_id":441382752,
"callback_query":{"id":"1869190636074603751","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":309,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101911,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 19:25:14,227 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 19:25:14,802 - dao.payment_dao - INFO - Saved payment: payment_id=474bdc6a-ab2e-4abb-a005-c31dfe2249b2, yookassa_id=2fe2835a-000f-5000-8000-19e941d52d2a, telegram_id=435204858
2025-06-16 19:25:14,842 - bot.handlers.payments - INFO - Sent payment link 474bdc6a-ab2e-4abb-a005-c31dfe2249b2 to user 435204858
2025-06-16 19:25:14,857 - aiogram.event - INFO - Update id=441382752 is handled. Duration 630 ms by bot id=7187206991
2025-06-16 19:25:14,858 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:25:14 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:25:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:25:40 UTC)" (scheduled at 2025-06-16 19:25:20+00:00)
2025-06-16 19:25:20,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:25:20,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:25:20,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:25:20,004 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-16 19:25:20,004 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:25:20,005 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:25:20,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:25:40 UTC)" executed successfully
2025-06-16 19:25:22,652 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe2835a-000f-5000-8000-19e941d52d2a",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe2835a-000f-5000-8000-19e941d52d2a",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T19:25:22.210Z",
    "created_at" : "2025-06-16T19:25:14.579Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "474bdc6a-ab2e-4abb-a005-c31dfe2249b2"
    }
  }
}
2025-06-16 19:25:22,741 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe2835a-000f-5000-8000-19e941d52d2a, status=succeeded
2025-06-16 19:25:22,818 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:25:22,821 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:25:22,821 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:25:27,880 - bot.handlers.payments - INFO - Payment succeeded: payment_id=474bdc6a-ab2e-4abb-a005-c31dfe2249b2, yookassa_id=2fe2835a-000f-5000-8000-19e941d52d2a, user=435204858
2025-06-16 19:25:27,881 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:25:22 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 19:25:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:26:00 UTC)" (scheduled at 2025-06-16 19:25:40+00:00)
2025-06-16 19:25:40,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:25:40,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:25:40,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:25:40,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:25:40,012 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:25:40,013 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:25:40,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:26:00 UTC)" executed successfully
2025-06-16 19:25:44,940 - __main__ - INFO - Received webhook request: {"update_id":441382753,
"message":{"message_id":313,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750101944,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:25:44,947 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:25:45,047 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 19:25:45,048 - aiogram.event - INFO - Update id=441382753 is not handled. Duration 102 ms by bot id=7187206991
2025-06-16 19:25:45,048 - aiogram.event - ERROR - Cause exception while process update id=441382753 by bot id=7187206991
AttributeError: 'UserDAO' object has no attribute 'commit_session'
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 141, in cmd_start
    user_dao.commit_session(user)
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'UserDAO' object has no attribute 'commit_session'
2025-06-16 19:25:45,061 - __main__ - ERROR - Error processing webhook: 'UserDAO' object has no attribute 'commit_session'
2025-06-16 19:25:45,065 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:25:44 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:26:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:26:20 UTC)" (scheduled at 2025-06-16 19:26:00+00:00)
2025-06-16 19:26:00,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:26:00,011 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:26:00,011 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:26:00,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:26:00,013 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:26:00,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:26:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:26:20 UTC)" executed successfully
2025-06-16 19:26:20,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:26:40 UTC)" (scheduled at 2025-06-16 19:26:20+00:00)
2025-06-16 19:26:20,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:26:20,017 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:26:20,017 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:26:20,018 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:26:20,018 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:26:20,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:26:20,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:26:40 UTC)" executed successfully
2025-06-16 19:26:40,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:27:00 UTC)" (scheduled at 2025-06-16 19:26:40+00:00)
2025-06-16 19:26:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:26:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:26:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:26:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:26:40,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:26:40,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:26:40,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:27:00 UTC)" executed successfully
2025-06-16 19:27:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:27:20 UTC)" (scheduled at 2025-06-16 19:27:00+00:00)
2025-06-16 19:27:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:27:00,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:27:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:27:00,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:27:00,005 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:27:00,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:27:00,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:27:20 UTC)" executed successfully
2025-06-16 19:27:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:27:40 UTC)" (scheduled at 2025-06-16 19:27:20+00:00)
2025-06-16 19:27:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:27:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:27:20,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:27:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:27:20,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:27:20,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:27:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:27:40 UTC)" executed successfully
2025-06-16 19:27:26,848 - __main__ - INFO - Bot stopped by user
2025-06-16 19:27:32,599 - __main__ - INFO - Starting bot...
2025-06-16 19:27:32,599 - __main__ - INFO - Routers and middleware included
2025-06-16 19:27:32,600 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:27:32,601 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:27:32,601 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:27:32,637 - __main__ - INFO - Webhook set successfully
2025-06-16 19:27:32,645 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:27:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:28:00 UTC)" (scheduled at 2025-06-16 19:27:40+00:00)
2025-06-16 19:27:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:27:40,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:27:40,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:27:40,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:27:40,013 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:27:40,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:27:40,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:28:00 UTC)" executed successfully
2025-06-16 19:27:54,605 - __main__ - INFO - Received webhook request: {"update_id":441382754,
"message":{"message_id":315,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102074,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:27:54,606 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:27:54,669 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 19:27:54,669 - aiogram.event - INFO - Update id=441382754 is not handled. Duration 64 ms by bot id=7187206991
2025-06-16 19:27:54,670 - aiogram.event - ERROR - Cause exception while process update id=441382754 by bot id=7187206991
AttributeError: 'UserDAO' object has no attribute 'commit_session'
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 142, in cmd_start
    user_dao.commit_session(user)
    ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'UserDAO' object has no attribute 'commit_session'
2025-06-16 19:27:54,672 - __main__ - ERROR - Error processing webhook: 'UserDAO' object has no attribute 'commit_session'
2025-06-16 19:27:54,673 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:27:54 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:28:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:28:20 UTC)" (scheduled at 2025-06-16 19:28:00+00:00)
2025-06-16 19:28:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:28:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:28:00,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:28:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:28:00,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:28:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:28:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:28:20 UTC)" executed successfully
2025-06-16 19:28:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:28:40 UTC)" (scheduled at 2025-06-16 19:28:20+00:00)
2025-06-16 19:28:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:28:20,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:28:20,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:28:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:28:20,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:28:20,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:28:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:28:40 UTC)" executed successfully
2025-06-16 19:28:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:29:00 UTC)" (scheduled at 2025-06-16 19:28:40+00:00)
2025-06-16 19:28:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:28:40,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:28:40,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:28:40,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:28:40,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:28:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:28:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:29:00 UTC)" executed successfully
2025-06-16 19:29:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:29:20 UTC)" (scheduled at 2025-06-16 19:29:00+00:00)
2025-06-16 19:29:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:29:00,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:29:00,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:29:00,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:29:00,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:29:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:29:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:29:20 UTC)" executed successfully
2025-06-16 19:29:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:29:40 UTC)" (scheduled at 2025-06-16 19:29:20+00:00)
2025-06-16 19:29:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:29:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:29:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:29:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:29:20,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:29:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:29:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:29:40 UTC)" executed successfully
2025-06-16 19:29:40,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:30:00 UTC)" (scheduled at 2025-06-16 19:29:40+00:00)
2025-06-16 19:29:40,017 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:29:40,019 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:29:40,019 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:29:40,021 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:29:40,021 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:29:40,021 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:29:40,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:30:00 UTC)" executed successfully
2025-06-16 19:30:00,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:30:20 UTC)" (scheduled at 2025-06-16 19:30:00+00:00)
2025-06-16 19:30:00,024 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:30:00,027 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:30:00,027 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:30:00,029 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:30:00,029 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:30:00,030 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:30:00,030 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:30:20 UTC)" executed successfully
2025-06-16 19:30:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:30:40 UTC)" (scheduled at 2025-06-16 19:30:20+00:00)
2025-06-16 19:30:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:30:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:30:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:30:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:30:20,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:30:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:30:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:30:40 UTC)" executed successfully
2025-06-16 19:30:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:31:00 UTC)" (scheduled at 2025-06-16 19:30:40+00:00)
2025-06-16 19:30:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:30:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:30:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:30:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:30:40,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:30:40,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:30:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:31:00 UTC)" executed successfully
2025-06-16 19:31:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:31:20 UTC)" (scheduled at 2025-06-16 19:31:00+00:00)
2025-06-16 19:31:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:31:00,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:31:00,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:31:00,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:31:00,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:31:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:31:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:31:20 UTC)" executed successfully
2025-06-16 19:31:18,103 - __main__ - INFO - Bot stopped by user
2025-06-16 19:31:23,107 - __main__ - INFO - Starting bot...
2025-06-16 19:31:23,108 - __main__ - INFO - Routers and middleware included
2025-06-16 19:31:23,108 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:31:23,109 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:31:23,109 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:31:23,136 - __main__ - INFO - Webhook set successfully
2025-06-16 19:31:23,137 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:31:40,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:32:00 UTC)" (scheduled at 2025-06-16 19:31:40+00:00)
2025-06-16 19:31:40,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:31:40,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:31:40,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:31:40,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:31:40,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:31:40,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:31:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:32:00 UTC)" executed successfully
2025-06-16 19:32:00,010 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:32:20 UTC)" (scheduled at 2025-06-16 19:32:00+00:00)
2025-06-16 19:32:00,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:32:00,012 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:32:00,012 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:32:00,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:32:00,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:32:00,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:32:00,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:32:20 UTC)" executed successfully
2025-06-16 19:32:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:32:40 UTC)" (scheduled at 2025-06-16 19:32:20+00:00)
2025-06-16 19:32:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:32:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:32:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:32:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:32:20,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:32:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:32:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:32:40 UTC)" executed successfully
2025-06-16 19:32:26,514 - __main__ - INFO - Received webhook request: {"update_id":441382755,
"message":{"message_id":317,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102346,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:32:26,516 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:32:26,703 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 19:32:26,777 - aiogram.event - INFO - Update id=441382755 is handled. Duration 261 ms by bot id=7187206991
2025-06-16 19:32:26,778 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:32:26 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:32:34,294 - __main__ - INFO - Received webhook request: {"update_id":441382756,
"message":{"message_id":319,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102354,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:32:34,295 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:32:34,343 - aiogram.event - INFO - Update id=441382756 is handled. Duration 48 ms by bot id=7187206991
2025-06-16 19:32:34,344 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:32:34 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:32:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:33:00 UTC)" (scheduled at 2025-06-16 19:32:40+00:00)
2025-06-16 19:32:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:32:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:32:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:32:40,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:32:40,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:32:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:32:40,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:33:00 UTC)" executed successfully
2025-06-16 19:33:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:33:20 UTC)" (scheduled at 2025-06-16 19:33:00+00:00)
2025-06-16 19:33:00,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:33:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:33:00,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:33:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:33:00,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:33:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:33:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:33:20 UTC)" executed successfully
2025-06-16 19:33:20,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:33:40 UTC)" (scheduled at 2025-06-16 19:33:20+00:00)
2025-06-16 19:33:20,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:33:20,017 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:33:20,017 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:33:20,018 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:33:20,018 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:33:20,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:33:20,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:33:40 UTC)" executed successfully
2025-06-16 19:33:31,935 - __main__ - INFO - Received webhook request: {"update_id":441382757,
"message":{"message_id":321,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102411,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:33:31,936 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:33:32,070 - aiogram.event - INFO - Update id=441382757 is handled. Duration 133 ms by bot id=7187206991
2025-06-16 19:33:32,070 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:33:31 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:33:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:34:00 UTC)" (scheduled at 2025-06-16 19:33:40+00:00)
2025-06-16 19:33:40,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:33:40,008 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:33:40,008 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:33:40,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:33:40,009 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:33:40,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:33:40,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:34:00 UTC)" executed successfully
2025-06-16 19:33:58,905 - __main__ - INFO - Received webhook request: {"update_id":441382758,
"message":{"message_id":323,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102438,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:33:58,906 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:33:59,147 - aiogram.event - INFO - Update id=441382758 is handled. Duration 240 ms by bot id=7187206991
2025-06-16 19:33:59,147 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:33:58 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:34:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:34:20 UTC)" (scheduled at 2025-06-16 19:34:00+00:00)
2025-06-16 19:34:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:34:00,003 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:34:00,003 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:34:00,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:34:00,004 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:34:00,004 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:34:00,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:34:20 UTC)" executed successfully
2025-06-16 19:34:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:34:40 UTC)" (scheduled at 2025-06-16 19:34:20+00:00)
2025-06-16 19:34:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:34:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:34:20,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:34:20,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:34:20,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:34:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:34:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:34:40 UTC)" executed successfully
2025-06-16 19:34:40,022 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:35:00 UTC)" (scheduled at 2025-06-16 19:34:40+00:00)
2025-06-16 19:34:40,023 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:34:40,025 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:34:40,025 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:34:40,026 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:34:40,026 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:34:40,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:34:40,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:35:00 UTC)" executed successfully
2025-06-16 19:35:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:35:20 UTC)" (scheduled at 2025-06-16 19:35:00+00:00)
2025-06-16 19:35:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:35:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:35:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:35:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:35:00,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:35:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:35:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:35:20 UTC)" executed successfully
2025-06-16 19:35:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:35:40 UTC)" (scheduled at 2025-06-16 19:35:20+00:00)
2025-06-16 19:35:20,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:35:20,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:35:20,007 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:35:20,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:35:20,008 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:35:20,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:35:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:35:40 UTC)" executed successfully
2025-06-16 19:35:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:36:00 UTC)" (scheduled at 2025-06-16 19:35:40+00:00)
2025-06-16 19:35:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:35:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:35:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:35:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:35:40,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:35:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:35:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:36:00 UTC)" executed successfully
2025-06-16 19:36:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:36:20 UTC)" (scheduled at 2025-06-16 19:36:00+00:00)
2025-06-16 19:36:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:36:00,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:36:00,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:36:00,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:36:00,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:36:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:36:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:36:20 UTC)" executed successfully
2025-06-16 19:36:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:36:40 UTC)" (scheduled at 2025-06-16 19:36:20+00:00)
2025-06-16 19:36:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:36:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:36:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:36:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:36:20,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:36:20,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:36:20,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:36:40 UTC)" executed successfully
2025-06-16 19:36:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:37:00 UTC)" (scheduled at 2025-06-16 19:36:40+00:00)
2025-06-16 19:36:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:36:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:36:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:36:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:36:40,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:36:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:36:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:37:00 UTC)" executed successfully
2025-06-16 19:36:45,887 - __main__ - INFO - Bot stopped by user
2025-06-16 19:39:06,532 - __main__ - INFO - Starting bot...
2025-06-16 19:39:06,532 - __main__ - INFO - Routers and middleware included
2025-06-16 19:39:06,533 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:39:06,533 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:39:06,534 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:39:06,600 - __main__ - INFO - Webhook set successfully
2025-06-16 19:39:06,601 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:39:14,248 - aiohttp.access - INFO - 20.65.194.29 [16/Jun/2025:19:39:14 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 19:39:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:39:40 UTC)" (scheduled at 2025-06-16 19:39:20+00:00)
2025-06-16 19:39:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:39:20,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:39:20,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:39:20,010 - scheduler - INFO - Skipping user 435204858: today=2025-06-16 != deadline=2025-06-15
2025-06-16 19:39:20,011 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:39:20,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:39:20,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:39:40 UTC)" executed successfully
2025-06-16 19:39:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:40:00 UTC)" (scheduled at 2025-06-16 19:39:40+00:00)
2025-06-16 19:39:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:39:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:39:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:39:40,022 - scheduler - INFO - Skipping user 435204858: today=2025-06-16 != deadline=2025-06-15
2025-06-16 19:39:40,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:39:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:39:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:40:00 UTC)" executed successfully
2025-06-16 19:39:53,975 - __main__ - INFO - Received webhook request: {"update_id":441382760,
"message":{"message_id":326,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102793,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:39:53,977 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:39:54,248 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 19:39:54,325 - aiogram.event - INFO - Update id=441382760 is handled. Duration 349 ms by bot id=7187206991
2025-06-16 19:39:54,326 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:39:53 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:40:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:40:20 UTC)" (scheduled at 2025-06-16 19:40:00+00:00)
2025-06-16 19:40:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:40:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:40:00,022 - scheduler - INFO - Skipping user 435204858: today=2025-06-16 != deadline=2025-06-15
2025-06-16 19:40:00,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:40:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:40:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:40:20 UTC)" executed successfully
2025-06-16 19:40:01,549 - __main__ - INFO - Received webhook request: {"update_id":441382761,
"callback_query":{"id":"1869190635521734402","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":327,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102794,"text":"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u043e\u0442 \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437\u0430 \ud83d\udc99\n\n\u041e\u043d \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0432\u0430\u043c \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u0430\u043a\u0440\u0435\u043f\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":201,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 19:40:01,551 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 19:40:02,160 - dao.payment_dao - INFO - Saved payment: payment_id=7ac52a4d-d2ad-4ee0-848a-6207507fa96e, yookassa_id=2fe286d1-000f-5001-8000-19b51e117e75, telegram_id=435204858
2025-06-16 19:40:02,227 - bot.handlers.payments - INFO - Sent payment link 7ac52a4d-d2ad-4ee0-848a-6207507fa96e to user 435204858
2025-06-16 19:40:02,274 - aiogram.event - INFO - Update id=441382761 is handled. Duration 724 ms by bot id=7187206991
2025-06-16 19:40:02,276 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:40:01 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:40:08,226 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe286d1-000f-5001-8000-19b51e117e75",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe286d1-000f-5001-8000-19b51e117e75",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T19:40:07.747Z",
    "created_at" : "2025-06-16T19:40:01.869Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "7ac52a4d-d2ad-4ee0-848a-6207507fa96e"
    }
  }
}
2025-06-16 19:40:08,352 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe286d1-000f-5001-8000-19b51e117e75, status=succeeded
2025-06-16 19:40:08,443 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:08,446 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:40:08,446 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:40:08,446 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:40:08 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 19:40:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:40:40 UTC)" (scheduled at 2025-06-16 19:40:20+00:00)
2025-06-16 19:40:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:40:20,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:20,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:40:20,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:40:20,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:40:20,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:40:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:40:40 UTC)" executed successfully
2025-06-16 19:40:22,606 - __main__ - INFO - Received webhook request: {"update_id":441382762,
"message":{"message_id":329,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102822,"text":"/start payment_success_7ac52a4d-d2ad-4ee0-848a-6207507fa96e","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:40:22,607 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 7ac52a4d-d2ad-4ee0-848a-6207507fa96e
2025-06-16 19:40:22,800 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:22,803 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:40:22,803 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:40:27,906 - bot.handlers.start - INFO - Payment 7ac52a4d-d2ad-4ee0-848a-6207507fa96e confirmed via deep-link for user 435204858
2025-06-16 19:40:27,907 - aiogram.event - INFO - Update id=441382762 is handled. Duration 5299 ms by bot id=7187206991
2025-06-16 19:40:27,907 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:40:22 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:40:27,923 - __main__ - INFO - Received webhook request: {"update_id":441382763,
"message":{"message_id":331,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102827,"text":"/start payment_success_7ac52a4d-d2ad-4ee0-848a-6207507fa96e","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:40:27,943 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 7ac52a4d-d2ad-4ee0-848a-6207507fa96e
2025-06-16 19:40:28,175 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:28,178 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:40:28,178 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:40:33,257 - bot.handlers.start - INFO - Payment 7ac52a4d-d2ad-4ee0-848a-6207507fa96e confirmed via deep-link for user 435204858
2025-06-16 19:40:33,257 - aiogram.event - INFO - Update id=441382763 is handled. Duration 5333 ms by bot id=7187206991
2025-06-16 19:40:33,258 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:40:27 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:40:33,369 - __main__ - INFO - Received webhook request: {"update_id":441382764,
"message":{"message_id":333,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102828,"text":"/start payment_success_7ac52a4d-d2ad-4ee0-848a-6207507fa96e","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:40:33,395 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 7ac52a4d-d2ad-4ee0-848a-6207507fa96e
2025-06-16 19:40:33,595 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:33,597 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:40:33,598 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:40:38,686 - bot.handlers.start - INFO - Payment 7ac52a4d-d2ad-4ee0-848a-6207507fa96e confirmed via deep-link for user 435204858
2025-06-16 19:40:38,686 - aiogram.event - INFO - Update id=441382764 is handled. Duration 5316 ms by bot id=7187206991
2025-06-16 19:40:38,687 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:40:33 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:40:38,703 - __main__ - INFO - Received webhook request: {"update_id":441382765,
"message":{"message_id":335,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102828,"text":"/start payment_success_7ac52a4d-d2ad-4ee0-848a-6207507fa96e","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:40:38,727 - bot.handlers.start - INFO - Checking payment via deep-link for user 435204858: 7ac52a4d-d2ad-4ee0-848a-6207507fa96e
2025-06-16 19:40:38,913 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:38,916 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:40:38,916 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:40:40,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:41:00 UTC)" (scheduled at 2025-06-16 19:40:40+00:00)
2025-06-16 19:40:40,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:40:40,003 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:40:40,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:40:40,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:40:40,005 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:40:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:40:40,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:41:00 UTC)" executed successfully
2025-06-16 19:40:44,071 - bot.handlers.start - INFO - Payment 7ac52a4d-d2ad-4ee0-848a-6207507fa96e confirmed via deep-link for user 435204858
2025-06-16 19:40:44,072 - aiogram.event - INFO - Update id=441382765 is handled. Duration 5368 ms by bot id=7187206991
2025-06-16 19:40:44,073 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:40:38 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:41:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:41:20 UTC)" (scheduled at 2025-06-16 19:41:00+00:00)
2025-06-16 19:41:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:41:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:41:00,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:41:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:41:00,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:41:00,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:41:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:41:20 UTC)" executed successfully
2025-06-16 19:41:05,084 - __main__ - INFO - Received webhook request: {"update_id":441382766,
"message":{"message_id":341,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102865,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:41:05,087 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:41:05,374 - aiogram.event - INFO - Update id=441382766 is handled. Duration 287 ms by bot id=7187206991
2025-06-16 19:41:05,375 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:41:05 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:41:12,523 - __main__ - INFO - Bot stopped by user
2025-06-16 19:41:28,369 - __main__ - INFO - Starting bot...
2025-06-16 19:41:28,370 - __main__ - INFO - Routers and middleware included
2025-06-16 19:41:28,370 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:41:28,371 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:41:28,371 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:41:28,407 - __main__ - INFO - Webhook set successfully
2025-06-16 19:41:28,408 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:41:38,564 - __main__ - INFO - Received webhook request: {"update_id":441382768,
"message":{"message_id":344,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102898,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:41:38,566 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:41:38,725 - aiogram.event - INFO - Update id=441382768 is handled. Duration 160 ms by bot id=7187206991
2025-06-16 19:41:38,726 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:41:38 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:41:40,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:42:00 UTC)" (scheduled at 2025-06-16 19:41:40+00:00)
2025-06-16 19:41:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:41:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:41:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:41:40,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:41:40,008 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:41:40,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:41:40,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:42:00 UTC)" executed successfully
2025-06-16 19:41:48,354 - __main__ - INFO - Received webhook request: {"update_id":441382769,
"message":{"message_id":346,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102908,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:41:48,355 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:41:48,664 - aiogram.event - INFO - Update id=441382769 is handled. Duration 309 ms by bot id=7187206991
2025-06-16 19:41:48,665 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:41:48 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:42:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:42:20 UTC)" (scheduled at 2025-06-16 19:42:00+00:00)
2025-06-16 19:42:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:42:00,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:42:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:42:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:42:00,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:42:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:42:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:42:20 UTC)" executed successfully
2025-06-16 19:42:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:42:40 UTC)" (scheduled at 2025-06-16 19:42:20+00:00)
2025-06-16 19:42:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:42:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:42:20,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:42:20,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:42:20,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:42:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:42:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:42:40 UTC)" executed successfully
2025-06-16 19:42:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:43:00 UTC)" (scheduled at 2025-06-16 19:42:40+00:00)
2025-06-16 19:42:40,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:42:40,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:42:40,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:42:40,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:42:40,024 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:42:40,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:42:40,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:43:00 UTC)" executed successfully
2025-06-16 19:42:44,380 - __main__ - INFO - Received webhook request: {"update_id":441382770,
"message":{"message_id":348,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750102964,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:42:44,382 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:42:44,485 - aiogram.event - INFO - Update id=441382770 is handled. Duration 102 ms by bot id=7187206991
2025-06-16 19:42:44,486 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:42:44 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:42:52,371 - __main__ - INFO - Bot stopped by user
2025-06-16 19:43:14,977 - __main__ - INFO - Starting bot...
2025-06-16 19:43:14,978 - __main__ - INFO - Routers and middleware included
2025-06-16 19:43:14,978 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:43:14,979 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:43:14,979 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:43:14,999 - __main__ - INFO - Webhook set successfully
2025-06-16 19:43:14,999 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:43:20,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:43:40 UTC)" (scheduled at 2025-06-16 19:43:20+00:00)
2025-06-16 19:43:20,006 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:43:20,064 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:43:20,064 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:43:20,067 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:43:20,067 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:43:20,068 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:43:20,068 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:43:40 UTC)" executed successfully
2025-06-16 19:43:22,054 - __main__ - INFO - Received webhook request: {"update_id":441382771,
"message":{"message_id":350,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103001,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:43:22,055 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:43:22,125 - aiogram.event - INFO - Update id=441382771 is handled. Duration 70 ms by bot id=7187206991
2025-06-16 19:43:22,126 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:43:22 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:43:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:44:00 UTC)" (scheduled at 2025-06-16 19:43:40+00:00)
2025-06-16 19:43:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:43:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:43:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:43:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:43:40,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:43:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:43:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:44:00 UTC)" executed successfully
2025-06-16 19:44:00,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:44:20 UTC)" (scheduled at 2025-06-16 19:44:00+00:00)
2025-06-16 19:44:00,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:44:00,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:44:00,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:44:00,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:44:00,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:44:00,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:44:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:44:20 UTC)" executed successfully
2025-06-16 19:44:03,009 - __main__ - INFO - Bot stopped by user
2025-06-16 19:44:40,320 - __main__ - INFO - Starting bot...
2025-06-16 19:44:40,320 - __main__ - INFO - Routers and middleware included
2025-06-16 19:44:40,320 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:44:40,321 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:44:40,321 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:44:40,363 - __main__ - INFO - Webhook set successfully
2025-06-16 19:44:40,364 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:44:48,756 - __main__ - INFO - Received webhook request: {"update_id":441382772,
"message":{"message_id":352,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103088,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:44:48,758 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:44:48,819 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-16 19:44:48,820 - aiogram.event - INFO - Update id=441382772 is handled. Duration 62 ms by bot id=7187206991
2025-06-16 19:44:48,820 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:44:48 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:44:55,501 - __main__ - INFO - Received webhook request: {"update_id":441382773,
"message":{"message_id":354,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103095,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 19:44:55,503 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-16 19:44:55,580 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-16 19:44:55,580 - aiogram.event - INFO - Update id=441382773 is handled. Duration 78 ms by bot id=7187206991
2025-06-16 19:44:55,581 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:44:55 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:44:57,068 - __main__ - INFO - Received webhook request: {"update_id":441382774,
"callback_query":{"id":"1869190635112940442","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":355,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103095,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-5253664427425224793","data":"status_associate"}}
2025-06-16 19:44:57,069 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-16 19:44:57,165 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:44:57,169 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:44:57,169 - dao.user_dao - INFO - Created user 435204858
2025-06-16 19:44:57,392 - aiogram.event - INFO - Update id=441382774 is handled. Duration 323 ms by bot id=7187206991
2025-06-16 19:44:57,393 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:44:57 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:45:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:45:20 UTC)" (scheduled at 2025-06-16 19:45:00+00:00)
2025-06-16 19:45:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:45:00,007 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:45:00,007 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:45:00,007 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-16 19:45:00,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:45:00,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:45:00,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:45:20 UTC)" executed successfully
2025-06-16 19:45:01,113 - __main__ - INFO - Received webhook request: {"update_id":441382775,
"callback_query":{"id":"1869190635043674630","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":356,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103097,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 19:45:01,115 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 19:45:02,136 - dao.payment_dao - INFO - Saved payment: payment_id=1a3fb54a-efef-46b3-9b51-005713f68a2b, yookassa_id=2fe287fd-000f-5000-b000-19ce6d3f36d0, telegram_id=435204858
2025-06-16 19:45:02,280 - bot.handlers.payments - INFO - Sent payment link 1a3fb54a-efef-46b3-9b51-005713f68a2b to user 435204858
2025-06-16 19:45:02,399 - aiogram.event - INFO - Update id=441382775 is handled. Duration 1284 ms by bot id=7187206991
2025-06-16 19:45:02,399 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:45:01 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:45:08,564 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe287fd-000f-5000-b000-19ce6d3f36d0",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe287fd-000f-5000-b000-19ce6d3f36d0",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T19:45:08.242Z",
    "created_at" : "2025-06-16T19:45:01.391Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "1a3fb54a-efef-46b3-9b51-005713f68a2b"
    }
  }
}
2025-06-16 19:45:08,796 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe287fd-000f-5000-b000-19ce6d3f36d0, status=succeeded
2025-06-16 19:45:08,981 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:45:08,986 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:45:08,986 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 19:45:14,241 - bot.handlers.payments - INFO - Payment succeeded: payment_id=1a3fb54a-efef-46b3-9b51-005713f68a2b, yookassa_id=2fe287fd-000f-5000-b000-19ce6d3f36d0, user=435204858
2025-06-16 19:45:14,241 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:45:08 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 19:45:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:45:40 UTC)" (scheduled at 2025-06-16 19:45:20+00:00)
2025-06-16 19:45:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:45:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:45:20,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:45:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:45:20,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:45:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:45:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:45:40 UTC)" executed successfully
2025-06-16 19:45:23,898 - __main__ - INFO - Received webhook request: {"update_id":441382776,
"message":{"message_id":360,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103123,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:45:23,900 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:45:23,970 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 19:45:24,802 - aiogram.event - INFO - Update id=441382776 is handled. Duration 902 ms by bot id=7187206991
2025-06-16 19:45:24,803 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:45:23 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:45:33,065 - __main__ - INFO - Received webhook request: {"update_id":441382777,
"message":{"message_id":362,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103133,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:45:33,066 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:45:33,122 - aiogram.event - INFO - Update id=441382777 is handled. Duration 56 ms by bot id=7187206991
2025-06-16 19:45:33,123 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:45:33 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:45:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:46:00 UTC)" (scheduled at 2025-06-16 19:45:40+00:00)
2025-06-16 19:45:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:45:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:45:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:45:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:45:40,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:45:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:45:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:46:00 UTC)" executed successfully
2025-06-16 19:46:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:46:20 UTC)" (scheduled at 2025-06-16 19:46:00+00:00)
2025-06-16 19:46:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:46:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:46:00,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:46:00,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:46:00,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:46:00,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:46:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:46:20 UTC)" executed successfully
2025-06-16 19:46:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:46:40 UTC)" (scheduled at 2025-06-16 19:46:20+00:00)
2025-06-16 19:46:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:46:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:46:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:46:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:46:20,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:46:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:46:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:46:40 UTC)" executed successfully
2025-06-16 19:46:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:47:00 UTC)" (scheduled at 2025-06-16 19:46:40+00:00)
2025-06-16 19:46:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:46:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:46:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:46:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:46:40,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:46:40,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:46:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:47:00 UTC)" executed successfully
2025-06-16 19:47:00,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:47:20 UTC)" (scheduled at 2025-06-16 19:47:00+00:00)
2025-06-16 19:47:00,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:47:00,017 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:47:00,017 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:47:00,018 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:47:00,018 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:47:00,019 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:47:00,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:47:20 UTC)" executed successfully
2025-06-16 19:47:20,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:47:40 UTC)" (scheduled at 2025-06-16 19:47:20+00:00)
2025-06-16 19:47:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:47:20,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:47:20,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:47:20,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:47:20,015 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:47:20,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:47:20,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:47:40 UTC)" executed successfully
2025-06-16 19:47:40,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:48:00 UTC)" (scheduled at 2025-06-16 19:47:40+00:00)
2025-06-16 19:47:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:47:40,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:47:40,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:47:40,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:47:40,011 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:47:40,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:47:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:48:00 UTC)" executed successfully
2025-06-16 19:48:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:48:20 UTC)" (scheduled at 2025-06-16 19:48:00+00:00)
2025-06-16 19:48:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:48:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:48:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:48:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:48:00,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:48:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:48:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:48:20 UTC)" executed successfully
2025-06-16 19:48:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:48:40 UTC)" (scheduled at 2025-06-16 19:48:20+00:00)
2025-06-16 19:48:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:48:20,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:48:20,024 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:48:20,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:48:20,025 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:48:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:48:20,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:48:40 UTC)" executed successfully
2025-06-16 19:48:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:49:00 UTC)" (scheduled at 2025-06-16 19:48:40+00:00)
2025-06-16 19:48:40,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:48:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:48:40,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:48:40,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:48:40,015 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:48:40,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:48:40,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:49:00 UTC)" executed successfully
2025-06-16 19:49:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:49:20 UTC)" (scheduled at 2025-06-16 19:49:00+00:00)
2025-06-16 19:49:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:49:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:49:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:49:00,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:49:00,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:49:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:49:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:49:20 UTC)" executed successfully
2025-06-16 19:49:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:49:40 UTC)" (scheduled at 2025-06-16 19:49:20+00:00)
2025-06-16 19:49:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:49:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:49:20,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:49:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:49:20,024 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:49:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:49:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:49:40 UTC)" executed successfully
2025-06-16 19:49:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:50:00 UTC)" (scheduled at 2025-06-16 19:49:40+00:00)
2025-06-16 19:49:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:49:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:49:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:49:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:49:40,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:49:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:49:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:50:00 UTC)" executed successfully
2025-06-16 19:50:00,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:50:20 UTC)" (scheduled at 2025-06-16 19:50:00+00:00)
2025-06-16 19:50:00,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:50:00,008 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:50:00,008 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:50:00,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:50:00,009 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:50:00,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:50:00,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:50:20 UTC)" executed successfully
2025-06-16 19:50:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:50:40 UTC)" (scheduled at 2025-06-16 19:50:20+00:00)
2025-06-16 19:50:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:50:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:50:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:50:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:50:20,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:50:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:50:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:50:40 UTC)" executed successfully
2025-06-16 19:50:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:51:00 UTC)" (scheduled at 2025-06-16 19:50:40+00:00)
2025-06-16 19:50:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:50:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:50:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:50:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:50:40,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:50:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:50:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:51:00 UTC)" executed successfully
2025-06-16 19:51:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:51:20 UTC)" (scheduled at 2025-06-16 19:51:00+00:00)
2025-06-16 19:51:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:51:00,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:51:00,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:51:00,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:51:00,024 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:51:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:51:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:51:20 UTC)" executed successfully
2025-06-16 19:51:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:51:40 UTC)" (scheduled at 2025-06-16 19:51:20+00:00)
2025-06-16 19:51:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:51:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:51:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:51:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:51:20,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:51:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:51:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:51:40 UTC)" executed successfully
2025-06-16 19:51:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:52:00 UTC)" (scheduled at 2025-06-16 19:51:40+00:00)
2025-06-16 19:51:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:51:40,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:51:40,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:51:40,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:51:40,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:51:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:51:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:52:00 UTC)" executed successfully
2025-06-16 19:52:00,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:52:20 UTC)" (scheduled at 2025-06-16 19:52:00+00:00)
2025-06-16 19:52:00,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:52:00,024 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:52:00,024 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:52:00,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:52:00,025 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:52:00,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:52:00,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:52:20 UTC)" executed successfully
2025-06-16 19:52:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:52:40 UTC)" (scheduled at 2025-06-16 19:52:20+00:00)
2025-06-16 19:52:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:52:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:52:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:52:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:52:20,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:52:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:52:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:52:40 UTC)" executed successfully
2025-06-16 19:52:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:53:00 UTC)" (scheduled at 2025-06-16 19:52:40+00:00)
2025-06-16 19:52:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:52:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:52:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:52:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:52:40,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:52:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:52:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:53:00 UTC)" executed successfully
2025-06-16 19:53:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:53:20 UTC)" (scheduled at 2025-06-16 19:53:00+00:00)
2025-06-16 19:53:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:53:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:53:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:53:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:53:00,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:53:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:53:00,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:53:20 UTC)" executed successfully
2025-06-16 19:53:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:53:40 UTC)" (scheduled at 2025-06-16 19:53:20+00:00)
2025-06-16 19:53:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:53:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:53:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:53:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:53:20,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:53:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:53:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:53:40 UTC)" executed successfully
2025-06-16 19:53:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:54:00 UTC)" (scheduled at 2025-06-16 19:53:40+00:00)
2025-06-16 19:53:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:53:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:53:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:53:40,021 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:53:40,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:53:40,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:53:40,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:54:00 UTC)" executed successfully
2025-06-16 19:54:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:54:20 UTC)" (scheduled at 2025-06-16 19:54:00+00:00)
2025-06-16 19:54:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:54:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:54:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:54:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:54:00,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:54:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:54:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:54:20 UTC)" executed successfully
2025-06-16 19:54:20,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:54:40 UTC)" (scheduled at 2025-06-16 19:54:20+00:00)
2025-06-16 19:54:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:54:20,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:54:20,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:54:20,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:54:20,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:54:20,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:54:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:54:40 UTC)" executed successfully
2025-06-16 19:54:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:55:00 UTC)" (scheduled at 2025-06-16 19:54:40+00:00)
2025-06-16 19:54:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:54:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:54:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:54:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:54:40,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:54:40,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:54:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:55:00 UTC)" executed successfully
2025-06-16 19:55:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:55:20 UTC)" (scheduled at 2025-06-16 19:55:00+00:00)
2025-06-16 19:55:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:55:00,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:55:00,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:55:00,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:55:00,025 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:55:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:55:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:55:20 UTC)" executed successfully
2025-06-16 19:55:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:55:40 UTC)" (scheduled at 2025-06-16 19:55:20+00:00)
2025-06-16 19:55:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:55:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:55:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:55:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:55:20,023 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:55:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:55:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:55:40 UTC)" executed successfully
2025-06-16 19:55:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:56:00 UTC)" (scheduled at 2025-06-16 19:55:40+00:00)
2025-06-16 19:55:40,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:55:40,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:55:40,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 19:55:40,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 19:55:40,011 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:55:40,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:55:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:56:00 UTC)" executed successfully
2025-06-16 19:55:50,238 - __main__ - INFO - Bot stopped by user
2025-06-16 19:56:32,038 - __main__ - INFO - Starting bot...
2025-06-16 19:56:32,038 - __main__ - INFO - Routers and middleware included
2025-06-16 19:56:32,039 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:56:32,039 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:56:32,040 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:56:32,080 - __main__ - INFO - Webhook set successfully
2025-06-16 19:56:32,081 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:56:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:57:00 UTC)" (scheduled at 2025-06-16 19:56:40+00:00)
2025-06-16 19:56:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:56:40,006 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:56:40,006 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:56:40,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:56:40,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:56:40,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:57:00 UTC)" executed successfully
2025-06-16 19:57:00,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:57:20 UTC)" (scheduled at 2025-06-16 19:57:00+00:00)
2025-06-16 19:57:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:57:00,013 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:57:00,013 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:57:00,013 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:57:00,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:57:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:57:20 UTC)" executed successfully
2025-06-16 19:57:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:57:40 UTC)" (scheduled at 2025-06-16 19:57:20+00:00)
2025-06-16 19:57:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:57:20,022 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:57:20,022 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:57:20,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:57:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:57:20,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:57:40 UTC)" executed successfully
2025-06-16 19:57:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:58:00 UTC)" (scheduled at 2025-06-16 19:57:40+00:00)
2025-06-16 19:57:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:57:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:57:40,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:57:40,022 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:57:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:57:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:58:00 UTC)" executed successfully
2025-06-16 19:58:00,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:58:20 UTC)" (scheduled at 2025-06-16 19:58:00+00:00)
2025-06-16 19:58:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:58:00,009 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:58:00,009 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:58:00,009 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 19:58:00,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:58:00,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:58:20 UTC)" executed successfully
2025-06-16 19:58:08,961 - __main__ - INFO - Bot stopped by user
2025-06-16 19:58:09,067 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f8eb91eb810>
2025-06-16 19:58:50,516 - __main__ - INFO - Starting bot...
2025-06-16 19:58:50,516 - __main__ - INFO - Routers and middleware included
2025-06-16 19:58:50,516 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 19:58:50,517 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 19:58:50,517 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 19:58:50,536 - __main__ - INFO - Webhook set successfully
2025-06-16 19:58:50,536 - __main__ - INFO - Web server started on port 8443
2025-06-16 19:59:00,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:59:20 UTC)" (scheduled at 2025-06-16 19:59:00+00:00)
2025-06-16 19:59:00,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:59:00,014 - dao.user_dao - INFO - Retrieved 1 users
2025-06-16 19:59:00,014 - scheduler - INFO - Retrieved 1 users
2025-06-16 19:59:00,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:59:00,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:59:20 UTC)" executed successfully
2025-06-16 19:59:06,443 - __main__ - INFO - Received webhook request: {"update_id":441382778,
"message":{"message_id":364,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103946,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:59:06,445 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 19:59:06,561 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 19:59:06,562 - aiogram.event - INFO - Update id=441382778 is handled. Duration 117 ms by bot id=7187206991
2025-06-16 19:59:06,562 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:06 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:06,955 - __main__ - INFO - Received webhook request: {"update_id":441382779,
"message":{"message_id":366,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103946,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:59:06,956 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 19:59:07,209 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 19:59:07,210 - aiogram.event - INFO - Update id=441382779 is handled. Duration 254 ms by bot id=7187206991
2025-06-16 19:59:07,211 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:06 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:17,979 - __main__ - INFO - Received webhook request: {"update_id":441382780,
"message":{"message_id":368,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103957,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 19:59:17,981 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 19:59:18,108 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 19:59:18,108 - aiogram.event - INFO - Update id=441382780 is handled. Duration 127 ms by bot id=7187206991
2025-06-16 19:59:18,109 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:17 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:59:40 UTC)" (scheduled at 2025-06-16 19:59:20+00:00)
2025-06-16 19:59:20,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:59:20,004 - dao.user_dao - INFO - Retrieved 1 users
2025-06-16 19:59:20,004 - scheduler - INFO - Retrieved 1 users
2025-06-16 19:59:20,005 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:59:20,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 19:59:40 UTC)" executed successfully
2025-06-16 19:59:20,172 - __main__ - INFO - Received webhook request: {"update_id":441382781,
"callback_query":{"id":"1936887766129104316","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":369,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103958,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 19:59:20,174 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 19:59:20,366 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:59:20,370 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 19:59:20,370 - dao.user_dao - INFO - Created user 450966825
2025-06-16 19:59:20,466 - aiogram.event - INFO - Update id=441382781 is handled. Duration 292 ms by bot id=7187206991
2025-06-16 19:59:20,466 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:20 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:22,236 - __main__ - INFO - Received webhook request: {"update_id":441382782,
"callback_query":{"id":"1936887769064140201","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":370,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103960,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 19:59:22,238 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 19:59:22,763 - dao.payment_dao - INFO - Saved payment: payment_id=ddd2d201-cc96-4551-8cd3-8d1316f5eb55, yookassa_id=2fe28b5a-000f-5001-9000-1f5971d27b07, telegram_id=450966825
2025-06-16 19:59:22,801 - bot.handlers.payments - INFO - Sent payment link ddd2d201-cc96-4551-8cd3-8d1316f5eb55 to user 450966825
2025-06-16 19:59:22,821 - aiogram.event - INFO - Update id=441382782 is handled. Duration 584 ms by bot id=7187206991
2025-06-16 19:59:22,822 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:22 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:30,593 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe28b5a-000f-5001-9000-1f5971d27b07",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe28b5a-000f-5001-9000-1f5971d27b07",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T19:59:30.185Z",
    "created_at" : "2025-06-16T19:59:22.566Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "ddd2d201-cc96-4551-8cd3-8d1316f5eb55"
    }
  }
}
2025-06-16 19:59:30,757 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe28b5a-000f-5001-9000-1f5971d27b07, status=succeeded
2025-06-16 19:59:30,845 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:59:30,848 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 19:59:30,848 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 19:59:35,200 - __main__ - INFO - Received webhook request: {"update_id":441382783,
"message":{"message_id":373,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103975,"text":"/start payment_success_ddd2d201-cc96-4551-8cd3-8d1316f5eb55","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:59:35,202 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: ddd2d201-cc96-4551-8cd3-8d1316f5eb55
2025-06-16 19:59:35,409 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:59:35,412 - dao.user_dao - INFO - Saved 2 users to users.csv
2025-06-16 19:59:35,412 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 19:59:35,917 - bot.handlers.payments - INFO - Payment succeeded: payment_id=ddd2d201-cc96-4551-8cd3-8d1316f5eb55, yookassa_id=2fe28b5a-000f-5001-9000-1f5971d27b07, user=450966825
2025-06-16 19:59:35,918 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:30 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 19:59:40,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:00:00 UTC)" (scheduled at 2025-06-16 19:59:40+00:00)
2025-06-16 19:59:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 19:59:40,003 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 19:59:40,003 - scheduler - INFO - Retrieved 2 users
2025-06-16 19:59:40,005 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 19:59:40,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 19:59:40,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:00:00 UTC)" executed successfully
2025-06-16 19:59:40,586 - bot.handlers.start - INFO - Payment ddd2d201-cc96-4551-8cd3-8d1316f5eb55 confirmed via deep-link for user 450966825
2025-06-16 19:59:40,586 - aiogram.event - INFO - Update id=441382783 is handled. Duration 5384 ms by bot id=7187206991
2025-06-16 19:59:40,587 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:42,029 - __main__ - INFO - Received webhook request: {"update_id":441382784,
"message":{"message_id":377,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103981,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:59:42,030 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 19:59:42,082 - bot.handlers.start - INFO - Started registration for user 435204858
2025-06-16 19:59:42,083 - aiogram.event - INFO - Update id=441382784 is handled. Duration 52 ms by bot id=7187206991
2025-06-16 19:59:42,083 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:42 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:50,950 - __main__ - INFO - Received webhook request: {"update_id":441382785,
"message":{"message_id":379,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103990,"text":"\u041b\u0435\u0431\u0435\u0434\u0435\u0432 \u0410\u043b\u0430\u043d \u0412\u0438\u0442\u0430\u043b\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 19:59:50,952 - bot.handlers.registration - INFO - Processing FIO for user 435204858
2025-06-16 19:59:51,162 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 435204858
2025-06-16 19:59:51,163 - aiogram.event - INFO - Update id=441382785 is handled. Duration 212 ms by bot id=7187206991
2025-06-16 19:59:51,163 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:51,879 - __main__ - INFO - Received webhook request: {"update_id":441382786,
"message":{"message_id":381,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103991,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:59:51,880 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 19:59:51,939 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 19:59:51,939 - aiogram.event - INFO - Update id=441382786 is not handled. Duration 59 ms by bot id=7187206991
2025-06-16 19:59:51,939 - aiogram.event - ERROR - Cause exception while process update id=441382786 by bot id=7187206991
AttributeError: 'UserDAO' object has no attribute 'update_user'
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 150, in cmd_start
    user_dao.update_user(user)
    ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'UserDAO' object has no attribute 'update_user'
2025-06-16 19:59:51,944 - __main__ - ERROR - Error processing webhook: 'UserDAO' object has no attribute 'update_user'
2025-06-16 19:59:51,944 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:51 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:55,721 - __main__ - INFO - Received webhook request: {"update_id":441382787,
"callback_query":{"id":"1869190635045260861","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":380,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103991,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-5253664427425224793","data":"status_associate"}}
2025-06-16 19:59:55,722 - bot.handlers.menu - INFO - Processing status selection for user 435204858
2025-06-16 19:59:55,782 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 19:59:55,786 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 19:59:55,786 - dao.user_dao - INFO - Created user 435204858
2025-06-16 19:59:55,935 - aiogram.event - INFO - Update id=441382787 is handled. Duration 212 ms by bot id=7187206991
2025-06-16 19:59:55,935 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:55 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 19:59:59,074 - __main__ - INFO - Received webhook request: {"update_id":441382788,
"message":{"message_id":384,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750103999,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 19:59:59,075 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 19:59:59,249 - aiogram.event - INFO - Update id=441382788 is handled. Duration 174 ms by bot id=7187206991
2025-06-16 19:59:59,249 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:19:59:59 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:00:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:00:20 UTC)" (scheduled at 2025-06-16 20:00:00+00:00)
2025-06-16 20:00:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:00:00,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:00:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:00:00,004 - scheduler - INFO - Skipping user 435204858: no last_payment_date or payment_method_id
2025-06-16 20:00:00,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:00:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:00:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:00:20 UTC)" executed successfully
2025-06-16 20:00:11,282 - __main__ - INFO - Received webhook request: {"update_id":441382789,
"callback_query":{"id":"1869190633461729650","from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"message":{"message_id":383,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750103995,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-5253664427425224793","data":"pay"}}
2025-06-16 20:00:11,284 - bot.handlers.payments - INFO - Processing payment for user 435204858
2025-06-16 20:00:11,706 - dao.payment_dao - INFO - Saved payment: payment_id=25825ab9-0ed7-4d48-a75d-f71279b1046f, yookassa_id=2fe28b8b-000f-5001-8000-1d7e0071f379, telegram_id=435204858
2025-06-16 20:00:11,754 - bot.handlers.payments - INFO - Sent payment link 25825ab9-0ed7-4d48-a75d-f71279b1046f to user 435204858
2025-06-16 20:00:11,776 - aiogram.event - INFO - Update id=441382789 is handled. Duration 492 ms by bot id=7187206991
2025-06-16 20:00:11,777 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:00:11 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:00:18,193 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe28b8b-000f-5001-8000-1d7e0071f379",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe28b8b-000f-5001-8000-1d7e0071f379",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T20:00:17.870Z",
    "created_at" : "2025-06-16T20:00:11.491Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "435204858",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "25825ab9-0ed7-4d48-a75d-f71279b1046f"
    }
  }
}
2025-06-16 20:00:18,308 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe28b8b-000f-5001-8000-1d7e0071f379, status=succeeded
2025-06-16 20:00:18,341 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:00:18,344 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:00:18,344 - dao.user_dao - INFO - Updated payment for user 435204858
2025-06-16 20:00:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:00:40 UTC)" (scheduled at 2025-06-16 20:00:20+00:00)
2025-06-16 20:00:20,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:00:20,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:00:20,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:00:20,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:00:20,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:00:20,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:00:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:00:40 UTC)" executed successfully
2025-06-16 20:00:23,403 - bot.handlers.payments - INFO - Payment succeeded: payment_id=25825ab9-0ed7-4d48-a75d-f71279b1046f, yookassa_id=2fe28b8b-000f-5001-8000-1d7e0071f379, user=435204858
2025-06-16 20:00:23,404 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:00:18 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 20:00:34,796 - __main__ - INFO - Received webhook request: {"update_id":441382790,
"message":{"message_id":389,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750104034,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:00:34,797 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 20:00:34,837 - bot.handlers.start - INFO - Sent welcome message to user 435204858
2025-06-16 20:00:34,838 - aiogram.event - INFO - Update id=441382790 is not handled. Duration 41 ms by bot id=7187206991
2025-06-16 20:00:34,838 - aiogram.event - ERROR - Cause exception while process update id=441382790 by bot id=7187206991
AttributeError: 'UserDAO' object has no attribute 'update_user'
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 150, in cmd_start
    user_dao.update_user(user)
    ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'UserDAO' object has no attribute 'update_user'
2025-06-16 20:00:34,840 - __main__ - ERROR - Error processing webhook: 'UserDAO' object has no attribute 'update_user'
2025-06-16 20:00:34,841 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:00:34 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:00:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:01:00 UTC)" (scheduled at 2025-06-16 20:00:40+00:00)
2025-06-16 20:00:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:00:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:00:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:00:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:00:40,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:00:40,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:00:40,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:01:00 UTC)" executed successfully
2025-06-16 20:00:42,357 - __main__ - INFO - Received webhook request: {"update_id":441382791,
"message":{"message_id":391,"from":{"id":435204858,"is_bot":false,"first_name":"Alan","username":"alan_lebedev","language_code":"ru","is_premium":true},"chat":{"id":435204858,"first_name":"Alan","username":"alan_lebedev","type":"private"},"date":1750104042,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:00:42,358 - bot.handlers.start - INFO - Processing /start for user 435204858
2025-06-16 20:00:42,396 - aiogram.event - INFO - Update id=441382791 is handled. Duration 37 ms by bot id=7187206991
2025-06-16 20:00:42,396 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:00:42 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:01:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:01:20 UTC)" (scheduled at 2025-06-16 20:01:00+00:00)
2025-06-16 20:01:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:01:00,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:01:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:01:00,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:01:00,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:01:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:01:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:01:20 UTC)" executed successfully
2025-06-16 20:01:20,014 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:01:40 UTC)" (scheduled at 2025-06-16 20:01:20+00:00)
2025-06-16 20:01:20,015 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:01:20,016 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:01:20,016 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:01:20,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:01:20,017 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:01:20,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:01:20,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:01:40 UTC)" executed successfully
2025-06-16 20:01:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:02:00 UTC)" (scheduled at 2025-06-16 20:01:40+00:00)
2025-06-16 20:01:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:01:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:01:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:01:40,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:01:40,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:01:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:01:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:02:00 UTC)" executed successfully
2025-06-16 20:02:00,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:02:20 UTC)" (scheduled at 2025-06-16 20:02:00+00:00)
2025-06-16 20:02:00,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:02:00,008 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:02:00,008 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:02:00,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:02:00,010 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:02:00,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:02:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:02:20 UTC)" executed successfully
2025-06-16 20:02:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:02:40 UTC)" (scheduled at 2025-06-16 20:02:20+00:00)
2025-06-16 20:02:20,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:02:20,008 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:02:20,008 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:02:20,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:02:20,009 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:02:20,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:02:20,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:02:40 UTC)" executed successfully
2025-06-16 20:02:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:03:00 UTC)" (scheduled at 2025-06-16 20:02:40+00:00)
2025-06-16 20:02:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:02:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:02:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:02:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:02:40,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:02:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:02:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:03:00 UTC)" executed successfully
2025-06-16 20:03:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:03:20 UTC)" (scheduled at 2025-06-16 20:03:00+00:00)
2025-06-16 20:03:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:03:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:03:00,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:03:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:03:00,007 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:03:00,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:03:00,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:03:20 UTC)" executed successfully
2025-06-16 20:03:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:03:40 UTC)" (scheduled at 2025-06-16 20:03:20+00:00)
2025-06-16 20:03:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:03:20,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:03:20,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:03:20,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:03:20,025 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:03:20,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:03:20,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:03:40 UTC)" executed successfully
2025-06-16 20:03:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:04:00 UTC)" (scheduled at 2025-06-16 20:03:40+00:00)
2025-06-16 20:03:40,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:03:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:03:40,015 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:03:40,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:03:40,016 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:03:40,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:03:40,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:04:00 UTC)" executed successfully
2025-06-16 20:04:00,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:04:20 UTC)" (scheduled at 2025-06-16 20:04:00+00:00)
2025-06-16 20:04:00,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:04:00,024 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:04:00,024 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:04:00,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:04:00,026 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:04:00,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:04:00,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:04:20 UTC)" executed successfully
2025-06-16 20:04:20,022 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:04:40 UTC)" (scheduled at 2025-06-16 20:04:20+00:00)
2025-06-16 20:04:20,023 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:04:20,025 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:04:20,025 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:04:20,027 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:04:20,027 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:04:20,028 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:04:20,028 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:04:40 UTC)" executed successfully
2025-06-16 20:04:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:05:00 UTC)" (scheduled at 2025-06-16 20:04:40+00:00)
2025-06-16 20:04:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:04:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:04:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:04:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:04:40,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:04:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:04:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:05:00 UTC)" executed successfully
2025-06-16 20:04:47,486 - __main__ - INFO - Bot stopped by user
2025-06-16 20:06:17,718 - __main__ - INFO - Starting bot...
2025-06-16 20:06:17,719 - __main__ - INFO - Routers and middleware included
2025-06-16 20:06:17,719 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 20:06:17,719 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 20:06:17,720 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 20:06:17,758 - __main__ - INFO - Webhook set successfully
2025-06-16 20:06:17,758 - __main__ - INFO - Web server started on port 8443
2025-06-16 20:06:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:06:40 UTC)" (scheduled at 2025-06-16 20:06:20+00:00)
2025-06-16 20:06:20,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:06:20,005 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:06:20,006 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:06:20,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:06:20,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:06:20,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:06:40 UTC)" executed successfully
2025-06-16 20:06:35,524 - __main__ - INFO - Received webhook request: {"update_id":441382792,
"message":{"message_id":393,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104395,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:06:35,525 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:06:35,599 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 20:06:35,600 - aiogram.event - INFO - Update id=441382792 is handled. Duration 75 ms by bot id=7187206991
2025-06-16 20:06:35,601 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:06:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:06:40,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:07:00 UTC)" (scheduled at 2025-06-16 20:06:40+00:00)
2025-06-16 20:06:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:06:40,005 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:06:40,005 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:06:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:06:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:06:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:07:00 UTC)" executed successfully
2025-06-16 20:06:46,322 - __main__ - INFO - Received webhook request: {"update_id":441382793,
"message":{"message_id":395,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104406,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 20:06:46,324 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 20:06:46,675 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 20:06:46,675 - aiogram.event - INFO - Update id=441382793 is handled. Duration 352 ms by bot id=7187206991
2025-06-16 20:06:46,677 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:06:46 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:06:50,479 - __main__ - INFO - Received webhook request: {"update_id":441382794,
"callback_query":{"id":"1936887768708641834","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":396,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104406,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 20:06:50,481 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 20:06:50,519 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:06:50,523 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:06:50,523 - dao.user_dao - INFO - Created user 450966825
2025-06-16 20:06:50,590 - aiogram.event - INFO - Update id=441382794 is handled. Duration 110 ms by bot id=7187206991
2025-06-16 20:06:50,591 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:06:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:06:52,584 - __main__ - INFO - Received webhook request: {"update_id":441382795,
"callback_query":{"id":"1936887765290367371","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":397,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104410,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 20:06:52,586 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 20:06:53,471 - dao.payment_dao - INFO - Saved payment: payment_id=4f6c41b8-59c1-4658-9257-88a53af3f998, yookassa_id=2fe28d1d-000f-5000-b000-1fc423701ca6, telegram_id=450966825
2025-06-16 20:06:53,510 - bot.handlers.payments - INFO - Sent payment link 4f6c41b8-59c1-4658-9257-88a53af3f998 to user 450966825
2025-06-16 20:06:53,525 - aiogram.event - INFO - Update id=441382795 is handled. Duration 939 ms by bot id=7187206991
2025-06-16 20:06:53,525 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:06:52 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:07:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:07:20 UTC)" (scheduled at 2025-06-16 20:07:00+00:00)
2025-06-16 20:07:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:07:00,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:07:00,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:07:00,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:07:00,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 20:07:00,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:07:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:07:20 UTC)" executed successfully
2025-06-16 20:07:13,366 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe28d1d-000f-5000-b000-1fc423701ca6",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe28d1d-000f-5000-b000-1fc423701ca6",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T20:07:13.041Z",
    "created_at" : "2025-06-16T20:06:53.091Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "4f6c41b8-59c1-4658-9257-88a53af3f998"
    }
  }
}
2025-06-16 20:07:13,508 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe28d1d-000f-5000-b000-1fc423701ca6, status=succeeded
2025-06-16 20:07:13,615 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:07:13,617 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:07:13,617 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 20:07:16,243 - __main__ - INFO - Received webhook request: {"update_id":441382796,
"message":{"message_id":400,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104436,"text":"/start payment_success_4f6c41b8-59c1-4658-9257-88a53af3f998","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:07:16,244 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: 4f6c41b8-59c1-4658-9257-88a53af3f998
2025-06-16 20:07:16,430 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:07:16,432 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:07:16,432 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 20:07:18,766 - bot.handlers.payments - INFO - Payment succeeded: payment_id=4f6c41b8-59c1-4658-9257-88a53af3f998, yookassa_id=2fe28d1d-000f-5000-b000-1fc423701ca6, user=450966825
2025-06-16 20:07:18,768 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:07:13 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 20:07:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:07:40 UTC)" (scheduled at 2025-06-16 20:07:20+00:00)
2025-06-16 20:07:20,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:07:20,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:07:20,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:07:20,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:07:20,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:07:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:07:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:07:40 UTC)" executed successfully
2025-06-16 20:07:21,499 - bot.handlers.start - INFO - Payment 4f6c41b8-59c1-4658-9257-88a53af3f998 confirmed via deep-link for user 450966825
2025-06-16 20:07:21,499 - aiogram.event - INFO - Update id=441382796 is handled. Duration 5255 ms by bot id=7187206991
2025-06-16 20:07:21,500 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:07:16 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:07:38,810 - __main__ - INFO - Received webhook request: {"update_id":441382797,
"message":{"message_id":404,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104458,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:07:38,811 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:07:38,906 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 20:07:38,906 - aiogram.event - INFO - Update id=441382797 is not handled. Duration 95 ms by bot id=7187206991
2025-06-16 20:07:38,907 - aiogram.event - ERROR - Cause exception while process update id=441382797 by bot id=7187206991
NameError: name 'SessionLocal' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 142, in cmd_start
    user_dao.update_user(user)
  File "/home/vps/telegram_bot/dao/user_dao.py", line 158, in update_user
    session = SessionLocal()
              ^^^^^^^^^^^^
NameError: name 'SessionLocal' is not defined
2025-06-16 20:07:38,911 - __main__ - ERROR - Error processing webhook: name 'SessionLocal' is not defined
2025-06-16 20:07:38,912 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:07:38 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:07:40,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:08:00 UTC)" (scheduled at 2025-06-16 20:07:40+00:00)
2025-06-16 20:07:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:07:40,003 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:07:40,003 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:07:40,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:07:40,005 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:07:40,005 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:07:40,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:08:00 UTC)" executed successfully
2025-06-16 20:07:45,841 - __main__ - INFO - Received webhook request: {"update_id":441382798,
"message":{"message_id":406,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104465,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:07:45,842 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:07:45,927 - aiogram.event - INFO - Update id=441382798 is handled. Duration 85 ms by bot id=7187206991
2025-06-16 20:07:45,928 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:07:45 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:08:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:08:20 UTC)" (scheduled at 2025-06-16 20:08:00+00:00)
2025-06-16 20:08:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:08:00,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:08:00,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:08:00,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:08:00,011 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:08:00,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:08:00,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:08:20 UTC)" executed successfully
2025-06-16 20:08:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:08:40 UTC)" (scheduled at 2025-06-16 20:08:20+00:00)
2025-06-16 20:08:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:08:20,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:08:20,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:08:20,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:08:20,012 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:08:20,013 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:08:20,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:08:40 UTC)" executed successfully
2025-06-16 20:08:40,022 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:09:00 UTC)" (scheduled at 2025-06-16 20:08:40+00:00)
2025-06-16 20:08:40,023 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:08:40,025 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:08:40,025 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:08:40,026 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:08:40,027 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:08:40,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:08:40,028 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:09:00 UTC)" executed successfully
2025-06-16 20:09:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:09:20 UTC)" (scheduled at 2025-06-16 20:09:00+00:00)
2025-06-16 20:09:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:09:00,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:09:00,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:09:00,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:09:00,015 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:09:00,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:09:00,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:09:20 UTC)" executed successfully
2025-06-16 20:09:17,385 - __main__ - INFO - Bot stopped by user
2025-06-16 20:10:03,360 - __main__ - INFO - Starting bot...
2025-06-16 20:10:03,360 - __main__ - INFO - Routers and middleware included
2025-06-16 20:10:03,360 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 20:10:03,361 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 20:10:03,361 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 20:10:03,425 - __main__ - INFO - Webhook set successfully
2025-06-16 20:10:03,426 - __main__ - INFO - Web server started on port 8443
2025-06-16 20:10:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:10:40 UTC)" (scheduled at 2025-06-16 20:10:20+00:00)
2025-06-16 20:10:20,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:10:20,004 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:10:20,004 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:10:20,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:10:20,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:10:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:10:40 UTC)" executed successfully
2025-06-16 20:10:26,241 - __main__ - INFO - Received webhook request: {"update_id":441382799,
"message":{"message_id":408,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104626,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:10:26,243 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:10:26,352 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 20:10:26,352 - aiogram.event - INFO - Update id=441382799 is handled. Duration 110 ms by bot id=7187206991
2025-06-16 20:10:26,353 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:10:26 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:10:26,594 - __main__ - INFO - Received webhook request: {"update_id":441382800,
"message":{"message_id":410,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104626,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:10:26,595 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:10:26,673 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 20:10:26,673 - aiogram.event - INFO - Update id=441382800 is handled. Duration 78 ms by bot id=7187206991
2025-06-16 20:10:26,674 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:10:26 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:10:35,516 - __main__ - INFO - Received webhook request: {"update_id":441382801,
"message":{"message_id":412,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104635,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 20:10:35,517 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 20:10:35,586 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 20:10:35,586 - aiogram.event - INFO - Update id=441382801 is handled. Duration 69 ms by bot id=7187206991
2025-06-16 20:10:35,587 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:10:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:10:39,714 - __main__ - INFO - Received webhook request: {"update_id":441382802,
"callback_query":{"id":"1936887766488621581","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":413,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104635,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 20:10:39,716 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 20:10:39,742 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:10:39,745 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:10:39,745 - dao.user_dao - INFO - Created user 450966825
2025-06-16 20:10:40,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:11:00 UTC)" (scheduled at 2025-06-16 20:10:40+00:00)
2025-06-16 20:10:40,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:10:40,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:10:40,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:10:40,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:10:40,007 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 20:10:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:10:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:11:00 UTC)" executed successfully
2025-06-16 20:10:40,122 - aiogram.event - INFO - Update id=441382802 is handled. Duration 407 ms by bot id=7187206991
2025-06-16 20:10:40,123 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:10:39 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:10:41,670 - __main__ - INFO - Received webhook request: {"update_id":441382803,
"callback_query":{"id":"1936887768184326384","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":414,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104639,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 20:10:41,672 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 20:10:42,118 - dao.payment_dao - INFO - Saved payment: payment_id=a63693f3-fbd8-4bfc-8396-b834614510a7, yookassa_id=2fe28e01-000f-5001-8000-10cde2c91a02, telegram_id=450966825
2025-06-16 20:10:42,237 - bot.handlers.payments - INFO - Sent payment link a63693f3-fbd8-4bfc-8396-b834614510a7 to user 450966825
2025-06-16 20:10:42,330 - aiogram.event - INFO - Update id=441382803 is handled. Duration 659 ms by bot id=7187206991
2025-06-16 20:10:42,331 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:10:41 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:10:49,151 - bot.handlers.payments - INFO - Received YooKassa webhook: {
  "type" : "notification",
  "event" : "payment.succeeded",
  "object" : {
    "id" : "2fe28e01-000f-5001-8000-10cde2c91a02",
    "status" : "succeeded",
    "amount" : {
      "value" : "50000.00",
      "currency" : "RUB"
    },
    "income_amount" : {
      "value" : "48250.00",
      "currency" : "RUB"
    },
    "description" : "Членский взнос: Ассоциированный партнер",
    "recipient" : {
      "account_id" : "1095024",
      "gateway_id" : "2459989"
    },
    "payment_method" : {
      "type" : "yoo_money",
      "id" : "2fe28e01-000f-5001-8000-10cde2c91a02",
      "saved" : true,
      "status" : "active",
      "title" : "YooMoney wallet 410011758831136",
      "account_number" : "410011758831136"
    },
    "captured_at" : "2025-06-16T20:10:48.890Z",
    "created_at" : "2025-06-16T20:10:41.981Z",
    "test" : true,
    "refunded_amount" : {
      "value" : "0.00",
      "currency" : "RUB"
    },
    "paid" : true,
    "refundable" : true,
    "metadata" : {
      "telegram_id" : "450966825",
      "cms_name" : "yookassa_sdk_python",
      "payment_id" : "a63693f3-fbd8-4bfc-8396-b834614510a7"
    }
  }
}
2025-06-16 20:10:49,274 - dao.payment_dao - INFO - Updated payment status: yookassa_id=2fe28e01-000f-5001-8000-10cde2c91a02, status=succeeded
2025-06-16 20:10:49,319 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:10:49,322 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:10:49,322 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 20:10:54,398 - bot.handlers.payments - INFO - Payment succeeded: payment_id=a63693f3-fbd8-4bfc-8396-b834614510a7, yookassa_id=2fe28e01-000f-5001-8000-10cde2c91a02, user=450966825
2025-06-16 20:10:54,399 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:10:49 +0000] "POST /yookassa HTTP/1.1" 200 155 "-" "AHC/2.1"
2025-06-16 20:11:00,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:11:20 UTC)" (scheduled at 2025-06-16 20:11:00+00:00)
2025-06-16 20:11:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:11:00,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:11:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:11:00,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:11:00,005 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:11:00,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:11:00,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:11:20 UTC)" executed successfully
2025-06-16 20:11:08,469 - __main__ - INFO - Received webhook request: {"update_id":441382804,
"message":{"message_id":418,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104668,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:11:08,470 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:11:08,681 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 20:11:08,682 - aiogram.event - INFO - Update id=441382804 is not handled. Duration 211 ms by bot id=7187206991
2025-06-16 20:11:08,682 - aiogram.event - ERROR - Cause exception while process update id=441382804 by bot id=7187206991
NameError: name 'SessionLocal' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 142, in cmd_start
    user_dao.update_user(user)
  File "/home/vps/telegram_bot/dao/user_dao.py", line 158, in update_user
    session = SessionLocal()
              ^^^^^^^^^^^^
NameError: name 'SessionLocal' is not defined
2025-06-16 20:11:08,685 - __main__ - ERROR - Error processing webhook: name 'SessionLocal' is not defined
2025-06-16 20:11:08,685 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:11:08 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:11:11,997 - __main__ - INFO - Received webhook request: {"update_id":441382805,
"message":{"message_id":420,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104671,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:11:11,998 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:11:12,212 - aiogram.event - INFO - Update id=441382805 is handled. Duration 214 ms by bot id=7187206991
2025-06-16 20:11:12,213 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:11:11 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:11:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:11:40 UTC)" (scheduled at 2025-06-16 20:11:20+00:00)
2025-06-16 20:11:20,007 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:11:20,008 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:11:20,008 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:11:20,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:11:20,012 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:11:20,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:11:20,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:11:40 UTC)" executed successfully
2025-06-16 20:11:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:12:00 UTC)" (scheduled at 2025-06-16 20:11:40+00:00)
2025-06-16 20:11:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:11:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:11:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:11:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:11:40,011 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:11:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:11:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:12:00 UTC)" executed successfully
2025-06-16 20:12:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:12:20 UTC)" (scheduled at 2025-06-16 20:12:00+00:00)
2025-06-16 20:12:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:12:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:12:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:12:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:12:00,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:12:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:12:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:12:20 UTC)" executed successfully
2025-06-16 20:12:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:12:40 UTC)" (scheduled at 2025-06-16 20:12:20+00:00)
2025-06-16 20:12:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:12:20,023 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:12:20,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:12:20,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:12:20,025 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:12:20,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:12:20,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:12:40 UTC)" executed successfully
2025-06-16 20:12:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:13:00 UTC)" (scheduled at 2025-06-16 20:12:40+00:00)
2025-06-16 20:12:40,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:12:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:12:40,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:12:40,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:12:40,015 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:12:40,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:12:40,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:13:00 UTC)" executed successfully
2025-06-16 20:13:00,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:13:20 UTC)" (scheduled at 2025-06-16 20:13:00+00:00)
2025-06-16 20:13:00,017 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:13:00,018 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:13:00,018 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:13:00,019 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:13:00,020 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:13:00,021 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:13:00,021 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:13:20 UTC)" executed successfully
2025-06-16 20:13:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:13:40 UTC)" (scheduled at 2025-06-16 20:13:20+00:00)
2025-06-16 20:13:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:13:20,024 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:13:20,024 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:13:20,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:13:20,026 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:13:20,026 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:13:20,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:13:40 UTC)" executed successfully
2025-06-16 20:13:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:14:00 UTC)" (scheduled at 2025-06-16 20:13:40+00:00)
2025-06-16 20:13:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:13:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:13:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:13:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:13:40,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:13:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:13:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:14:00 UTC)" executed successfully
2025-06-16 20:13:45,444 - __main__ - INFO - Received webhook request: {"update_id":441382806,
"message":{"message_id":422,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104825,"text":"\\start"}}
2025-06-16 20:13:45,448 - aiogram.event - INFO - Update id=441382806 is not handled. Duration 1 ms by bot id=7187206991
2025-06-16 20:13:45,449 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:13:45 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:14:00,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:14:20 UTC)" (scheduled at 2025-06-16 20:14:00+00:00)
2025-06-16 20:14:00,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:14:00,017 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:14:00,017 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:14:00,019 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:14:00,020 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:14:00,020 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:14:00,021 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:14:20 UTC)" executed successfully
2025-06-16 20:14:02,251 - __main__ - INFO - Received webhook request: {"update_id":441382807,
"message":{"message_id":423,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750104842,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:14:02,252 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:14:02,441 - aiogram.event - INFO - Update id=441382807 is handled. Duration 189 ms by bot id=7187206991
2025-06-16 20:14:02,442 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:14:02 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:14:08,932 - __main__ - INFO - Bot stopped by user
2025-06-16 20:24:43,357 - __main__ - INFO - Starting bot...
2025-06-16 20:24:43,357 - __main__ - INFO - Routers and middleware included
2025-06-16 20:24:43,358 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 20:24:43,359 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 20:24:43,359 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 20:24:43,384 - __main__ - INFO - Webhook set successfully
2025-06-16 20:24:43,385 - __main__ - INFO - Web server started on port 8443
2025-06-16 20:25:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:25:20 UTC)" (scheduled at 2025-06-16 20:25:00+00:00)
2025-06-16 20:25:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:25:00,004 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:25:00,005 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:25:00,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:25:00,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:25:00,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:25:20 UTC)" executed successfully
2025-06-16 20:25:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:25:40 UTC)" (scheduled at 2025-06-16 20:25:20+00:00)
2025-06-16 20:25:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:25:20,005 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:25:20,005 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:25:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:25:20,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:25:20,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:25:40 UTC)" executed successfully
2025-06-16 20:25:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:26:00 UTC)" (scheduled at 2025-06-16 20:25:40+00:00)
2025-06-16 20:25:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:25:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:25:40,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:25:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:25:40,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:25:40,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:26:00 UTC)" executed successfully
2025-06-16 20:26:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:26:20 UTC)" (scheduled at 2025-06-16 20:26:00+00:00)
2025-06-16 20:26:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:26:00,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:26:00,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:26:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:26:00,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:26:00,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:26:20 UTC)" executed successfully
2025-06-16 20:26:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:26:40 UTC)" (scheduled at 2025-06-16 20:26:20+00:00)
2025-06-16 20:26:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:26:20,005 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:26:20,005 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:26:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:26:20,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:26:20,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:26:40 UTC)" executed successfully
2025-06-16 20:26:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:27:00 UTC)" (scheduled at 2025-06-16 20:26:40+00:00)
2025-06-16 20:26:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:26:40,021 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:26:40,021 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:26:40,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:26:40,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:26:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:27:00 UTC)" executed successfully
2025-06-16 20:27:00,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:27:20 UTC)" (scheduled at 2025-06-16 20:27:00+00:00)
2025-06-16 20:27:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:27:00,009 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:27:00,009 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:27:00,009 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:27:00,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:27:00,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:27:20 UTC)" executed successfully
2025-06-16 20:27:20,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:27:40 UTC)" (scheduled at 2025-06-16 20:27:20+00:00)
2025-06-16 20:27:20,022 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:27:20,024 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:27:20,024 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:27:20,026 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:27:20,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:27:20,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:27:40 UTC)" executed successfully
2025-06-16 20:27:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:28:00 UTC)" (scheduled at 2025-06-16 20:27:40+00:00)
2025-06-16 20:27:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:27:40,009 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:27:40,009 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:27:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:27:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:27:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:28:00 UTC)" executed successfully
2025-06-16 20:27:58,971 - __main__ - INFO - Bot stopped by user
2025-06-16 20:27:59,084 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f5c7582b990>
2025-06-16 20:28:03,701 - __main__ - INFO - Starting bot...
2025-06-16 20:28:03,701 - __main__ - INFO - Routers and middleware included
2025-06-16 20:28:03,701 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 20:28:03,702 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 20:28:03,702 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 20:28:03,729 - __main__ - INFO - Webhook set successfully
2025-06-16 20:28:03,730 - __main__ - INFO - Web server started on port 8443
2025-06-16 20:28:19,631 - __main__ - INFO - Received webhook request: {"update_id":441382811,
"message":{"message_id":428,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105699,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:28:19,633 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:28:19,715 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 20:28:19,715 - aiogram.event - INFO - Update id=441382811 is handled. Duration 83 ms by bot id=7187206991
2025-06-16 20:28:19,716 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:28:19 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:28:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:28:40 UTC)" (scheduled at 2025-06-16 20:28:20+00:00)
2025-06-16 20:28:20,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:28:20,005 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:28:20,005 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:28:20,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:28:20,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:28:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:28:40 UTC)" executed successfully
2025-06-16 20:28:35,110 - __main__ - INFO - Received webhook request: {"update_id":441382812,
"message":{"message_id":430,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105715,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 20:28:35,112 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 20:28:35,285 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 20:28:35,285 - aiogram.event - INFO - Update id=441382812 is handled. Duration 173 ms by bot id=7187206991
2025-06-16 20:28:35,286 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:28:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:28:36,965 - __main__ - INFO - Received webhook request: {"update_id":441382813,
"callback_query":{"id":"1936887765175974251","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":431,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105715,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 20:28:36,967 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 20:28:37,066 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:28:37,070 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:28:37,071 - dao.user_dao - INFO - Created user 450966825
2025-06-16 20:28:37,341 - aiogram.event - INFO - Update id=441382813 is handled. Duration 375 ms by bot id=7187206991
2025-06-16 20:28:37,342 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:28:36 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:28:38,717 - __main__ - INFO - Received webhook request: {"update_id":441382814,
"callback_query":{"id":"1936887768275050766","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":432,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105717,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 20:28:38,718 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 20:28:39,194 - dao.payment_dao - INFO - Saved payment: payment_id=a9eb1b83-aa22-4a2a-9e2f-1d751fb37a4a, yookassa_id=2fe29236-000f-5001-8000-19949399650a, telegram_id=450966825
2025-06-16 20:28:39,289 - bot.handlers.payments - INFO - Sent payment link a9eb1b83-aa22-4a2a-9e2f-1d751fb37a4a to user 450966825
2025-06-16 20:28:39,372 - aiogram.event - INFO - Update id=441382814 is handled. Duration 654 ms by bot id=7187206991
2025-06-16 20:28:39,373 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:28:38 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:28:40,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:29:00 UTC)" (scheduled at 2025-06-16 20:28:40+00:00)
2025-06-16 20:28:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:28:40,003 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:28:40,003 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:28:40,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:28:40,004 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 20:28:40,005 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:28:40,005 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:29:00 UTC)" executed successfully
2025-06-16 20:28:50,580 - __main__ - INFO - Received webhook request: {"update_id":441382815,
"message":{"message_id":434,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105730,"text":"/start payment_success_a9eb1b83-aa22-4a2a-9e2f-1d751fb37a4a","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:28:50,582 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: a9eb1b83-aa22-4a2a-9e2f-1d751fb37a4a
2025-06-16 20:28:51,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:28:51,007 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:28:51,008 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 20:28:56,093 - bot.handlers.start - INFO - Payment a9eb1b83-aa22-4a2a-9e2f-1d751fb37a4a confirmed via deep-link for user 450966825
2025-06-16 20:28:56,094 - aiogram.event - INFO - Update id=441382815 is handled. Duration 5512 ms by bot id=7187206991
2025-06-16 20:28:56,122 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:28:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:29:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:29:20 UTC)" (scheduled at 2025-06-16 20:29:00+00:00)
2025-06-16 20:29:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:29:00,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:29:00,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:29:00,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:29:00,008 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:29:00,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:29:00,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:29:20 UTC)" executed successfully
2025-06-16 20:29:04,468 - __main__ - INFO - Received webhook request: {"update_id":441382816,
"message":{"message_id":437,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105744,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:29:04,469 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:29:04,503 - aiogram.event - INFO - Update id=441382816 is not handled. Duration 34 ms by bot id=7187206991
2025-06-16 20:29:04,503 - aiogram.event - ERROR - Cause exception while process update id=441382816 by bot id=7187206991
NameError: name 'SessionLocal' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 125, in cmd_start
    user_dao.update_user(user)
  File "/home/vps/telegram_bot/dao/user_dao.py", line 158, in update_user
    session = SessionLocal()
              ^^^^^^^^^^^^
NameError: name 'SessionLocal' is not defined
2025-06-16 20:29:04,509 - __main__ - ERROR - Error processing webhook: name 'SessionLocal' is not defined
2025-06-16 20:29:04,510 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:29:04 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:29:08,498 - __main__ - INFO - Received webhook request: {"update_id":441382817,
"message":{"message_id":438,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105748,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:29:08,499 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:29:08,556 - aiogram.event - INFO - Update id=441382817 is handled. Duration 56 ms by bot id=7187206991
2025-06-16 20:29:08,556 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:29:08 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:29:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:29:40 UTC)" (scheduled at 2025-06-16 20:29:20+00:00)
2025-06-16 20:29:20,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:29:20,012 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:29:20,012 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:29:20,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:29:20,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:29:20,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:29:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:29:40 UTC)" executed successfully
2025-06-16 20:29:40,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:30:00 UTC)" (scheduled at 2025-06-16 20:29:40+00:00)
2025-06-16 20:29:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:29:40,003 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:29:40,003 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:29:40,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:29:40,005 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:29:40,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:29:40,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:30:00 UTC)" executed successfully
2025-06-16 20:30:00,013 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:30:20 UTC)" (scheduled at 2025-06-16 20:30:00+00:00)
2025-06-16 20:30:00,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:30:00,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:30:00,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:30:00,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:30:00,015 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:30:00,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:30:00,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:30:20 UTC)" executed successfully
2025-06-16 20:30:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:30:40 UTC)" (scheduled at 2025-06-16 20:30:20+00:00)
2025-06-16 20:30:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:30:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:30:20,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:30:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:30:20,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:30:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:30:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:30:40 UTC)" executed successfully
2025-06-16 20:30:29,699 - __main__ - INFO - Bot stopped by user
2025-06-16 20:31:57,309 - __main__ - INFO - Starting bot...
2025-06-16 20:31:57,309 - __main__ - INFO - Routers and middleware included
2025-06-16 20:31:57,310 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 20:31:57,310 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 20:31:57,310 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 20:31:57,333 - __main__ - INFO - Webhook set successfully
2025-06-16 20:31:57,334 - __main__ - INFO - Web server started on port 8443
2025-06-16 20:31:59,920 - __main__ - INFO - Received webhook request: {"update_id":441382819,
"message":{"message_id":441,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105919,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:31:59,921 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:32:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:32:20 UTC)" (scheduled at 2025-06-16 20:32:00+00:00)
2025-06-16 20:32:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:32:00,004 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 20:32:00,004 - scheduler - INFO - Retrieved 2 users
2025-06-16 20:32:00,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:32:00,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:32:00,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:32:20 UTC)" executed successfully
2025-06-16 20:32:00,030 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 20:32:00,030 - aiogram.event - INFO - Update id=441382819 is handled. Duration 109 ms by bot id=7187206991
2025-06-16 20:32:00,031 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:31:59 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:32:00,288 - __main__ - INFO - Received webhook request: {"update_id":441382820,
"message":{"message_id":443,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105920,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:32:00,289 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:32:00,325 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 20:32:00,338 - aiogram.event - INFO - Update id=441382820 is handled. Duration 48 ms by bot id=7187206991
2025-06-16 20:32:00,339 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:32:00 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:32:09,148 - __main__ - INFO - Received webhook request: {"update_id":441382821,
"message":{"message_id":445,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105929,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 20:32:09,150 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 20:32:09,193 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 20:32:09,193 - aiogram.event - INFO - Update id=441382821 is handled. Duration 44 ms by bot id=7187206991
2025-06-16 20:32:09,193 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:32:09 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:32:11,210 - __main__ - INFO - Received webhook request: {"update_id":441382822,
"callback_query":{"id":"1936887765630596328","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":446,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105929,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 20:32:11,212 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 20:32:11,320 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:32:11,323 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:32:11,324 - dao.user_dao - INFO - Created user 450966825
2025-06-16 20:32:11,378 - aiogram.event - INFO - Update id=441382822 is handled. Duration 166 ms by bot id=7187206991
2025-06-16 20:32:11,378 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:32:11 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:32:14,416 - __main__ - INFO - Received webhook request: {"update_id":441382823,
"callback_query":{"id":"1936887768061432928","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":447,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105931,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 20:32:14,418 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 20:32:14,996 - dao.payment_dao - INFO - Saved payment: payment_id=d6557d95-d392-49f4-975b-a5e82108f472, yookassa_id=2fe2930e-000f-5001-8000-1ad12f56cc71, telegram_id=450966825
2025-06-16 20:32:15,053 - bot.handlers.payments - INFO - Sent payment link d6557d95-d392-49f4-975b-a5e82108f472 to user 450966825
2025-06-16 20:32:15,065 - aiogram.event - INFO - Update id=441382823 is handled. Duration 647 ms by bot id=7187206991
2025-06-16 20:32:15,065 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:32:14 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:32:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:32:40 UTC)" (scheduled at 2025-06-16 20:32:20+00:00)
2025-06-16 20:32:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:32:20,042 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:32:20,043 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:32:20,044 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:32:20,044 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 20:32:20,045 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:32:20,045 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:32:40 UTC)" executed successfully
2025-06-16 20:32:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:33:00 UTC)" (scheduled at 2025-06-16 20:32:40+00:00)
2025-06-16 20:32:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:32:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:32:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:32:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:32:40,014 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 20:32:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:32:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:33:00 UTC)" executed successfully
2025-06-16 20:32:40,638 - __main__ - INFO - Received webhook request: {"update_id":441382824,
"message":{"message_id":449,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105960,"text":"/start payment_success_d6557d95-d392-49f4-975b-a5e82108f472","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:32:40,639 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: d6557d95-d392-49f4-975b-a5e82108f472
2025-06-16 20:32:40,941 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:32:40,943 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 20:32:40,943 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 20:32:46,138 - bot.handlers.start - INFO - Payment d6557d95-d392-49f4-975b-a5e82108f472 confirmed via deep-link for user 450966825
2025-06-16 20:32:46,139 - aiogram.event - INFO - Update id=441382824 is handled. Duration 5500 ms by bot id=7187206991
2025-06-16 20:32:46,158 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:32:40 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:32:56,773 - __main__ - INFO - Received webhook request: {"update_id":441382825,
"message":{"message_id":452,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105976,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:32:56,773 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:32:57,145 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 20:32:57,145 - aiogram.event - INFO - Update id=441382825 is handled. Duration 371 ms by bot id=7187206991
2025-06-16 20:32:57,146 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:32:56 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:32:59,981 - __main__ - INFO - Received webhook request: {"update_id":441382826,
"message":{"message_id":454,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750105979,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:32:59,983 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:33:00,000 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:33:20 UTC)" (scheduled at 2025-06-16 20:33:00+00:00)
2025-06-16 20:33:00,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:33:00,002 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:33:00,002 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:33:00,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:33:00,005 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:33:00,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:33:00,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:33:20 UTC)" executed successfully
2025-06-16 20:33:00,032 - aiogram.event - INFO - Update id=441382826 is handled. Duration 50 ms by bot id=7187206991
2025-06-16 20:33:00,033 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:32:59 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:33:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:33:40 UTC)" (scheduled at 2025-06-16 20:33:20+00:00)
2025-06-16 20:33:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:33:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:33:20,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:33:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:33:20,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:33:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:33:20,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:33:40 UTC)" executed successfully
2025-06-16 20:33:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:34:00 UTC)" (scheduled at 2025-06-16 20:33:40+00:00)
2025-06-16 20:33:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 20:33:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 20:33:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 20:33:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 20:33:40,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 20:33:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 20:33:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 20:34:00 UTC)" executed successfully
2025-06-16 20:33:40,249 - __main__ - INFO - Received webhook request: {"update_id":441382827,
"message":{"message_id":456,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750106020,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:33:40,250 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:33:40,383 - aiogram.event - INFO - Update id=441382827 is handled. Duration 133 ms by bot id=7187206991
2025-06-16 20:33:40,399 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:33:40 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:33:42,098 - __main__ - INFO - Received webhook request: {"update_id":441382828,
"message":{"message_id":458,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750106022,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 20:33:42,099 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 20:33:42,269 - aiogram.event - INFO - Update id=441382828 is handled. Duration 169 ms by bot id=7187206991
2025-06-16 20:33:42,270 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:20:33:42 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 20:33:56,668 - __main__ - INFO - Bot stopped by user
2025-06-16 21:12:29,145 - __main__ - INFO - Starting bot...
2025-06-16 21:12:29,145 - __main__ - INFO - Routers and middleware included
2025-06-16 21:12:29,146 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:12:29,146 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:12:29,146 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:12:29,165 - __main__ - INFO - Webhook set successfully
2025-06-16 21:12:29,165 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:12:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:13:00 UTC)" (scheduled at 2025-06-16 21:12:40+00:00)
2025-06-16 21:12:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:12:40,014 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 21:12:40,014 - scheduler - INFO - Retrieved 2 users
2025-06-16 21:12:40,017 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:12:40,018 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:12:40,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:13:00 UTC)" executed successfully
2025-06-16 21:12:50,443 - __main__ - INFO - Received webhook request: {"update_id":441382829,
"message":{"message_id":460,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108370,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:12:50,445 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:12:50,492 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 21:12:50,492 - aiogram.event - INFO - Update id=441382829 is handled. Duration 47 ms by bot id=7187206991
2025-06-16 21:12:50,493 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:12:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:12:50,797 - __main__ - INFO - Received webhook request: {"update_id":441382830,
"message":{"message_id":462,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108370,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:12:50,798 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:12:50,833 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 21:12:50,834 - aiogram.event - INFO - Update id=441382830 is handled. Duration 36 ms by bot id=7187206991
2025-06-16 21:12:50,834 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:12:50 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:12:59,647 - __main__ - INFO - Received webhook request: {"update_id":441382831,
"message":{"message_id":464,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108379,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 21:12:59,648 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 21:12:59,893 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 21:12:59,893 - aiogram.event - INFO - Update id=441382831 is handled. Duration 245 ms by bot id=7187206991
2025-06-16 21:12:59,893 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:12:59 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:13:00,000 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:13:20 UTC)" (scheduled at 2025-06-16 21:13:00+00:00)
2025-06-16 21:13:00,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:13:00,002 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 21:13:00,002 - scheduler - INFO - Retrieved 2 users
2025-06-16 21:13:00,003 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:13:00,003 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:13:00,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:13:20 UTC)" executed successfully
2025-06-16 21:13:01,740 - __main__ - INFO - Received webhook request: {"update_id":441382832,
"callback_query":{"id":"1936887764970512025","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":465,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108379,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 21:13:01,741 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 21:13:02,066 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:13:02,070 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 21:13:02,070 - dao.user_dao - INFO - Created user 450966825
2025-06-16 21:13:02,365 - aiogram.event - INFO - Update id=441382832 is handled. Duration 624 ms by bot id=7187206991
2025-06-16 21:13:02,366 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:13:01 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:13:06,573 - __main__ - INFO - Received webhook request: {"update_id":441382833,
"callback_query":{"id":"1936887769042437957","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":466,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108382,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 21:13:06,575 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 21:13:07,121 - dao.payment_dao - INFO - Saved payment: payment_id=f0c507a0-7906-470e-a9f5-830694e32f1c, yookassa_id=2fe29ca2-000f-5000-b000-1a84fadc5673, telegram_id=450966825
2025-06-16 21:13:07,197 - bot.handlers.payments - INFO - Sent payment link f0c507a0-7906-470e-a9f5-830694e32f1c to user 450966825
2025-06-16 21:13:07,250 - aiogram.event - INFO - Update id=441382833 is handled. Duration 676 ms by bot id=7187206991
2025-06-16 21:13:07,251 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:13:06 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:13:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:13:40 UTC)" (scheduled at 2025-06-16 21:13:20+00:00)
2025-06-16 21:13:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:13:20,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:13:20,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:13:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:13:20,010 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 21:13:20,010 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:13:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:13:40 UTC)" executed successfully
2025-06-16 21:13:37,068 - __main__ - INFO - Received webhook request: {"update_id":441382834,
"message":{"message_id":468,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108417,"text":"/start payment_success_f0c507a0-7906-470e-a9f5-830694e32f1c","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:13:37,069 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: f0c507a0-7906-470e-a9f5-830694e32f1c
2025-06-16 21:13:37,329 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:13:37,333 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 21:13:37,333 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 21:13:40,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:14:00 UTC)" (scheduled at 2025-06-16 21:13:40+00:00)
2025-06-16 21:13:40,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:13:40,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:13:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:13:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:13:40,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:13:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:13:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:14:00 UTC)" executed successfully
2025-06-16 21:13:42,577 - bot.handlers.start - INFO - Payment f0c507a0-7906-470e-a9f5-830694e32f1c confirmed via deep-link for user 450966825
2025-06-16 21:13:42,578 - aiogram.event - INFO - Update id=441382834 is handled. Duration 5509 ms by bot id=7187206991
2025-06-16 21:13:42,602 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:13:37 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:13:58,420 - __main__ - INFO - Received webhook request: {"update_id":441382835,
"message":{"message_id":471,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108438,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:13:58,421 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:13:58,450 - aiogram.event - INFO - Update id=441382835 is not handled. Duration 29 ms by bot id=7187206991
2025-06-16 21:13:58,451 - aiogram.event - ERROR - Cause exception while process update id=441382835 by bot id=7187206991
NameError: name 'message_ids' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 123, in cmd_start
    if not message_ids:
           ^^^^^^^^^^^
NameError: name 'message_ids' is not defined
2025-06-16 21:13:58,454 - __main__ - ERROR - Error processing webhook: name 'message_ids' is not defined
2025-06-16 21:13:58,454 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:13:58 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:14:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:14:20 UTC)" (scheduled at 2025-06-16 21:14:00+00:00)
2025-06-16 21:14:00,003 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:14:00,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:14:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:14:00,005 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:14:00,005 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:14:00,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:14:00,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:14:20 UTC)" executed successfully
2025-06-16 21:14:00,710 - __main__ - INFO - Received webhook request: {"update_id":441382836,
"message":{"message_id":472,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108440,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:14:00,711 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:14:00,725 - aiogram.event - INFO - Update id=441382836 is not handled. Duration 14 ms by bot id=7187206991
2025-06-16 21:14:00,725 - aiogram.event - ERROR - Cause exception while process update id=441382836 by bot id=7187206991
NameError: name 'message_ids' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 123, in cmd_start
    if not message_ids:
           ^^^^^^^^^^^
NameError: name 'message_ids' is not defined
2025-06-16 21:14:00,727 - __main__ - ERROR - Error processing webhook: name 'message_ids' is not defined
2025-06-16 21:14:00,727 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:14:00 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:14:02,477 - __main__ - INFO - Received webhook request: {"update_id":441382837,
"message":{"message_id":473,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108442,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:14:02,478 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:14:02,518 - aiogram.event - INFO - Update id=441382837 is not handled. Duration 40 ms by bot id=7187206991
2025-06-16 21:14:02,519 - aiogram.event - ERROR - Cause exception while process update id=441382837 by bot id=7187206991
NameError: name 'message_ids' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 123, in cmd_start
    if not message_ids:
           ^^^^^^^^^^^
NameError: name 'message_ids' is not defined
2025-06-16 21:14:02,520 - __main__ - ERROR - Error processing webhook: name 'message_ids' is not defined
2025-06-16 21:14:02,520 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:14:02 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:14:03,461 - __main__ - INFO - Received webhook request: {"update_id":441382838,
"message":{"message_id":474,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108443,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:14:03,463 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:14:03,479 - aiogram.event - INFO - Update id=441382838 is not handled. Duration 17 ms by bot id=7187206991
2025-06-16 21:14:03,479 - aiogram.event - ERROR - Cause exception while process update id=441382838 by bot id=7187206991
NameError: name 'message_ids' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 123, in cmd_start
    if not message_ids:
           ^^^^^^^^^^^
NameError: name 'message_ids' is not defined
2025-06-16 21:14:03,480 - __main__ - ERROR - Error processing webhook: name 'message_ids' is not defined
2025-06-16 21:14:03,481 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:14:03 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:14:07,293 - __main__ - INFO - Received webhook request: {"update_id":441382839,
"message":{"message_id":475,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108447,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:14:07,294 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:14:07,356 - aiogram.event - INFO - Update id=441382839 is not handled. Duration 62 ms by bot id=7187206991
2025-06-16 21:14:07,356 - aiogram.event - ERROR - Cause exception while process update id=441382839 by bot id=7187206991
NameError: name 'message_ids' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 123, in cmd_start
    if not message_ids:
           ^^^^^^^^^^^
NameError: name 'message_ids' is not defined
2025-06-16 21:14:07,358 - __main__ - ERROR - Error processing webhook: name 'message_ids' is not defined
2025-06-16 21:14:07,358 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:14:07 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:14:09,196 - __main__ - INFO - Received webhook request: {"update_id":441382840,
"message":{"message_id":476,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108449,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:14:09,197 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:14:09,270 - aiogram.event - INFO - Update id=441382840 is not handled. Duration 73 ms by bot id=7187206991
2025-06-16 21:14:09,270 - aiogram.event - ERROR - Cause exception while process update id=441382840 by bot id=7187206991
NameError: name 'message_ids' is not defined
Traceback (most recent call last):
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 404, in _feed_webhook_update
    return await self.feed_update(bot, update, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/middlewares/update_filter.py", line 16, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/venv/lib/python3.11/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/vps/telegram_bot/bot/handlers/start.py", line 123, in cmd_start
    if not message_ids:
           ^^^^^^^^^^^
NameError: name 'message_ids' is not defined
2025-06-16 21:14:09,272 - __main__ - ERROR - Error processing webhook: name 'message_ids' is not defined
2025-06-16 21:14:09,272 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:14:09 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:14:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:14:40 UTC)" (scheduled at 2025-06-16 21:14:20+00:00)
2025-06-16 21:14:20,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:14:20,012 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:14:20,012 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:14:20,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:14:20,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:14:20,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:14:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:14:40 UTC)" executed successfully
2025-06-16 21:14:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:15:00 UTC)" (scheduled at 2025-06-16 21:14:40+00:00)
2025-06-16 21:14:40,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:14:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:14:40,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:14:40,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:14:40,016 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:14:40,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:14:40,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:15:00 UTC)" executed successfully
2025-06-16 21:15:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:15:20 UTC)" (scheduled at 2025-06-16 21:15:00+00:00)
2025-06-16 21:15:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:15:00,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:15:00,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:15:00,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:15:00,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:15:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:15:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:15:20 UTC)" executed successfully
2025-06-16 21:15:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:15:40 UTC)" (scheduled at 2025-06-16 21:15:20+00:00)
2025-06-16 21:15:20,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:15:20,007 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:15:20,007 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:15:20,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:15:20,009 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:15:20,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:15:20,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:15:40 UTC)" executed successfully
2025-06-16 21:15:20,639 - __main__ - INFO - Bot stopped by user
2025-06-16 21:16:23,850 - __main__ - INFO - Starting bot...
2025-06-16 21:16:23,850 - __main__ - INFO - Routers and middleware included
2025-06-16 21:16:23,850 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:16:23,851 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:16:23,851 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:16:23,890 - __main__ - INFO - Webhook set successfully
2025-06-16 21:16:23,890 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:16:38,947 - __main__ - INFO - Received webhook request: {"update_id":441382841,
"message":{"message_id":477,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108598,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:16:38,948 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:16:38,999 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 21:16:38,999 - aiogram.event - INFO - Update id=441382841 is handled. Duration 51 ms by bot id=7187206991
2025-06-16 21:16:39,000 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:16:38 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:16:39,273 - __main__ - INFO - Received webhook request: {"update_id":441382842,
"message":{"message_id":479,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108599,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:16:39,275 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:16:39,313 - bot.handlers.start - INFO - Started registration for user 450966825
2025-06-16 21:16:39,313 - aiogram.event - INFO - Update id=441382842 is handled. Duration 38 ms by bot id=7187206991
2025-06-16 21:16:39,313 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:16:39 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:16:40,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:17:00 UTC)" (scheduled at 2025-06-16 21:16:40+00:00)
2025-06-16 21:16:40,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:16:40,004 - dao.user_dao - INFO - Retrieved 2 users
2025-06-16 21:16:40,004 - scheduler - INFO - Retrieved 2 users
2025-06-16 21:16:40,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:16:40,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:16:40,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:17:00 UTC)" executed successfully
2025-06-16 21:16:48,993 - __main__ - INFO - Received webhook request: {"update_id":441382843,
"message":{"message_id":481,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108608,"text":"\u041f\u043e\u0442\u043e\u0446\u043a\u0438\u0439 \u0410\u0440\u0441\u0435\u043d\u0438\u0439 \u0415\u0432\u0433\u0435\u043d\u044c\u0435\u0432\u0438\u0447"}}
2025-06-16 21:16:48,995 - bot.handlers.registration - INFO - Processing FIO for user 450966825
2025-06-16 21:16:49,063 - bot.handlers.registration - INFO - Stored FIO and sent status selection to user 450966825
2025-06-16 21:16:49,063 - aiogram.event - INFO - Update id=441382843 is handled. Duration 69 ms by bot id=7187206991
2025-06-16 21:16:49,064 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:16:48 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:16:53,050 - __main__ - INFO - Received webhook request: {"update_id":441382844,
"callback_query":{"id":"1936887768346354758","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":482,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108609,"text":"\u0427\u0442\u043e\u0431\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043e\u043f\u043b\u0430\u0442\u0443 \u0435\u0436\u0435\u0433\u043e\u0434\u043d\u043e\u0433\u043e \u0447\u043b\u0435\u043d\u0441\u043a\u043e\u0433\u043e \u0432\u0437\u043d\u043e\u0441\u0430.\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043b\u044f \u043e\u043f\u043b\u0430\u0442\u044b \u043d\u0438\u0436\u0435.","reply_markup":{"inline_keyboard":[[{"text":"\u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50 000 \u0440\u0443\u0431.","callback_data":"status_associate"}],[{"text":"\u041f\u0430\u0440\u0442\u043d\u0435\u0440 | 500 000 \u0440\u0443\u0431.","callback_data":"status_partner"}]]}},"chat_instance":"-1545185443588410996","data":"status_associate"}}
2025-06-16 21:16:53,052 - bot.handlers.menu - INFO - Processing status selection for user 450966825
2025-06-16 21:16:53,095 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:16:53,099 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 21:16:53,100 - dao.user_dao - INFO - Created user 450966825
2025-06-16 21:16:53,472 - aiogram.event - INFO - Update id=441382844 is handled. Duration 420 ms by bot id=7187206991
2025-06-16 21:16:53,472 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:16:53 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:17:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:17:20 UTC)" (scheduled at 2025-06-16 21:17:00+00:00)
2025-06-16 21:17:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:17:00,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:17:00,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:17:00,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:17:00,006 - scheduler - INFO - Skipping user 450966825: no last_payment_date or payment_method_id
2025-06-16 21:17:00,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:17:00,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:17:20 UTC)" executed successfully
2025-06-16 21:17:01,730 - __main__ - INFO - Received webhook request: {"update_id":441382845,
"callback_query":{"id":"1936887766396584401","from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"message":{"message_id":483,"from":{"id":7187206991,"is_bot":true,"first_name":"\u0427\u043b\u0435\u043d\u0441\u0442\u0432\u043e \u0424\u0438\u0437\u0442\u0435\u0445-\u0421\u043e\u044e\u0437","username":"phystech_union_bot"},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108613,"text":"\u0412\u0430\u0448 \u0441\u0442\u0430\u0442\u0443\u0441: \u0410\u0441\u0441\u043e\u0446\u0438\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u043f\u0430\u0440\u0442\u043d\u0435\u0440 | 50000 \u0440\u0443\u0431.\n\n\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u043f\u043e\u0436\u0435\u0440\u0442\u0432\u043e\u0432\u0430\u043d\u0438\u0439","entities":[{"offset":50,"length":21,"type":"text_link","url":"https://phystech-union.org/wp-content/uploads/2019/06/dog.pdf"}],"link_preview_options":{"is_disabled":true},"reply_markup":{"inline_keyboard":[[{"text":"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043e\u043f\u043b\u0430\u0442\u0435","callback_data":"pay"}],[{"text":"\u0421\u043b\u0443\u0436\u0431\u0430 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438","url":"https://t.me/ofisFS"}]]}},"chat_instance":"-1545185443588410996","data":"pay"}}
2025-06-16 21:17:01,732 - bot.handlers.payments - INFO - Processing payment for user 450966825
2025-06-16 21:17:02,248 - dao.payment_dao - INFO - Saved payment: payment_id=7beae173-2aee-4111-854e-dc7f1c79b063, yookassa_id=2fe29d8e-000f-5000-8000-1b7b5c22e633, telegram_id=450966825
2025-06-16 21:17:02,331 - bot.handlers.payments - INFO - Sent payment link 7beae173-2aee-4111-854e-dc7f1c79b063 to user 450966825
2025-06-16 21:17:02,393 - aiogram.event - INFO - Update id=441382845 is handled. Duration 661 ms by bot id=7187206991
2025-06-16 21:17:02,393 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:17:01 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:17:17,628 - __main__ - INFO - Received webhook request: {"update_id":441382846,
"message":{"message_id":485,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108637,"text":"/start payment_success_7beae173-2aee-4111-854e-dc7f1c79b063","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:17:17,629 - bot.handlers.start - INFO - Checking payment via deep-link for user 450966825: 7beae173-2aee-4111-854e-dc7f1c79b063
2025-06-16 21:17:17,902 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:17:17,904 - dao.user_dao - INFO - Saved 3 users to users.csv
2025-06-16 21:17:17,904 - dao.user_dao - INFO - Updated payment for user 450966825
2025-06-16 21:17:20,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:17:40 UTC)" (scheduled at 2025-06-16 21:17:20+00:00)
2025-06-16 21:17:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:17:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:17:20,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:17:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:17:20,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:17:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:17:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:17:40 UTC)" executed successfully
2025-06-16 21:17:22,968 - bot.handlers.start - INFO - Payment 7beae173-2aee-4111-854e-dc7f1c79b063 confirmed via deep-link for user 450966825
2025-06-16 21:17:22,969 - aiogram.event - INFO - Update id=441382846 is handled. Duration 5340 ms by bot id=7187206991
2025-06-16 21:17:22,973 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:17:17 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:17:30,047 - __main__ - INFO - Received webhook request: {"update_id":441382847,
"message":{"message_id":488,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108650,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:17:30,049 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:17:30,092 - aiogram.event - INFO - Update id=441382847 is handled. Duration 44 ms by bot id=7187206991
2025-06-16 21:17:30,093 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:17:30 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:17:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:18:00 UTC)" (scheduled at 2025-06-16 21:17:40+00:00)
2025-06-16 21:17:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:17:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:17:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:17:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:17:40,011 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:17:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:17:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:18:00 UTC)" executed successfully
2025-06-16 21:17:42,591 - __main__ - INFO - Received webhook request: {"update_id":441382848,
"message":{"message_id":490,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108662,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:17:42,592 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:17:42,627 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:17:42,627 - aiogram.event - INFO - Update id=441382848 is handled. Duration 35 ms by bot id=7187206991
2025-06-16 21:17:42,628 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:17:42 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:17:42,912 - __main__ - INFO - Received webhook request: {"update_id":441382849,
"message":{"message_id":492,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108662,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:17:42,913 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:17:42,949 - aiogram.event - INFO - Update id=441382849 is handled. Duration 36 ms by bot id=7187206991
2025-06-16 21:17:42,950 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:17:42 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:18:00,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:18:20 UTC)" (scheduled at 2025-06-16 21:18:00+00:00)
2025-06-16 21:18:00,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:18:00,003 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:18:00,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:18:00,004 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:18:00,005 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:18:00,006 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:18:00,006 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:18:20 UTC)" executed successfully
2025-06-16 21:18:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:18:40 UTC)" (scheduled at 2025-06-16 21:18:20+00:00)
2025-06-16 21:18:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:18:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:18:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:18:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:18:20,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:18:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:18:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:18:40 UTC)" executed successfully
2025-06-16 21:18:40,016 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:19:00 UTC)" (scheduled at 2025-06-16 21:18:40+00:00)
2025-06-16 21:18:40,017 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:18:40,019 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:18:40,019 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:18:40,020 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:18:40,021 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:18:40,022 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:18:40,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:19:00 UTC)" executed successfully
2025-06-16 21:19:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:19:20 UTC)" (scheduled at 2025-06-16 21:19:00+00:00)
2025-06-16 21:19:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:19:00,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:19:00,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:19:00,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:19:00,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:19:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:19:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:19:20 UTC)" executed successfully
2025-06-16 21:19:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:19:40 UTC)" (scheduled at 2025-06-16 21:19:20+00:00)
2025-06-16 21:19:20,010 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:19:20,012 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:19:20,012 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:19:20,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:19:20,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:19:20,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:19:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:19:40 UTC)" executed successfully
2025-06-16 21:19:40,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:20:00 UTC)" (scheduled at 2025-06-16 21:19:40+00:00)
2025-06-16 21:19:40,015 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:19:40,016 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:19:40,016 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:19:40,017 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:19:40,018 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:19:40,019 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:19:40,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:20:00 UTC)" executed successfully
2025-06-16 21:20:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:20:20 UTC)" (scheduled at 2025-06-16 21:20:00+00:00)
2025-06-16 21:20:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:20:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:20:00,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:20:00,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:20:00,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:20:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:20:00,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:20:20 UTC)" executed successfully
2025-06-16 21:20:05,972 - __main__ - INFO - Bot stopped by user
2025-06-16 21:20:10,984 - __main__ - INFO - Starting bot...
2025-06-16 21:20:10,984 - __main__ - INFO - Routers and middleware included
2025-06-16 21:20:10,984 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:20:10,985 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:20:10,985 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:20:11,025 - __main__ - INFO - Webhook set successfully
2025-06-16 21:20:11,026 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:20:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:20:40 UTC)" (scheduled at 2025-06-16 21:20:20+00:00)
2025-06-16 21:20:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:20:20,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:20:20,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:20:20,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:20:20,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:20:20,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:20:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:20:40 UTC)" executed successfully
2025-06-16 21:20:33,842 - __main__ - INFO - Received webhook request: {"update_id":441382850,
"message":{"message_id":494,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108833,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:20:33,843 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:20:33,919 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:20:33,919 - aiogram.event - INFO - Update id=441382850 is handled. Duration 76 ms by bot id=7187206991
2025-06-16 21:20:33,920 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:20:33 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:20:34,205 - __main__ - INFO - Received webhook request: {"update_id":441382851,
"message":{"message_id":496,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750108834,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:20:34,206 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:20:34,249 - aiogram.event - INFO - Update id=441382851 is handled. Duration 44 ms by bot id=7187206991
2025-06-16 21:20:34,251 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:20:34 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:20:40,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:21:00 UTC)" (scheduled at 2025-06-16 21:20:40+00:00)
2025-06-16 21:20:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:20:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:20:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:20:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:20:40,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:20:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:20:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:21:00 UTC)" executed successfully
2025-06-16 21:21:00,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:21:20 UTC)" (scheduled at 2025-06-16 21:21:00+00:00)
2025-06-16 21:21:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:21:00,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:21:00,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:21:00,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:21:00,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:21:00,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:21:00,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:21:20 UTC)" executed successfully
2025-06-16 21:21:20,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:21:40 UTC)" (scheduled at 2025-06-16 21:21:20+00:00)
2025-06-16 21:21:20,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:21:20,017 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:21:20,017 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:21:20,018 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:21:20,018 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:21:20,019 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:21:20,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:21:40 UTC)" executed successfully
2025-06-16 21:21:40,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:22:00 UTC)" (scheduled at 2025-06-16 21:21:40+00:00)
2025-06-16 21:21:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:21:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:21:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:21:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:21:40,006 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:21:40,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:21:40,007 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:22:00 UTC)" executed successfully
2025-06-16 21:22:00,022 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:22:20 UTC)" (scheduled at 2025-06-16 21:22:00+00:00)
2025-06-16 21:22:00,023 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:22:00,025 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:22:00,025 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:22:00,027 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:22:00,027 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:22:00,028 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:22:00,028 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:22:20 UTC)" executed successfully
2025-06-16 21:22:20,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:22:40 UTC)" (scheduled at 2025-06-16 21:22:20+00:00)
2025-06-16 21:22:20,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:22:20,017 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:22:20,017 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:22:20,017 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:22:20,018 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:22:20,019 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:22:20,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:22:40 UTC)" executed successfully
2025-06-16 21:22:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:23:00 UTC)" (scheduled at 2025-06-16 21:22:40+00:00)
2025-06-16 21:22:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:22:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:22:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:22:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:22:40,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:22:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:22:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:23:00 UTC)" executed successfully
2025-06-16 21:23:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:23:20 UTC)" (scheduled at 2025-06-16 21:23:00+00:00)
2025-06-16 21:23:00,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:23:00,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:23:00,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:23:00,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:23:00,015 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:23:00,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:23:00,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:23:20 UTC)" executed successfully
2025-06-16 21:23:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:23:40 UTC)" (scheduled at 2025-06-16 21:23:20+00:00)
2025-06-16 21:23:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:23:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:23:20,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:23:20,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:23:20,025 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:23:20,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:23:20,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:23:40 UTC)" executed successfully
2025-06-16 21:23:40,022 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:24:00 UTC)" (scheduled at 2025-06-16 21:23:40+00:00)
2025-06-16 21:23:40,023 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:23:40,024 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:23:40,024 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:23:40,025 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:23:40,026 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:23:40,027 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:23:40,027 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:24:00 UTC)" executed successfully
2025-06-16 21:24:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:24:20 UTC)" (scheduled at 2025-06-16 21:24:00+00:00)
2025-06-16 21:24:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:24:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:24:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:24:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:24:00,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:24:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:24:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:24:20 UTC)" executed successfully
2025-06-16 21:24:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:24:40 UTC)" (scheduled at 2025-06-16 21:24:20+00:00)
2025-06-16 21:24:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:24:20,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:24:20,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:24:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:24:20,007 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:24:20,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:24:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:24:40 UTC)" executed successfully
2025-06-16 21:24:40,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:25:00 UTC)" (scheduled at 2025-06-16 21:24:40+00:00)
2025-06-16 21:24:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:24:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:24:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:24:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:24:40,015 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:24:40,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:24:40,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:25:00 UTC)" executed successfully
2025-06-16 21:25:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:25:20 UTC)" (scheduled at 2025-06-16 21:25:00+00:00)
2025-06-16 21:25:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:25:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:25:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:25:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:25:00,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:25:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:25:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:25:20 UTC)" executed successfully
2025-06-16 21:25:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:25:40 UTC)" (scheduled at 2025-06-16 21:25:20+00:00)
2025-06-16 21:25:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:25:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:25:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:25:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:25:20,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:25:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:25:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:25:40 UTC)" executed successfully
2025-06-16 21:25:40,010 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:26:00 UTC)" (scheduled at 2025-06-16 21:25:40+00:00)
2025-06-16 21:25:40,011 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:25:40,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:25:40,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:25:40,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:25:40,017 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:25:40,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:25:40,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:26:00 UTC)" executed successfully
2025-06-16 21:26:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:26:20 UTC)" (scheduled at 2025-06-16 21:26:00+00:00)
2025-06-16 21:26:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:26:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:26:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:26:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:26:00,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:26:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:26:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:26:20 UTC)" executed successfully
2025-06-16 21:26:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:26:40 UTC)" (scheduled at 2025-06-16 21:26:20+00:00)
2025-06-16 21:26:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:26:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:26:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:26:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:26:20,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:26:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:26:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:26:40 UTC)" executed successfully
2025-06-16 21:26:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:27:00 UTC)" (scheduled at 2025-06-16 21:26:40+00:00)
2025-06-16 21:26:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:26:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:26:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:26:40,021 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:26:40,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:26:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:26:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:27:00 UTC)" executed successfully
2025-06-16 21:27:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:27:20 UTC)" (scheduled at 2025-06-16 21:27:00+00:00)
2025-06-16 21:27:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:27:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:27:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:27:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:27:00,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:27:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:27:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:27:20 UTC)" executed successfully
2025-06-16 21:27:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:27:40 UTC)" (scheduled at 2025-06-16 21:27:20+00:00)
2025-06-16 21:27:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:27:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:27:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:27:20,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:27:20,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:27:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:27:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:27:40 UTC)" executed successfully
2025-06-16 21:27:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:28:00 UTC)" (scheduled at 2025-06-16 21:27:40+00:00)
2025-06-16 21:27:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:27:40,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:27:40,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:27:40,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:27:40,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:27:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:27:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:28:00 UTC)" executed successfully
2025-06-16 21:28:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:28:20 UTC)" (scheduled at 2025-06-16 21:28:00+00:00)
2025-06-16 21:28:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:28:00,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:28:00,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:28:00,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:28:00,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:28:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:28:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:28:20 UTC)" executed successfully
2025-06-16 21:28:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:28:40 UTC)" (scheduled at 2025-06-16 21:28:20+00:00)
2025-06-16 21:28:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:28:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:28:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:28:20,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:28:20,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:28:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:28:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:28:40 UTC)" executed successfully
2025-06-16 21:28:23,512 - __main__ - INFO - Bot stopped by user
2025-06-16 21:28:28,447 - __main__ - INFO - Starting bot...
2025-06-16 21:28:28,448 - __main__ - INFO - Routers and middleware included
2025-06-16 21:28:28,448 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:28:28,449 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:28:28,449 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:28:28,474 - __main__ - INFO - Webhook set successfully
2025-06-16 21:28:28,475 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:28:35,210 - __main__ - INFO - Received webhook request: {"update_id":441382852,
"message":{"message_id":498,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109315,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:28:35,211 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:28:35,416 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:28:35,416 - aiogram.event - INFO - Update id=441382852 is handled. Duration 205 ms by bot id=7187206991
2025-06-16 21:28:35,418 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:28:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:28:35,743 - __main__ - INFO - Received webhook request: {"update_id":441382853,
"message":{"message_id":500,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109315,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:28:35,744 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:28:35,789 - aiogram.event - INFO - Update id=441382853 is handled. Duration 45 ms by bot id=7187206991
2025-06-16 21:28:35,790 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:28:35 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:28:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:29:00 UTC)" (scheduled at 2025-06-16 21:28:40+00:00)
2025-06-16 21:28:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:28:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:28:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:28:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:28:40,016 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:28:40,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:28:40,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:29:00 UTC)" executed successfully
2025-06-16 21:29:00,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:29:20 UTC)" (scheduled at 2025-06-16 21:29:00+00:00)
2025-06-16 21:29:00,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:29:00,002 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:29:00,002 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:29:00,003 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:29:00,004 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:29:00,004 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:29:00,004 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:29:20 UTC)" executed successfully
2025-06-16 21:29:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:29:40 UTC)" (scheduled at 2025-06-16 21:29:20+00:00)
2025-06-16 21:29:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:29:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:29:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:29:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:29:20,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:29:20,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:29:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:29:40 UTC)" executed successfully
2025-06-16 21:29:40,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:30:00 UTC)" (scheduled at 2025-06-16 21:29:40+00:00)
2025-06-16 21:29:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:29:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:29:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:29:40,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:29:40,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:29:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:29:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:30:00 UTC)" executed successfully
2025-06-16 21:30:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:30:20 UTC)" (scheduled at 2025-06-16 21:30:00+00:00)
2025-06-16 21:30:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:30:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:30:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:30:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:30:00,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:30:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:30:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:30:20 UTC)" executed successfully
2025-06-16 21:30:20,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:30:40 UTC)" (scheduled at 2025-06-16 21:30:20+00:00)
2025-06-16 21:30:20,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:30:20,015 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:30:20,015 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:30:20,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:30:20,017 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:30:20,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:30:20,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:30:40 UTC)" executed successfully
2025-06-16 21:30:40,017 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:31:00 UTC)" (scheduled at 2025-06-16 21:30:40+00:00)
2025-06-16 21:30:40,018 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:30:40,019 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:30:40,019 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:30:40,020 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:30:40,021 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:30:40,021 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:30:40,022 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:31:00 UTC)" executed successfully
2025-06-16 21:31:00,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:31:20 UTC)" (scheduled at 2025-06-16 21:31:00+00:00)
2025-06-16 21:31:00,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:31:00,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:31:00,023 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:31:00,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:31:00,025 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:31:00,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:31:00,026 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:31:20 UTC)" executed successfully
2025-06-16 21:31:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:31:40 UTC)" (scheduled at 2025-06-16 21:31:20+00:00)
2025-06-16 21:31:20,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:31:20,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:31:20,011 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:31:20,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:31:20,013 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:31:20,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:31:20,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:31:40 UTC)" executed successfully
2025-06-16 21:31:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:32:00 UTC)" (scheduled at 2025-06-16 21:31:40+00:00)
2025-06-16 21:31:40,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:31:40,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:31:40,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:31:40,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:31:40,008 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:31:40,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:31:40,009 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:32:00 UTC)" executed successfully
2025-06-16 21:32:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:32:20 UTC)" (scheduled at 2025-06-16 21:32:00+00:00)
2025-06-16 21:32:00,019 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:32:00,020 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:32:00,020 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:32:00,021 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:32:00,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:32:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:32:00,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:32:20 UTC)" executed successfully
2025-06-16 21:32:20,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:32:40 UTC)" (scheduled at 2025-06-16 21:32:20+00:00)
2025-06-16 21:32:20,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:32:20,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:32:20,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:32:20,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:32:20,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:32:20,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:32:20,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:32:40 UTC)" executed successfully
2025-06-16 21:32:27,901 - __main__ - INFO - Bot stopped by user
2025-06-16 21:32:32,890 - __main__ - INFO - Starting bot...
2025-06-16 21:32:32,890 - __main__ - INFO - Routers and middleware included
2025-06-16 21:32:32,890 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:32:32,891 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:32:32,891 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:32:32,908 - __main__ - INFO - Webhook set successfully
2025-06-16 21:32:32,909 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:32:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:33:00 UTC)" (scheduled at 2025-06-16 21:32:40+00:00)
2025-06-16 21:32:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:32:40,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:32:40,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:32:40,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:32:40,017 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:32:40,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:32:40,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:33:00 UTC)" executed successfully
2025-06-16 21:32:40,385 - __main__ - INFO - Received webhook request: {"update_id":441382854,
"message":{"message_id":502,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109560,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:32:40,387 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:32:40,638 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:32:40,639 - aiogram.event - INFO - Update id=441382854 is handled. Duration 252 ms by bot id=7187206991
2025-06-16 21:32:40,639 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:32:40 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:32:40,982 - __main__ - INFO - Received webhook request: {"update_id":441382855,
"message":{"message_id":504,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109560,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:32:40,983 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:32:41,021 - bot.handlers.start - INFO - Sent support message to user 450966825
2025-06-16 21:32:41,021 - aiogram.event - INFO - Update id=441382855 is handled. Duration 38 ms by bot id=7187206991
2025-06-16 21:32:41,024 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:32:40 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:33:00,013 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:33:20 UTC)" (scheduled at 2025-06-16 21:33:00+00:00)
2025-06-16 21:33:00,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:33:00,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:33:00,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:33:00,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:33:00,016 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:33:00,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:33:00,016 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:33:20 UTC)" executed successfully
2025-06-16 21:33:20,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:33:40 UTC)" (scheduled at 2025-06-16 21:33:20+00:00)
2025-06-16 21:33:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:33:20,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:33:20,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:33:20,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:33:20,012 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:33:20,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:33:20,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:33:40 UTC)" executed successfully
2025-06-16 21:33:40,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:34:00 UTC)" (scheduled at 2025-06-16 21:33:40+00:00)
2025-06-16 21:33:40,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:33:40,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:33:40,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:33:40,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:33:40,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:33:40,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:33:40,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:34:00 UTC)" executed successfully
2025-06-16 21:34:00,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:34:20 UTC)" (scheduled at 2025-06-16 21:34:00+00:00)
2025-06-16 21:34:00,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:34:00,011 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:34:00,011 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:34:00,013 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:34:00,014 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:34:00,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:34:00,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:34:20 UTC)" executed successfully
2025-06-16 21:34:20,009 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:34:40 UTC)" (scheduled at 2025-06-16 21:34:20+00:00)
2025-06-16 21:34:20,009 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:34:20,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:34:20,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:34:20,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:34:20,012 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:34:20,013 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:34:20,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:34:40 UTC)" executed successfully
2025-06-16 21:34:30,650 - __main__ - INFO - Bot stopped by user
2025-06-16 21:34:35,753 - __main__ - INFO - Starting bot...
2025-06-16 21:34:35,753 - __main__ - INFO - Routers and middleware included
2025-06-16 21:34:35,771 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:34:35,771 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:34:35,772 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:34:35,821 - __main__ - INFO - Webhook set successfully
2025-06-16 21:34:35,822 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:34:40,005 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:35:00 UTC)" (scheduled at 2025-06-16 21:34:40+00:00)
2025-06-16 21:34:40,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:34:40,007 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:34:40,007 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:34:40,012 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:34:40,013 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:34:40,014 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:34:40,014 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:35:00 UTC)" executed successfully
2025-06-16 21:34:43,968 - __main__ - INFO - Received webhook request: {"update_id":441382856,
"message":{"message_id":506,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109683,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:34:43,970 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:34:44,031 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:34:44,145 - bot.handlers.start - INFO - Sent support message to user 450966825
2025-06-16 21:34:44,146 - aiogram.event - INFO - Update id=441382856 is handled. Duration 176 ms by bot id=7187206991
2025-06-16 21:34:44,146 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:34:43 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:34:44,411 - __main__ - INFO - Received webhook request: {"update_id":441382857,
"message":{"message_id":509,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109684,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:34:44,412 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:34:44,459 - bot.handlers.start - INFO - Sent support message to user 450966825
2025-06-16 21:34:44,460 - aiogram.event - INFO - Update id=441382857 is handled. Duration 48 ms by bot id=7187206991
2025-06-16 21:34:44,460 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:34:44 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:35:00,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:35:20 UTC)" (scheduled at 2025-06-16 21:35:00+00:00)
2025-06-16 21:35:00,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:35:00,010 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:35:00,010 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:35:00,011 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:35:00,012 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:35:00,013 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:35:00,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:35:20 UTC)" executed successfully
2025-06-16 21:35:10,473 - __main__ - INFO - Bot stopped by user
2025-06-16 21:35:16,378 - __main__ - INFO - Starting bot...
2025-06-16 21:35:16,378 - __main__ - INFO - Routers and middleware included
2025-06-16 21:35:16,379 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:35:16,379 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:35:16,380 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:35:16,402 - __main__ - INFO - Webhook set successfully
2025-06-16 21:35:16,403 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:35:18,063 - __main__ - INFO - Received webhook request: {"update_id":441382858,
"message":{"message_id":511,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109718,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:35:18,064 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:35:18,111 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:35:18,288 - aiogram.event - INFO - Update id=441382858 is handled. Duration 224 ms by bot id=7187206991
2025-06-16 21:35:18,288 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:35:18 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:35:18,453 - __main__ - INFO - Received webhook request: {"update_id":441382859,
"message":{"message_id":513,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109718,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:35:18,454 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:35:18,583 - bot.handlers.start - INFO - Sent support message to user 450966825
2025-06-16 21:35:18,583 - aiogram.event - INFO - Update id=441382859 is handled. Duration 129 ms by bot id=7187206991
2025-06-16 21:35:18,583 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:35:18 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:35:20,002 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:35:40 UTC)" (scheduled at 2025-06-16 21:35:20+00:00)
2025-06-16 21:35:20,002 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:35:20,004 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:35:20,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:35:20,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:35:20,007 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:35:20,007 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:35:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:35:40 UTC)" executed successfully
2025-06-16 21:35:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:36:00 UTC)" (scheduled at 2025-06-16 21:35:40+00:00)
2025-06-16 21:35:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:35:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:35:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:35:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:35:40,011 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:35:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:35:40,012 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:36:00 UTC)" executed successfully
2025-06-16 21:36:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:36:20 UTC)" (scheduled at 2025-06-16 21:36:00+00:00)
2025-06-16 21:36:00,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:36:00,014 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:36:00,014 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:36:00,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:36:00,016 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:36:00,016 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:36:00,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:36:20 UTC)" executed successfully
2025-06-16 21:36:19,138 - __main__ - INFO - Bot stopped by user
2025-06-16 21:36:50,464 - __main__ - INFO - Starting bot...
2025-06-16 21:36:50,464 - __main__ - INFO - Routers and middleware included
2025-06-16 21:36:50,464 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:36:50,465 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:36:50,465 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:36:50,505 - __main__ - INFO - Webhook set successfully
2025-06-16 21:36:50,506 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:36:52,121 - __main__ - INFO - Received webhook request: {"update_id":441382861,
"message":{"message_id":516,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109812,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:36:52,123 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:36:52,189 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:36:52,354 - aiogram.event - INFO - Update id=441382861 is handled. Duration 232 ms by bot id=7187206991
2025-06-16 21:36:52,355 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:36:52 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:36:52,401 - __main__ - INFO - Received webhook request: {"update_id":441382862,
"message":{"message_id":518,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109812,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:36:52,402 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:36:52,456 - bot.handlers.start - INFO - Sent support message to user 450966825
2025-06-16 21:36:52,456 - aiogram.event - INFO - Update id=441382862 is handled. Duration 54 ms by bot id=7187206991
2025-06-16 21:36:52,457 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:36:52 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:36:54,032 - aiohttp.access - INFO - 147.185.132.108 [16/Jun/2025:21:36:54 +0000] "UNKNOWN / HTTP/1.0" 400 227 "-" "-"
2025-06-16 21:36:54,220 - aiohttp.access - INFO - 147.185.132.108 [16/Jun/2025:21:36:54 +0000] "UNKNOWN / HTTP/1.0" 400 215 "-" "-"
2025-06-16 21:37:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:37:20 UTC)" (scheduled at 2025-06-16 21:37:00+00:00)
2025-06-16 21:37:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:37:00,007 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:37:00,008 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:37:00,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:37:00,011 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:37:00,012 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:37:00,013 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:37:20 UTC)" executed successfully
2025-06-16 21:37:20,011 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:37:40 UTC)" (scheduled at 2025-06-16 21:37:20+00:00)
2025-06-16 21:37:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:37:20,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:37:20,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:37:20,014 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:37:20,015 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:37:20,015 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:37:20,015 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:37:40 UTC)" executed successfully
2025-06-16 21:37:29,833 - __main__ - INFO - Received webhook request: {"update_id":441382863,
"message":{"message_id":520,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750109849,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:37:29,835 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:37:30,026 - bot.handlers.start - INFO - Sent support message to user 450966825
2025-06-16 21:37:30,026 - aiogram.event - INFO - Update id=441382863 is handled. Duration 191 ms by bot id=7187206991
2025-06-16 21:37:30,027 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:37:29 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:37:40,008 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:38:00 UTC)" (scheduled at 2025-06-16 21:37:40+00:00)
2025-06-16 21:37:40,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:37:40,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:37:40,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:37:40,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:37:40,010 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:37:40,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:37:40,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:38:00 UTC)" executed successfully
2025-06-16 21:38:00,015 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:38:20 UTC)" (scheduled at 2025-06-16 21:38:00+00:00)
2025-06-16 21:38:00,016 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:38:00,017 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:38:00,017 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:38:00,018 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:38:00,018 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:38:00,019 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:38:00,019 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:38:20 UTC)" executed successfully
2025-06-16 21:38:20,007 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:38:40 UTC)" (scheduled at 2025-06-16 21:38:20+00:00)
2025-06-16 21:38:20,008 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:38:20,009 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:38:20,009 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:38:20,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:38:20,010 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:38:20,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:38:20,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:38:40 UTC)" executed successfully
2025-06-16 21:38:40,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:39:00 UTC)" (scheduled at 2025-06-16 21:38:40+00:00)
2025-06-16 21:38:40,005 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:38:40,007 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:38:40,007 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:38:40,008 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:38:40,009 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:38:40,009 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:38:40,010 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:39:00 UTC)" executed successfully
2025-06-16 21:39:00,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:39:20 UTC)" (scheduled at 2025-06-16 21:39:00+00:00)
2025-06-16 21:39:00,013 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:39:00,015 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:39:00,015 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:39:00,016 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:39:00,017 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:39:00,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:39:00,018 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:39:20 UTC)" executed successfully
2025-06-16 21:39:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:39:40 UTC)" (scheduled at 2025-06-16 21:39:20+00:00)
2025-06-16 21:39:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:39:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:39:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:39:20,024 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:39:20,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:39:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:39:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:39:40 UTC)" executed successfully
2025-06-16 21:39:40,003 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:40:00 UTC)" (scheduled at 2025-06-16 21:39:40+00:00)
2025-06-16 21:39:40,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:39:40,005 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:39:40,005 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:39:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:39:40,007 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:39:40,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:39:40,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:40:00 UTC)" executed successfully
2025-06-16 21:40:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:40:20 UTC)" (scheduled at 2025-06-16 21:40:00+00:00)
2025-06-16 21:40:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:40:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:40:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:40:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:40:00,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:40:00,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:40:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:40:20 UTC)" executed successfully
2025-06-16 21:40:20,012 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:40:40 UTC)" (scheduled at 2025-06-16 21:40:20+00:00)
2025-06-16 21:40:20,012 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:40:20,013 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:40:20,013 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:40:20,015 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:40:20,016 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:40:20,017 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:40:20,017 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:40:40 UTC)" executed successfully
2025-06-16 21:40:40,021 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:41:00 UTC)" (scheduled at 2025-06-16 21:40:40+00:00)
2025-06-16 21:40:40,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:40:40,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:40:40,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:40:40,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:40:40,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:40:40,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:40:40,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:41:00 UTC)" executed successfully
2025-06-16 21:41:00,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:41:20 UTC)" (scheduled at 2025-06-16 21:41:00+00:00)
2025-06-16 21:41:00,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:41:00,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:41:00,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:41:00,022 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:41:00,023 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:41:00,024 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:41:00,024 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:41:20 UTC)" executed successfully
2025-06-16 21:41:20,020 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:41:40 UTC)" (scheduled at 2025-06-16 21:41:20+00:00)
2025-06-16 21:41:20,021 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:41:20,022 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:41:20,022 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:41:20,023 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:41:20,024 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:41:20,025 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:41:20,025 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:41:40 UTC)" executed successfully
2025-06-16 21:41:40,019 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:42:00 UTC)" (scheduled at 2025-06-16 21:41:40+00:00)
2025-06-16 21:41:40,020 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:41:40,021 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:41:40,021 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:41:40,021 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:41:40,022 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:41:40,023 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:41:40,023 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:42:00 UTC)" executed successfully
2025-06-16 21:41:53,319 - __main__ - INFO - Bot stopped by user
2025-06-16 21:41:58,085 - __main__ - INFO - Starting bot...
2025-06-16 21:41:58,085 - __main__ - INFO - Routers and middleware included
2025-06-16 21:41:58,085 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:41:58,086 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:41:58,086 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:41:58,111 - __main__ - INFO - Webhook set successfully
2025-06-16 21:41:58,112 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:42:00,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:42:20 UTC)" (scheduled at 2025-06-16 21:42:00+00:00)
2025-06-16 21:42:00,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:42:00,007 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:42:00,007 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:42:00,010 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:42:00,010 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:42:00,011 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:42:00,011 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:42:20 UTC)" executed successfully
2025-06-16 21:42:20,004 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:42:40 UTC)" (scheduled at 2025-06-16 21:42:20+00:00)
2025-06-16 21:42:20,004 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:42:20,006 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:42:20,006 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:42:20,007 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:42:20,007 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:42:20,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:42:20,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:42:40 UTC)" executed successfully
2025-06-16 21:42:20,058 - __main__ - INFO - Bot stopped by user
2025-06-16 21:42:20,168 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7f440dc84210>
2025-06-16 21:42:24,489 - __main__ - INFO - Starting bot...
2025-06-16 21:42:24,489 - __main__ - INFO - Routers and middleware included
2025-06-16 21:42:24,489 - apscheduler.scheduler - INFO - Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-06-16 21:42:24,490 - apscheduler.scheduler - INFO - Added job "check_subscriptions" to job store "default"
2025-06-16 21:42:24,490 - apscheduler.scheduler - INFO - Scheduler started
2025-06-16 21:42:24,507 - __main__ - INFO - Webhook set successfully
2025-06-16 21:42:24,508 - __main__ - INFO - Web server started on port 8443
2025-06-16 21:42:31,065 - __main__ - INFO - Received webhook request: {"update_id":441382864,
"message":{"message_id":522,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750110151,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:42:31,066 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:42:31,156 - bot.handlers.start - INFO - Sent welcome message to user 450966825
2025-06-16 21:42:31,157 - aiogram.event - INFO - Update id=441382864 is handled. Duration 90 ms by bot id=7187206991
2025-06-16 21:42:31,157 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:42:31 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:42:36,274 - __main__ - INFO - Received webhook request: {"update_id":441382865,
"message":{"message_id":524,"from":{"id":450966825,"is_bot":false,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","language_code":"ru","is_premium":true},"chat":{"id":450966825,"first_name":"Arseniy","last_name":"Pototskiy","username":"arsik905","type":"private"},"date":1750110156,"text":"/start","entities":[{"offset":0,"length":6,"type":"bot_command"}]}}
2025-06-16 21:42:36,276 - bot.handlers.start - INFO - Processing /start for user 450966825
2025-06-16 21:42:36,330 - bot.handlers.start - INFO - Sent support message to user 450966825
2025-06-16 21:42:36,330 - aiogram.event - INFO - Update id=441382865 is handled. Duration 55 ms by bot id=7187206991
2025-06-16 21:42:36,331 - aiohttp.access - INFO - 127.0.0.1 [16/Jun/2025:21:42:36 +0000] "POST /7187206991:AAHFx9CHsPTdhw_0c_GYuigWGL-ubOQlvs8 HTTP/1.1" 200 155 "-" "-"
2025-06-16 21:42:40,001 - apscheduler.executors.default - INFO - Running job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:43:00 UTC)" (scheduled at 2025-06-16 21:42:40+00:00)
2025-06-16 21:42:40,001 - scheduler - INFO - 🔄 Checking subscriptions
2025-06-16 21:42:40,003 - dao.user_dao - INFO - Retrieved 3 users
2025-06-16 21:42:40,004 - scheduler - INFO - Retrieved 3 users
2025-06-16 21:42:40,006 - scheduler - INFO - Skipping user 435204858: subscription valid until 2026-06-16
2025-06-16 21:42:40,007 - scheduler - INFO - Skipping user 450966825: subscription valid until 2026-06-16
2025-06-16 21:42:40,008 - scheduler - INFO - Skipping user 1013170672: subscription valid until 2026-06-16
2025-06-16 21:42:40,008 - apscheduler.executors.default - INFO - Job "check_subscriptions (trigger: cron[second='*/20'], next run at: 2025-06-16 21:43:00 UTC)" executed successfully
2025-06-16 21:42:40,291 - __main__ - INFO - Bot stopped by user
